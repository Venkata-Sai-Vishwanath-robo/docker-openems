import{a as pe}from"./chunk-2OZBANFK.js";import{f as de}from"./chunk-GYAINRZU.js";import"./chunk-V6SQQYN5.js";import{Ca as O,Da as m,E as C,Ea as p,F as b,Gc as B,Gd as ee,Hd as te,Hf as me,Kd as ie,Lc as V,Ld as ne,Ma as D,Me as ae,Nc as z,Oc as q,Pd as oe,Qa as c,R as M,Ra as U,Sa as u,Sd as se,V as s,Va as L,Wa as f,Wf as ue,Xa as y,Xe as ce,Yc as j,Zc as H,ad as X,ba as g,c as _,cd as J,da as N,dd as K,dg as ge,ee as re,ge as le,jb as w,jc as P,jd as Q,kb as T,ld as Y,m as G,mg as he,o as x,oa as R,pc as F,qa as A,qd as Z,sa as E,ta as S,td as $,u as k,ua as v,va as d,wa as l,xa as a,xc as W,ya as I}from"./chunk-UEHZAF3Y.js";import"./chunk-TCWA4BEU.js";import"./chunk-HJTVDRW6.js";import"./chunk-YJIFWFWF.js";import"./chunk-QUJFQN2Y.js";import"./chunk-P3LHHAYW.js";import"./chunk-Y7WT5TFP.js";import"./chunk-JHMH7CMQ.js";import"./chunk-WVHTM5RI.js";import"./chunk-IN6HLDFE.js";import"./chunk-GIMG75PD.js";import"./chunk-IHO4TDRD.js";import"./chunk-4KCIDQZU.js";import"./chunk-7UI6JPU6.js";import"./chunk-J5AVGG2P.js";import"./chunk-VIYDSDQU.js";import"./chunk-F46NF3P5.js";import"./chunk-SAL3DLJT.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EOGXKGKT.js";import"./chunk-CKP3SGE2.js";import"./chunk-RY6RMDSE.js";import"./chunk-OQDXQ3X5.js";function _e(n,h){if(n&1){let e=O();l(0,"ion-col")(1,"ion-item",6)(2,"ion-toggle",13),m("ionChange",function(t){C(e);let o=p();return b(o.toggleCondensedOutput(t))}),y("ngModelChange",function(t){C(e);let o=p();return f(o.isCondensedOutput,t)||(o.isCondensedOutput=t),b(t)}),a(),l(3,"ion-label",14),c(4),w(5,"translate"),a()()()}if(n&2){let e=p();s(2),L("ngModel",e.isCondensedOutput),s(2),U(T(5,2,"EDGE.CONFIG.LOG.CONDENSED_OUTPUT"))}}function Ce(n,h){if(n&1){let e=O();l(0,"ion-select-option",15),m("keydown.enter",function(t){C(e);let o=p();return b(o.searchOnChange(t))}),c(1),a()}if(n&2){let e=h.$implicit;d("value",e.value),s(),u("",e.name," ")}}function be(n,h){if(n&1&&(l(0,"ion-grid",12)(1,"ion-row",16)(2,"ion-col",17),c(3),a(),l(4,"ion-col",18),c(5),a(),l(6,"ion-col",19),c(7),a()(),l(8,"ion-row",20)(9,"ion-col",0),I(10,"ion-text",21),a()()()),n&2){let e=h.$implicit;s(3),u(" ",e.time," "),s(2),u(" ",e.level," "),s(2),u(" ",e.source," "),s(),D("color",e.color),s(2),d("innerHTML",e.message,M)}}var Le=n=>({placeholder:n.instant("EDGE.CONFIG.LOG.LEVEL"),category:"level",options:[{name:"Debug",value:"DEBUG"},{name:n.instant("GENERAL.INFO"),value:"INFO"},{name:n.instant("GENERAL.WARNING"),value:"WARN"},{name:n.instant("GENERAL.FAULT"),value:"ERROR"}]}),Re=(()=>{class n{static{this.SELECTOR="systemLog"}static{this.DEBUG_LOG_CONTROLLER_ID="ctrlDebugLog0"}constructor(e,i,t,o){this.utils=e,this.websocket=i,this.service=t,this.translate=o,this.isSubscribed=!1,this.logLines=[],this.query=null,this.filters=Le(this.translate),this.isCondensedOutput=null,this.isAtLeastGuest=!1,this.ngUnsubscribe=new _,this.searchParams=null,this.MAX_LOG_ENTRIES=200,this._logLines=[]}subscribe(){this.logLines.length>0&&this.logLines.unshift({time:"-------------------",level:"----",color:"black",message:"",source:""}),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=new _,this.service.getCurrentEdge().then(e=>{e.subscribeSystemLog(this.websocket),e.systemLog.pipe(k(this.ngUnsubscribe)).subscribe(i=>{this._logLines.unshift({time:ae(i.time,"yyyy-MM-dd'T'HH:mm:ss.SSSxxx",new Date).toLocaleString(),color:this.getColor(i.level),level:i.level,source:i.source,message:i.message.replace(/\n/g,"</br>")}),this.filterLogs(),this._logLines.length>this.MAX_LOG_ENTRIES&&(this._logLines.length=this.MAX_LOG_ENTRIES)})}),this.isSubscribed=!0}ngOnInit(){this.subscribe(),this.service.getCurrentEdge().then(e=>{this.isAtLeastGuest=!e.roleIsAtLeast(me.OWNER),e.getConfig(this.websocket).pipe(G(i=>!!i),x(1)).subscribe(i=>{let t=i.getComponent(n.DEBUG_LOG_CONTROLLER_ID);t||(this.isCondensedOutput=null),t.properties?.condensedOutput!=null&&(this.isCondensedOutput=t.properties?.condensedOutput)})})}ngOnDestroy(){this.unsubscribe()}toggleSubscribe(e){e.detail.checked?this.subscribe():this.unsubscribe()}unsubscribe(){this.service.getCurrentEdge().then(e=>{e.unsubscribeSystemLog(this.websocket)}),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.ngUnsubscribe=new _}toggleCondensedOutput(e){this.service.getCurrentEdge().then(i=>i.updateComponentConfig(this.websocket,n.DEBUG_LOG_CONTROLLER_ID,[{name:"condensedOutput",value:e.detail.checked}]).then(()=>{this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(t=>{this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+t.error.message,"danger")}))}searchOnChange(e){e&&(this.searchParams=e?.target?.value??null),this.filterLogs()}getColor(e){switch(e){case"INFO":return"green";case"WARN":return"orange";case"DEBUG":return"gray";case"ERROR":return"red"}}filterLogs(){if(this.query===null&&this.searchParams===null){this.logLines=this._logLines;return}this.logLines=this._logLines.filter(e=>this.searchParams!=null&&this.searchParams?.length>0?this.searchParams?.includes(e.level):!0).reduce((e,i)=>{if(this.query==null||!this.query.length)return this._logLines;let t=i.message.split("</br>").filter(o=>o.toLowerCase().includes(this.query.toLowerCase())).join("</br>");return t?.length>0&&(i.message=t,e.push(i)),e},[])}static{this.\u0275fac=function(i){return new(i||n)(g(ce),g(ge),g(ue),g(re))}}static{this.\u0275cmp=N({type:n,selectors:[["systemLog"]],decls:30,vars:8,consts:[["size","12"],["lines","full","color","light"],["slot","start","name","code-working-outline","color","primary"],[1,"ion-no-padding"],["lines","none",3,"keydown.enter","click"],["slot","start",3,"ionChange","ngModelChange","labelPlacement","ngModel"],["lines","none"],["interface","popover","label","Level","fill","outline",1,"custom-ion-popover",2,"white-space","initial",3,"ionDismiss","multiple"],["button","",3,"value"],[1,"ion-justify-content-center"],[2,"--background","var(--ion-color-searchbar-background)","color","var(--ion-color-searchbar-text)",3,"ngModelChange","ionChange","ngModel"],[2,"overflow-x","scroll"],[1,"ion-no-padding",2,"user-select","text"],["tabindex","0","mode","md","slot","start",3,"ionChange","ngModelChange","ngModel"],[1,"ion-text-wrap"],["button","",3,"keydown.enter","value"],["style.color","black",2,"font-family","monospace","font-size","small"],["size-sm","2","size","6"],["size-sm","1","size","6"],["size-sm","auto","size","12"],[2,"font-family","monospace"],[3,"innerHTML"]],template:function(i,t){i&1&&(l(0,"ion-content")(1,"ion-grid")(2,"ion-row")(3,"ion-col",0)(4,"ion-card")(5,"ion-item",1),I(6,"ion-icon",2),l(7,"ion-label"),c(8,"System-Log"),a()(),l(9,"ion-card-content")(10,"ion-grid",3)(11,"ion-row")(12,"ion-col")(13,"ion-item",4),m("keydown.enter",function(r){return t.toggleSubscribe(r)})("click",function(r){return t.toggleSubscribe(r)}),l(14,"ion-checkbox",5),m("ionChange",function(r){return t.toggleSubscribe(r)}),y("ngModelChange",function(r){return f(t.isSubscribed,r)||(t.isSubscribed=r),r}),c(15),w(16,"translate"),a()()(),R(17,_e,6,4,"ion-col"),l(18,"ion-col")(19,"ion-item",6)(20,"ion-select",7),m("ionDismiss",function(r){return t.searchOnChange(r)}),S(21,Ce,2,2,"ion-select-option",8,E),a()()()()(),l(23,"ion-grid",3)(24,"ion-row",9)(25,"ion-col")(26,"ion-searchbar",10),y("ngModelChange",function(r){return f(t.query,r)||(t.query=r),r}),m("ionChange",function(){return t.searchOnChange()}),a()()()()(),l(27,"ion-card-content",11),S(28,be,11,6,"ion-grid",12,E),a()()()()()()),i&2&&(s(14),d("labelPlacement","start"),L("ngModel",t.isSubscribed),s(),u(" ",T(16,6,"EDGE.CONFIG.LOG.AUTOMATIC_UPDATING")," "),s(2),A(t.isCondensedOutput!==null&&t.isAtLeastGuest?17:-1),s(3),d("multiple",!0),s(),v(t.filters.options),s(5),L("ngModel",t.query),s(2),v(t.logLines))},dependencies:[he,j,H,X,J,K,Q,Y,Z,$,ee,te,ie,ne,oe,se,V,z,q,pe,de,P,B,F,W,le],encapsulation:2})}}return n})();export{Le as LOG_LEVEL_FILTER,Re as SystemLogComponent};
