import{a as su}from"./chunk-WVXKKERN.js";import{a as pe,b as Vs,c as Qi,d as Ri,e as we,f as qd,g as Vt,h as ro,i as Kd,j as Qd,k as Zd,l as li,m as Nn,n as Hs,o as Sn,p as Mn,q as Ma,r as eu,s as Ac,t as sn,u as Sr,v as nr,w as iu,x as ou,z as Fa}from"./chunk-AHZPXDMV.js";import{a as lu}from"./chunk-3K6WAZNX.js";import{a as Vi,b as nu}from"./chunk-QUO5KERL.js";import{a as da}from"./chunk-MYE774MM.js";import{a as ru}from"./chunk-A6D3LFCM.js";import{a as mt,b as dd,c as Ds,d as si,e as ud,f as $i,g as Xi,h as fd,i as Bt,j as rn}from"./chunk-VQJOV6KK.js";import{a as yd,b as Ei,c as au}from"./chunk-A46VKJRB.js";import{a as kt,b as ci}from"./chunk-NLFVUSHU.js";import{a as Jd,b as Oi}from"./chunk-AE767NUV.js";import{a as jt}from"./chunk-IZM4D5AZ.js";import{a as xn,c as To}from"./chunk-U4AVYC7D.js";import{a as et}from"./chunk-B5TTBQK4.js";import{a as Cd,b as gd,c as Ed,d as ye,e as Ec,f as In,g as tt,h as Ee,i as Ud,j as _n,k as tr,l as $d,m as Ki,n as Xd}from"./chunk-RQWSIHDL.js";import{a as qi}from"./chunk-6SDHATKH.js";import"./chunk-2OZBANFK.js";import{a as Ut,c as zd,e as jd,f as Yd,g as Na}from"./chunk-GYAINRZU.js";import"./chunk-V6SQQYN5.js";import{$ as yp,$b as xs,$d as he,$e as on,$f as Lt,A as $,Aa as z,Ab as Jr,Ac as ot,Ad as vo,Af as Be,Ba as _o,Bb as lt,Bc as As,Bd as Ai,Bf as Ps,C as Jt,Ca as W,Cb as $o,Cc as en,Cd as ia,Cf as Pt,D as Ro,Da as O,Dc as Up,Dd as oa,Df as oo,E as P,Ea as p,Eb as bp,Ed as ws,Ef as de,F as L,Fa as vs,Fb as Dp,Fc as Ft,Fd as ra,Ff as U,G as gt,Ga as ys,Gb as Rp,Gc as Mo,Gd as Se,Gf as Fd,H as Oo,Hb as Et,Hc as st,Hd as od,Hf as Rt,I as Cs,Ia as wn,Ib as Op,Ic as zp,Id as ri,Ie as io,J as Ep,Ja as bn,Jc as Xo,Jd as ai,K as fc,Ka as Dn,Kb as Np,Kc as jp,Kd as jn,La as it,Lb as Mp,Lc as ft,Ld as Yn,Le as vc,Lf as Ci,M as En,Ma as re,Mb as Te,Mc as tn,Md as rd,N as D,Na as fi,Nb as Fp,Nc as $e,Nd as ad,Ne as sa,Nf as bi,O as fo,Oa as Da,Ob as Gp,Oc as Bn,Od as sd,Oe as Id,Of as Gd,Pa as Qr,Pb as Pp,Pc as Yp,Pd as He,Pe as xd,Pf as Qo,Q as _c,Qa as h,Qc as $p,Qd as ld,R as Vn,Ra as N,Rb as Lp,Rc as Xp,Rd as St,Re as Sd,Rf as Pd,S as No,Sa as R,Sb as Tt,Sd as wi,Se as Ad,Sf as Ld,Ta as Ts,Tb as no,Td as ct,Te as yc,Tf as Zo,Ua as Sp,Ub as go,Ud as aa,Ue as Ze,Uf as me,V as r,Va as Kt,Vb as ei,Vd as ji,Vf as gi,W as qr,Wa as Qt,Wb as kp,Wc as Ge,Wd as bs,We as wd,Wf as j,X as hc,Xa as Zt,Xb as Rn,Xc as Xe,Xd as cd,Xe as M,Xf as Jo,Ya as ki,Yb as ti,Yc as Ht,Yd as Yi,Ye as Z,Yf as xc,Z as vp,Za as Ui,Zb as ni,Zc as We,Ze as B,Zf as Vd,_a as Jn,_b as vr,_d as yr,_e as Je,_f as Hd,a as hs,aa as gs,ab as vn,ac as Ra,ad as zt,ae as md,af as Fo,ag as fn,b as ba,ba as x,bb as Cc,bc as ea,be as pd,bf as la,bg as qn,c as qt,ca as Tp,cb as H,cc as Vp,cd as Ae,ce as Ve,cf as dn,cg as pa,d as $r,da as I,db as be,dc as De,dd as je,de as _d,df as Os,dg as Ce,ea as X,eb as at,ec as Hp,ed as zi,ee as te,ef as Tc,eg as y,fa as Wi,fb as _i,fc as It,fd as Wn,fe as Ne,ff as Ns,fg as er,g as Xr,ga as ui,gb as Zr,gc as ii,gd as Un,ge as V,gf as bd,gg as Sc,h as dp,ha as S,hc as ta,hd as qp,he as hd,hf as On,hg as Wd,ia as G,ic as Bp,id as Kp,ie as an,if as Dd,ig as Di,j as up,jb as g,jc as na,jd as Me,jf as Tr,jg as ks,ka as Ip,kb as E,kd as xt,kf as un,kg as xr,l as uc,la as xp,lb as q,lc as Ss,ld as ie,lf as Ms,m as vt,ma as ze,mb as Ap,md as Qp,me as vd,mg as tu,n as fp,na as Es,nb as yt,nc as le,nd as Zp,nf as Rd,o as pn,oa as f,ob as jo,od as Jp,oe as pt,of as Od,p as _p,pb as wp,pc as Ie,pd as nn,qa as _,qb as wt,qc as Ke,qd as J,qe as Ko,qf as Fs,ra as Kr,rb as ln,rd as ed,rf as Nd,s as hp,sa as xe,sc as hi,sd as td,sf as Md,t as Cp,ta as fe,tb as Is,td as ne,tf as Ic,u as An,ua as _e,ub as Si,uc as Wp,ud as zn,uf as Oa,v as gp,va as c,vb as Hn,vc as K,vd as nd,ve as Td,vf as Gs,wa as s,wb as yn,wd as id,we as gc,wf as yo,x as Ct,xa as l,xb as ho,xc as Tn,xd as qo,xf as ca,ya as d,yb as Co,yc as cn,yd as oi,yf as ma,z as xi,za as Y,zb as Yo,zc as Mt,zd as Eo,ze as Rs,zf as Ir}from"./chunk-UEHZAF3Y.js";import{a as Bd}from"./chunk-TCWA4BEU.js";import{a as Ls,b as kd}from"./chunk-HJTVDRW6.js";import"./chunk-YJIFWFWF.js";import"./chunk-QUJFQN2Y.js";import"./chunk-P3LHHAYW.js";import"./chunk-Y7WT5TFP.js";import"./chunk-JHMH7CMQ.js";import"./chunk-WVHTM5RI.js";import"./chunk-IN6HLDFE.js";import"./chunk-GIMG75PD.js";import"./chunk-IHO4TDRD.js";import"./chunk-4KCIDQZU.js";import"./chunk-7UI6JPU6.js";import"./chunk-J5AVGG2P.js";import"./chunk-VIYDSDQU.js";import"./chunk-F46NF3P5.js";import"./chunk-SAL3DLJT.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EOGXKGKT.js";import"./chunk-CKP3SGE2.js";import"./chunk-RY6RMDSE.js";import{a as ke,b as Li,e as pp,f as _s,g as ae}from"./chunk-OQDXQ3X5.js";function cu(t){return new Ct(3e3,!1)}function Z1(){return new Ct(3100,!1)}function J1(){return new Ct(3101,!1)}function eE(t){return new Ct(3001,!1)}function tE(t){return new Ct(3003,!1)}function nE(t){return new Ct(3004,!1)}function pu(t,o){return new Ct(3005,!1)}function du(){return new Ct(3006,!1)}function uu(){return new Ct(3007,!1)}function fu(t,o){return new Ct(3008,!1)}function _u(t){return new Ct(3002,!1)}function hu(t,o,e,n,i){return new Ct(3010,!1)}function Cu(){return new Ct(3011,!1)}function gu(){return new Ct(3012,!1)}function Eu(){return new Ct(3200,!1)}function vu(){return new Ct(3202,!1)}function yu(){return new Ct(3013,!1)}function Tu(t){return new Ct(3014,!1)}function Iu(t){return new Ct(3015,!1)}function xu(t){return new Ct(3016,!1)}function Su(t,o){return new Ct(3404,!1)}function iE(t){return new Ct(3502,!1)}function Au(t){return new Ct(3503,!1)}function wu(){return new Ct(3300,!1)}function bu(t){return new Ct(3504,!1)}function Du(t){return new Ct(3301,!1)}function Ru(t,o){return new Ct(3302,!1)}function Ou(t){return new Ct(3303,!1)}function Nu(t,o){return new Ct(3400,!1)}function Mu(t){return new Ct(3401,!1)}function Fu(t){return new Ct(3402,!1)}function Gu(t,o){return new Ct(3505,!1)}function Go(t){switch(t.length){case 0:return new vr;case 1:return t[0];default:return new xs(t)}}function Rc(t,o,e=new Map,n=new Map){let i=[],a=[],m=-1,u=null;if(o.forEach(C=>{let v=C.get("offset"),T=v==m,A=T&&u||new Map;C.forEach((b,F)=>{let k=F,Q=b;if(F!=="offset")switch(k=t.normalizePropertyName(k,i),Q){case Ra:Q=e.get(F);break;case no:Q=n.get(F);break;default:Q=t.normalizeStyleValue(F,k,Q,i);break}A.set(k,Q)}),T||a.push(A),u=A,m=v}),i.length)throw iE(i);return a}function Bs(t,o,e,n){switch(o){case"start":t.onStart(()=>n(e&&wc(e,"start",t)));break;case"done":t.onDone(()=>n(e&&wc(e,"done",t)));break;case"destroy":t.onDestroy(()=>n(e&&wc(e,"destroy",t)));break}}function wc(t,o,e){let n=e.totalTime,i=!!e.disabled,a=Ws(t.element,t.triggerName,t.fromState,t.toState,o||t.phaseName,n??t.totalTime,i),m=t._data;return m!=null&&(a._data=m),a}function Ws(t,o,e,n,i="",a=0,m){return{element:t,triggerName:o,fromState:e,toState:n,phaseName:i,totalTime:a,disabled:!!m}}function Ni(t,o,e){let n=t.get(o);return n||t.set(o,n=e),n}function Oc(t){let o=t.indexOf(":"),e=t.substring(1,o),n=t.slice(o+1);return[e,n]}var oE=typeof document>"u"?null:document.documentElement;function Us(t){let o=t.parentNode||t.host||null;return o===oE?null:o}function rE(t){return t.substring(1,6)=="ebkit"}var Ar=null,mu=!1;function Pu(t){Ar||(Ar=aE()||{},mu=Ar.style?"WebkitAppearance"in Ar.style:!1);let o=!0;return Ar.style&&!rE(t)&&(o=t in Ar.style,!o&&mu&&(o="Webkit"+t.charAt(0).toUpperCase()+t.slice(1)in Ar.style)),o}function aE(){return typeof document<"u"?document.body:null}function Nc(t,o){for(;o;){if(o===t)return!0;o=Us(o)}return!1}function Mc(t,o,e){if(e)return Array.from(t.querySelectorAll(o));let n=t.querySelector(o);return n?[n]:[]}var sE=1e3,Fc="{{",lE="}}",Gc="ng-enter",zs="ng-leave",Ga="ng-trigger",Pa=".ng-trigger",Pc="ng-animating",js=".ng-animating";function Io(t){if(typeof t=="number")return t;let o=t.match(/^(-?[\.\d]+)(m?s)/);return!o||o.length<2?0:bc(parseFloat(o[1]),o[2])}function bc(t,o){switch(o){case"s":return t*sE;default:return t}}function La(t,o,e){return t.hasOwnProperty("duration")?t:mE(t,o,e)}var cE=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;function mE(t,o,e){let n,i=0,a="";if(typeof t=="string"){let m=t.match(cE);if(m===null)return o.push(cu(t)),{duration:0,delay:0,easing:""};n=bc(parseFloat(m[1]),m[2]);let u=m[3];u!=null&&(i=bc(parseFloat(u),m[4]));let C=m[5];C&&(a=C)}else n=t;if(!e){let m=!1,u=o.length;n<0&&(o.push(Z1()),m=!0),i<0&&(o.push(J1()),m=!0),m&&o.splice(u,0,cu(t))}return{duration:n,delay:i,easing:a}}function Lu(t){return t.length?t[0]instanceof Map?t:t.map(o=>new Map(Object.entries(o))):[]}function ao(t,o,e){o.forEach((n,i)=>{let a=Ys(i);e&&!e.has(i)&&e.set(i,t.style[a]),t.style[a]=n})}function ir(t,o){o.forEach((e,n)=>{let i=Ys(n);t.style[i]=""})}function ua(t){return Array.isArray(t)?t.length==1?t[0]:kp(t):t}function ku(t,o,e){let n=o.params||{},i=Lc(t);i.length&&i.forEach(a=>{n.hasOwnProperty(a)||e.push(eE(a))})}var Dc=new RegExp(`${Fc}\\s*(.+?)\\s*${lE}`,"g");function Lc(t){let o=[];if(typeof t=="string"){let e;for(;e=Dc.exec(t);)o.push(e[1]);Dc.lastIndex=0}return o}function fa(t,o,e){let n=`${t}`,i=n.replace(Dc,(a,m)=>{let u=o[m];return u==null&&(e.push(tE(m)),u=""),u.toString()});return i==n?t:i}var pE=/-+([a-z0-9])/g;function Ys(t){return t.replace(pE,(...o)=>o[1].toUpperCase())}function Vu(t,o){return t===0||o===0}function Hu(t,o,e){if(e.size&&o.length){let n=o[0],i=[];if(e.forEach((a,m)=>{n.has(m)||i.push(m),n.set(m,a)}),i.length)for(let a=1;a<o.length;a++){let m=o[a];i.forEach(u=>m.set(u,$s(t,u)))}}return o}function Mi(t,o,e){switch(o.type){case Tt.Trigger:return t.visitTrigger(o,e);case Tt.State:return t.visitState(o,e);case Tt.Transition:return t.visitTransition(o,e);case Tt.Sequence:return t.visitSequence(o,e);case Tt.Group:return t.visitGroup(o,e);case Tt.Animate:return t.visitAnimate(o,e);case Tt.Keyframes:return t.visitKeyframes(o,e);case Tt.Style:return t.visitStyle(o,e);case Tt.Reference:return t.visitReference(o,e);case Tt.AnimateChild:return t.visitAnimateChild(o,e);case Tt.AnimateRef:return t.visitAnimateRef(o,e);case Tt.Query:return t.visitQuery(o,e);case Tt.Stagger:return t.visitStagger(o,e);default:throw nE(o.type)}}function $s(t,o){return window.getComputedStyle(t)[o]}var em=(()=>{class t{validateStyleProperty(e){return Pu(e)}containsElement(e,n){return Nc(e,n)}getParentElement(e){return Us(e)}query(e,n,i){return Mc(e,n,i)}computeStyle(e,n,i){return i||""}animate(e,n,i,a,m,u=[],C){return new vr(i,a)}static \u0275fac=function(n){return new(n||t)};static \u0275prov=xi({token:t,factory:t.\u0275fac})}return t})(),br=class{static NOOP=new em},Dr=class{};var dE=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Zs=class extends Dr{normalizePropertyName(o,e){return Ys(o)}normalizeStyleValue(o,e,n,i){let a="",m=n.toString().trim();if(dE.has(e)&&n!==0&&n!=="0")if(typeof n=="number")a="px";else{let u=n.match(/^[+-]?[\d\.]+([a-z]*)$/);u&&u[1].length==0&&i.push(pu(o,n))}return m+a}};var Js="*";function uE(t,o){let e=[];return typeof t=="string"?t.split(/\s*,\s*/).forEach(n=>fE(n,e,o)):e.push(t),e}function fE(t,o,e){if(t[0]==":"){let C=_E(t,e);if(typeof C=="function"){o.push(C);return}t=C}let n=t.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return e.push(Iu(t)),o;let i=n[1],a=n[2],m=n[3];o.push(Bu(i,m));let u=i==Js&&m==Js;a[0]=="<"&&!u&&o.push(Bu(m,i))}function _E(t,o){switch(t){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,n)=>parseFloat(n)>parseFloat(e);case":decrement":return(e,n)=>parseFloat(n)<parseFloat(e);default:return o.push(xu(t)),"* => *"}}var Xs=new Set(["true","1"]),qs=new Set(["false","0"]);function Bu(t,o){let e=Xs.has(t)||qs.has(t),n=Xs.has(o)||qs.has(o);return(i,a)=>{let m=t==Js||t==i,u=o==Js||o==a;return!m&&e&&typeof i=="boolean"&&(m=i?Xs.has(t):qs.has(t)),!u&&n&&typeof a=="boolean"&&(u=a?Xs.has(o):qs.has(o)),m&&u}}var Qu=":self",hE=new RegExp(`s*${Qu}s*,?`,"g");function Zu(t,o,e,n){return new Uc(t).build(o,e,n)}var Wu="",Uc=class{_driver;constructor(o){this._driver=o}build(o,e,n){let i=new zc(e);return this._resetContextStyleTimingState(i),Mi(this,ua(o),i)}_resetContextStyleTimingState(o){o.currentQuerySelector=Wu,o.collectedStyles=new Map,o.collectedStyles.set(Wu,new Map),o.currentTime=0}visitTrigger(o,e){let n=e.queryCount=0,i=e.depCount=0,a=[],m=[];return o.name.charAt(0)=="@"&&e.errors.push(du()),o.definitions.forEach(u=>{if(this._resetContextStyleTimingState(e),u.type==Tt.State){let C=u,v=C.name;v.toString().split(/\s*,\s*/).forEach(T=>{C.name=T,a.push(this.visitState(C,e))}),C.name=v}else if(u.type==Tt.Transition){let C=this.visitTransition(u,e);n+=C.queryCount,i+=C.depCount,m.push(C)}else e.errors.push(uu())}),{type:Tt.Trigger,name:o.name,states:a,transitions:m,queryCount:n,depCount:i,options:null}}visitState(o,e){let n=this.visitStyle(o.styles,e),i=o.options&&o.options.params||null;if(n.containsDynamicStyles){let a=new Set,m=i||{};n.styles.forEach(u=>{u instanceof Map&&u.forEach(C=>{Lc(C).forEach(v=>{m.hasOwnProperty(v)||a.add(v)})})}),a.size&&e.errors.push(fu(o.name,[...a.values()]))}return{type:Tt.State,name:o.name,style:n,options:i?{params:i}:null}}visitTransition(o,e){e.queryCount=0,e.depCount=0;let n=Mi(this,ua(o.animation),e),i=uE(o.expr,e.errors);return{type:Tt.Transition,matchers:i,animation:n,queryCount:e.queryCount,depCount:e.depCount,options:wr(o.options)}}visitSequence(o,e){return{type:Tt.Sequence,steps:o.steps.map(n=>Mi(this,n,e)),options:wr(o.options)}}visitGroup(o,e){let n=e.currentTime,i=0,a=o.steps.map(m=>{e.currentTime=n;let u=Mi(this,m,e);return i=Math.max(i,e.currentTime),u});return e.currentTime=i,{type:Tt.Group,steps:a,options:wr(o.options)}}visitAnimate(o,e){let n=vE(o.timings,e.errors);e.currentAnimateTimings=n;let i,a=o.styles?o.styles:Rn({});if(a.type==Tt.Keyframes)i=this.visitKeyframes(a,e);else{let m=o.styles,u=!1;if(!m){u=!0;let v={};n.easing&&(v.easing=n.easing),m=Rn(v)}e.currentTime+=n.duration+n.delay;let C=this.visitStyle(m,e);C.isEmptyStep=u,i=C}return e.currentAnimateTimings=null,{type:Tt.Animate,timings:n,style:i,options:null}}visitStyle(o,e){let n=this._makeStyleAst(o,e);return this._validateStyleAst(n,e),n}_makeStyleAst(o,e){let n=[],i=Array.isArray(o.styles)?o.styles:[o.styles];for(let u of i)typeof u=="string"?u===no?n.push(u):e.errors.push(_u(u)):n.push(new Map(Object.entries(u)));let a=!1,m=null;return n.forEach(u=>{if(u instanceof Map&&(u.has("easing")&&(m=u.get("easing"),u.delete("easing")),!a)){for(let C of u.values())if(C.toString().indexOf(Fc)>=0){a=!0;break}}}),{type:Tt.Style,styles:n,easing:m,offset:o.offset,containsDynamicStyles:a,options:null}}_validateStyleAst(o,e){let n=e.currentAnimateTimings,i=e.currentTime,a=e.currentTime;n&&a>0&&(a-=n.duration+n.delay),o.styles.forEach(m=>{typeof m!="string"&&m.forEach((u,C)=>{let v=e.collectedStyles.get(e.currentQuerySelector),T=v.get(C),A=!0;T&&(a!=i&&a>=T.startTime&&i<=T.endTime&&(e.errors.push(hu(C,T.startTime,T.endTime,a,i)),A=!1),a=T.startTime),A&&v.set(C,{startTime:a,endTime:i}),e.options&&ku(u,e.options,e.errors)})})}visitKeyframes(o,e){let n={type:Tt.Keyframes,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(Cu()),n;let i=1,a=0,m=[],u=!1,C=!1,v=0,T=o.steps.map(Re=>{let se=this._makeStyleAst(Re,e),ge=se.offset!=null?se.offset:EE(se.styles),Ue=0;return ge!=null&&(a++,Ue=se.offset=ge),C=C||Ue<0||Ue>1,u=u||Ue<v,v=Ue,m.push(Ue),se});C&&e.errors.push(gu()),u&&e.errors.push(Eu());let A=o.steps.length,b=0;a>0&&a<A?e.errors.push(vu()):a==0&&(b=i/(A-1));let F=A-1,k=e.currentTime,Q=e.currentAnimateTimings,ve=Q.duration;return T.forEach((Re,se)=>{let ge=b>0?se==F?1:b*se:m[se],Ue=ge*ve;e.currentTime=k+Q.delay+Ue,Q.duration=Ue,this._validateStyleAst(Re,e),Re.offset=ge,n.styles.push(Re)}),n}visitReference(o,e){return{type:Tt.Reference,animation:Mi(this,ua(o.animation),e),options:wr(o.options)}}visitAnimateChild(o,e){return e.depCount++,{type:Tt.AnimateChild,options:wr(o.options)}}visitAnimateRef(o,e){return{type:Tt.AnimateRef,animation:this.visitReference(o.animation,e),options:wr(o.options)}}visitQuery(o,e){let n=e.currentQuerySelector,i=o.options||{};e.queryCount++,e.currentQuery=o;let[a,m]=CE(o.selector);e.currentQuerySelector=n.length?n+" "+a:a,Ni(e.collectedStyles,e.currentQuerySelector,new Map);let u=Mi(this,ua(o.animation),e);return e.currentQuery=null,e.currentQuerySelector=n,{type:Tt.Query,selector:a,limit:i.limit||0,optional:!!i.optional,includeSelf:m,animation:u,originalSelector:o.selector,options:wr(o.options)}}visitStagger(o,e){e.currentQuery||e.errors.push(yu());let n=o.timings==="full"?{duration:0,delay:0,easing:"full"}:La(o.timings,e.errors,!0);return{type:Tt.Stagger,animation:Mi(this,ua(o.animation),e),timings:n,options:null}}};function CE(t){let o=!!t.split(/\s*,\s*/).find(e=>e==Qu);return o&&(t=t.replace(hE,"")),t=t.replace(/@\*/g,Pa).replace(/@\w+/g,e=>Pa+"-"+e.slice(1)).replace(/:animating/g,js),[t,o]}function gE(t){return t?ke({},t):null}var zc=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(o){this.errors=o}};function EE(t){if(typeof t=="string")return null;let o=null;if(Array.isArray(t))t.forEach(e=>{if(e instanceof Map&&e.has("offset")){let n=e;o=parseFloat(n.get("offset")),n.delete("offset")}});else if(t instanceof Map&&t.has("offset")){let e=t;o=parseFloat(e.get("offset")),e.delete("offset")}return o}function vE(t,o){if(t.hasOwnProperty("duration"))return t;if(typeof t=="number"){let a=La(t,o).duration;return kc(a,0,"")}let e=t;if(e.split(/\s+/).some(a=>a.charAt(0)=="{"&&a.charAt(1)=="{")){let a=kc(0,0,"");return a.dynamic=!0,a.strValue=e,a}let i=La(e,o);return kc(i.duration,i.delay,i.easing)}function wr(t){return t?(t=ke({},t),t.params&&(t.params=gE(t.params))):t={},t}function kc(t,o,e){return{duration:t,delay:o,easing:e}}function tm(t,o,e,n,i,a,m=null,u=!1){return{type:1,element:t,keyframes:o,preStyleProps:e,postStyleProps:n,duration:i,delay:a,totalTime:i+a,easing:m,subTimeline:u}}var Va=class{_map=new Map;get(o){return this._map.get(o)||[]}append(o,e){let n=this._map.get(o);n||this._map.set(o,n=[]),n.push(...e)}has(o){return this._map.has(o)}clear(){this._map.clear()}},yE=1,TE=":enter",IE=new RegExp(TE,"g"),xE=":leave",SE=new RegExp(xE,"g");function Ju(t,o,e,n,i,a=new Map,m=new Map,u,C,v=[]){return new jc().buildKeyframes(t,o,e,n,i,a,m,u,C,v)}var jc=class{buildKeyframes(o,e,n,i,a,m,u,C,v,T=[]){v=v||new Va;let A=new Yc(o,e,v,i,a,T,[]);A.options=C;let b=C.delay?Io(C.delay):0;A.currentTimeline.delayNextStep(b),A.currentTimeline.setStyles([m],null,A.errors,C),Mi(this,n,A);let F=A.timelines.filter(k=>k.containsAnimation());if(F.length&&u.size){let k;for(let Q=F.length-1;Q>=0;Q--){let ve=F[Q];if(ve.element===e){k=ve;break}}k&&!k.allowOnlyTimelineStyles()&&k.setStyles([u],null,A.errors,C)}return F.length?F.map(k=>k.buildKeyframes()):[tm(e,[],[],[],0,b,"",!1)]}visitTrigger(o,e){}visitState(o,e){}visitTransition(o,e){}visitAnimateChild(o,e){let n=e.subInstructions.get(e.element);if(n){let i=e.createSubContext(o.options),a=e.currentTimeline.currentTime,m=this._visitSubInstructions(n,i,i.options);a!=m&&e.transformIntoNewTimeline(m)}e.previousNode=o}visitAnimateRef(o,e){let n=e.createSubContext(o.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([o.options,o.animation.options],e,n),this.visitReference(o.animation,n),e.transformIntoNewTimeline(n.currentTimeline.currentTime),e.previousNode=o}_applyAnimationRefDelays(o,e,n){for(let i of o){let a=i?.delay;if(a){let m=typeof a=="number"?a:Io(fa(a,i?.params??{},e.errors));n.delayNextStep(m)}}}_visitSubInstructions(o,e,n){let a=e.currentTimeline.currentTime,m=n.duration!=null?Io(n.duration):null,u=n.delay!=null?Io(n.delay):null;return m!==0&&o.forEach(C=>{let v=e.appendInstructionToTimeline(C,m,u);a=Math.max(a,v.duration+v.delay)}),a}visitReference(o,e){e.updateOptions(o.options,!0),Mi(this,o.animation,e),e.previousNode=o}visitSequence(o,e){let n=e.subContextCount,i=e,a=o.options;if(a&&(a.params||a.delay)&&(i=e.createSubContext(a),i.transformIntoNewTimeline(),a.delay!=null)){i.previousNode.type==Tt.Style&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=el);let m=Io(a.delay);i.delayNextStep(m)}o.steps.length&&(o.steps.forEach(m=>Mi(this,m,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>n&&i.transformIntoNewTimeline()),e.previousNode=o}visitGroup(o,e){let n=[],i=e.currentTimeline.currentTime,a=o.options&&o.options.delay?Io(o.options.delay):0;o.steps.forEach(m=>{let u=e.createSubContext(o.options);a&&u.delayNextStep(a),Mi(this,m,u),i=Math.max(i,u.currentTimeline.currentTime),n.push(u.currentTimeline)}),n.forEach(m=>e.currentTimeline.mergeTimelineCollectedStyles(m)),e.transformIntoNewTimeline(i),e.previousNode=o}_visitTiming(o,e){if(o.dynamic){let n=o.strValue,i=e.params?fa(n,e.params,e.errors):n;return La(i,e.errors)}else return{duration:o.duration,delay:o.delay,easing:o.easing}}visitAnimate(o,e){let n=e.currentAnimateTimings=this._visitTiming(o.timings,e),i=e.currentTimeline;n.delay&&(e.incrementTime(n.delay),i.snapshotCurrentStyles());let a=o.style;a.type==Tt.Keyframes?this.visitKeyframes(a,e):(e.incrementTime(n.duration),this.visitStyle(a,e),i.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=o}visitStyle(o,e){let n=e.currentTimeline,i=e.currentAnimateTimings;!i&&n.hasCurrentStyleProperties()&&n.forwardFrame();let a=i&&i.easing||o.easing;o.isEmptyStep?n.applyEmptyStep(a):n.setStyles(o.styles,a,e.errors,e.options),e.previousNode=o}visitKeyframes(o,e){let n=e.currentAnimateTimings,i=e.currentTimeline.duration,a=n.duration,u=e.createSubContext().currentTimeline;u.easing=n.easing,o.styles.forEach(C=>{let v=C.offset||0;u.forwardTime(v*a),u.setStyles(C.styles,C.easing,e.errors,e.options),u.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(u),e.transformIntoNewTimeline(i+a),e.previousNode=o}visitQuery(o,e){let n=e.currentTimeline.currentTime,i=o.options||{},a=i.delay?Io(i.delay):0;a&&(e.previousNode.type===Tt.Style||n==0&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=el);let m=n,u=e.invokeQuery(o.selector,o.originalSelector,o.limit,o.includeSelf,!!i.optional,e.errors);e.currentQueryTotal=u.length;let C=null;u.forEach((v,T)=>{e.currentQueryIndex=T;let A=e.createSubContext(o.options,v);a&&A.delayNextStep(a),v===e.element&&(C=A.currentTimeline),Mi(this,o.animation,A),A.currentTimeline.applyStylesToKeyframe();let b=A.currentTimeline.currentTime;m=Math.max(m,b)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(m),C&&(e.currentTimeline.mergeTimelineCollectedStyles(C),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=o}visitStagger(o,e){let n=e.parentContext,i=e.currentTimeline,a=o.timings,m=Math.abs(a.duration),u=m*(e.currentQueryTotal-1),C=m*e.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":C=u-C;break;case"full":C=n.currentStaggerTime;break}let T=e.currentTimeline;C&&T.delayNextStep(C);let A=T.currentTime;Mi(this,o.animation,e),e.previousNode=o,n.currentStaggerTime=i.currentTime-A+(i.startTime-n.currentTimeline.startTime)}},el={},Yc=class t{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=el;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(o,e,n,i,a,m,u,C){this._driver=o,this.element=e,this.subInstructions=n,this._enterClassName=i,this._leaveClassName=a,this.errors=m,this.timelines=u,this.currentTimeline=C||new tl(this._driver,e,0),u.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(o,e){if(!o)return;let n=o,i=this.options;n.duration!=null&&(i.duration=Io(n.duration)),n.delay!=null&&(i.delay=Io(n.delay));let a=n.params;if(a){let m=i.params;m||(m=this.options.params={}),Object.keys(a).forEach(u=>{(!e||!m.hasOwnProperty(u))&&(m[u]=fa(a[u],m,this.errors))})}}_copyOptions(){let o={};if(this.options){let e=this.options.params;if(e){let n=o.params={};Object.keys(e).forEach(i=>{n[i]=e[i]})}}return o}createSubContext(o=null,e,n){let i=e||this.element,a=new t(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,n||0));return a.previousNode=this.previousNode,a.currentAnimateTimings=this.currentAnimateTimings,a.options=this._copyOptions(),a.updateOptions(o),a.currentQueryIndex=this.currentQueryIndex,a.currentQueryTotal=this.currentQueryTotal,a.parentContext=this,this.subContextCount++,a}transformIntoNewTimeline(o){return this.previousNode=el,this.currentTimeline=this.currentTimeline.fork(this.element,o),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(o,e,n){let i={duration:e??o.duration,delay:this.currentTimeline.currentTime+(n??0)+o.delay,easing:""},a=new $c(this._driver,o.element,o.keyframes,o.preStyleProps,o.postStyleProps,i,o.stretchStartingKeyframe);return this.timelines.push(a),i}incrementTime(o){this.currentTimeline.forwardTime(this.currentTimeline.duration+o)}delayNextStep(o){o>0&&this.currentTimeline.delayNextStep(o)}invokeQuery(o,e,n,i,a,m){let u=[];if(i&&u.push(this.element),o.length>0){o=o.replace(IE,"."+this._enterClassName),o=o.replace(SE,"."+this._leaveClassName);let C=n!=1,v=this._driver.query(this.element,o,C);n!==0&&(v=n<0?v.slice(v.length+n,v.length):v.slice(0,n)),u.push(...v)}return!a&&u.length==0&&m.push(Tu(e)),u}},tl=class t{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(o,e,n,i){this._driver=o,this.element=e,this.startTime=n,this._elementTimelineStylesLookup=i,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(o){let e=this._keyframes.size===1&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+o),e&&this.snapshotCurrentStyles()):this.startTime+=o}fork(o,e){return this.applyStylesToKeyframe(),new t(this._driver,o,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=yE,this._loadKeyframe()}forwardTime(o){this.applyStylesToKeyframe(),this.duration=o,this._loadKeyframe()}_updateStyle(o,e){this._localTimelineStyles.set(o,e),this._globalTimelineStyles.set(o,e),this._styleSummary.set(o,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(o){o&&this._previousKeyframe.set("easing",o);for(let[e,n]of this._globalTimelineStyles)this._backFill.set(e,n||no),this._currentKeyframe.set(e,no);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(o,e,n,i){e&&this._previousKeyframe.set("easing",e);let a=i&&i.params||{},m=AE(o,this._globalTimelineStyles);for(let[u,C]of m){let v=fa(C,a,n);this._pendingStyles.set(u,v),this._localTimelineStyles.has(u)||this._backFill.set(u,this._globalTimelineStyles.get(u)??no),this._updateStyle(u,v)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((o,e)=>{this._currentKeyframe.set(e,o)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((o,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,o)}))}snapshotCurrentStyles(){for(let[o,e]of this._localTimelineStyles)this._pendingStyles.set(o,e),this._updateStyle(o,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let o=[];for(let e in this._currentKeyframe)o.push(e);return o}mergeTimelineCollectedStyles(o){o._styleSummary.forEach((e,n)=>{let i=this._styleSummary.get(n);(!i||e.time>i.time)&&this._updateStyle(n,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();let o=new Set,e=new Set,n=this._keyframes.size===1&&this.duration===0,i=[];this._keyframes.forEach((u,C)=>{let v=new Map([...this._backFill,...u]);v.forEach((T,A)=>{T===Ra?o.add(A):T===no&&e.add(A)}),n||v.set("offset",C/this.duration),i.push(v)});let a=[...o.values()],m=[...e.values()];if(n){let u=i[0],C=new Map(u);u.set("offset",0),C.set("offset",1),i=[u,C]}return tm(this.element,i,a,m,this.duration,this.startTime,this.easing,!1)}},$c=class extends tl{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(o,e,n,i,a,m,u=!1){super(o,e,m.delay),this.keyframes=n,this.preStyleProps=i,this.postStyleProps=a,this._stretchStartingKeyframe=u,this.timings={duration:m.duration,delay:m.delay,easing:m.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let o=this.keyframes,{delay:e,duration:n,easing:i}=this.timings;if(this._stretchStartingKeyframe&&e){let a=[],m=n+e,u=e/m,C=new Map(o[0]);C.set("offset",0),a.push(C);let v=new Map(o[0]);v.set("offset",Uu(u)),a.push(v);let T=o.length-1;for(let A=1;A<=T;A++){let b=new Map(o[A]),F=b.get("offset"),k=e+F*n;b.set("offset",Uu(k/m)),a.push(b)}n=m,e=0,i="",o=a}return tm(this.element,o,this.preStyleProps,this.postStyleProps,n,e,i,!0)}};function Uu(t,o=3){let e=Math.pow(10,o-1);return Math.round(t*e)/e}function AE(t,o){let e=new Map,n;return t.forEach(i=>{if(i==="*"){n??=o.keys();for(let a of n)e.set(a,no)}else for(let[a,m]of i)e.set(a,m)}),e}function zu(t,o,e,n,i,a,m,u,C,v,T,A,b){return{type:0,element:t,triggerName:o,isRemovalTransition:i,fromState:e,fromStyles:a,toState:n,toStyles:m,timelines:u,queriedElements:C,preStyleProps:v,postStyleProps:T,totalTime:A,errors:b}}var Vc={},nl=class{_triggerName;ast;_stateStyles;constructor(o,e,n){this._triggerName=o,this.ast=e,this._stateStyles=n}match(o,e,n,i){return wE(this.ast.matchers,o,e,n,i)}buildStyles(o,e,n){let i=this._stateStyles.get("*");return o!==void 0&&(i=this._stateStyles.get(o?.toString())||i),i?i.buildStyles(e,n):new Map}build(o,e,n,i,a,m,u,C,v,T){let A=[],b=this.ast.options&&this.ast.options.params||Vc,F=u&&u.params||Vc,k=this.buildStyles(n,F,A),Q=C&&C.params||Vc,ve=this.buildStyles(i,Q,A),Re=new Set,se=new Map,ge=new Map,Ue=i==="void",Ot={params:e0(Q,b),delay:this.ast.options?.delay},$t=T?[]:Ju(o,e,this.ast.animation,a,m,k,ve,Ot,v,A),nt=0;return $t.forEach(Gt=>{nt=Math.max(Gt.duration+Gt.delay,nt)}),A.length?zu(e,this._triggerName,n,i,Ue,k,ve,[],[],se,ge,nt,A):($t.forEach(Gt=>{let Ln=Gt.element,Xn=Ni(se,Ln,new Set);Gt.preStyleProps.forEach(Cn=>Xn.add(Cn));let pi=Ni(ge,Ln,new Set);Gt.postStyleProps.forEach(Cn=>pi.add(Cn)),Ln!==e&&Re.add(Ln)}),zu(e,this._triggerName,n,i,Ue,k,ve,$t,[...Re.values()],se,ge,nt))}};function wE(t,o,e,n,i){return t.some(a=>a(o,e,n,i))}function e0(t,o){let e=ke({},o);return Object.entries(t).forEach(([n,i])=>{i!=null&&(e[n]=i)}),e}var Xc=class{styles;defaultParams;normalizer;constructor(o,e,n){this.styles=o,this.defaultParams=e,this.normalizer=n}buildStyles(o,e){let n=new Map,i=e0(o,this.defaultParams);return this.styles.styles.forEach(a=>{typeof a!="string"&&a.forEach((m,u)=>{m&&(m=fa(m,i,e));let C=this.normalizer.normalizePropertyName(u,e);m=this.normalizer.normalizeStyleValue(u,C,m,e),n.set(u,m)})}),n}};function bE(t,o,e){return new qc(t,o,e)}var qc=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(o,e,n){this.name=o,this.ast=e,this._normalizer=n,e.states.forEach(i=>{let a=i.options&&i.options.params||{};this.states.set(i.name,new Xc(i.style,a,n))}),ju(this.states,"true","1"),ju(this.states,"false","0"),e.transitions.forEach(i=>{this.transitionFactories.push(new nl(o,i,this.states))}),this.fallbackTransition=DE(o,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(o,e,n,i){return this.transitionFactories.find(m=>m.match(o,e,n,i))||null}matchStyles(o,e,n){return this.fallbackTransition.buildStyles(o,e,n)}};function DE(t,o,e){let n=[(m,u)=>!0],i={type:Tt.Sequence,steps:[],options:null},a={type:Tt.Transition,animation:i,matchers:n,options:null,queryCount:0,depCount:0};return new nl(t,a,o)}function ju(t,o,e){t.has(o)?t.has(e)||t.set(e,t.get(o)):t.has(e)&&t.set(o,t.get(e))}var RE=new Va,Kc=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(o,e,n){this.bodyNode=o,this._driver=e,this._normalizer=n}register(o,e){let n=[],i=[],a=Zu(this._driver,e,n,i);if(n.length)throw Au(n);this._animations.set(o,a)}_buildPlayer(o,e,n){let i=o.element,a=Rc(this._normalizer,o.keyframes,e,n);return this._driver.animate(i,a,o.duration,o.delay,o.easing,[],!0)}create(o,e,n={}){let i=[],a=this._animations.get(o),m,u=new Map;if(a?(m=Ju(this._driver,e,a,Gc,zs,new Map,new Map,n,RE,i),m.forEach(T=>{let A=Ni(u,T.element,new Map);T.postStyleProps.forEach(b=>A.set(b,null))})):(i.push(wu()),m=[]),i.length)throw bu(i);u.forEach((T,A)=>{T.forEach((b,F)=>{T.set(F,this._driver.computeStyle(A,F,no))})});let C=m.map(T=>{let A=u.get(T.element);return this._buildPlayer(T,new Map,A)}),v=Go(C);return this._playersById.set(o,v),v.onDestroy(()=>this.destroy(o)),this.players.push(v),v}destroy(o){let e=this._getPlayer(o);e.destroy(),this._playersById.delete(o);let n=this.players.indexOf(e);n>=0&&this.players.splice(n,1)}_getPlayer(o){let e=this._playersById.get(o);if(!e)throw Du(o);return e}listen(o,e,n,i){let a=Ws(e,"","","");return Bs(this._getPlayer(o),n,a,i),()=>{}}command(o,e,n,i){if(n=="register"){this.register(o,i[0]);return}if(n=="create"){let m=i[0]||{};this.create(o,e,m);return}let a=this._getPlayer(o);switch(n){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(o);break}}},Yu="ng-animate-queued",OE=".ng-animate-queued",Hc="ng-animate-disabled",NE=".ng-animate-disabled",ME="ng-star-inserted",FE=".ng-star-inserted",GE=[],t0={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},PE={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},so="__ng_removed",Ha=class{namespaceId;value;options;get params(){return this.options.params}constructor(o,e=""){this.namespaceId=e;let n=o&&o.hasOwnProperty("value"),i=n?o.value:o;if(this.value=kE(i),n){let a=o,{value:m}=a,u=pp(a,["value"]);this.options=u}else this.options={};this.options.params||(this.options.params={})}absorbOptions(o){let e=o.params;if(e){let n=this.options.params;Object.keys(e).forEach(i=>{n[i]==null&&(n[i]=e[i])})}}},ka="void",Bc=new Ha(ka),Qc=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(o,e,n){this.id=o,this.hostElement=e,this._engine=n,this._hostClassName="ng-tns-"+o,Zi(e,this._hostClassName)}listen(o,e,n,i){if(!this._triggers.has(e))throw Ru(n,e);if(n==null||n.length==0)throw Ou(e);if(!VE(n))throw Nu(n,e);let a=Ni(this._elementListeners,o,[]),m={name:e,phase:n,callback:i};a.push(m);let u=Ni(this._engine.statesByElement,o,new Map);return u.has(e)||(Zi(o,Ga),Zi(o,Ga+"-"+e),u.set(e,Bc)),()=>{this._engine.afterFlush(()=>{let C=a.indexOf(m);C>=0&&a.splice(C,1),this._triggers.has(e)||u.delete(e)})}}register(o,e){return this._triggers.has(o)?!1:(this._triggers.set(o,e),!0)}_getTrigger(o){let e=this._triggers.get(o);if(!e)throw Mu(o);return e}trigger(o,e,n,i=!0){let a=this._getTrigger(e),m=new Ba(this.id,e,o),u=this._engine.statesByElement.get(o);u||(Zi(o,Ga),Zi(o,Ga+"-"+e),this._engine.statesByElement.set(o,u=new Map));let C=u.get(e),v=new Ha(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&C&&v.absorbOptions(C.options),u.set(e,v),C||(C=Bc),!(v.value===ka)&&C.value===v.value){if(!WE(C.params,v.params)){let Q=[],ve=a.matchStyles(C.value,C.params,Q),Re=a.matchStyles(v.value,v.params,Q);Q.length?this._engine.reportError(Q):this._engine.afterFlush(()=>{ir(o,ve),ao(o,Re)})}return}let b=Ni(this._engine.playersByElement,o,[]);b.forEach(Q=>{Q.namespaceId==this.id&&Q.triggerName==e&&Q.queued&&Q.destroy()});let F=a.matchTransition(C.value,v.value,o,v.params),k=!1;if(!F){if(!i)return;F=a.fallbackTransition,k=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:o,triggerName:e,transition:F,fromState:C,toState:v,player:m,isFallbackTransition:k}),k||(Zi(o,Yu),m.onStart(()=>{_a(o,Yu)})),m.onDone(()=>{let Q=this.players.indexOf(m);Q>=0&&this.players.splice(Q,1);let ve=this._engine.playersByElement.get(o);if(ve){let Re=ve.indexOf(m);Re>=0&&ve.splice(Re,1)}}),this.players.push(m),b.push(m),m}deregister(o){this._triggers.delete(o),this._engine.statesByElement.forEach(e=>e.delete(o)),this._elementListeners.forEach((e,n)=>{this._elementListeners.set(n,e.filter(i=>i.name!=o))})}clearElementCache(o){this._engine.statesByElement.delete(o),this._elementListeners.delete(o);let e=this._engine.playersByElement.get(o);e&&(e.forEach(n=>n.destroy()),this._engine.playersByElement.delete(o))}_signalRemovalForInnerTriggers(o,e){let n=this._engine.driver.query(o,Pa,!0);n.forEach(i=>{if(i[so])return;let a=this._engine.fetchNamespacesByElement(i);a.size?a.forEach(m=>m.triggerLeaveAnimation(i,e,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(o,e,n,i){let a=this._engine.statesByElement.get(o),m=new Map;if(a){let u=[];if(a.forEach((C,v)=>{if(m.set(v,C.value),this._triggers.has(v)){let T=this.trigger(o,v,ka,i);T&&u.push(T)}}),u.length)return this._engine.markElementAsRemoved(this.id,o,!0,e,m),n&&Go(u).onDone(()=>this._engine.processLeaveNode(o)),!0}return!1}prepareLeaveAnimationListeners(o){let e=this._elementListeners.get(o),n=this._engine.statesByElement.get(o);if(e&&n){let i=new Set;e.forEach(a=>{let m=a.name;if(i.has(m))return;i.add(m);let C=this._triggers.get(m).fallbackTransition,v=n.get(m)||Bc,T=new Ha(ka),A=new Ba(this.id,m,o);this._engine.totalQueuedPlayers++,this._queue.push({element:o,triggerName:m,transition:C,fromState:v,toState:T,player:A,isFallbackTransition:!0})})}}removeNode(o,e){let n=this._engine;if(o.childElementCount&&this._signalRemovalForInnerTriggers(o,e),this.triggerLeaveAnimation(o,e,!0))return;let i=!1;if(n.totalAnimations){let a=n.players.length?n.playersByQueriedElement.get(o):[];if(a&&a.length)i=!0;else{let m=o;for(;m=m.parentNode;)if(n.statesByElement.get(m)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(o),i)n.markElementAsRemoved(this.id,o,!1,e);else{let a=o[so];(!a||a===t0)&&(n.afterFlush(()=>this.clearElementCache(o)),n.destroyInnerAnimations(o),n._onRemovalComplete(o,e))}}insertNode(o,e){Zi(o,this._hostClassName)}drainQueuedTransitions(o){let e=[];return this._queue.forEach(n=>{let i=n.player;if(i.destroyed)return;let a=n.element,m=this._elementListeners.get(a);m&&m.forEach(u=>{if(u.name==n.triggerName){let C=Ws(a,n.triggerName,n.fromState.value,n.toState.value);C._data=o,Bs(n.player,u.phase,C,u.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):e.push(n)}),this._queue=[],e.sort((n,i)=>{let a=n.transition.ast.depCount,m=i.transition.ast.depCount;return a==0||m==0?a-m:this._engine.driver.containsElement(n.element,i.element)?1:-1})}destroy(o){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,o)}},Zc=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(o,e)=>{};_onRemovalComplete(o,e){this.onRemovalComplete(o,e)}constructor(o,e,n){this.bodyNode=o,this.driver=e,this._normalizer=n}get queuedPlayers(){let o=[];return this._namespaceList.forEach(e=>{e.players.forEach(n=>{n.queued&&o.push(n)})}),o}createNamespace(o,e){let n=new Qc(o,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(n,e):(this.newHostElements.set(e,n),this.collectEnterElement(e)),this._namespaceLookup[o]=n}_balanceNamespaceList(o,e){let n=this._namespaceList,i=this.namespacesByHostElement;if(n.length-1>=0){let m=!1,u=this.driver.getParentElement(e);for(;u;){let C=i.get(u);if(C){let v=n.indexOf(C);n.splice(v+1,0,o),m=!0;break}u=this.driver.getParentElement(u)}m||n.unshift(o)}else n.push(o);return i.set(e,o),o}register(o,e){let n=this._namespaceLookup[o];return n||(n=this.createNamespace(o,e)),n}registerTrigger(o,e,n){let i=this._namespaceLookup[o];i&&i.register(e,n)&&this.totalAnimations++}destroy(o,e){o&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(o);this.namespacesByHostElement.delete(n.hostElement);let i=this._namespaceList.indexOf(n);i>=0&&this._namespaceList.splice(i,1),n.destroy(e),delete this._namespaceLookup[o]}))}_fetchNamespace(o){return this._namespaceLookup[o]}fetchNamespacesByElement(o){let e=new Set,n=this.statesByElement.get(o);if(n){for(let i of n.values())if(i.namespaceId){let a=this._fetchNamespace(i.namespaceId);a&&e.add(a)}}return e}trigger(o,e,n,i){if(Ks(e)){let a=this._fetchNamespace(o);if(a)return a.trigger(e,n,i),!0}return!1}insertNode(o,e,n,i){if(!Ks(e))return;let a=e[so];if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;let m=this.collectedLeaveElements.indexOf(e);m>=0&&this.collectedLeaveElements.splice(m,1)}if(o){let m=this._fetchNamespace(o);m&&m.insertNode(e,n)}i&&this.collectEnterElement(e)}collectEnterElement(o){this.collectedEnterElements.push(o)}markElementAsDisabled(o,e){e?this.disabledNodes.has(o)||(this.disabledNodes.add(o),Zi(o,Hc)):this.disabledNodes.has(o)&&(this.disabledNodes.delete(o),_a(o,Hc))}removeNode(o,e,n){if(Ks(e)){let i=o?this._fetchNamespace(o):null;i?i.removeNode(e,n):this.markElementAsRemoved(o,e,!1,n);let a=this.namespacesByHostElement.get(e);a&&a.id!==o&&a.removeNode(e,n)}else this._onRemovalComplete(e,n)}markElementAsRemoved(o,e,n,i,a){this.collectedLeaveElements.push(e),e[so]={namespaceId:o,setForRemoval:i,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:a}}listen(o,e,n,i,a){return Ks(e)?this._fetchNamespace(o).listen(e,n,i,a):()=>{}}_buildInstruction(o,e,n,i,a){return o.transition.build(this.driver,o.element,o.fromState.value,o.toState.value,n,i,o.fromState.options,o.toState.options,e,a)}destroyInnerAnimations(o){let e=this.driver.query(o,Pa,!0);e.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(e=this.driver.query(o,js,!0),e.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(o){let e=this.playersByElement.get(o);e&&e.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(o){let e=this.playersByQueriedElement.get(o);e&&e.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(o=>{if(this.players.length)return Go(this.players).onDone(()=>o());o()})}processLeaveNode(o){let e=o[so];if(e&&e.setForRemoval){if(o[so]=t0,e.namespaceId){this.destroyInnerAnimations(o);let n=this._fetchNamespace(e.namespaceId);n&&n.clearElementCache(o)}this._onRemovalComplete(o,e.setForRemoval)}o.classList?.contains(Hc)&&this.markElementAsDisabled(o,!1),this.driver.query(o,NE,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(o=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,i)=>this._balanceNamespaceList(n,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let i=this.collectedEnterElements[n];Zi(i,ME)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{e=this._flushAnimations(n,o)}finally{for(let i=0;i<n.length;i++)n[i]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let i=this.collectedLeaveElements[n];this.processLeaveNode(i)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],e.length?Go(e).onDone(()=>{n.forEach(i=>i())}):n.forEach(i=>i())}}reportError(o){throw Fu(o)}_flushAnimations(o,e){let n=new Va,i=[],a=new Map,m=[],u=new Map,C=new Map,v=new Map,T=new Set;this.disabledNodes.forEach(Oe=>{T.add(Oe);let Fe=this.driver.query(Oe,OE,!0);for(let Le=0;Le<Fe.length;Le++)T.add(Fe[Le])});let A=this.bodyNode,b=Array.from(this.statesByElement.keys()),F=qu(b,this.collectedEnterElements),k=new Map,Q=0;F.forEach((Oe,Fe)=>{let Le=Gc+Q++;k.set(Fe,Le),Oe.forEach(ut=>Zi(ut,Le))});let ve=[],Re=new Set,se=new Set;for(let Oe=0;Oe<this.collectedLeaveElements.length;Oe++){let Fe=this.collectedLeaveElements[Oe],Le=Fe[so];Le&&Le.setForRemoval&&(ve.push(Fe),Re.add(Fe),Le.hasAnimation?this.driver.query(Fe,FE,!0).forEach(ut=>Re.add(ut)):se.add(Fe))}let ge=new Map,Ue=qu(b,Array.from(Re));Ue.forEach((Oe,Fe)=>{let Le=zs+Q++;ge.set(Fe,Le),Oe.forEach(ut=>Zi(ut,Le))}),o.push(()=>{F.forEach((Oe,Fe)=>{let Le=k.get(Fe);Oe.forEach(ut=>_a(ut,Le))}),Ue.forEach((Oe,Fe)=>{let Le=ge.get(Fe);Oe.forEach(ut=>_a(ut,Le))}),ve.forEach(Oe=>{this.processLeaveNode(Oe)})});let Ot=[],$t=[];for(let Oe=this._namespaceList.length-1;Oe>=0;Oe--)this._namespaceList[Oe].drainQueuedTransitions(e).forEach(Le=>{let ut=Le.player,mn=Le.element;if(Ot.push(ut),this.collectedEnterElements.length){let gn=mn[so];if(gn&&gn.setForMove){if(gn.previousTriggersValues&&gn.previousTriggersValues.has(Le.triggerName)){let to=gn.previousTriggersValues.get(Le.triggerName),Zn=this.statesByElement.get(Le.element);if(Zn&&Zn.has(Le.triggerName)){let Er=Zn.get(Le.triggerName);Er.value=to,Zn.set(Le.triggerName,Er)}}ut.destroy();return}}let di=!A||!this.driver.containsElement(A,mn),kn=ge.get(mn),Hi=k.get(mn),Xt=this._buildInstruction(Le,n,Hi,kn,di);if(Xt.errors&&Xt.errors.length){$t.push(Xt);return}if(di){ut.onStart(()=>ir(mn,Xt.fromStyles)),ut.onDestroy(()=>ao(mn,Xt.toStyles)),i.push(ut);return}if(Le.isFallbackTransition){ut.onStart(()=>ir(mn,Xt.fromStyles)),ut.onDestroy(()=>ao(mn,Xt.toStyles)),i.push(ut);return}let Bi=[];Xt.timelines.forEach(gn=>{gn.stretchStartingKeyframe=!0,this.disabledNodes.has(gn.element)||Bi.push(gn)}),Xt.timelines=Bi,n.append(mn,Xt.timelines);let wa={instruction:Xt,player:ut,element:mn};m.push(wa),Xt.queriedElements.forEach(gn=>Ni(u,gn,[]).push(ut)),Xt.preStyleProps.forEach((gn,to)=>{if(gn.size){let Zn=C.get(to);Zn||C.set(to,Zn=new Set),gn.forEach((Er,Yr)=>Zn.add(Yr))}}),Xt.postStyleProps.forEach((gn,to)=>{let Zn=v.get(to);Zn||v.set(to,Zn=new Set),gn.forEach((Er,Yr)=>Zn.add(Yr))})});if($t.length){let Oe=[];$t.forEach(Fe=>{Oe.push(Gu(Fe.triggerName,Fe.errors))}),Ot.forEach(Fe=>Fe.destroy()),this.reportError(Oe)}let nt=new Map,Gt=new Map;m.forEach(Oe=>{let Fe=Oe.element;n.has(Fe)&&(Gt.set(Fe,Fe),this._beforeAnimationBuild(Oe.player.namespaceId,Oe.instruction,nt))}),i.forEach(Oe=>{let Fe=Oe.element;this._getPreviousPlayers(Fe,!1,Oe.namespaceId,Oe.triggerName,null).forEach(ut=>{Ni(nt,Fe,[]).push(ut),ut.destroy()})});let Ln=ve.filter(Oe=>Ku(Oe,C,v)),Xn=new Map;Xu(Xn,this.driver,se,v,no).forEach(Oe=>{Ku(Oe,C,v)&&Ln.push(Oe)});let Cn=new Map;F.forEach((Oe,Fe)=>{Xu(Cn,this.driver,new Set(Oe),C,Ra)}),Ln.forEach(Oe=>{let Fe=Xn.get(Oe),Le=Cn.get(Oe);Xn.set(Oe,new Map([...Fe?.entries()??[],...Le?.entries()??[]]))});let qe=[],Nt=[],uo={};m.forEach(Oe=>{let{element:Fe,player:Le,instruction:ut}=Oe;if(n.has(Fe)){if(T.has(Fe)){Le.onDestroy(()=>ao(Fe,ut.toStyles)),Le.disabled=!0,Le.overrideTotalTime(ut.totalTime),i.push(Le);return}let mn=uo;if(Gt.size>1){let kn=Fe,Hi=[];for(;kn=kn.parentNode;){let Xt=Gt.get(kn);if(Xt){mn=Xt;break}Hi.push(kn)}Hi.forEach(Xt=>Gt.set(Xt,mn))}let di=this._buildAnimation(Le.namespaceId,ut,nt,a,Cn,Xn);if(Le.setRealPlayer(di),mn===uo)qe.push(Le);else{let kn=this.playersByElement.get(mn);kn&&kn.length&&(Le.parentPlayer=Go(kn)),i.push(Le)}}else ir(Fe,ut.fromStyles),Le.onDestroy(()=>ao(Fe,ut.toStyles)),Nt.push(Le),T.has(Fe)&&i.push(Le)}),Nt.forEach(Oe=>{let Fe=a.get(Oe.element);if(Fe&&Fe.length){let Le=Go(Fe);Oe.setRealPlayer(Le)}}),i.forEach(Oe=>{Oe.parentPlayer?Oe.syncPlayerEvents(Oe.parentPlayer):Oe.destroy()});for(let Oe=0;Oe<ve.length;Oe++){let Fe=ve[Oe],Le=Fe[so];if(_a(Fe,zs),Le&&Le.hasAnimation)continue;let ut=[];if(u.size){let di=u.get(Fe);di&&di.length&&ut.push(...di);let kn=this.driver.query(Fe,js,!0);for(let Hi=0;Hi<kn.length;Hi++){let Xt=u.get(kn[Hi]);Xt&&Xt.length&&ut.push(...Xt)}}let mn=ut.filter(di=>!di.destroyed);mn.length?HE(this,Fe,mn):this.processLeaveNode(Fe)}return ve.length=0,qe.forEach(Oe=>{this.players.push(Oe),Oe.onDone(()=>{Oe.destroy();let Fe=this.players.indexOf(Oe);this.players.splice(Fe,1)}),Oe.play()}),qe}afterFlush(o){this._flushFns.push(o)}afterFlushAnimationsDone(o){this._whenQuietFns.push(o)}_getPreviousPlayers(o,e,n,i,a){let m=[];if(e){let u=this.playersByQueriedElement.get(o);u&&(m=u)}else{let u=this.playersByElement.get(o);if(u){let C=!a||a==ka;u.forEach(v=>{v.queued||!C&&v.triggerName!=i||m.push(v)})}}return(n||i)&&(m=m.filter(u=>!(n&&n!=u.namespaceId||i&&i!=u.triggerName))),m}_beforeAnimationBuild(o,e,n){let i=e.triggerName,a=e.element,m=e.isRemovalTransition?void 0:o,u=e.isRemovalTransition?void 0:i;for(let C of e.timelines){let v=C.element,T=v!==a,A=Ni(n,v,[]);this._getPreviousPlayers(v,T,m,u,e.toState).forEach(F=>{let k=F.getRealPlayer();k.beforeDestroy&&k.beforeDestroy(),F.destroy(),A.push(F)})}ir(a,e.fromStyles)}_buildAnimation(o,e,n,i,a,m){let u=e.triggerName,C=e.element,v=[],T=new Set,A=new Set,b=e.timelines.map(k=>{let Q=k.element;T.add(Q);let ve=Q[so];if(ve&&ve.removedBeforeQueried)return new vr(k.duration,k.delay);let Re=Q!==C,se=BE((n.get(Q)||GE).map(nt=>nt.getRealPlayer())).filter(nt=>{let Gt=nt;return Gt.element?Gt.element===Q:!1}),ge=a.get(Q),Ue=m.get(Q),Ot=Rc(this._normalizer,k.keyframes,ge,Ue),$t=this._buildPlayer(k,Ot,se);if(k.subTimeline&&i&&A.add(Q),Re){let nt=new Ba(o,u,Q);nt.setRealPlayer($t),v.push(nt)}return $t});v.forEach(k=>{Ni(this.playersByQueriedElement,k.element,[]).push(k),k.onDone(()=>LE(this.playersByQueriedElement,k.element,k))}),T.forEach(k=>Zi(k,Pc));let F=Go(b);return F.onDestroy(()=>{T.forEach(k=>_a(k,Pc)),ao(C,e.toStyles)}),A.forEach(k=>{Ni(i,k,[]).push(F)}),F}_buildPlayer(o,e,n){return e.length>0?this.driver.animate(o.element,e,o.duration,o.delay,o.easing,n):new vr(o.duration,o.delay)}},Ba=class{namespaceId;triggerName;element;_player=new vr;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(o,e,n){this.namespaceId=o,this.triggerName=e,this.element=n}setRealPlayer(o){this._containsRealPlayer||(this._player=o,this._queuedCallbacks.forEach((e,n)=>{e.forEach(i=>Bs(o,n,void 0,i))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(o.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(o){this.totalTime=o}syncPlayerEvents(o){let e=this._player;e.triggerCallback&&o.onStart(()=>e.triggerCallback("start")),o.onDone(()=>this.finish()),o.onDestroy(()=>this.destroy())}_queueEvent(o,e){Ni(this._queuedCallbacks,o,[]).push(e)}onDone(o){this.queued&&this._queueEvent("done",o),this._player.onDone(o)}onStart(o){this.queued&&this._queueEvent("start",o),this._player.onStart(o)}onDestroy(o){this.queued&&this._queueEvent("destroy",o),this._player.onDestroy(o)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(o){this.queued||this._player.setPosition(o)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(o){let e=this._player;e.triggerCallback&&e.triggerCallback(o)}};function LE(t,o,e){let n=t.get(o);if(n){if(n.length){let i=n.indexOf(e);n.splice(i,1)}n.length==0&&t.delete(o)}return n}function kE(t){return t??null}function Ks(t){return t&&t.nodeType===1}function VE(t){return t=="start"||t=="done"}function $u(t,o){let e=t.style.display;return t.style.display=o??"none",e}function Xu(t,o,e,n,i){let a=[];e.forEach(C=>a.push($u(C)));let m=[];n.forEach((C,v)=>{let T=new Map;C.forEach(A=>{let b=o.computeStyle(v,A,i);T.set(A,b),(!b||b.length==0)&&(v[so]=PE,m.push(v))}),t.set(v,T)});let u=0;return e.forEach(C=>$u(C,a[u++])),m}function qu(t,o){let e=new Map;if(t.forEach(u=>e.set(u,[])),o.length==0)return e;let n=1,i=new Set(o),a=new Map;function m(u){if(!u)return n;let C=a.get(u);if(C)return C;let v=u.parentNode;return e.has(v)?C=v:i.has(v)?C=n:C=m(v),a.set(u,C),C}return o.forEach(u=>{let C=m(u);C!==n&&e.get(C).push(u)}),e}function Zi(t,o){t.classList?.add(o)}function _a(t,o){t.classList?.remove(o)}function HE(t,o,e){Go(e).onDone(()=>t.processLeaveNode(o))}function BE(t){let o=[];return n0(t,o),o}function n0(t,o){for(let e=0;e<t.length;e++){let n=t[e];n instanceof xs?n0(n.players,o):o.push(n)}}function WE(t,o){let e=Object.keys(t),n=Object.keys(o);if(e.length!=n.length)return!1;for(let i=0;i<e.length;i++){let a=e[i];if(!o.hasOwnProperty(a)||t[a]!==o[a])return!1}return!0}function Ku(t,o,e){let n=e.get(t);if(!n)return!1;let i=o.get(t);return i?n.forEach(a=>i.add(a)):o.set(t,n),e.delete(t),!0}var ha=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(o,e)=>{};constructor(o,e,n){this._driver=e,this._normalizer=n,this._transitionEngine=new Zc(o.body,e,n),this._timelineEngine=new Kc(o.body,e,n),this._transitionEngine.onRemovalComplete=(i,a)=>this.onRemovalComplete(i,a)}registerTrigger(o,e,n,i,a){let m=o+"-"+i,u=this._triggerCache[m];if(!u){let C=[],v=[],T=Zu(this._driver,a,C,v);if(C.length)throw Su(i,C);u=bE(i,T,this._normalizer),this._triggerCache[m]=u}this._transitionEngine.registerTrigger(e,i,u)}register(o,e){this._transitionEngine.register(o,e)}destroy(o,e){this._transitionEngine.destroy(o,e)}onInsert(o,e,n,i){this._transitionEngine.insertNode(o,e,n,i)}onRemove(o,e,n){this._transitionEngine.removeNode(o,e,n)}disableAnimations(o,e){this._transitionEngine.markElementAsDisabled(o,e)}process(o,e,n,i){if(n.charAt(0)=="@"){let[a,m]=Oc(n),u=i;this._timelineEngine.command(a,e,m,u)}else this._transitionEngine.trigger(o,e,n,i)}listen(o,e,n,i,a){if(n.charAt(0)=="@"){let[m,u]=Oc(n);return this._timelineEngine.listen(m,e,u,a)}return this._transitionEngine.listen(o,e,n,i,a)}flush(o=-1){this._transitionEngine.flush(o)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(o){this._transitionEngine.afterFlushAnimationsDone(o)}};function UE(t,o){let e=null,n=null;return Array.isArray(o)&&o.length?(e=Wc(o[0]),o.length>1&&(n=Wc(o[o.length-1]))):o instanceof Map&&(e=Wc(o)),e||n?new zE(t,e,n):null}var zE=(()=>{class t{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(e,n,i){this._element=e,this._startStyles=n,this._endStyles=i;let a=t.initialStylesByElement.get(e);a||t.initialStylesByElement.set(e,a=new Map),this._initialStyles=a}start(){this._state<1&&(this._startStyles&&ao(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ao(this._element,this._initialStyles),this._endStyles&&(ao(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(t.initialStylesByElement.delete(this._element),this._startStyles&&(ir(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(ir(this._element,this._endStyles),this._endStyles=null),ao(this._element,this._initialStyles),this._state=3)}}return t})();function Wc(t){let o=null;return t.forEach((e,n)=>{jE(n)&&(o=o||new Map,o.set(n,e))}),o}function jE(t){return t==="display"||t==="position"}var il=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(o,e,n,i){this.element=o,this.keyframes=e,this.options=n,this._specialStyles=i,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(o=>o()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let o=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,o,this.options),this._finalKeyframe=o.length?o[o.length-1]:new Map;let e=()=>this._onFinish();this.domPlayer.addEventListener("finish",e),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",e)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(o){let e=[];return o.forEach(n=>{e.push(Object.fromEntries(n))}),e}_triggerWebAnimation(o,e,n){return o.animate(this._convertKeyframesToObject(e),n)}onStart(o){this._originalOnStartFns.push(o),this._onStartFns.push(o)}onDone(o){this._originalOnDoneFns.push(o),this._onDoneFns.push(o)}onDestroy(o){this._onDestroyFns.push(o)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(o=>o()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(o=>o()),this._onDestroyFns=[])}setPosition(o){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=o*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let o=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,i)=>{i!=="offset"&&o.set(i,this._finished?n:$s(this.element,i))}),this.currentSnapshot=o}triggerCallback(o){let e=o==="start"?this._onStartFns:this._onDoneFns;e.forEach(n=>n()),e.length=0}},ol=class{validateStyleProperty(o){return!0}validateAnimatableStyleProperty(o){return!0}containsElement(o,e){return Nc(o,e)}getParentElement(o){return Us(o)}query(o,e,n){return Mc(o,e,n)}computeStyle(o,e,n){return $s(o,e)}animate(o,e,n,i,a,m=[]){let u=i==0?"both":"forwards",C={duration:n,delay:i,fill:u};a&&(C.easing=a);let v=new Map,T=m.filter(F=>F instanceof il);Vu(n,i)&&T.forEach(F=>{F.currentSnapshot.forEach((k,Q)=>v.set(Q,k))});let A=Lu(e).map(F=>new Map(F));A=Hu(o,A,v);let b=UE(o,A);return new il(o,A,C,b)}};var Qs="@",i0="@.disabled",rl=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(o,e,n,i){this.namespaceId=o,this.delegate=e,this.engine=n,this._onDestroy=i}get data(){return this.delegate.data}destroyNode(o){this.delegate.destroyNode?.(o)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(o,e){return this.delegate.createElement(o,e)}createComment(o){return this.delegate.createComment(o)}createText(o){return this.delegate.createText(o)}appendChild(o,e){this.delegate.appendChild(o,e),this.engine.onInsert(this.namespaceId,e,o,!1)}insertBefore(o,e,n,i=!0){this.delegate.insertBefore(o,e,n),this.engine.onInsert(this.namespaceId,e,o,i)}removeChild(o,e,n,i){if(i){this.delegate.removeChild(o,e,n);return}this.parentNode(e)&&this.engine.onRemove(this.namespaceId,e,this.delegate)}selectRootElement(o,e){return this.delegate.selectRootElement(o,e)}parentNode(o){return this.delegate.parentNode(o)}nextSibling(o){return this.delegate.nextSibling(o)}setAttribute(o,e,n,i){this.delegate.setAttribute(o,e,n,i)}removeAttribute(o,e,n){this.delegate.removeAttribute(o,e,n)}addClass(o,e){this.delegate.addClass(o,e)}removeClass(o,e){this.delegate.removeClass(o,e)}setStyle(o,e,n,i){this.delegate.setStyle(o,e,n,i)}removeStyle(o,e,n){this.delegate.removeStyle(o,e,n)}setProperty(o,e,n){e.charAt(0)==Qs&&e==i0?this.disableAnimations(o,!!n):this.delegate.setProperty(o,e,n)}setValue(o,e){this.delegate.setValue(o,e)}listen(o,e,n,i){return this.delegate.listen(o,e,n,i)}disableAnimations(o,e){this.engine.disableAnimations(o,e)}},Jc=class extends rl{factory;constructor(o,e,n,i,a){super(e,n,i,a),this.factory=o,this.namespaceId=e}setProperty(o,e,n){e.charAt(0)==Qs?e.charAt(1)=="."&&e==i0?(n=n===void 0?!0:!!n,this.disableAnimations(o,n)):this.engine.process(this.namespaceId,o,e.slice(1),n):this.delegate.setProperty(o,e,n)}listen(o,e,n,i){if(e.charAt(0)==Qs){let a=YE(o),m=e.slice(1),u="";return m.charAt(0)!=Qs&&([m,u]=$E(m)),this.engine.listen(this.namespaceId,a,m,u,C=>{let v=C._data||-1;this.factory.scheduleListenerCallback(v,n,C)})}return this.delegate.listen(o,e,n,i)}};function YE(t){switch(t){case"body":return document.body;case"document":return document;case"window":return window;default:return t}}function $E(t){let o=t.indexOf("."),e=t.substring(0,o),n=t.slice(o+1);return[e,n]}var al=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(o,e,n){this.delegate=o,this.engine=e,this._zone=n,e.onRemovalComplete=(i,a)=>{a?.removeChild(null,i)}}createRenderer(o,e){let i=this.delegate.createRenderer(o,e);if(!o||!e?.data?.animation){let v=this._rendererCache,T=v.get(i);if(!T){let A=()=>v.delete(i);T=new rl("",i,this.engine,A),v.set(i,T)}return T}let a=e.id,m=e.id+"-"+this._currentId;this._currentId++,this.engine.register(m,o);let u=v=>{Array.isArray(v)?v.forEach(u):this.engine.registerTrigger(a,m,o,v.name,v)};return e.data.animation.forEach(u),new Jc(this,m,i,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(o,e,n){if(o>=0&&o<this._microtaskId){this._zone.run(()=>e(n));return}let i=this._animationCallbacksBuffer;i.length==0&&queueMicrotask(()=>{this._zone.run(()=>{i.forEach(a=>{let[m,u]=a;m(u)}),this._animationCallbacksBuffer=[]})}),i.push([e,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(o){this.engine.flush(),this.delegate.componentReplaced?.(o)}};var qE=(()=>{class t extends ha{constructor(e,n,i){super(e,n,i)}ngOnDestroy(){this.flush()}static \u0275fac=function(n){return new(n||t)(Jt(Cs),Jt(br),Jt(Dr))};static \u0275prov=xi({token:t,factory:t.\u0275fac})}return t})();function KE(){return new Zs}function QE(t,o,e){return new al(t,o,e)}var r0=[{provide:Dr,useFactory:KE},{provide:ha,useClass:qE},{provide:yp,useFactory:QE,deps:[Np,ha,hc]}],ZE=[{provide:br,useClass:em},{provide:_c,useValue:"NoopAnimations"},...r0],o0=[{provide:br,useFactory:()=>new ol},{provide:_c,useFactory:()=>"BrowserAnimations"},...r0],lo=(()=>{class t{static withConfig(e){return{ngModule:t,providers:e.disableAnimations?ZE:o0}}static \u0275fac=function(n){return new(n||t)};static \u0275mod=X({type:t});static \u0275inj=$({providers:o0,imports:[Te]})}return t})();function a0(t,o,e){let[n,i]=Td(e?.in,t,o);return+sa(n)==+sa(i)}var l0=(()=>{class t{constructor(e,n,i,a){this.routeService=e,this.service=n,this.websocket=i,this.pagination=a,this.latestIncident=null,this.edge=null,wt(()=>{let m=this.service.currentEdge();!this.routeService.getRouteParam("edgeId")||!m||a.subscribeEdge(m)})}ngOnInit(){return ae(this,null,function*(){let e=this.routeService.getRouteParam("edgeId");this.service.updateCurrentEdge(e)})}ionViewWillLeave(){this.ngOnDestroy()}ngOnDestroy(){this.service.currentEdge.set(null),this.edge&&this.edge.unsubscribeAllChannels(this.websocket)}static{this.\u0275fac=function(n){return new(n||t)(x(Ko),x(j),x(Ce),x(pa))}}static{this.\u0275cmp=I({type:t,selectors:[["edge"]],standalone:!1,decls:2,vars:0,consts:[["id","content"]],template:function(n,i){n&1&&d(0,"ion-content")(1,"ion-router-outlet",0)},dependencies:[je,aa],encapsulation:2})}}return t})();function ev(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function tv(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var c0=(()=>{class t extends de{getChartData(){return this.spinnerId="autarchy-chart",{input:[{name:"Consumption",powerChannel:y.fromString("_sum/ConsumptionActivePower"),energyChannel:y.fromString("_sum/ConsumptionActiveEnergy")},{name:"GridBuy",powerChannel:y.fromString("_sum/GridActivePower"),energyChannel:y.fromString("_sum/GridBuyActiveEnergy"),converter:Je.ValueConverter.NON_NULL_OR_NEGATIVE}],output:e=>[{name:this.translate.instant("GENERAL.AUTARCHY"),nameSuffix:n=>M.calculateAutarchy(n?.result.data["_sum/GridBuyActiveEnergy"]??null,n?.result.data["_sum/ConsumptionActiveEnergy"]??null),converter:()=>e.Consumption?.map((n,i)=>M.calculateAutarchy(e.GridBuy[i],n)),color:"rgb(0,152,204)"}],tooltip:{formatNumber:"1.0-0"},yAxes:[{unit:Z.PERCENTAGE,position:"left",yAxisId:B.LEFT}]}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["autarchychart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,ev,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,tv,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();var m0=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:3,vars:4,consts:[[3,"title"],[3,"isOnlyChart"]],template:function(n,i){n&1&&(s(0,"oe-chart",0),g(1,"translate"),d(2,"autarchychart",1),l()),n&2&&(c("title",E(1,2,"GENERAL.AUTARCHY")),r(2),c("isOnlyChart",!0))},dependencies:[tt,c0,V],encapsulation:2})}}return t})();function iv(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function ov(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var p0=(()=>{class t extends de{static getChartData(e,n,i){let a=e?.getComponent(n.snapshot.params.componentId);return{input:[{name:a.id,powerChannel:y.fromString(a.id+"/ActivePower"),energyChannel:y.fromString(a.id+"/ActiveProductionEnergy")},...jt.THREE_PHASE.map(m=>({name:"ConsumptionActivePower"+m,powerChannel:y.fromString(a.id+"/ActivePower"+m),energyChannel:y.fromString(a.id+"/ActiveProductionEnergy"+m)}))],output:m=>[{name:a.alias,nameSuffix:u=>u.result.data[a.id+"/ActiveProductionEnergy"],converter:()=>m[a.id],color:U.Colors.RED,hiddenOnInit:!1,stack:2},...jt.THREE_PHASE.map((u,C)=>({name:"Phase "+u,converter:()=>m["ConsumptionActivePower"+u],color:"rgb("+de.phaseColors[C]+")",stack:3}))],tooltip:{formatNumber:"1.1-2",afterTitle:i.instant("GENERAL.TOTAL")},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.route,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["consumptionMeterChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,iv,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,ov,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();var vi=class t extends Qo.Component{constructor(o,e,n,i){super(o,e),this.powerChannel=n,this.energyChannel=i}static isDeprecated(o,e,n){return!(n!=null&&o!=null&&e!=null&&e.hasComponentNature("io.openems.edge.evcs.api.DeprecatedEvcs",o.id)==!1&&n.isVersionAtLeast("2024.10.2"))}static getComponents(o,e){return o.getComponentsImplementingNature("io.openems.edge.evcs.api.Evcs").filter(n=>!["Evcs.Cluster","Evcs.Cluster.PeakShaving","Evcs.Cluster.SelfConsumption"].includes(n.factoryId)).map(n=>t.from(n,o,e))}static from(o,e,n){let i=t.isDeprecated(o,e,n)?"ChargePower":"ActivePower",a=t.isDeprecated(o,e,n)?"ActiveConsumptionEnergy":"ActiveProductionEnergy";return new t(o.id,o.alias,new y(o.id,i),new y(o.id,a))}getChartInputChannel(){return console.log(this.powerChannel),console.log(this.energyChannel),{name:this.powerChannel.toString(),powerChannel:this.powerChannel,energyChannel:this.energyChannel}}getChartDisplayValue(o,e,n){return ke({name:this.alias,nameSuffix:i=>i?.result.data[this.energyChannel.toString()],converter:()=>o[this.powerChannel.toString()]??null,color:e},n)}};function av(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function sv(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var d0=(()=>{class t extends de{static getChartData(e,n,i,a){let m=e?.getComponent(n.snapshot.params.componentId),u=vi.from(m,e,a);return{input:[{name:u.id,powerChannel:u.powerChannel,energyChannel:u.energyChannel}],output:C=>[{name:u.alias,nameSuffix:v=>v.result.data[u.energyChannel.toString()],converter:()=>C[u.id],color:U.Colors.GREEN,hiddenOnInit:!1,stack:2}],tooltip:{formatNumber:"1.1-2",afterTitle:i.instant("GENERAL.TOTAL")},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.route,this.translate,this.edge)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["evcsChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,av,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,sv,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function cv(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function mv(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var u0=(()=>{class t extends de{static getChartData(e,n,i){let a=e?.getComponent(n.snapshot.params.componentId);return{input:[{name:a.id,powerChannel:y.fromString(a.id+"/ConsumptionActivePower"),energyChannel:y.fromString(a.id+"/ConsumptionActiveEnergy")},...jt.THREE_PHASE.map(m=>({name:"ConsumptionActivePower"+m,powerChannel:y.fromString(a.id+"/ConsumptionActivePower"+m)}))],output:m=>[{name:a.alias,nameSuffix:u=>u.result.data[a.id+"/ConsumptionActiveEnergy"],converter:()=>m[a.id],color:"rgb(0,152,204)",hiddenOnInit:!1,stack:2},...jt.THREE_PHASE.map((u,C)=>({name:"Phase "+u,converter:()=>m["ConsumptionActivePower"+u],color:"rgb("+de.phaseColors[C]+")",stack:3}))],tooltip:{formatNumber:"1.1-2",afterTitle:i.instant("GENERAL.TOTAL")},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.route,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["sumChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,cv,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,mv,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function dv(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function uv(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var f0=(()=>{class t extends de{static getChartData(e,n,i){let a=e?.getComponent(n.snapshot.params.componentId);return{input:[{name:a.id,powerChannel:y.fromString(a.id+"/ActivePower"),energyChannel:y.fromString(a.id+"/ActiveProductionEnergy")}],output:m=>[{name:a.alias,nameSuffix:u=>u.result.data[a.id+"/ActiveProductionEnergy"],converter:()=>m[a.id],color:U.Colors.GREEN,stack:2}],tooltip:{formatNumber:"1.1-2"},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.route,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["heatChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,dv,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,uv,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function _v(t,o){t&1&&d(0,"sumChart",2),t&2&&c("isOnlyChart",!0)}function hv(t,o){t&1&&d(0,"consumptionMeterChart",2),t&2&&c("isOnlyChart",!0)}function Cv(t,o){t&1&&d(0,"evcsChart",2),t&2&&c("isOnlyChart",!0)}function gv(t,o){t&1&&d(0,"heatChart",2),t&2&&c("isOnlyChart",!0)}function Ev(t,o){if(t&1&&(s(0,"oe-chart",0),g(1,"translate"),f(2,_v,1,1,"sumChart",2)(3,hv,1,1,"consumptionMeterChart",2)(4,Cv,1,1,"evcsChart",2)(5,gv,1,1,"heatChart",2),l()),t&2){let e,n=p();c("title",n.component.alias+"\xA0-\xA0"+E(1,3,"EDGE.HISTORY.PHASE_ACCURATE"))("period",n.service.historyPeriod.value),r(2),_((e=n.componentType)==="sum"?2:e==="consumptionMeter"?3:e==="evcs"?4:e==="heat"?5:-1)}}function vv(t,o){if(t&1&&d(0,"oe-footer-subnavigation",1),t&2){let e=p();c("backButton",!0)("navigationOptions",e.navigationButtons)}}var _0=(()=>{class t extends et{constructor(e,n,i,a,m){super(e,n,i),this.service=e,this.route=n,this.modalCtrl=i,this.router=a,this.translate=m,this.navigationButtons=[],this.componentType=null}afterIsInitialized(){this.componentType=this.getComponentType(),this.service.getCurrentEdge().then(e=>{if(this.component&&!this.config?.hasComponentNature("io.openems.edge.evcs.api.Evcs",this.component.id)){if(this.component.factoryId==="Core.Sum"){this.component.alias=this.translate.instant("GENERAL.TOTAL");return}this.component.factoryId!=="Heat.Askoma"&&(this.navigationButtons=[{id:"currentVoltage",isEnabled:e.roleIsAtLeast(Rt.INSTALLER),alias:this.translate.instant("EDGE.HISTORY.CURRENT_AND_VOLTAGE"),callback:()=>{this.router.navigate(["./currentVoltage"],{relativeTo:this.route})}}])}})}getComponentType(){return this.component?this.config?.hasComponentNature("io.openems.edge.evcs.api.Evcs",this.component.id)&&this.component.factoryId!=="Evcs.Cluster.SelfConsumption"&&this.component.factoryId!=="Evcs.Cluster.PeakShaving"&&this.component.isEnabled!==!1?"evcs":this.config?.hasComponentNature("io.openems.edge.heat.api.Heat",this.component.id)&&this.component.factoryId!=="Controller.Heat.Heatingelement"&&this.component.isEnabled!==!1?"heat":this.config?.hasComponentNature("io.openems.edge.meter.api.ElectricityMeter",this.component.id)&&this.config.isTypeConsumptionMetered(this.component)&&this.component.isEnabled?"consumptionMeter":this.component.factoryId==="Core.Sum"?"sum":null:null}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(he),x(It),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:2,vars:2,consts:[[3,"title","period"],[3,"backButton","navigationOptions"],[3,"isOnlyChart"]],template:function(n,i){n&1&&(f(0,Ev,6,5,"oe-chart",0),f(1,vv,1,2,"oe-footer-subnavigation",1)),n&2&&(_(i.isInitialized&&i.component?0:-1),r(),_(i.isInitialized?1:-1))},dependencies:[xn,tt,p0,d0,u0,f0,V],encapsulation:2})}}return t})();function yv(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function Tv(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var h0=(()=>{class t extends de{static getChartData(e,n,i){let a=[{name:"ConsumptionActivePower",powerChannel:y.fromString("_sum/ConsumptionActivePower"),energyChannel:y.fromString("_sum/ConsumptionActiveEnergy")}],m=vi.getComponents(e,i);m.forEach(v=>{a.push(v.getChartInputChannel())});let u=e.getComponentsImplementingNature("io.openems.edge.heat.api.Heat").filter(v=>v.factoryId!=="Controller.Heat.Heatingelement"&&!!v.isEnabled);a.push(...u.map(v=>({name:v.id+"/ActivePower",powerChannel:new y(v.id,"ActivePower"),energyChannel:new y(v.id,"ActiveProductionEnergy")})));let C=e.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(v=>{let T=e.getNatureIdsByFactoryId(v.factoryId),A=T.includes("io.openems.edge.evcs.api.Evcs"),b=T.includes("io.openems.edge.heat.api.Heat");return v.isEnabled&&e.isTypeConsumptionMetered(v)&&A===!1&&b===!1});return C.forEach(v=>{a.push({name:v.id+"/ActivePower",powerChannel:y.fromString(v.id+"/ActivePower"),energyChannel:y.fromString(v.id+"/ActiveProductionEnergy")})}),{input:[...a],output:v=>{let T=[];T.push({name:n.instant("GENERAL.TOTAL"),nameSuffix:k=>k?.result.data["_sum/ConsumptionActiveEnergy"],converter:()=>v.ConsumptionActivePower??null,color:U.Colors.YELLOW,stack:0});let A=U.Colors.SHADES_OF_GREEN;T.push(...m.map((k,Q)=>k.getChartDisplayValue(v,A[Q%(A.length-1)])));let b=U.Colors.SHADES_OF_GREEN;u.forEach((k,Q)=>{T.push({name:k.alias,nameSuffix:ve=>ve?.result.data[k.id+"/ActiveProductionEnergy"],converter:()=>v[k.id+"/ActivePower"]??null,color:b[Q%(b.length-1)],stack:2})});let F=U.Colors.SHADES_OF_YELLOW;return C.forEach((k,Q)=>{T.push({name:k.alias,nameSuffix:ve=>ve?.result.data[k.id+"/ActiveProductionEnergy"],converter:()=>v[k.id+"/ActivePower"]??null,color:F[Q%(F.length-1)],stack:1})}),(C.length>0||m.length>0||u.length>0)&&T.push({name:n.instant("GENERAL.OTHER_CONSUMPTION"),nameSuffix:k=>M.calculateOtherConsumptionTotal(k,m,u,C),converter:()=>M.calculateOtherConsumption(v,m,u,C),color:U.Colors.GREY,stack:1}),T},tooltip:{formatNumber:"1.0-2"},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.translate,this.edge)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["consumptionchart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,yv,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,Tv,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function xv(t,o){if(t&1){let e=W();s(0,"oe-chart",2),g(1,"translate"),Zt("showPhasesChange",function(i){P(e);let a=p();return Qt(a.showPhases,i)||(a.showPhases=i),L(i)}),d(2,"consumptionchart",3),l()}if(t&2){let e=p();c("title",E(1,4,"GENERAL.CONSUMPTION")),Kt("showPhases",e.showPhases),c("period",e.service.historyPeriod.value),r(2),c("isOnlyChart",!0)}}function Sv(t,o){if(t&1&&d(0,"oe-footer-subnavigation",1),t&2){let e=p();c("navigationOptions",e.navigationButtons)}}var C0=(()=>{class t extends et{constructor(e,n,i,a,m){super(e,n,i),this.service=e,this.route=n,this.modalCtrl=i,this.router=a,this.translate=m,this.navigationButtons=[],this.evcsComponents=[],this.consumptionMeterComponents=[]}getChannelAddresses(){this.evcsComponents=this.config?.getComponentsImplementingNature("io.openems.edge.evcs.api.Evcs").filter(i=>i.factoryId!=="Evcs.Cluster.SelfConsumption"&&i.factoryId!=="Evcs.Cluster.PeakShaving"&&!!i.isEnabled);let e=this.config?.getComponentsImplementingNature("io.openems.edge.heat.api.Heat").filter(i=>i.factoryId!=="Controller.Heat.Heatingelement"&&!!i.isEnabled);this.consumptionMeterComponents=this.config?.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(i=>i.isEnabled&&this.config.isTypeConsumptionMetered(i)&&!this.config.getNatureIdsByFactoryId(i.factoryId).includes("io.openems.edge.evcs.api.Evcs")&&!this.config.getNatureIdsByFactoryId(i.factoryId).includes("io.openems.edge.heat.api.Heat"));let n=this.config.getComponent("_sum");return n.alias=this.translate.instant("EDGE.HISTORY.PHASE_ACCURATE"),this.navigationButtons=[n,...this.evcsComponents,...e,...this.consumptionMeterComponents].map(i=>({id:i.id,alias:i.alias,callback:()=>{this.router.navigate(["./"+i.id],{relativeTo:this.route})}})),[]}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(he),x(It),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:2,vars:2,consts:[[3,"title","showPhases","period"],[3,"navigationOptions"],[3,"showPhasesChange","title","showPhases","period"],[3,"isOnlyChart"]],template:function(n,i){n&1&&(f(0,xv,3,6,"oe-chart",0),f(1,Sv,1,1,"oe-footer-subnavigation",1)),n&2&&(_(i.isInitialized?0:-1),r(),_(i.isInitialized?1:-1))},dependencies:[xn,tt,h0,V],encapsulation:2})}}return t})();var Av={value:()=>{}};function E0(){for(var t=0,o=arguments.length,e={},n;t<o;++t){if(!(n=arguments[t]+"")||n in e||/[\s.]/.test(n))throw new Error("illegal type: "+n);e[n]=[]}return new sl(e)}function sl(t){this._=t}function wv(t,o){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");if(i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),e&&!o.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}})}sl.prototype=E0.prototype={constructor:sl,on:function(t,o){var e=this._,n=wv(t+"",e),i,a=-1,m=n.length;if(arguments.length<2){for(;++a<m;)if((i=(t=n[a]).type)&&(i=bv(e[i],t.name)))return i;return}if(o!=null&&typeof o!="function")throw new Error("invalid callback: "+o);for(;++a<m;)if(i=(t=n[a]).type)e[i]=g0(e[i],t.name,o);else if(o==null)for(i in e)e[i]=g0(e[i],t.name,null);return this},copy:function(){var t={},o=this._;for(var e in o)t[e]=o[e].slice();return new sl(t)},call:function(t,o){if((i=arguments.length-2)>0)for(var e=new Array(i),n=0,i,a;n<i;++n)e[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],n=0,i=a.length;n<i;++n)a[n].value.apply(o,e)},apply:function(t,o,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],i=0,a=n.length;i<a;++i)n[i].value.apply(o,e)}};function bv(t,o){for(var e=0,n=t.length,i;e<n;++e)if((i=t[e]).name===o)return i.value}function g0(t,o,e){for(var n=0,i=t.length;n<i;++n)if(t[n].name===o){t[n]=Av,t=t.slice(0,n).concat(t.slice(n+1));break}return e!=null&&t.push({name:o,value:e}),t}var nm=E0;var ll="http://www.w3.org/1999/xhtml",im={svg:"http://www.w3.org/2000/svg",xhtml:ll,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Lo(t){var o=t+="",e=o.indexOf(":");return e>=0&&(o=t.slice(0,e))!=="xmlns"&&(t=t.slice(e+1)),im.hasOwnProperty(o)?{space:im[o],local:t}:t}function Dv(t){return function(){var o=this.ownerDocument,e=this.namespaceURI;return e===ll&&o.documentElement.namespaceURI===ll?o.createElement(t):o.createElementNS(e,t)}}function Rv(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function cl(t){var o=Lo(t);return(o.local?Rv:Dv)(o)}function Ov(){}function Rr(t){return t==null?Ov:function(){return this.querySelector(t)}}function v0(t){typeof t!="function"&&(t=Rr(t));for(var o=this._groups,e=o.length,n=new Array(e),i=0;i<e;++i)for(var a=o[i],m=a.length,u=n[i]=new Array(m),C,v,T=0;T<m;++T)(C=a[T])&&(v=t.call(C,C.__data__,T,a))&&("__data__"in C&&(v.__data__=C.__data__),u[T]=v);return new Fn(n,this._parents)}function om(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Nv(){return[]}function Wa(t){return t==null?Nv:function(){return this.querySelectorAll(t)}}function Mv(t){return function(){return om(t.apply(this,arguments))}}function y0(t){typeof t=="function"?t=Mv(t):t=Wa(t);for(var o=this._groups,e=o.length,n=[],i=[],a=0;a<e;++a)for(var m=o[a],u=m.length,C,v=0;v<u;++v)(C=m[v])&&(n.push(t.call(C,C.__data__,v,m)),i.push(C));return new Fn(n,i)}function Ua(t){return function(){return this.matches(t)}}function ml(t){return function(o){return o.matches(t)}}var Fv=Array.prototype.find;function Gv(t){return function(){return Fv.call(this.children,t)}}function Pv(){return this.firstElementChild}function T0(t){return this.select(t==null?Pv:Gv(typeof t=="function"?t:ml(t)))}var Lv=Array.prototype.filter;function kv(){return Array.from(this.children)}function Vv(t){return function(){return Lv.call(this.children,t)}}function I0(t){return this.selectAll(t==null?kv:Vv(typeof t=="function"?t:ml(t)))}function x0(t){typeof t!="function"&&(t=Ua(t));for(var o=this._groups,e=o.length,n=new Array(e),i=0;i<e;++i)for(var a=o[i],m=a.length,u=n[i]=[],C,v=0;v<m;++v)(C=a[v])&&t.call(C,C.__data__,v,a)&&u.push(C);return new Fn(n,this._parents)}function pl(t){return new Array(t.length)}function S0(){return new Fn(this._enter||this._groups.map(pl),this._parents)}function za(t,o){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=o}za.prototype={constructor:za,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,o){return this._parent.insertBefore(t,o)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function A0(t){return function(){return t}}function Hv(t,o,e,n,i,a){for(var m=0,u,C=o.length,v=a.length;m<v;++m)(u=o[m])?(u.__data__=a[m],n[m]=u):e[m]=new za(t,a[m]);for(;m<C;++m)(u=o[m])&&(i[m]=u)}function Bv(t,o,e,n,i,a,m){var u,C,v=new Map,T=o.length,A=a.length,b=new Array(T),F;for(u=0;u<T;++u)(C=o[u])&&(b[u]=F=m.call(C,C.__data__,u,o)+"",v.has(F)?i[u]=C:v.set(F,C));for(u=0;u<A;++u)F=m.call(t,a[u],u,a)+"",(C=v.get(F))?(n[u]=C,C.__data__=a[u],v.delete(F)):e[u]=new za(t,a[u]);for(u=0;u<T;++u)(C=o[u])&&v.get(b[u])===C&&(i[u]=C)}function Wv(t){return t.__data__}function w0(t,o){if(!arguments.length)return Array.from(this,Wv);var e=o?Bv:Hv,n=this._parents,i=this._groups;typeof t!="function"&&(t=A0(t));for(var a=i.length,m=new Array(a),u=new Array(a),C=new Array(a),v=0;v<a;++v){var T=n[v],A=i[v],b=A.length,F=Uv(t.call(T,T&&T.__data__,v,n)),k=F.length,Q=u[v]=new Array(k),ve=m[v]=new Array(k),Re=C[v]=new Array(b);e(T,A,Q,ve,Re,F,o);for(var se=0,ge=0,Ue,Ot;se<k;++se)if(Ue=Q[se]){for(se>=ge&&(ge=se+1);!(Ot=ve[ge])&&++ge<k;);Ue._next=Ot||null}}return m=new Fn(m,n),m._enter=u,m._exit=C,m}function Uv(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function b0(){return new Fn(this._exit||this._groups.map(pl),this._parents)}function D0(t,o,e){var n=this.enter(),i=this,a=this.exit();return typeof t=="function"?(n=t(n),n&&(n=n.selection())):n=n.append(t+""),o!=null&&(i=o(i),i&&(i=i.selection())),e==null?a.remove():e(a),n&&i?n.merge(i).order():i}function R0(t){for(var o=t.selection?t.selection():t,e=this._groups,n=o._groups,i=e.length,a=n.length,m=Math.min(i,a),u=new Array(i),C=0;C<m;++C)for(var v=e[C],T=n[C],A=v.length,b=u[C]=new Array(A),F,k=0;k<A;++k)(F=v[k]||T[k])&&(b[k]=F);for(;C<i;++C)u[C]=e[C];return new Fn(u,this._parents)}function O0(){for(var t=this._groups,o=-1,e=t.length;++o<e;)for(var n=t[o],i=n.length-1,a=n[i],m;--i>=0;)(m=n[i])&&(a&&m.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(m,a),a=m);return this}function N0(t){t||(t=zv);function o(A,b){return A&&b?t(A.__data__,b.__data__):!A-!b}for(var e=this._groups,n=e.length,i=new Array(n),a=0;a<n;++a){for(var m=e[a],u=m.length,C=i[a]=new Array(u),v,T=0;T<u;++T)(v=m[T])&&(C[T]=v);C.sort(o)}return new Fn(i,this._parents).order()}function zv(t,o){return t<o?-1:t>o?1:t>=o?0:NaN}function M0(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function F0(){return Array.from(this)}function G0(){for(var t=this._groups,o=0,e=t.length;o<e;++o)for(var n=t[o],i=0,a=n.length;i<a;++i){var m=n[i];if(m)return m}return null}function P0(){let t=0;for(let o of this)++t;return t}function L0(){return!this.node()}function k0(t){for(var o=this._groups,e=0,n=o.length;e<n;++e)for(var i=o[e],a=0,m=i.length,u;a<m;++a)(u=i[a])&&t.call(u,u.__data__,a,i);return this}function jv(t){return function(){this.removeAttribute(t)}}function Yv(t){return function(){this.removeAttributeNS(t.space,t.local)}}function $v(t,o){return function(){this.setAttribute(t,o)}}function Xv(t,o){return function(){this.setAttributeNS(t.space,t.local,o)}}function qv(t,o){return function(){var e=o.apply(this,arguments);e==null?this.removeAttribute(t):this.setAttribute(t,e)}}function Kv(t,o){return function(){var e=o.apply(this,arguments);e==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function V0(t,o){var e=Lo(t);if(arguments.length<2){var n=this.node();return e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}return this.each((o==null?e.local?Yv:jv:typeof o=="function"?e.local?Kv:qv:e.local?Xv:$v)(e,o))}function dl(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Qv(t){return function(){this.style.removeProperty(t)}}function Zv(t,o,e){return function(){this.style.setProperty(t,o,e)}}function Jv(t,o,e){return function(){var n=o.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,e)}}function H0(t,o,e){return arguments.length>1?this.each((o==null?Qv:typeof o=="function"?Jv:Zv)(t,o,e??"")):or(this.node(),t)}function or(t,o){return t.style.getPropertyValue(o)||dl(t).getComputedStyle(t,null).getPropertyValue(o)}function ey(t){return function(){delete this[t]}}function ty(t,o){return function(){this[t]=o}}function ny(t,o){return function(){var e=o.apply(this,arguments);e==null?delete this[t]:this[t]=e}}function B0(t,o){return arguments.length>1?this.each((o==null?ey:typeof o=="function"?ny:ty)(t,o)):this.node()[t]}function W0(t){return t.trim().split(/^|\s+/)}function rm(t){return t.classList||new U0(t)}function U0(t){this._node=t,this._names=W0(t.getAttribute("class")||"")}U0.prototype={add:function(t){var o=this._names.indexOf(t);o<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var o=this._names.indexOf(t);o>=0&&(this._names.splice(o,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function z0(t,o){for(var e=rm(t),n=-1,i=o.length;++n<i;)e.add(o[n])}function j0(t,o){for(var e=rm(t),n=-1,i=o.length;++n<i;)e.remove(o[n])}function iy(t){return function(){z0(this,t)}}function oy(t){return function(){j0(this,t)}}function ry(t,o){return function(){(o.apply(this,arguments)?z0:j0)(this,t)}}function Y0(t,o){var e=W0(t+"");if(arguments.length<2){for(var n=rm(this.node()),i=-1,a=e.length;++i<a;)if(!n.contains(e[i]))return!1;return!0}return this.each((typeof o=="function"?ry:o?iy:oy)(e,o))}function ay(){this.textContent=""}function sy(t){return function(){this.textContent=t}}function ly(t){return function(){var o=t.apply(this,arguments);this.textContent=o??""}}function $0(t){return arguments.length?this.each(t==null?ay:(typeof t=="function"?ly:sy)(t)):this.node().textContent}function cy(){this.innerHTML=""}function my(t){return function(){this.innerHTML=t}}function py(t){return function(){var o=t.apply(this,arguments);this.innerHTML=o??""}}function X0(t){return arguments.length?this.each(t==null?cy:(typeof t=="function"?py:my)(t)):this.node().innerHTML}function dy(){this.nextSibling&&this.parentNode.appendChild(this)}function q0(){return this.each(dy)}function uy(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function K0(){return this.each(uy)}function Q0(t){var o=typeof t=="function"?t:cl(t);return this.select(function(){return this.appendChild(o.apply(this,arguments))})}function fy(){return null}function Z0(t,o){var e=typeof t=="function"?t:cl(t),n=o==null?fy:typeof o=="function"?o:Rr(o);return this.select(function(){return this.insertBefore(e.apply(this,arguments),n.apply(this,arguments)||null)})}function _y(){var t=this.parentNode;t&&t.removeChild(this)}function J0(){return this.each(_y)}function hy(){var t=this.cloneNode(!1),o=this.parentNode;return o?o.insertBefore(t,this.nextSibling):t}function Cy(){var t=this.cloneNode(!0),o=this.parentNode;return o?o.insertBefore(t,this.nextSibling):t}function ef(t){return this.select(t?Cy:hy)}function tf(t){return arguments.length?this.property("__data__",t):this.node().__data__}function gy(t){return function(o){t.call(this,o,this.__data__)}}function Ey(t){return t.trim().split(/^|\s+/).map(function(o){var e="",n=o.indexOf(".");return n>=0&&(e=o.slice(n+1),o=o.slice(0,n)),{type:o,name:e}})}function vy(t){return function(){var o=this.__on;if(o){for(var e=0,n=-1,i=o.length,a;e<i;++e)a=o[e],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):o[++n]=a;++n?o.length=n:delete this.__on}}}function yy(t,o,e){return function(){var n=this.__on,i,a=gy(o);if(n){for(var m=0,u=n.length;m<u;++m)if((i=n[m]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=e),i.value=o;return}}this.addEventListener(t.type,a,e),i={type:t.type,name:t.name,value:o,listener:a,options:e},n?n.push(i):this.__on=[i]}}function nf(t,o,e){var n=Ey(t+""),i,a=n.length,m;if(arguments.length<2){var u=this.node().__on;if(u){for(var C=0,v=u.length,T;C<v;++C)for(i=0,T=u[C];i<a;++i)if((m=n[i]).type===T.type&&m.name===T.name)return T.value}return}for(u=o?yy:vy,i=0;i<a;++i)this.each(u(n[i],o,e));return this}function of(t,o,e){var n=dl(t),i=n.CustomEvent;typeof i=="function"?i=new i(o,e):(i=n.document.createEvent("Event"),e?(i.initEvent(o,e.bubbles,e.cancelable),i.detail=e.detail):i.initEvent(o,!1,!1)),t.dispatchEvent(i)}function Ty(t,o){return function(){return of(this,t,o)}}function Iy(t,o){return function(){return of(this,t,o.apply(this,arguments))}}function rf(t,o){return this.each((typeof o=="function"?Iy:Ty)(t,o))}function*af(){for(var t=this._groups,o=0,e=t.length;o<e;++o)for(var n=t[o],i=0,a=n.length,m;i<a;++i)(m=n[i])&&(yield m)}var xy=[null];function Fn(t,o){this._groups=t,this._parents=o}function sf(){return new Fn([[document.documentElement]],xy)}function Sy(){return this}Fn.prototype=sf.prototype={constructor:Fn,select:v0,selectAll:y0,selectChild:T0,selectChildren:I0,filter:x0,data:w0,enter:S0,exit:b0,join:D0,merge:R0,selection:Sy,order:O0,sort:N0,call:M0,nodes:F0,node:G0,size:P0,empty:L0,each:k0,attr:V0,style:H0,property:B0,classed:Y0,text:$0,html:X0,raise:q0,lower:K0,append:Q0,insert:Z0,remove:J0,clone:ef,datum:tf,on:nf,dispatch:rf,[Symbol.iterator]:af};var ko=sf;function ul(t,o,e){t.prototype=o.prototype=e,e.constructor=t}function am(t,o){var e=Object.create(t.prototype);for(var n in o)e[n]=o[n];return e}function $a(){}var ja=.7,hl=1/ja,Ca="\\s*([+-]?\\d+)\\s*",Ya="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",xo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ay=/^#([0-9a-f]{3,8})$/,wy=new RegExp(`^rgb\\(${Ca},${Ca},${Ca}\\)$`),by=new RegExp(`^rgb\\(${xo},${xo},${xo}\\)$`),Dy=new RegExp(`^rgba\\(${Ca},${Ca},${Ca},${Ya}\\)$`),Ry=new RegExp(`^rgba\\(${xo},${xo},${xo},${Ya}\\)$`),Oy=new RegExp(`^hsl\\(${Ya},${xo},${xo}\\)$`),Ny=new RegExp(`^hsla\\(${Ya},${xo},${xo},${Ya}\\)$`),lf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ul($a,rr,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:cf,formatHex:cf,formatHex8:My,formatHsl:Fy,formatRgb:mf,toString:mf});function cf(){return this.rgb().formatHex()}function My(){return this.rgb().formatHex8()}function Fy(){return hf(this).formatHsl()}function mf(){return this.rgb().formatRgb()}function rr(t){var o,e;return t=(t+"").trim().toLowerCase(),(o=Ay.exec(t))?(e=o[1].length,o=parseInt(o[1],16),e===6?pf(o):e===3?new Fi(o>>8&15|o>>4&240,o>>4&15|o&240,(o&15)<<4|o&15,1):e===8?fl(o>>24&255,o>>16&255,o>>8&255,(o&255)/255):e===4?fl(o>>12&15|o>>8&240,o>>8&15|o>>4&240,o>>4&15|o&240,((o&15)<<4|o&15)/255):null):(o=wy.exec(t))?new Fi(o[1],o[2],o[3],1):(o=by.exec(t))?new Fi(o[1]*255/100,o[2]*255/100,o[3]*255/100,1):(o=Dy.exec(t))?fl(o[1],o[2],o[3],o[4]):(o=Ry.exec(t))?fl(o[1]*255/100,o[2]*255/100,o[3]*255/100,o[4]):(o=Oy.exec(t))?ff(o[1],o[2]/100,o[3]/100,1):(o=Ny.exec(t))?ff(o[1],o[2]/100,o[3]/100,o[4]):lf.hasOwnProperty(t)?pf(lf[t]):t==="transparent"?new Fi(NaN,NaN,NaN,0):null}function pf(t){return new Fi(t>>16&255,t>>8&255,t&255,1)}function fl(t,o,e,n){return n<=0&&(t=o=e=NaN),new Fi(t,o,e,n)}function Gy(t){return t instanceof $a||(t=rr(t)),t?(t=t.rgb(),new Fi(t.r,t.g,t.b,t.opacity)):new Fi}function ga(t,o,e,n){return arguments.length===1?Gy(t):new Fi(t,o,e,n??1)}function Fi(t,o,e,n){this.r=+t,this.g=+o,this.b=+e,this.opacity=+n}ul(Fi,ga,am($a,{brighter(t){return t=t==null?hl:Math.pow(hl,t),new Fi(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ja:Math.pow(ja,t),new Fi(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Fi(Nr(this.r),Nr(this.g),Nr(this.b),Cl(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:df,formatHex:df,formatHex8:Py,formatRgb:uf,toString:uf}));function df(){return`#${Or(this.r)}${Or(this.g)}${Or(this.b)}`}function Py(){return`#${Or(this.r)}${Or(this.g)}${Or(this.b)}${Or((isNaN(this.opacity)?1:this.opacity)*255)}`}function uf(){let t=Cl(this.opacity);return`${t===1?"rgb(":"rgba("}${Nr(this.r)}, ${Nr(this.g)}, ${Nr(this.b)}${t===1?")":`, ${t})`}`}function Cl(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Nr(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Or(t){return t=Nr(t),(t<16?"0":"")+t.toString(16)}function ff(t,o,e,n){return n<=0?t=o=e=NaN:e<=0||e>=1?t=o=NaN:o<=0&&(t=NaN),new co(t,o,e,n)}function hf(t){if(t instanceof co)return new co(t.h,t.s,t.l,t.opacity);if(t instanceof $a||(t=rr(t)),!t)return new co;if(t instanceof co)return t;t=t.rgb();var o=t.r/255,e=t.g/255,n=t.b/255,i=Math.min(o,e,n),a=Math.max(o,e,n),m=NaN,u=a-i,C=(a+i)/2;return u?(o===a?m=(e-n)/u+(e<n)*6:e===a?m=(n-o)/u+2:m=(o-e)/u+4,u/=C<.5?a+i:2-a-i,m*=60):u=C>0&&C<1?0:m,new co(m,u,C,t.opacity)}function Cf(t,o,e,n){return arguments.length===1?hf(t):new co(t,o,e,n??1)}function co(t,o,e,n){this.h=+t,this.s=+o,this.l=+e,this.opacity=+n}ul(co,Cf,am($a,{brighter(t){return t=t==null?hl:Math.pow(hl,t),new co(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ja:Math.pow(ja,t),new co(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,o=isNaN(t)||isNaN(this.s)?0:this.s,e=this.l,n=e+(e<.5?e:1-e)*o,i=2*e-n;return new Fi(sm(t>=240?t-240:t+120,i,n),sm(t,i,n),sm(t<120?t+240:t-120,i,n),this.opacity)},clamp(){return new co(_f(this.h),_l(this.s),_l(this.l),Cl(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=Cl(this.opacity);return`${t===1?"hsl(":"hsla("}${_f(this.h)}, ${_l(this.s)*100}%, ${_l(this.l)*100}%${t===1?")":`, ${t})`}`}}));function _f(t){return t=(t||0)%360,t<0?t+360:t}function _l(t){return Math.max(0,Math.min(1,t||0))}function sm(t,o,e){return(t<60?o+(e-o)*t/60:t<180?e:t<240?o+(e-o)*(240-t)/60:o)*255}function lm(t,o,e,n,i){var a=t*t,m=a*t;return((1-3*t+3*a-m)*o+(4-6*a+3*m)*e+(1+3*t+3*a-3*m)*n+m*i)/6}function gf(t){var o=t.length-1;return function(e){var n=e<=0?e=0:e>=1?(e=1,o-1):Math.floor(e*o),i=t[n],a=t[n+1],m=n>0?t[n-1]:2*i-a,u=n<o-1?t[n+2]:2*a-i;return lm((e-n/o)*o,m,i,a,u)}}function Ef(t){var o=t.length;return function(e){var n=Math.floor(((e%=1)<0?++e:e)*o),i=t[(n+o-1)%o],a=t[n%o],m=t[(n+1)%o],u=t[(n+2)%o];return lm((e-n/o)*o,i,a,m,u)}}var cm=t=>()=>t;function Ly(t,o){return function(e){return t+e*o}}function ky(t,o,e){return t=Math.pow(t,e),o=Math.pow(o,e)-t,e=1/e,function(n){return Math.pow(t+n*o,e)}}function vf(t){return(t=+t)==1?gl:function(o,e){return e-o?ky(o,e,t):cm(isNaN(o)?e:o)}}function gl(t,o){var e=o-t;return e?Ly(t,e):cm(isNaN(t)?o:t)}var El=(function t(o){var e=vf(o);function n(i,a){var m=e((i=ga(i)).r,(a=ga(a)).r),u=e(i.g,a.g),C=e(i.b,a.b),v=gl(i.opacity,a.opacity);return function(T){return i.r=m(T),i.g=u(T),i.b=C(T),i.opacity=v(T),i+""}}return n.gamma=t,n})(1);function yf(t){return function(o){var e=o.length,n=new Array(e),i=new Array(e),a=new Array(e),m,u;for(m=0;m<e;++m)u=ga(o[m]),n[m]=u.r||0,i[m]=u.g||0,a[m]=u.b||0;return n=t(n),i=t(i),a=t(a),u.opacity=1,function(C){return u.r=n(C),u.g=i(C),u.b=a(C),u+""}}}var Vy=yf(gf),Hy=yf(Ef);function Ji(t,o){return t=+t,o=+o,function(e){return t*(1-e)+o*e}}var pm=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,mm=new RegExp(pm.source,"g");function By(t){return function(){return t}}function Wy(t){return function(o){return t(o)+""}}function dm(t,o){var e=pm.lastIndex=mm.lastIndex=0,n,i,a,m=-1,u=[],C=[];for(t=t+"",o=o+"";(n=pm.exec(t))&&(i=mm.exec(o));)(a=i.index)>e&&(a=o.slice(e,a),u[m]?u[m]+=a:u[++m]=a),(n=n[0])===(i=i[0])?u[m]?u[m]+=i:u[++m]=i:(u[++m]=null,C.push({i:m,x:Ji(n,i)})),e=mm.lastIndex;return e<o.length&&(a=o.slice(e),u[m]?u[m]+=a:u[++m]=a),u.length<2?C[0]?Wy(C[0].x):By(o):(o=C.length,function(v){for(var T=0,A;T<o;++T)u[(A=C[T]).i]=A.x(v);return u.join("")})}var Tf=180/Math.PI,vl={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function um(t,o,e,n,i,a){var m,u,C;return(m=Math.sqrt(t*t+o*o))&&(t/=m,o/=m),(C=t*e+o*n)&&(e-=t*C,n-=o*C),(u=Math.sqrt(e*e+n*n))&&(e/=u,n/=u,C/=u),t*n<o*e&&(t=-t,o=-o,C=-C,m=-m),{translateX:i,translateY:a,rotate:Math.atan2(o,t)*Tf,skewX:Math.atan(C)*Tf,scaleX:m,scaleY:u}}var yl;function If(t){let o=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return o.isIdentity?vl:um(o.a,o.b,o.c,o.d,o.e,o.f)}function xf(t){return t==null?vl:(yl||(yl=document.createElementNS("http://www.w3.org/2000/svg","g")),yl.setAttribute("transform",t),(t=yl.transform.baseVal.consolidate())?(t=t.matrix,um(t.a,t.b,t.c,t.d,t.e,t.f)):vl)}function Sf(t,o,e,n){function i(v){return v.length?v.pop()+" ":""}function a(v,T,A,b,F,k){if(v!==A||T!==b){var Q=F.push("translate(",null,o,null,e);k.push({i:Q-4,x:Ji(v,A)},{i:Q-2,x:Ji(T,b)})}else(A||b)&&F.push("translate("+A+o+b+e)}function m(v,T,A,b){v!==T?(v-T>180?T+=360:T-v>180&&(v+=360),b.push({i:A.push(i(A)+"rotate(",null,n)-2,x:Ji(v,T)})):T&&A.push(i(A)+"rotate("+T+n)}function u(v,T,A,b){v!==T?b.push({i:A.push(i(A)+"skewX(",null,n)-2,x:Ji(v,T)}):T&&A.push(i(A)+"skewX("+T+n)}function C(v,T,A,b,F,k){if(v!==A||T!==b){var Q=F.push(i(F)+"scale(",null,",",null,")");k.push({i:Q-4,x:Ji(v,A)},{i:Q-2,x:Ji(T,b)})}else(A!==1||b!==1)&&F.push(i(F)+"scale("+A+","+b+")")}return function(v,T){var A=[],b=[];return v=t(v),T=t(T),a(v.translateX,v.translateY,T.translateX,T.translateY,A,b),m(v.rotate,T.rotate,A,b),u(v.skewX,T.skewX,A,b),C(v.scaleX,v.scaleY,T.scaleX,T.scaleY,A,b),v=T=null,function(F){for(var k=-1,Q=b.length,ve;++k<Q;)A[(ve=b[k]).i]=ve.x(F);return A.join("")}}}var fm=Sf(If,"px, ","px)","deg)"),_m=Sf(xf,", ",")",")");var Ea=0,qa=0,Xa=0,wf=1e3,Tl,Ka,Il=0,Mr=0,xl=0,Qa=typeof performance=="object"&&performance.now?performance:Date,bf=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Ja(){return Mr||(bf(Uy),Mr=Qa.now()+xl)}function Uy(){Mr=0}function Za(){this._call=this._time=this._next=null}Za.prototype=Sl.prototype={constructor:Za,restart:function(t,o,e){if(typeof t!="function")throw new TypeError("callback is not a function");e=(e==null?Ja():+e)+(o==null?0:+o),!this._next&&Ka!==this&&(Ka?Ka._next=this:Tl=this,Ka=this),this._call=t,this._time=e,hm()},stop:function(){this._call&&(this._call=null,this._time=1/0,hm())}};function Sl(t,o,e){var n=new Za;return n.restart(t,o,e),n}function Df(){Ja(),++Ea;for(var t=Tl,o;t;)(o=Mr-t._time)>=0&&t._call.call(void 0,o),t=t._next;--Ea}function Af(){Mr=(Il=Qa.now())+xl,Ea=qa=0;try{Df()}finally{Ea=0,jy(),Mr=0}}function zy(){var t=Qa.now(),o=t-Il;o>wf&&(xl-=o,Il=t)}function jy(){for(var t,o=Tl,e,n=1/0;o;)o._call?(n>o._time&&(n=o._time),t=o,o=o._next):(e=o._next,o._next=null,o=t?t._next=e:Tl=e);Ka=t,hm(n)}function hm(t){if(!Ea){qa&&(qa=clearTimeout(qa));var o=t-Mr;o>24?(t<1/0&&(qa=setTimeout(Af,t-Qa.now()-xl)),Xa&&(Xa=clearInterval(Xa))):(Xa||(Il=Qa.now(),Xa=setInterval(zy,wf)),Ea=1,bf(Af))}}function Al(t,o,e){var n=new Za;return o=o==null?0:+o,n.restart(i=>{n.stop(),t(i+o)},o,e),n}var Yy=nm("start","end","cancel","interrupt"),$y=[],Nf=0,Rf=1,bl=2,wl=3,Of=4,Dl=5,es=6;function ar(t,o,e,n,i,a){var m=t.__transition;if(!m)t.__transition={};else if(e in m)return;Xy(t,e,{name:o,index:n,group:i,on:Yy,tween:$y,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Nf})}function ts(t,o){var e=Gn(t,o);if(e.state>Nf)throw new Error("too late; already scheduled");return e}function Kn(t,o){var e=Gn(t,o);if(e.state>wl)throw new Error("too late; already running");return e}function Gn(t,o){var e=t.__transition;if(!e||!(e=e[o]))throw new Error("transition not found");return e}function Xy(t,o,e){var n=t.__transition,i;n[o]=e,e.timer=Sl(a,0,e.time);function a(v){e.state=Rf,e.timer.restart(m,e.delay,e.time),e.delay<=v&&m(v-e.delay)}function m(v){var T,A,b,F;if(e.state!==Rf)return C();for(T in n)if(F=n[T],F.name===e.name){if(F.state===wl)return Al(m);F.state===Of?(F.state=es,F.timer.stop(),F.on.call("interrupt",t,t.__data__,F.index,F.group),delete n[T]):+T<o&&(F.state=es,F.timer.stop(),F.on.call("cancel",t,t.__data__,F.index,F.group),delete n[T])}if(Al(function(){e.state===wl&&(e.state=Of,e.timer.restart(u,e.delay,e.time),u(v))}),e.state=bl,e.on.call("start",t,t.__data__,e.index,e.group),e.state===bl){for(e.state=wl,i=new Array(b=e.tween.length),T=0,A=-1;T<b;++T)(F=e.tween[T].value.call(t,t.__data__,e.index,e.group))&&(i[++A]=F);i.length=A+1}}function u(v){for(var T=v<e.duration?e.ease.call(null,v/e.duration):(e.timer.restart(C),e.state=Dl,1),A=-1,b=i.length;++A<b;)i[A].call(t,T);e.state===Dl&&(e.on.call("end",t,t.__data__,e.index,e.group),C())}function C(){e.state=es,e.timer.stop(),delete n[o];for(var v in n)return;delete t.__transition}}function Rl(t,o){var e=t.__transition,n,i,a=!0,m;if(e){o=o==null?null:o+"";for(m in e){if((n=e[m]).name!==o){a=!1;continue}i=n.state>bl&&n.state<Dl,n.state=es,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete e[m]}a&&delete t.__transition}}function Mf(t){return this.each(function(){Rl(this,t)})}function qy(t,o){var e,n;return function(){var i=Kn(this,t),a=i.tween;if(a!==e){n=e=a;for(var m=0,u=n.length;m<u;++m)if(n[m].name===o){n=n.slice(),n.splice(m,1);break}}i.tween=n}}function Ky(t,o,e){var n,i;if(typeof e!="function")throw new Error;return function(){var a=Kn(this,t),m=a.tween;if(m!==n){i=(n=m).slice();for(var u={name:o,value:e},C=0,v=i.length;C<v;++C)if(i[C].name===o){i[C]=u;break}C===v&&i.push(u)}a.tween=i}}function Ff(t,o){var e=this._id;if(t+="",arguments.length<2){for(var n=Gn(this.node(),e).tween,i=0,a=n.length,m;i<a;++i)if((m=n[i]).name===t)return m.value;return null}return this.each((o==null?qy:Ky)(e,t,o))}function va(t,o,e){var n=t._id;return t.each(function(){var i=Kn(this,n);(i.value||(i.value={}))[o]=e.apply(this,arguments)}),function(i){return Gn(i,n).value[o]}}function Ol(t,o){var e;return(typeof o=="number"?Ji:o instanceof rr?El:(e=rr(o))?(o=e,El):dm)(t,o)}function Qy(t){return function(){this.removeAttribute(t)}}function Zy(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Jy(t,o,e){var n,i=e+"",a;return function(){var m=this.getAttribute(t);return m===i?null:m===n?a:a=o(n=m,e)}}function eT(t,o,e){var n,i=e+"",a;return function(){var m=this.getAttributeNS(t.space,t.local);return m===i?null:m===n?a:a=o(n=m,e)}}function tT(t,o,e){var n,i,a;return function(){var m,u=e(this),C;return u==null?void this.removeAttribute(t):(m=this.getAttribute(t),C=u+"",m===C?null:m===n&&C===i?a:(i=C,a=o(n=m,u)))}}function nT(t,o,e){var n,i,a;return function(){var m,u=e(this),C;return u==null?void this.removeAttributeNS(t.space,t.local):(m=this.getAttributeNS(t.space,t.local),C=u+"",m===C?null:m===n&&C===i?a:(i=C,a=o(n=m,u)))}}function Gf(t,o){var e=Lo(t),n=e==="transform"?_m:Ol;return this.attrTween(t,typeof o=="function"?(e.local?nT:tT)(e,n,va(this,"attr."+t,o)):o==null?(e.local?Zy:Qy)(e):(e.local?eT:Jy)(e,n,o))}function iT(t,o){return function(e){this.setAttribute(t,o.call(this,e))}}function oT(t,o){return function(e){this.setAttributeNS(t.space,t.local,o.call(this,e))}}function rT(t,o){var e,n;function i(){var a=o.apply(this,arguments);return a!==n&&(e=(n=a)&&oT(t,a)),e}return i._value=o,i}function aT(t,o){var e,n;function i(){var a=o.apply(this,arguments);return a!==n&&(e=(n=a)&&iT(t,a)),e}return i._value=o,i}function Pf(t,o){var e="attr."+t;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(o==null)return this.tween(e,null);if(typeof o!="function")throw new Error;var n=Lo(t);return this.tween(e,(n.local?rT:aT)(n,o))}function sT(t,o){return function(){ts(this,t).delay=+o.apply(this,arguments)}}function lT(t,o){return o=+o,function(){ts(this,t).delay=o}}function Lf(t){var o=this._id;return arguments.length?this.each((typeof t=="function"?sT:lT)(o,t)):Gn(this.node(),o).delay}function cT(t,o){return function(){Kn(this,t).duration=+o.apply(this,arguments)}}function mT(t,o){return o=+o,function(){Kn(this,t).duration=o}}function kf(t){var o=this._id;return arguments.length?this.each((typeof t=="function"?cT:mT)(o,t)):Gn(this.node(),o).duration}function pT(t,o){if(typeof o!="function")throw new Error;return function(){Kn(this,t).ease=o}}function Vf(t){var o=this._id;return arguments.length?this.each(pT(o,t)):Gn(this.node(),o).ease}function dT(t,o){return function(){var e=o.apply(this,arguments);if(typeof e!="function")throw new Error;Kn(this,t).ease=e}}function Hf(t){if(typeof t!="function")throw new Error;return this.each(dT(this._id,t))}function Bf(t){typeof t!="function"&&(t=Ua(t));for(var o=this._groups,e=o.length,n=new Array(e),i=0;i<e;++i)for(var a=o[i],m=a.length,u=n[i]=[],C,v=0;v<m;++v)(C=a[v])&&t.call(C,C.__data__,v,a)&&u.push(C);return new yi(n,this._parents,this._name,this._id)}function Wf(t){if(t._id!==this._id)throw new Error;for(var o=this._groups,e=t._groups,n=o.length,i=e.length,a=Math.min(n,i),m=new Array(n),u=0;u<a;++u)for(var C=o[u],v=e[u],T=C.length,A=m[u]=new Array(T),b,F=0;F<T;++F)(b=C[F]||v[F])&&(A[F]=b);for(;u<n;++u)m[u]=o[u];return new yi(m,this._parents,this._name,this._id)}function uT(t){return(t+"").trim().split(/^|\s+/).every(function(o){var e=o.indexOf(".");return e>=0&&(o=o.slice(0,e)),!o||o==="start"})}function fT(t,o,e){var n,i,a=uT(o)?ts:Kn;return function(){var m=a(this,t),u=m.on;u!==n&&(i=(n=u).copy()).on(o,e),m.on=i}}function Uf(t,o){var e=this._id;return arguments.length<2?Gn(this.node(),e).on.on(t):this.each(fT(e,t,o))}function _T(t){return function(){var o=this.parentNode;for(var e in this.__transition)if(+e!==t)return;o&&o.removeChild(this)}}function zf(){return this.on("end.remove",_T(this._id))}function jf(t){var o=this._name,e=this._id;typeof t!="function"&&(t=Rr(t));for(var n=this._groups,i=n.length,a=new Array(i),m=0;m<i;++m)for(var u=n[m],C=u.length,v=a[m]=new Array(C),T,A,b=0;b<C;++b)(T=u[b])&&(A=t.call(T,T.__data__,b,u))&&("__data__"in T&&(A.__data__=T.__data__),v[b]=A,ar(v[b],o,e,b,v,Gn(T,e)));return new yi(a,this._parents,o,e)}function Yf(t){var o=this._name,e=this._id;typeof t!="function"&&(t=Wa(t));for(var n=this._groups,i=n.length,a=[],m=[],u=0;u<i;++u)for(var C=n[u],v=C.length,T,A=0;A<v;++A)if(T=C[A]){for(var b=t.call(T,T.__data__,A,C),F,k=Gn(T,e),Q=0,ve=b.length;Q<ve;++Q)(F=b[Q])&&ar(F,o,e,Q,b,k);a.push(b),m.push(T)}return new yi(a,m,o,e)}var hT=ko.prototype.constructor;function $f(){return new hT(this._groups,this._parents)}function CT(t,o){var e,n,i;return function(){var a=or(this,t),m=(this.style.removeProperty(t),or(this,t));return a===m?null:a===e&&m===n?i:i=o(e=a,n=m)}}function Xf(t){return function(){this.style.removeProperty(t)}}function gT(t,o,e){var n,i=e+"",a;return function(){var m=or(this,t);return m===i?null:m===n?a:a=o(n=m,e)}}function ET(t,o,e){var n,i,a;return function(){var m=or(this,t),u=e(this),C=u+"";return u==null&&(C=u=(this.style.removeProperty(t),or(this,t))),m===C?null:m===n&&C===i?a:(i=C,a=o(n=m,u))}}function vT(t,o){var e,n,i,a="style."+o,m="end."+a,u;return function(){var C=Kn(this,t),v=C.on,T=C.value[a]==null?u||(u=Xf(o)):void 0;(v!==e||i!==T)&&(n=(e=v).copy()).on(m,i=T),C.on=n}}function qf(t,o,e){var n=(t+="")=="transform"?fm:Ol;return o==null?this.styleTween(t,CT(t,n)).on("end.style."+t,Xf(t)):typeof o=="function"?this.styleTween(t,ET(t,n,va(this,"style."+t,o))).each(vT(this._id,t)):this.styleTween(t,gT(t,n,o),e).on("end.style."+t,null)}function yT(t,o,e){return function(n){this.style.setProperty(t,o.call(this,n),e)}}function TT(t,o,e){var n,i;function a(){var m=o.apply(this,arguments);return m!==i&&(n=(i=m)&&yT(t,m,e)),n}return a._value=o,a}function Kf(t,o,e){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(o==null)return this.tween(n,null);if(typeof o!="function")throw new Error;return this.tween(n,TT(t,o,e??""))}function IT(t){return function(){this.textContent=t}}function xT(t){return function(){var o=t(this);this.textContent=o??""}}function Qf(t){return this.tween("text",typeof t=="function"?xT(va(this,"text",t)):IT(t==null?"":t+""))}function ST(t){return function(o){this.textContent=t.call(this,o)}}function AT(t){var o,e;function n(){var i=t.apply(this,arguments);return i!==e&&(o=(e=i)&&ST(i)),o}return n._value=t,n}function Zf(t){var o="text";if(arguments.length<1)return(o=this.tween(o))&&o._value;if(t==null)return this.tween(o,null);if(typeof t!="function")throw new Error;return this.tween(o,AT(t))}function Jf(){for(var t=this._name,o=this._id,e=Nl(),n=this._groups,i=n.length,a=0;a<i;++a)for(var m=n[a],u=m.length,C,v=0;v<u;++v)if(C=m[v]){var T=Gn(C,o);ar(C,t,e,v,m,{time:T.time+T.delay+T.duration,delay:0,duration:T.duration,ease:T.ease})}return new yi(n,this._parents,t,e)}function e_(){var t,o,e=this,n=e._id,i=e.size();return new Promise(function(a,m){var u={value:m},C={value:function(){--i===0&&a()}};e.each(function(){var v=Kn(this,n),T=v.on;T!==t&&(o=(t=T).copy(),o._.cancel.push(u),o._.interrupt.push(u),o._.end.push(C)),v.on=o}),i===0&&a()})}var wT=0;function yi(t,o,e,n){this._groups=t,this._parents=o,this._name=e,this._id=n}function t_(t){return ko().transition(t)}function Nl(){return++wT}var Vo=ko.prototype;yi.prototype=t_.prototype={constructor:yi,select:jf,selectAll:Yf,selectChild:Vo.selectChild,selectChildren:Vo.selectChildren,filter:Bf,merge:Wf,selection:$f,transition:Jf,call:Vo.call,nodes:Vo.nodes,node:Vo.node,size:Vo.size,empty:Vo.empty,each:Vo.each,on:Uf,attr:Gf,attrTween:Pf,style:qf,styleTween:Kf,text:Qf,textTween:Zf,remove:zf,tween:Ff,delay:Lf,duration:kf,ease:Vf,easeVarying:Hf,end:e_,[Symbol.iterator]:Vo[Symbol.iterator]};function Ml(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var bT={time:null,delay:0,duration:250,ease:Ml};function DT(t,o){for(var e;!(e=t.__transition)||!(e=e[o]);)if(!(t=t.parentNode))throw new Error(`transition ${o} not found`);return e}function n_(t){var o,e;t instanceof yi?(o=t._id,t=t._name):(o=Nl(),(e=bT).time=Ja(),t=t==null?null:t+"");for(var n=this._groups,i=n.length,a=0;a<i;++a)for(var m=n[a],u=m.length,C,v=0;v<u;++v)(C=m[v])&&ar(C,t,o,v,m,e||DT(C,o));return new yi(n,this._parents,t,o)}ko.prototype.interrupt=Mf;ko.prototype.transition=n_;var{abs:q7,max:K7,min:Q7}=Math;function i_(t){return[+t[0],+t[1]]}function RT(t){return[i_(t[0]),i_(t[1])]}var Z7={name:"x",handles:["w","e"].map(Cm),input:function(t,o){return t==null?null:[[+t[0],o[0][1]],[+t[1],o[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},J7={name:"y",handles:["n","s"].map(Cm),input:function(t,o){return t==null?null:[[o[0][0],+t[0]],[o[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},e9={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Cm),input:function(t){return t==null?null:RT(t)},output:function(t){return t}};function Cm(t){return{type:t}}var gm=Math.PI,Em=2*gm,Fr=1e-6,OT=Em-Fr;function o_(t){this._+=t[0];for(let o=1,e=t.length;o<e;++o)this._+=arguments[o]+t[o]}function NT(t){let o=Math.floor(t);if(!(o>=0))throw new Error(`invalid digits: ${t}`);if(o>15)return o_;let e=10**o;return function(n){this._+=n[0];for(let i=1,a=n.length;i<a;++i)this._+=Math.round(arguments[i]*e)/e+n[i]}}var Gr=class{constructor(o){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=o==null?o_:NT(o)}moveTo(o,e){this._append`M${this._x0=this._x1=+o},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(o,e){this._append`L${this._x1=+o},${this._y1=+e}`}quadraticCurveTo(o,e,n,i){this._append`Q${+o},${+e},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(o,e,n,i,a,m){this._append`C${+o},${+e},${+n},${+i},${this._x1=+a},${this._y1=+m}`}arcTo(o,e,n,i,a){if(o=+o,e=+e,n=+n,i=+i,a=+a,a<0)throw new Error(`negative radius: ${a}`);let m=this._x1,u=this._y1,C=n-o,v=i-e,T=m-o,A=u-e,b=T*T+A*A;if(this._x1===null)this._append`M${this._x1=o},${this._y1=e}`;else if(b>Fr)if(!(Math.abs(A*C-v*T)>Fr)||!a)this._append`L${this._x1=o},${this._y1=e}`;else{let F=n-m,k=i-u,Q=C*C+v*v,ve=F*F+k*k,Re=Math.sqrt(Q),se=Math.sqrt(b),ge=a*Math.tan((gm-Math.acos((Q+b-ve)/(2*Re*se)))/2),Ue=ge/se,Ot=ge/Re;Math.abs(Ue-1)>Fr&&this._append`L${o+Ue*T},${e+Ue*A}`,this._append`A${a},${a},0,0,${+(A*F>T*k)},${this._x1=o+Ot*C},${this._y1=e+Ot*v}`}}arc(o,e,n,i,a,m){if(o=+o,e=+e,n=+n,m=!!m,n<0)throw new Error(`negative radius: ${n}`);let u=n*Math.cos(i),C=n*Math.sin(i),v=o+u,T=e+C,A=1^m,b=m?i-a:a-i;this._x1===null?this._append`M${v},${T}`:(Math.abs(this._x1-v)>Fr||Math.abs(this._y1-T)>Fr)&&this._append`L${v},${T}`,n&&(b<0&&(b=b%Em+Em),b>OT?this._append`A${n},${n},0,1,${A},${o-u},${e-C}A${n},${n},0,1,${A},${this._x1=v},${this._y1=T}`:b>Fr&&this._append`A${n},${n},0,${+(b>=gm)},${A},${this._x1=o+n*Math.cos(a)},${this._y1=e+n*Math.sin(a)}`)}rect(o,e,n,i){this._append`M${this._x0=this._x1=+o},${this._y0=this._y1=+e}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}};function r_(){return new Gr}r_.prototype=Gr.prototype;function Ho(t){return function(){return t}}var vm=Math.abs,Qn=Math.atan2,sr=Math.cos,a_=Math.max,Fl=Math.min,mo=Math.sin,Pr=Math.sqrt,Ti=1e-12,ya=Math.PI,ns=ya/2,s_=2*ya;function l_(t){return t>1?0:t<-1?ya:Math.acos(t)}function ym(t){return t>=1?ns:t<=-1?-ns:Math.asin(t)}function c_(t){let o=3;return t.digits=function(e){if(!arguments.length)return o;if(e==null)o=null;else{let n=Math.floor(e);if(!(n>=0))throw new RangeError(`invalid digits: ${e}`);o=n}return t},()=>new Gr(o)}function MT(t){return t.innerRadius}function FT(t){return t.outerRadius}function GT(t){return t.startAngle}function PT(t){return t.endAngle}function LT(t){return t&&t.padAngle}function kT(t,o,e,n,i,a,m,u){var C=e-t,v=n-o,T=m-i,A=u-a,b=A*C-T*v;if(!(b*b<Ti))return b=(T*(o-a)-A*(t-i))/b,[t+b*C,o+b*v]}function Gl(t,o,e,n,i,a,m){var u=t-e,C=o-n,v=(m?a:-a)/Pr(u*u+C*C),T=v*C,A=-v*u,b=t+T,F=o+A,k=e+T,Q=n+A,ve=(b+k)/2,Re=(F+Q)/2,se=k-b,ge=Q-F,Ue=se*se+ge*ge,Ot=i-a,$t=b*Q-k*F,nt=(ge<0?-1:1)*Pr(a_(0,Ot*Ot*Ue-$t*$t)),Gt=($t*ge-se*nt)/Ue,Ln=(-$t*se-ge*nt)/Ue,Xn=($t*ge+se*nt)/Ue,pi=(-$t*se+ge*nt)/Ue,Cn=Gt-ve,qe=Ln-Re,Nt=Xn-ve,uo=pi-Re;return Cn*Cn+qe*qe>Nt*Nt+uo*uo&&(Gt=Xn,Ln=pi),{cx:Gt,cy:Ln,x01:-T,y01:-A,x11:Gt*(i/Ot-1),y11:Ln*(i/Ot-1)}}function Tm(){var t=MT,o=FT,e=Ho(0),n=null,i=GT,a=PT,m=LT,u=null,C=c_(v);function v(){var T,A,b=+t.apply(this,arguments),F=+o.apply(this,arguments),k=i.apply(this,arguments)-ns,Q=a.apply(this,arguments)-ns,ve=vm(Q-k),Re=Q>k;if(u||(u=T=C()),F<b&&(A=F,F=b,b=A),!(F>Ti))u.moveTo(0,0);else if(ve>s_-Ti)u.moveTo(F*sr(k),F*mo(k)),u.arc(0,0,F,k,Q,!Re),b>Ti&&(u.moveTo(b*sr(Q),b*mo(Q)),u.arc(0,0,b,Q,k,Re));else{var se=k,ge=Q,Ue=k,Ot=Q,$t=ve,nt=ve,Gt=m.apply(this,arguments)/2,Ln=Gt>Ti&&(n?+n.apply(this,arguments):Pr(b*b+F*F)),Xn=Fl(vm(F-b)/2,+e.apply(this,arguments)),pi=Xn,Cn=Xn,qe,Nt;if(Ln>Ti){var uo=ym(Ln/b*mo(Gt)),Oe=ym(Ln/F*mo(Gt));($t-=uo*2)>Ti?(uo*=Re?1:-1,Ue+=uo,Ot-=uo):($t=0,Ue=Ot=(k+Q)/2),(nt-=Oe*2)>Ti?(Oe*=Re?1:-1,se+=Oe,ge-=Oe):(nt=0,se=ge=(k+Q)/2)}var Fe=F*sr(se),Le=F*mo(se),ut=b*sr(Ot),mn=b*mo(Ot);if(Xn>Ti){var di=F*sr(ge),kn=F*mo(ge),Hi=b*sr(Ue),Xt=b*mo(Ue),Bi;if(ve<ya)if(Bi=kT(Fe,Le,Hi,Xt,di,kn,ut,mn)){var wa=Fe-Bi[0],gn=Le-Bi[1],to=di-Bi[0],Zn=kn-Bi[1],Er=1/mo(l_((wa*to+gn*Zn)/(Pr(wa*wa+gn*gn)*Pr(to*to+Zn*Zn)))/2),Yr=Pr(Bi[0]*Bi[0]+Bi[1]*Bi[1]);pi=Fl(Xn,(b-Yr)/(Er-1)),Cn=Fl(Xn,(F-Yr)/(Er+1))}else pi=Cn=0}nt>Ti?Cn>Ti?(qe=Gl(Hi,Xt,Fe,Le,F,Cn,Re),Nt=Gl(di,kn,ut,mn,F,Cn,Re),u.moveTo(qe.cx+qe.x01,qe.cy+qe.y01),Cn<Xn?u.arc(qe.cx,qe.cy,Cn,Qn(qe.y01,qe.x01),Qn(Nt.y01,Nt.x01),!Re):(u.arc(qe.cx,qe.cy,Cn,Qn(qe.y01,qe.x01),Qn(qe.y11,qe.x11),!Re),u.arc(0,0,F,Qn(qe.cy+qe.y11,qe.cx+qe.x11),Qn(Nt.cy+Nt.y11,Nt.cx+Nt.x11),!Re),u.arc(Nt.cx,Nt.cy,Cn,Qn(Nt.y11,Nt.x11),Qn(Nt.y01,Nt.x01),!Re))):(u.moveTo(Fe,Le),u.arc(0,0,F,se,ge,!Re)):u.moveTo(Fe,Le),!(b>Ti)||!($t>Ti)?u.lineTo(ut,mn):pi>Ti?(qe=Gl(ut,mn,di,kn,b,-pi,Re),Nt=Gl(Fe,Le,Hi,Xt,b,-pi,Re),u.lineTo(qe.cx+qe.x01,qe.cy+qe.y01),pi<Xn?u.arc(qe.cx,qe.cy,pi,Qn(qe.y01,qe.x01),Qn(Nt.y01,Nt.x01),!Re):(u.arc(qe.cx,qe.cy,pi,Qn(qe.y01,qe.x01),Qn(qe.y11,qe.x11),!Re),u.arc(0,0,b,Qn(qe.cy+qe.y11,qe.cx+qe.x11),Qn(Nt.cy+Nt.y11,Nt.cx+Nt.x11),Re),u.arc(Nt.cx,Nt.cy,pi,Qn(Nt.y11,Nt.x11),Qn(Nt.y01,Nt.x01),!Re))):u.arc(0,0,b,Ot,Ue,Re)}if(u.closePath(),T)return u=null,T+""||null}return v.centroid=function(){var T=(+t.apply(this,arguments)+ +o.apply(this,arguments))/2,A=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-ya/2;return[sr(A)*T,mo(A)*T]},v.innerRadius=function(T){return arguments.length?(t=typeof T=="function"?T:Ho(+T),v):t},v.outerRadius=function(T){return arguments.length?(o=typeof T=="function"?T:Ho(+T),v):o},v.cornerRadius=function(T){return arguments.length?(e=typeof T=="function"?T:Ho(+T),v):e},v.padRadius=function(T){return arguments.length?(n=T==null?null:typeof T=="function"?T:Ho(+T),v):n},v.startAngle=function(T){return arguments.length?(i=typeof T=="function"?T:Ho(+T),v):i},v.endAngle=function(T){return arguments.length?(a=typeof T=="function"?T:Ho(+T),v):a},v.padAngle=function(T){return arguments.length?(m=typeof T=="function"?T:Ho(+T),v):m},v.context=function(T){return arguments.length?(u=T??null,v):u},v}function lr(t,o,e){this.k=t,this.x=o,this.y=e}lr.prototype={constructor:lr,scale:function(t){return t===1?this:new lr(this.k*t,this.x,this.y)},translate:function(t,o){return t===0&o===0?this:new lr(this.k,this.x+this.k*t,this.y+this.k*o)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Im=new lr(1,0,0);xm.prototype=lr.prototype;function xm(t){for(;!t.__zoom;)if(!(t=t.parentNode))return Im;return t.__zoom}var So=class{constructor(o,e){this.x=o,this.y=e}},Sm=class{constructor(o,e,n,i){this.length=o,this.valueRatio=e,this.valueText=n,this.image=i}},Pl=class{constructor(o,e,n,i){this.x=o,this.y=e,this.anchor=n,this.fontsize=i}},Am=class{constructor(o,e,n,i){this.image=o,this.x=e,this.y=n,this.length=i}},Ao=class{constructor(o,e){this.radius=o,this.gradient=e,this.points="0,0 0,0",this.animationPoints="0,0 0,0",this.state="one"}update(o,e){if(o==null)this.points="0,0 0,0";else{let n=o;this.points=n.topLeft.x+","+n.topLeft.y+(n.middleTop?" "+n.middleTop.x+","+n.middleTop.y:"")+" "+n.topRight.x+","+n.topRight.y+(n.middleRight?" "+n.middleRight.x+","+n.middleRight.y:"")+" "+n.bottomRight.x+","+n.bottomRight.y+(n.middleBottom?" "+n.middleBottom.x+","+n.middleBottom.y:"")+" "+n.bottomLeft.x+","+n.bottomLeft.y+(n.middleLeft?" "+n.middleLeft.x+","+n.middleLeft.y:"")}if(e==null)this.animationPoints="0,0 0,0";else{let n=e;this.animationPoints=n.topLeft.x+","+n.topLeft.y+(n.middleTop?" "+n.middleTop.x+","+n.middleTop.y:"")+" "+n.topRight.x+","+n.topRight.y+(n.middleRight?" "+n.middleRight.x+","+n.middleRight.y:"")+" "+n.bottomRight.x+","+n.bottomRight.y+(n.middleBottom?" "+n.middleBottom.x+","+n.middleBottom.y:"")+" "+n.bottomLeft.x+","+n.bottomLeft.y+(n.middleLeft?" "+n.middleLeft.x+","+n.middleLeft.y:"")}}switchState(){this.state=="one"?this.state="two":this.state=="two"?this.state="one":this.state="one"}hide(){this.state="three"}},wo=class{constructor(o,e="left",n,i,a,m){this.direction=e,this.color=n,this.translate=i,this.service=a,this.fillRef="",this.valuePath="",this.outlinePath="",this.energyFlow=null,this.name="",this.sectionId="",this.isEnabled=!1,this.animationSpeed=500,this.valueText="",this.innerRadius=0,this.outerRadius=0,this.height=0,this.width=0,this.lastCurrentData=null,this.sectionId=o+"-"+la(),this.name=i.instant(o),this.energyFlow=this.initEnergyFlow(0),a.getConfig().then(u=>{u.widgets.classes.forEach(C=>{C.toString()===m&&(this.isEnabled=!0)})})}updateCurrentData(o){this.lastCurrentData=o,this._updateCurrentData(o)}updateOnWindowResize(o,e,n,i){this.outerRadius=o,this.innerRadius=e,this.height=n,this.width=i;let a=this.getArc().startAngle(this.deg2rad(this.getStartAngle())).endAngle(this.deg2rad(this.getEndAngle()));this.outlinePath=a(),this.square=this.getSquare(e),this.squarePosition=this.getSquarePosition(this.square,e);let m=e-this.square.image.y-this.square.image.length-10;this.energyFlow=this.initEnergyFlow(m),this.lastCurrentData&&this.updateCurrentData(this.lastCurrentData),this.setElementHeight()}adjustFillRefbyBrowser(){navigator.vendor.match(/apple/i)?this.fillRef="url("+window.location.origin+window.location.pathname+"#"+this.sectionId+")":this.fillRef="url(#"+this.sectionId+")"}getArc(){return Tm().innerRadius(this.innerRadius).outerRadius(this.outerRadius)}deg2rad(o){return o*(Math.PI/180)}updateSectionData(o,e,n){if(!this.isEnabled)return;this.valueText=this.getValueText(o);let i;switch(this.getRatioType()){case"Only Positive [0,1]":i=this.getStartAngle(),e=Math.min(1,Math.max(0,e));break;case"Negative and Positive [-1,1]":i=(this.getStartAngle()+this.getEndAngle())/2,e=Math.min(1,Math.max(-1,e));break}let a=(this.getEndAngle()-i)*e+i,m=this.getArc().startAngle(this.deg2rad(i)).endAngle(this.deg2rad(a));this.valuePath=m(),n?n>0&&n<.1?n=.1:n<0&&n>-.1&&(n=-.1):n=0,n*=10;let u=this.getSvgEnergyFlow(n,this.energyFlow.radius*1.2),C=this.getSvgAnimationEnergyFlow(n,this.energyFlow.radius*1.2);this.energyFlow.update(u,C)}getSquare(o){let e=o/2.5,n=e/4,i=n,a=n-3,m=i+5+a,u=e,C=m+5,v=C+u,T=v/2;return new Sm(v,new Pl(T,i,"middle",n),new Pl(T,m,"middle",a),new Am("assets/img/"+this.getImagePath(),v/2-u/2,C,u))}};var HT=["gridsection",""];function BT(t,o){if(t&1&&(gt(),d(0,"path",2)),t&2){let e=p();ze("d",e.valuePath)}}function WT(t,o){if(t&1&&(gt(),Y(0),d(1,"polygon",5),z()),t&2){let e=p(2);r(),c("@GridBuy",e.stateNameBuy),ze("points",e.energyFlow.animationPoints)}}function UT(t,o){if(t&1&&(gt(),Y(0),d(1,"polygon",5),z()),t&2){let e=p(2);r(),c("@GridSell",e.stateNameSell),ze("points",e.energyFlow.animationPoints)}}function zT(t,o){if(t&1&&(gt(),s(0,"g")(1,"defs")(2,"linearGradient"),d(3,"stop",3)(4,"stop",4),l()(),d(5,"polygon"),f(6,WT,2,2,":svg:ng-container"),f(7,UT,2,2,":svg:ng-container"),l()),t&2){let e=p();r(2),ze("id",e.sectionId)("x1",e.energyFlow.gradient.x1)("y1",e.energyFlow.gradient.y1)("x2",e.energyFlow.gradient.x2)("y2",e.energyFlow.gradient.y2),r(3),ze("points",e.energyFlow.points)("fill",e.fillRef),r(),_(e.buyAnimationTrigger?6:-1),r(),_(e.sellAnimationTrigger?7:-1)}}function jT(t,o){if(t&1&&(gt(),Y(0),h(1),z()),t&2){let e=p(2);r(),N(e.valueText)}}function YT(t,o){}function $T(t,o){if(t&1&&G(0,YT,0,0,"ng-template",7),t&2){p();let e=it(5);c("ngTemplateOutlet",e)}}function XT(t,o){t&1&&h(0,"-")}function qT(t,o){if(t&1&&(gt(),s(0,"g")(1,"text",6),f(2,jT,2,1,":svg:ng-container")(3,$T,1,1,":svg:ng-template",7),G(4,XT,1,0,"ng-template",null,0,yt),l(),d(6,"use",8),l()),t&2){let e=p();ze("transform",Jn("translate(",e.squarePosition.x,",",e.squarePosition.y,")")),r(),ze("x",e.square.valueText.x)("y",e.square.valueText.y)("text-anchor",e.square.valueText.anchor),r(),_(e.valueText?2:3),r(4),ze("x",e.square.image.x)("y",e.square.image.y)("width",e.square.image.length)("height",e.square.image.length)("href",e.square.image.image+"#root")}}var Yt=(()=>{class t extends wo{constructor(e,n,i){super("GENERAL.GRID","left","var(--ion-color-dark)",e,n,"Grid"),this.buyAnimationTrigger=!1,this.sellAnimationTrigger=!1,this.startAnimation=null,this.showBuyAnimation=!1,this.showSellAnimation=!1,this.unitpipe=i}get stateNameBuy(){return this.showBuyAnimation?"show":"hide"}get stateNameSell(){return this.showSellAnimation?"show":"hide"}static getCurrentGridIcon(e){let n=e.allComponents["_sum/GridMode"],i=e.allComponents["ctrlEssLimiter14a0/RestrictionMode"];return n===Oa.OFF_GRID?{color:"dark",name:"oe-offgrid",size:""}:i===1?{color:"dark",name:"oe-grid-restriction",size:""}:{color:"dark",name:"oe-grid",size:""}}static isControllerEnabled(e,n){return e.getComponentsByFactory(n).filter(i=>i.isEnabled).length>0}ngOnInit(){this.adjustFillRefbyBrowser()}ngOnDestroy(){clearInterval(this.startAnimation)}toggleBuyAnimation(){this.startAnimation=setInterval(()=>{this.showBuyAnimation=!this.showBuyAnimation},this.animationSpeed),this.buyAnimationTrigger=!0,this.sellAnimationTrigger=!1}toggleSellAnimation(){this.startAnimation=setInterval(()=>{this.showSellAnimation=!this.showSellAnimation},this.animationSpeed),this.buyAnimationTrigger=!1,this.sellAnimationTrigger=!0}_updateCurrentData(e){if(e.grid.buyActivePower&&e.grid.buyActivePower>49){this.buyAnimationTrigger||this.toggleBuyAnimation();let n;e.grid.buyActivePower>49?n=M.multiplySafely(M.divideSafely(e.grid.buyActivePower,e.system.totalPower),-1):n=0,this.name=this.translate.instant("GENERAL.GRID_BUY"),super.updateSectionData(e.grid.buyActivePower,e.grid.powerRatio,n)}else if(e.grid.sellActivePower&&e.grid.sellActivePower>49){this.sellAnimationTrigger||this.toggleSellAnimation();let n;e.grid.sellActivePower>49?n=M.divideSafely(e.grid.sellActivePower,e.system.totalPower):n=0,this.name=this.translate.instant("GENERAL.GRID_SELL"),super.updateSectionData(e.grid.sellActivePower,e.grid.powerRatio,n)}else this.name=this.translate.instant("GENERAL.GRID"),super.updateSectionData(0,null,null);this.gridMode=e.grid.gridMode,this.square&&(this.square.image.image="assets/img/"+this.getImagePath())}getStartAngle(){return 226}getEndAngle(){return 314}getRatioType(){return"Negative and Positive [-1,1]"}getSquarePosition(e,n){let i=(n-5)*-1,a=e.length/2*-1;return new So(i,a)}getImagePath(){return this.gridMode===Oa.OFF_GRID?"icon/offgrid.svg":this.restrictionMode===1?"icon/gridRestriction.svg":"icon/grid.svg"}getValueText(e){return e==null||Number.isNaN(e)?"":this.unitpipe.transform(e,"kW")}initEnergyFlow(e){return new Ao(e,{x1:"100%",y1:"50%",x2:"0%",y2:"50%"})}setElementHeight(){this.square.valueText.y=this.square.valueText.y-this.square.valueText.y*.3,this.square.image.y=this.square.image.y-this.square.image.y*.3}getSvgEnergyFlow(e,n){let i=Math.abs(e),a=n,m={bottomRight:{x:i*-1,y:i},bottomLeft:{x:a*-1,y:i},topRight:{x:i*-1,y:i*-1},topLeft:{x:a*-1,y:i*-1},middleLeft:{x:a*-1+i,y:0},middleRight:{x:0,y:0}};return e>0&&(m.topLeft.x=m.topLeft.x+i,m.middleLeft.x=m.middleLeft.x-i,m.bottomLeft.x=m.bottomLeft.x+i,m.middleRight.x=m.topRight.x-i),m}getSvgAnimationEnergyFlow(e,n){let i=Math.abs(e),a=n,m=a*-1+i,u={bottomRight:{x:i*-1,y:i},bottomLeft:{x:a*-1,y:i},topRight:{x:i*-1,y:i*-1},topLeft:{x:a*-1,y:i*-1},middleLeft:{x:a*-1+i,y:0},middleRight:{x:0,y:0}};return e>0?(u.topLeft.x=u.topRight.x-m*.2,u.middleLeft.x=u.middleRight.x-m*.2-2*i,u.bottomLeft.x=u.bottomRight.x-m*.2,u.middleRight.x=u.middleLeft.x+m*.2):e<0?(u.middleRight.x=u.middleLeft.x+m*.2,u.topRight.x=u.topLeft.x+m*.2,u.bottomRight.x=u.bottomLeft.x+m*.2):u=null,u}static{this.\u0275fac=function(n){return new(n||t)(x(te),x(j),x(Ut))}}static{this.\u0275cmp=I({type:t,selectors:[["","gridsection",""]],standalone:!1,features:[S],attrs:HT,decls:4,vars:4,consts:[["no_text",""],["fill","var(--ion-color-light)","stroke","var(--ion-color-medium-soft)"],["fill","var(--ion-color-dark)","stroke","var(--ion-color-dark)"],["offset","0%","stop-color","var(--ion-item-background)"],["offset","100%","stop-color","var(--ion-color-dark)"],[2,"fill","var(--ion-item-background)"],["font-family","sans-serif","font-size","square.valueText.fontsize","fill","var(--ion-text-color)"],[3,"ngTemplateOutlet"],[2,"color","var(--ion-color-dark)"]],template:function(n,i){n&1&&(gt(),d(0,"path",1),f(1,BT,1,1,":svg:path",2),f(2,zT,8,9,":svg:g"),f(3,qT,7,12,":svg:g")),n&2&&(ze("d",i.outlinePath),r(),_(i.isEnabled?1:-1),r(),_(i.isEnabled&&i.energyFlow?2:-1),r(),_(i.isEnabled&&i.squarePosition&&i.square?3:-1))},encapsulation:2,data:{animation:[go("GridBuy",[ti("show",Rn({opacity:.4,transform:"translateX(0%)"})),ti("hide",Rn({opacity:.1,transform:"translateX(17%)"})),ni("show => hide",ei("650ms")),ni("hide => show",ei("0ms"))]),go("GridSell",[ti("show",Rn({opacity:.1,transform:"translateX(0%)"})),ti("hide",Rn({opacity:.4,transform:"translateX(-17%)"})),ni("show => hide",ei("650ms ease-out")),ni("hide => show",ei("0ms ease-in"))])]}})}}return t})();function Ll(t){return t===null?null:{[xr.NO_RESTRICTION]:0,[xr.ZERO_PERCENT]:100,[xr.THIRTY_PERCENT]:70,[xr.SIXTY_PERCENT]:40}[t]??null}function QT(t){if(t===null)return null;let o=t*1e3;return o===0?null:Ll(o)}function ZT(t,o,e){switch(o){case"rcr":return JT(t,e);case"14a":case"offGrid":default:return eI(t)}}function is(t,o){return t==="bar"?{unit:Z.TIME,position:"right",yAxisId:B.RIGHT,displayGrid:!1}:{unit:Z.RELAY,position:"right",yAxisId:B.RIGHT,customTitle:o.instant("GENERAL.STATE"),displayGrid:!1}}function os(t){return t==="bar"?{unit:Z.TIME,position:"right",yAxisId:B.RIGHT_2,displayGrid:!1}:{unit:Z.RESTRICTION,position:"right",yAxisId:B.RIGHT_2,displayGrid:!1}}function kl(t,o){let e=null,n=null,i=null;return o==="line"?(e=t.Restriction14a?.map(a=>a>0?yo.ON:yo.OFF_HIDDEN)??null,n=t.OffGrid?.map(a=>a*1e3>1?yo.ON:yo.OFF_HIDDEN)??null,i=t.RestrictionRcr?.map(a=>QT(a))??null):(e=t.Restriction14a?.map(a=>a*1e3)??null,n=t.OffGrid?.map(a=>a*1e3)??null,i=t.RestrictionRcr?.map(a=>a*1e3)??null),{restrictionData14a:e,offGridData:n,restrictionDataRcr:i}}function Lr(t,o,e,n,i){return t?ZT(t,e,i).map(m=>({type:"box",borderWidth:1,xScaleID:"x",yMin:m.yMin??null,yMax:m.yMax??null,xMin:o[m.start].toISOString(),xMax:o[m.end].toISOString(),yScaleID:n})):[]}function kr(t,o){return t&&Array.isArray(o)&&o.some(e=>Number.isFinite(e))}function JT(t,o){return o?t.map(Ll).reduce((n,i,a,m)=>{let u=a>0?m[a-1]:null,C=i!==null&&i!==u,v=i===null&&u!==null;return C&&n.push({start:a,end:-1}),v&&n.length>0&&n[n.length-1].end===-1&&(n[n.length-1].end=a-1),n},[]).map(n=>Li(ke({},n),{end:n.end===-1?t.length-1:n.end})):[]}function eI(t){let o=[],e=null;return t.forEach((n,i)=>{n===yo.ON&&e===null?e=i:(n===yo.OFF||n===null)&&e!==null&&(o.push({start:e,end:i-1}),e=null)}),e!==null&&o.push({start:e,end:t.length-1}),o}function tI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function nI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var m_=(()=>{class t extends de{static getChartData(e,n,i,a){let m=Yt.isControllerEnabled(e,"Controller.Ess.Limiter14a"),u=Yt.isControllerEnabled(e,"Controller.Ess.RippleControlReceiver"),C=e.getComponentIdsByFactory("Controller.Ess.Limiter14a")[0]??null,v=e.getComponentIdsByFactory("Controller.Ess.RippleControlReceiver")[0]??null,T=[];m&&T.push({name:"Restriction14a",powerChannel:y.fromString(C+"/RestrictionMode"),energyChannel:y.fromString(C+"/CumulatedRestrictionTime")}),Yt.isControllerEnabled(e,"Controller.Ess.EmergencyCapacityReserve")&&T.push({name:"OffGrid",powerChannel:y.fromString("_sum/GridMode"),energyChannel:y.fromString("_sum/GridModeOffGridTime")}),u&&T.push({name:"RestrictionRcr",powerChannel:y.fromString(v+"/RestrictionMode"),energyChannel:y.fromString(v+"/CumulatedRestrictionTime")});let A=[];return{input:T,output:(b,F)=>{let{restrictionData14a:k,restrictionDataRcr:Q}=kl(b,n),ve=kr(m,k),Re=kr(u,Q),se=[];return ve&&(A.push(is(n,i)),se.push({name:i.instant("GRID_STATES.CONSUMPTION_LIMITATION"),nameSuffix:ge=>ge?.result.data[C+"/CumulatedRestrictionTime"],converter:()=>k,color:U.Colors.ORANGE,stack:2,custom:n==="line"?{unit:Z.RELAY,pluginType:"box",annotations:Lr(k,F,"14a",B.RIGHT)}:{unit:Z.TIME},yAxisId:B.RIGHT})),Re&&(A.push(os(n)),se.push({name:i.instant("GRID_STATES.FEED_IN_LIMITATION"),nameSuffix:ge=>ge?.result.data[v+"/CumulatedRestrictionTime"],converter:()=>Q,color:U.Colors.GREEN,stack:3,custom:n==="line"?{unit:Z.PERCENTAGE,pluginType:"box",annotations:Lr(Q,F,"rcr",B.RIGHT_2,A[A.length-1])}:{unit:Z.TIME},yAxisId:B.RIGHT_2})),se},tooltip:{formatNumber:U.NumberFormat.ZERO_TO_TWO},yAxes:A}}getChartData(){return t.getChartData(this.config,this.chartType,this.translate,this.showPhases)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["common-grid-details-external-limitation-chart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,tI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,nI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();var oI=()=>["day","week"];function rI(t,o){if(t&1){let e=W();s(0,"oe-chart",0),g(1,"translate"),g(2,"translate"),O("setShowTotal",function(i){P(e);let a=p();return L(a.setShowTotal(i))})("setShowPhases",function(i){P(e);let a=p();return L(a.setShowPhases(i))}),d(3,"pickdate",1)(4,"common-grid-details-external-limitation-chart",2),l(),d(5,"oe-footer-subnavigation",3)}if(t&2){let e=p();c("title",E(1,7,"GENERAL.GRID")+"\xA0-\xA0"+E(2,9,"EDGE.HISTORY.EXTERNAL_LIMITATION"))("showPhases",e.showPhases)("showTotal",e.showTotal)("period",e.service.historyPeriod.value),r(3),c("historyPeriods",H(11,oI)),r(),c("isOnlyChart",!0),r(),c("backButton",!0)}}var p_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"setShowTotal","setShowPhases","title","showPhases","showTotal","period"],["custom-pickdate","",3,"historyPeriods"],[3,"isOnlyChart"],[3,"backButton"]],template:function(n,i){n&1&&f(0,rI,6,12),n&2&&_(i.isInitialized?0:-1)},dependencies:[xn,In,tt,m_,V],encapsulation:2})}}return t})();function aI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function sI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var d_=(()=>{class t extends de{static getChartData(e){return{input:[{name:"GridActivePower",powerChannel:y.fromString("_sum/GridActivePower")},...jt.THREE_PHASE.map((n,i)=>({name:"Phase"+n,powerChannel:y.fromString("_sum/GridActivePower"+n)}))],output:n=>[{name:e.instant("GENERAL.TOTAL"),converter:()=>n.GridActivePower,color:U.Colors.BLUE,stack:1},...jt.THREE_PHASE.map((a,m)=>({name:"Phase "+a,converter:()=>n["Phase"+a],color:de.phaseColors[m]}))],tooltip:{formatNumber:"1.0-2"},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["common-grid-details-phase-accurate-chart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,aI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,sI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();var cI=()=>["day","week"];function mI(t,o){if(t&1){let e=W();s(0,"oe-chart",0),g(1,"translate"),O("setShowTotal",function(i){P(e);let a=p();return L(a.setShowTotal(i))})("setShowPhases",function(i){P(e);let a=p();return L(a.setShowPhases(i))}),d(2,"pickdate",1)(3,"common-grid-details-phase-accurate-chart",2),l(),d(4,"oe-footer-subnavigation",3)}if(t&2){let e=p();c("title",(e.title??e.component.alias)+"\xA0-\xA0"+E(1,8,"EDGE.HISTORY.PHASE_ACCURATE"))("showPhases",e.showPhases)("showTotal",e.showTotal)("period",e.service.historyPeriod.value),r(2),c("historyPeriods",H(10,cI)),r(),c("isOnlyChart",!0),r(),c("backButton",!0)("navigationOptions",e.navigationButtons)}}var u_=(()=>{class t extends et{constructor(e,n,i,a,m){super(e,n,i),this.service=e,this.route=n,this.modalCtrl=i,this.router=a,this.translate=m,this.navigationButtons=[],this.title=null,this.gridMeters=[]}afterIsInitialized(){this.service.getCurrentEdge().then(e=>{if(!this.component||!(this.config.isTypeGrid(this.component)??null))return;(Object.values(this.config.components).filter(a=>a.isEnabled&&this.config.isTypeGrid(a))??null)?.length==1&&(this.title=this.translate.instant("GENERAL.GRID")),this.navigationButtons=[{id:"currentVoltage",isEnabled:e.roleIsAtLeast(Rt.INSTALLER),alias:this.translate.instant("EDGE.HISTORY.CURRENT_AND_VOLTAGE"),callback:()=>{this.router.navigate(["./currentVoltage"],{relativeTo:this.route})}}]})}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(he),x(It),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"setShowTotal","setShowPhases","title","showPhases","showTotal","period"],["custom-pickdate","",3,"historyPeriods"],[3,"isOnlyChart"],[3,"backButton","navigationOptions"]],template:function(n,i){n&1&&f(0,mI,5,11),n&2&&_(i.isInitialized&&i.component?0:-1)},dependencies:[xn,In,tt,d_,V],encapsulation:2})}}return t})();function pI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function dI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var f_=(()=>{class t extends de{static getChartData(e,n,i,a){let m=Yt.isControllerEnabled(e,"Controller.Ess.Limiter14a"),u=Yt.isControllerEnabled(e,"Controller.Ess.RippleControlReceiver"),C=Yt.isControllerEnabled(e,"GoodWe.BatteryInverter"),v=Yt.isControllerEnabled(e,"Controller.Ess.EmergencyCapacityReserve"),T=e.getComponentIdsByFactory("Controller.Ess.Limiter14a")[0]??null,A=e.getComponentIdsByFactory("Controller.Ess.RippleControlReceiver")[0]??null,b=[ke({name:"GridSell",powerChannel:y.fromString("_sum/GridActivePower"),energyChannel:y.fromString("_sum/GridSellActiveEnergy")},n==="line"&&{converter:Je.ValueConverter.ONLY_NEGATIVE_AND_NEGATIVE_AS_POSITIVE}),{name:"GridBuy",powerChannel:y.fromString("_sum/GridActivePower"),energyChannel:y.fromString("_sum/GridBuyActiveEnergy"),converter:Je.ValueConverter.NEGATIVE_AS_ZERO}];if(m&&b.push({name:"Restriction14a",powerChannel:y.fromString(T+"/RestrictionMode"),energyChannel:y.fromString(T+"/CumulatedRestrictionTime")}),v&&b.push({name:"OffGrid",powerChannel:y.fromString("_sum/GridMode"),energyChannel:y.fromString("_sum/GridModeOffGridTime")}),u&&b.push({name:"RestrictionRcr",powerChannel:y.fromString(A+"/RestrictionMode"),energyChannel:y.fromString(A+"/CumulatedRestrictionTime")}),C){let k=y.fromString(A+"/CumulatedRestrictionTime")??null;b.push({name:"FeedInLimit",powerChannel:y.fromString("batteryInverter0/FeedPowerParaSet"),energyChannel:k})}a&&["L1","L2","L3"].forEach(k=>{b.push({name:"GridActivePower"+k,powerChannel:y.fromString("_sum/GridActivePower"+k)})});let F=[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}];return m&&F.push(is(n,i)),u&&F.push(os(n)),{input:b,output:(k,Q)=>{let{restrictionData14a:ve,restrictionDataRcr:Re,offGridData:se}=kl(k,n),ge=[{name:i.instant("GENERAL.GRID_SELL_ADVANCED"),nameSuffix:nt=>nt?.result.data["_sum/GridSellActiveEnergy"]??null,converter:()=>k.GridSell,color:U.Colors.PURPLE,stack:1},{name:i.instant("GENERAL.GRID_BUY_ADVANCED"),nameSuffix:nt=>nt?.result.data["_sum/GridBuyActiveEnergy"]??null,converter:()=>k.GridBuy,color:U.Colors.BLUE_GREY,stack:0}],Ue=kr(m,ve),Ot=kr(u,Re);return kr(v,se)&&ge.push({name:i.instant("GRID_STATES.OFF_GRID"),nameSuffix:nt=>nt?.result.data["_sum/GridModeOffGridTime"],converter:()=>se,color:U.Colors.RED,stack:2,custom:n==="line"?{unit:Z.RELAY,pluginType:"box",annotations:Lr(se,Q,"offGrid",B.RIGHT)}:{unit:Z.TIME},yAxisId:B.RIGHT}),Ue&&(F.push(is(n,i)),ge.push({name:i.instant("GRID_STATES.CONSUMPTION_LIMITATION"),nameSuffix:nt=>nt?.result.data[T+"/CumulatedRestrictionTime"],converter:()=>ve,color:U.Colors.ORANGE,stack:2,custom:n==="line"?{unit:Z.RELAY,pluginType:"box",annotations:Lr(ve,Q,"14a",B.RIGHT)}:{unit:Z.TIME},yAxisId:B.RIGHT})),Ot&&(F.push(os(n)),ge.push({name:i.instant("GRID_STATES.FEED_IN_LIMITATION"),nameSuffix:nt=>nt?.result.data[A+"/CumulatedRestrictionTime"],converter:()=>Re,color:U.Colors.GREEN,stack:3,custom:n==="line"?{unit:Z.PERCENTAGE,pluginType:"box",annotations:Lr(Re,Q,"rcr",B.RIGHT_2,F[F.length-1])}:{unit:Z.TIME},yAxisId:B.RIGHT_2})),a&&["L1","L2","L3"].forEach((nt,Gt)=>{ge.push({name:"Phase "+nt,nameSuffix:Ln=>Ln?.result.data["_sum/GridActivePower"+nt],converter:()=>k["GridActivePower"+nt]??null,color:de.phaseColors[Gt],stack:3})}),ge},tooltip:{formatNumber:"1.0-2"},yAxes:F}}getChartData(){return t.getChartData(this.config,this.chartType,this.translate,this.showPhases)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["gridchart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,pI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,dI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function fI(t,o){if(t&1){let e=W();s(0,"oe-chart",2),g(1,"translate"),O("setShowPhases",function(i){P(e);let a=p();return L(a.setShowPhases(i))}),d(2,"gridchart",3),l()}if(t&2){let e=p();c("title",E(1,6,"GENERAL.GRID"))("showPhases",e.showPhases)("period",e.service.historyPeriod),r(2),c("isOnlyChart",!0)("showPhases",e.showPhases)("showTotal",e.showTotal)}}function _I(t,o){if(t&1&&d(0,"oe-footer-subnavigation",1),t&2){let e=p();c("navigationOptions",e.navigationButtons)}}var __=(()=>{class t extends et{constructor(e,n,i,a,m){super(e,n,i),this.service=e,this.route=n,this.modalCtrl=i,this.router=a,this.translate=m,this.navigationButtons=[],this.isAllowed=!1}afterIsInitialized(){this.service.historyPeriod.pipe(An(this.stopOnDestroy),vt(i=>!!i)).subscribe(i=>{this.isAllowed=i.isWeekOrDay()});let e=[],n=Object.values(this.config.components).filter(i=>i.isEnabled&&this.config.isTypeGrid(i));n&&(e.push(...n),this.navigationButtons=e.flatMap(i=>[{id:i.id,alias:e.length===1?this.translate.instant("EDGE.HISTORY.PHASE_ACCURATE"):i.alias,callback:()=>{this.router.navigate(["./"+i.id],{relativeTo:this.route})}},{id:"externalLimitation",alias:this.translate.instant("EDGE.HISTORY.EXTERNAL_LIMITATION"),callback:()=>{this.router.navigate(["./externalLimitation"],{relativeTo:this.route})}}]))}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(he),x(It),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:2,vars:2,consts:[[3,"title","showPhases","period"],[3,"navigationOptions"],[3,"setShowPhases","title","showPhases","period"],[3,"isOnlyChart","showPhases","showTotal"]],template:function(n,i){n&1&&(f(0,fI,3,8,"oe-chart",0),f(1,_I,1,1,"oe-footer-subnavigation",1)),n&2&&(_(i.isInitialized?0:-1),r(),_(i.isInitialized&&i.isAllowed?1:-1))},dependencies:[xn,tt,f_,V],encapsulation:2})}}return t})();function hI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function CI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var h_=(()=>{class t extends de{static getChartData(e,n,i){let a=e.getComponent(n.snapshot.params.componentId);return{input:[{name:a.id,powerChannel:y.fromString(a.id+"/ActualPower"),energyChannel:y.fromString(a.id+"/ActualEnergy")}],output:m=>[{name:a.alias,nameSuffix:u=>u.result.data[a.id+"/ActualEnergy"],converter:()=>m[a.id],color:"rgb(0,152,204)",hiddenOnInit:!1,stack:2}],tooltip:{formatNumber:"1.1-2",afterTitle:i.instant("GENERAL.TOTAL")},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.route,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["chargerChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,hI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,CI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function EI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function vI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var C_=(()=>{class t extends de{static getChartData(e,n,i){let a=e.getComponent(n.snapshot.params.componentId);return{input:[{name:a.id,powerChannel:y.fromString(a.id+"/ActivePower"),energyChannel:y.fromString(a.id+"/ActiveProductionEnergy")},...jt.THREE_PHASE.map(m=>({name:"ProductionAcActivePower"+m,powerChannel:y.fromString(a.id+"/ActivePower"+m)}))],output:m=>{let u=[];return u.push({name:a.alias,nameSuffix:C=>C.result.data[a.id+"/ActiveProductionEnergy"],converter:()=>m[a.id],color:"rgb(0,152,204)",hiddenOnInit:!1,stack:2}),u.push(...jt.THREE_PHASE.map((C,v)=>({name:"Phase "+C,converter:()=>m["ProductionAcActivePower"+C],color:"rgb("+de.phaseColors[v]+")",stack:3}))),u},tooltip:{formatNumber:"1.1-2",afterTitle:i.instant("GENERAL.TOTAL")},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.route,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["productionMeterChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,EI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,vI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function TI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function II(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var g_=(()=>{class t extends de{static getChartData(e,n,i){let a=e.getComponent(n.snapshot.params.componentId),m=e.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger").length>0,u=e.getComponentsImplementingNature("io.openems.edge.meter.api.AsymmetricMeter").length>0,C=[{name:a.id,powerChannel:y.fromString(a.id+"/ProductionActivePower"),energyChannel:y.fromString(a.id+"/ProductionActiveEnergy")}],v=null;m&&(C.push({name:a.id+"ActualPower",powerChannel:y.fromString("_sum/ProductionDcActualPower")}),v=(b,F)=>b[a.id+"ActualPower"]?.reduce((k,Q,ve)=>(k.push(M.addSafely(M.divideSafely(Q,3),b["ProductionAcActivePower"+F][ve])),k),[])),u&&(v=(b,F)=>b["ProductionAcActivePower"+F]),(u||m)&&C.push(...jt.THREE_PHASE.map(b=>({name:"ProductionAcActivePower"+b,powerChannel:y.fromString(a.id+"/ProductionAcActivePower"+b)})));let T=v?b=>jt.THREE_PHASE.map((F,k)=>({name:"Phase "+F,converter:()=>v(b,F),color:"rgb("+de.phaseColors[k]+")",stack:3})):()=>[];return{input:C,output:b=>[{name:i.instant("GENERAL.TOTAL"),nameSuffix:F=>F.result.data["_sum/ProductionActiveEnergy"],converter:()=>b[a.id],color:U.Colors.BLUE,hiddenOnInit:!1,stack:2},...T(b)],tooltip:{formatNumber:"1.1-2",afterTitle:i.instant("GENERAL.TOTAL")},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.route,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["sumChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,TI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,II,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function SI(t,o){t&1&&d(0,"sumChart",2),t&2&&c("isOnlyChart",!0)}function AI(t,o){t&1&&d(0,"productionMeterChart",2),t&2&&c("isOnlyChart",!0)}function wI(t,o){t&1&&d(0,"chargerChart",2),t&2&&c("isOnlyChart",!0)}function bI(t,o){if(t&1&&(s(0,"oe-chart",0),f(1,SI,1,1,"sumChart",2)(2,AI,1,1,"productionMeterChart",2)(3,wI,1,1,"chargerChart",2),l()),t&2){let e,n=p();c("title",n.componentSome.displayName)("period",n.service.historyPeriod.value),r(),_((e=n.componentSome.type)==="sum"?1:e==="productionMeter"?2:e==="charger"?3:-1)}}function DI(t,o){if(t&1&&d(0,"oe-footer-subnavigation",1),t&2){let e=p();c("backButton",!0)("navigationOptions",e.navigationButtons)}}var E_=(()=>{class t extends et{constructor(e,n,i,a,m){super(e,n,i),this.service=e,this.route=n,this.modalCtrl=i,this.router=a,this.translate=m,this.navigationButtons=[],this.componentSome=null}afterIsInitialized(){this.componentSome=this.getComponentType(),this.service.getCurrentEdge().then(e=>{this.component?.factoryId!=="Core.Sum"&&(this.navigationButtons=[{id:"currentVoltage",isEnabled:e.roleIsAtLeast(Rt.INSTALLER),alias:this.translate.instant("EDGE.HISTORY.CURRENT_AND_VOLTAGE"),callback:()=>{this.router.navigate(["./currentVoltage"],{relativeTo:this.route})}}])})}getComponentType(){return this.component?this.config.hasComponentNature("io.openems.edge.ess.dccharger.api.EssDcCharger",this.component.id)&&this.component.isEnabled?{type:"charger",displayName:this.component.alias}:this.config.isProducer(this.component)&&this.component.isEnabled?{type:"productionMeter",displayName:this.component.alias}:this.component.factoryId==="Core.Sum"?{type:"sum",displayName:this.translate.instant("GENERAL.TOTAL")}:null:null}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(he),x(It),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:2,vars:2,consts:[[3,"title","period"],[3,"backButton","navigationOptions"],[3,"isOnlyChart"]],template:function(n,i){n&1&&(f(0,bI,4,3,"oe-chart",0),f(1,DI,1,2,"oe-footer-subnavigation",1)),n&2&&(_(i.isInitialized&&i.component&&i.componentSome?0:-1),r(),_(i.isInitialized?1:-1))},dependencies:[xn,tt,h_,C_,g_],encapsulation:2})}}return t})();function RI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function OI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var v_=(()=>{class t extends de{getChartHeight(){return this.showTotal?window.innerHeight/1.3:window.innerHeight/2.3}getChartData(){let e=this.config?.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(m=>this.config.isProducer(m)),n=this.config.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger"),i=[{name:"ProductionActivePower",powerChannel:y.fromString("_sum/ProductionActivePower"),energyChannel:y.fromString("_sum/ProductionActiveEnergy")}];n.length>0&&i.push({name:"ProductionDcActualPower",powerChannel:y.fromString("_sum/ProductionDcActualPower"),energyChannel:y.fromString("_sum/ProductionDcActiveEnergy")}),this.showPhases&&i.push({name:"ProductionAcActivePowerL1",powerChannel:y.fromString("_sum/ProductionAcActivePowerL1")},{name:"ProductionAcActivePowerL2",powerChannel:y.fromString("_sum/ProductionAcActivePowerL2")},{name:"ProductionAcActivePowerL3",powerChannel:y.fromString("_sum/ProductionAcActivePowerL3")});for(let m of e)i.push({name:m.id,powerChannel:y.fromString(m.id+"/ActivePower"),energyChannel:y.fromString(m.id+"/ActiveProductionEnergy")});for(let m of n)i.push({name:m.id,powerChannel:y.fromString(m.id+"/ActualPower"),energyChannel:y.fromString(m.id+"/ActualEnergy")});return{input:i,output:m=>{let u=[];if(u.push({name:this.showTotal==!1?this.translate.instant("GENERAL.PRODUCTION"):this.translate.instant("GENERAL.TOTAL"),nameSuffix:T=>T?.result.data["_sum/ProductionActiveEnergy"]??null,converter:()=>m.ProductionActivePower,color:U.Colors.BLUE,hiddenOnInit:!0,stack:2}),!this.showTotal)return u;for(let T=1;T<4;T++)u.push({name:"Phase L"+T,nameSuffix:A=>A.result.data["_sum/ProductionAcActiveEnergyL"+T],converter:()=>{if(!this.showPhases)return null;let A=[];return this.config.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger").length>0?m.ProductionDcActualPower.forEach((b,F)=>{A[F]=M.addSafely(m["ProductionAcActivePowerL"+T][F],b/3)}):this.config.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").length>0&&(A=m["ProductionAcActivePowerL"+T]),A},color:"rgb("+de.phaseColors[T-1]+")",stack:3});let C=["rgb(253,197,7)","rgb(202, 158, 6","rgb(228, 177, 6)","rgb(177, 138, 5)","rgb(152, 118, 4)"];for(let T=0;T<e.length;T++){let A=e[T];u.push({name:A.alias??A.id,nameSuffix:b=>b.result.data[A.id+"/ActiveProductionEnergy"]??null,converter:()=>m[A.id]??null,color:C[Math.min(T,C.length-1)],stack:1})}let v=["rgb(0,223,0)","rgb(0,134,0)","rgb(0,201,0)","rgb(0,134,0)","rgb(0,156,0)"];for(let T=0;T<n.length;T++){let A=n[T];u.push({name:A.alias??A.id,nameSuffix:b=>b.result.data[new y(A.id,"ActualEnergy").toString()],converter:()=>m[A.id]??null,color:v[Math.min(T,v.length-1)],stack:1})}return u},tooltip:{formatNumber:"1.1-2",afterTitle:this.translate.instant("GENERAL.TOTAL")},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["productionTotalChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,RI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,OI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function MI(t,o){if(t&1){let e=W();s(0,"oe-chart",2),g(1,"translate"),Zt("showPhasesChange",function(i){P(e);let a=p();return Qt(a.showPhases,i)||(a.showPhases=i),L(i)}),O("setShowTotal",function(i){P(e);let a=p();return L(a.setShowTotal(i))}),d(2,"productionTotalChart",3),l()}if(t&2){let e=p();c("title",E(1,7,"GENERAL.PRODUCTION"))("period",e.service.historyPeriod.value),Kt("showPhases",e.showPhases),c("showTotal",!1),r(2),c("isOnlyChart",!0)("showTotal",e.showTotal)("showPhases",e.showPhases)}}function FI(t,o){if(t&1&&d(0,"oe-footer-subnavigation",1),t&2){let e=p();c("navigationOptions",e.navigationButtons)}}var y_=(()=>{class t extends et{constructor(e,n,i,a,m){super(e,n,i),this.service=e,this.route=n,this.modalCtrl=i,this.router=a,this.translate=m,this.chargerComponents=[],this.productionMeterComponents=[],this.navigationButtons=[]}getChannelAddresses(){return this.chargerComponents=this.config.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger").filter(e=>e.isEnabled),this.productionMeterComponents=this.config.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(e=>e.isEnabled&&this.config.isProducer(e)),this.navigationButtons=[...this.productionMeterComponents,...this.chargerComponents].map(e=>({id:e.id,alias:e.alias,callback:()=>{this.router.navigate(["./"+e.id],{relativeTo:this.route})}})),[]}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(he),x(It),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:2,vars:2,consts:[[3,"title","period","showPhases","showTotal"],[3,"navigationOptions"],[3,"showPhasesChange","setShowTotal","title","period","showPhases","showTotal"],[3,"isOnlyChart","showTotal","showPhases"]],template:function(n,i){n&1&&(f(0,MI,3,9,"oe-chart",0),f(1,FI,1,1,"oe-footer-subnavigation",1)),n&2&&(_(i.isInitialized?0:-1),r(),_(i.isInitialized?1:-1))},dependencies:[xn,tt,v_,V],encapsulation:2})}}return t})();function GI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function PI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var T_=(()=>{class t extends de{getChartData(){return this.spinnerId="selfconsumption-chart",{input:[ke({name:"GridSell",powerChannel:y.fromString("_sum/GridActivePower"),energyChannel:y.fromString("_sum/GridSellActiveEnergy")},this.chartType==="line"&&{converter:Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE}),{name:"ProductionActivePower",powerChannel:y.fromString("_sum/ProductionActivePower"),energyChannel:y.fromString("_sum/ProductionActiveEnergy")}],output:e=>[{name:this.translate.instant("GENERAL.SELF_CONSUMPTION"),nameSuffix:n=>M.calculateSelfConsumption(n?.result.data["_sum/GridSellActiveEnergy"]??null,n?.result.data["_sum/ProductionActiveEnergy"]??null),converter:()=>e.GridSell?.map((n,i)=>M.calculateSelfConsumption(n,e.ProductionActivePower[i])),color:U.Colors.YELLOW}],tooltip:{formatNumber:"1.0-0"},yAxes:[{unit:Z.PERCENTAGE,position:"left",yAxisId:B.LEFT}]}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["selfconsumptionChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,GI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,PI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();var I_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:3,vars:4,consts:[[3,"title"],[3,"isOnlyChart"]],template:function(n,i){n&1&&(s(0,"oe-chart",0),g(1,"translate"),d(2,"selfconsumptionChart",1),l()),n&2&&(c("title",E(1,2,"GENERAL.SELF_CONSUMPTION")),r(2),c("isOnlyChart",!0))},dependencies:[tt,T_,V],encapsulation:2})}}return t})();function kI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function VI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var x_=(()=>{class t extends de{static getChartData(e){let n=e?.getComponentIdsImplementingNature("io.openems.impl.controller.channelthreshold.ChannelThresholdController").concat(e.getComponentIdsByFactory("Controller.ChannelThreshold")),i={},a=[];for(let m of n){let u=y.fromString(e.getComponentProperties(m).outputChannelAddress);i[m]=u.channelId,a.push({name:m,powerChannel:u,energyChannel:new y(m,"CumulatedActiveTime")})}return{input:a,output:m=>{let u=[];for(let C=0;C<n.length;C++){let v=n[C];u.push({name:i[v]??v,nameSuffix:T=>T?.result.data[v+"/CumulatedActiveTime"]??null,converter:()=>m[v].map(T=>M.multiplySafely(T,1e3)),color:U.Colors.SHADES_OF_YELLOW[C%(U.Colors.SHADES_OF_YELLOW.length-1)],stack:0})}return u},tooltip:{formatNumber:"1.0-0"},yAxes:[{unit:Z.RELAY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["totalChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,kI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,VI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function BI(t,o){if(t&1){let e=W();s(0,"oe-chart",1),g(1,"translate"),O("setShowTotal",function(i){P(e);let a=p();return L(a.setShowTotal(i))}),d(2,"totalChart",2),l()}if(t&2){let e=p();c("showTotal",e.showTotal)("period",e.service.historyPeriod)("title",E(1,4,"EDGE.INDEX.WIDGETS.CHANNELTRESHOLD.TITLE")),r(2),c("isOnlyChart",!0)}}var S_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["overview"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"showTotal","period","title"],[3,"setShowTotal","showTotal","period","title"],[3,"isOnlyChart"]],template:function(n,i){n&1&&f(0,BI,3,6,"oe-chart",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[tt,x_,V],encapsulation:2})}}return t})();var A_={de:{LEGEND_DESCRIPTION:"Legende Betriebszustand"},en:{LEGEND_DESCRIPTION:"Legend operating status"}};function UI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function zI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var w_=(()=>{class t extends de{static getChartData(e,n,i){return{input:[{name:"ControlMode",powerChannel:new y(e.id,"ControlMode")},{name:"CumulatedInactiveTime",energyChannel:new y(e.id,"CumulatedInactiveTime")},{name:"CumulatedNoDischargeTime",energyChannel:new y(e.id,"CumulatedNoDischargeTime")}],output:m=>n==="line"?[{name:i.instant("GENERAL.STATE"),converter:()=>m.ControlMode?.map(u=>{let C=M.multiplySafely(u,1e3);return C!=null?M.addSafely(C,1):null}),color:U.Colors.RED,stack:0}]:[{name:i.instant("'CumulatedInactiveTime'"),nameSuffix:u=>u?.result.data[e.id+"/CumulatedInactiveTime"],converter:()=>m.CumulatedInactiveTime?.map(u=>M.multiplySafely(u,1e3)),color:U.Colors.DARK_GREY,stack:0},{name:i.instant("'CumulatedNoDischargeTime'"),nameSuffix:u=>u?.result.data[e.id+"/CumulatedNoDischargeTime"],converter:()=>m.CumulatedNoDischargeTime?.map(u=>M.multiplySafely(u,1e3)),color:U.Colors.YELLOW,stack:0}],tooltip:{formatNumber:U.NumberFormat.NO_DECIMALS},yAxes:[{unit:n==="line"?Z.ENERIX_CONTROL:Z.TIME,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.component,this.chartType,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["enerixControlChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,UI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,zI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function YI(t,o){if(t&1&&(d(0,"oe-chart-legend",2),g(1,"translate")),t&2){let e=p(2);c("description",e.STATES)("header",E(1,2,"LEGEND_DESCRIPTION"))}}function $I(t,o){if(t&1){let e=W();s(0,"oe-chart",0)(1,"enerixControlChart",1),O("setChartConfig",function(i){P(e);let a=p();return L(a.setChartConfig(i))}),l(),f(2,YI,2,4,"oe-chart-legend",2),l()}if(t&2){let e=p();c("title",e.component.alias),r(),c("isOnlyChart",!0)("component",e.component),r(),_(e.chartType==="line"?2:-1)}}var b_=(()=>{class t extends et{constructor(e,n,i,a){super(e,n,i),this.service=e,this.route=n,this.modalCtrl=i,this.translate=a,this.STATES=`
    1.${this.translate.instant("EDGE.INDEX.WIDGETS.ENERIX_CONTROL.NO_INPUT")}
    2.${this.translate.instant("EDGE.INDEX.WIDGETS.ENERIX_CONTROL.NO_DISCHARGE")} 
    `,this.chartType="line",Ze.setAdditionalTranslationFile(A_,this.translate).then(({lang:m,translations:u,shouldMerge:C})=>{this.translate.setTranslation(m,u,C)})}setChartConfig(e){this.chartType=e.chartType}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(he),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["enerixControl-overview"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title"],[3,"setChartConfig","isOnlyChart","component"],[3,"description","header"]],template:function(n,i){n&1&&f(0,$I,3,4,"oe-chart",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[tt,Ud,w_,V],encapsulation:2})}}return t})();function XI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function qI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var D_=(()=>{class t extends de{static getChartData(e,n){return{input:[{name:"DelayChargeMaximumChargeLimit",powerChannel:new y(e.id,"DelayChargeMaximumChargeLimit")},{name:"SellToGridLimitMinimumChargeLimit",powerChannel:new y(e.id,"SellToGridLimitMinimumChargeLimit"),converter:Je.ValueConverter.NEGATIVE_AS_ZERO},{name:"ProductionDcActualPower",powerChannel:new y("_sum","ProductionDcActualPower")},{name:"EssActivePower",powerChannel:new y("_sum","EssActivePower")},{name:"EssSoc",powerChannel:new y("_sum","EssSoc")}],output:i=>[{name:n.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MAXIMUM_CHARGE"),converter:()=>i.DelayChargeMaximumChargeLimit,color:U.Colors.YELLOW,borderDash:[3,3]},{name:n.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MINIMUM_CHARGE"),converter:()=>i.SellToGridLimitMinimumChargeLimit,color:U.Colors.RED,borderDash:[3,3]},{name:n.instant("GENERAL.CHARGE"),converter:()=>(i.ProductionDcActualPower?i.ProductionDcActualPower.map((a,m)=>M.subtractSafely(i.EssActivePower[m],a)):i.EssActivePower)?.map(a=>Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE(a))??null,color:U.Colors.GREEN},{name:n.instant("GENERAL.SOC"),converter:()=>i.EssSoc.map(a=>M.multiplySafely(a,1e3)),color:"rgb(189, 195, 199)",borderDash:[10,10],yAxisId:B.RIGHT,custom:{unit:Z.PERCENTAGE}}],tooltip:{formatNumber:"1.0-2"},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT},{unit:Z.PERCENTAGE,position:"right",yAxisId:B.RIGHT,displayGrid:!1}]}}getChartData(){return t.getChartData(this.component,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["gridOptimizedChargeChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,XI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,qI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function Hr(t){return t.isVersionAtLeast("2025.9.1")}function QI(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function ZI(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var R_=(()=>{class t extends de{static getChartData(e,n,i,a){return{input:[{name:"ActivePower",powerChannel:new y(e,"ActivePower"),converter:Je.ValueConverter.ONLY_NEGATIVE_AND_NEGATIVE_AS_POSITIVE},...Hr(a)?[{name:"_PropertyMaximumGridFeedInLimit",powerChannel:new y("_meta","_PropertyMaximumGridFeedInLimit")}]:[{name:"_PropertyMaximumSellToGridPower",powerChannel:new y(n,"_PropertyMaximumSellToGridPower")}],{name:"ProductionActivePower",powerChannel:new y("_sum","ProductionActivePower")}],output:m=>[{name:i.instant("GENERAL.GRID_SELL"),converter:()=>m.ActivePower,color:U.Colors.PURPLE},{name:i.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MAXIMUM_GRID_FEED_IN"),converter:Hr(a)?()=>m._PropertyMaximumGridFeedInLimit:()=>m._PropertyMaximumSellToGridPower,color:U.Colors.YELLOW,hideShadow:!0,borderDash:[3,3]},{name:i.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MAXIMUM_GRIDSELL_WITH_CHARGE"),converter:Hr(a)?()=>m._PropertyMaximumGridFeedInLimit.map(u=>M.multiplySafely(u,.95)):()=>m._PropertyMaximumSellToGridPower.map(u=>M.multiplySafely(u,.95)),color:U.Colors.RED,hideShadow:!0,borderDash:[3,3]},{name:i.instant("GENERAL.PRODUCTION"),converter:()=>m.ProductionActivePower,color:"rgb(45,143,171)"}],tooltip:{formatNumber:"1.0-2"},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){let e=this.config.getComponentProperties(this.component.id)["meter.id"];return t.getChartData(e,this.component.id,this.translate,this.edge)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["sellToGridLimitChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,QI,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,ZI,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function ex(t,o){if(t&1&&(s(0,"oe-chart",0),d(1,"gridOptimizedChargeChart",1),g(2,"translate"),s(3,"ion-card-content",2)(4,"ion-row",3)(5,"ion-item",4),d(6,"ion-icon",5),s(7,"ion-label",6)(8,"small",7),h(9," EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.HISTORY.PRIORITY_DESCRIPTION "),l()()()()(),d(10,"sellToGridLimitChart",1),g(11,"translate"),s(12,"ion-card-content",2)(13,"ion-row",3)(14,"ion-item",4),d(15,"ion-icon",5),s(16,"ion-label",6)(17,"small",7),h(18," EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.HISTORY.BATTERY_CHARGE_GRID_LIMIT_DESCRIPTION "),l()()()()()()),t&2){let e=p();c("period",e.service.historyPeriod)("title",e.component.alias),r(),c("chartTitle",E(2,6,"GENERAL.CHARGE"))("component",e.component),r(9),c("chartTitle",E(11,8,"GENERAL.GRID_SELL"))("component",e.component)}}var O_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["gridoptimizedcharge-chart-overview"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"period","title"],[3,"chartTitle","component"],[1,"underline"],[1,"ion-justify-content-center"],["lines","none",1,"ion-text-center",2,"width","100%"],["color","primary","size","large","slot","start","name","alert-outline"],[1,"ion-text-wrap"],["translate",""]],template:function(n,i){n&1&&f(0,ex,19,10,"oe-chart",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[tt,We,ie,J,ne,Se,Ne,D_,R_,V],encapsulation:2})}}return t})();function tx(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function nx(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var N_=(()=>{class t extends de{constructor(e,n,i,a,m,u){super(n,i,a,m,u),this.websocket=e,this.service=n,this.cdRef=i,this.translate=a,this.route=m,this.logger=u,this.currencyUnit=null,wt(()=>{let C=this.service.currentEdge();C&&C.getFirstValidConfig(this.websocket).then(v=>{let T=v?.getComponent("_meta"),A=v?.getPropertyFromComponent(T,"currency");this.currencyUnit=Di.getChartCurrencyUnitLabel(A)})})}getChartData(){let e=this.config.getComponentIdsByFactory("Controller.Ess.Time-Of-Use-Tariff")[0];this.component=this.config.components[e];let n=this.config?.getComponent("_meta"),i=this.config?.getPropertyFromComponent(n,"currency");return this.currencyLabel=Di.getCurrencyLabelByCurrency(i),this.chartType="bar",{input:[{name:"QuarterlyPrice",powerChannel:y.fromString(this.component.id+"/QuarterlyPrices")},{name:"StateMachine",powerChannel:y.fromString(this.component.id+"/StateMachine")},{name:"Soc",powerChannel:y.fromString("_sum/EssSoc")},{name:"GridBuy",powerChannel:y.fromString("_sum/GridActivePower"),converter:Je.ValueConverter.NEGATIVE_AS_ZERO}],output:a=>[{name:this.translate.instant("EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.BALANCING"),converter:()=>this.getDataset(a,on.State.Balancing),color:"rgb(51,102,0)",stack:1,custom:{formatNumber:U.NumberFormat.TWO},order:2},{name:this.translate.instant("EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.CHARGE_GRID"),converter:()=>this.getDataset(a,on.State.ChargeGrid),color:"rgb(0, 204, 204)",stack:1,order:2},{name:this.translate.instant("EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.DELAY_DISCHARGE"),converter:()=>this.getDataset(a,on.State.DelayDischarge),color:"rgb(0,0,0)",stack:1,order:2},{name:this.translate.instant("GENERAL.SOC"),converter:()=>a.Soc?.map(m=>M.multiplySafely(m,1e3)),color:"rgb(189, 195, 199)",borderDash:[10,10],yAxisId:B.RIGHT,custom:{type:"line",unit:Z.PERCENTAGE,formatNumber:"1.0-0"},order:1},{name:this.translate.instant("GENERAL.GRID_BUY_ADVANCED"),converter:()=>a.GridBuy,color:U.Colors.BLUE_GREY,yAxisId:B.RIGHT_2,custom:{type:"line",formatNumber:"1.0-0"},hiddenOnInit:!0,order:0}],tooltip:{formatNumber:U.NumberFormat.TWO},yAxes:[{unit:Z.CURRENCY,position:"left",yAxisId:B.LEFT,customTitle:Di.getChartCurrencyUnitLabel(i),scale:{dynamicScale:!0}},{unit:Z.PERCENTAGE,position:"right",yAxisId:B.RIGHT,displayGrid:!1},{unit:Z.POWER,position:"right",yAxisId:B.RIGHT_2,displayGrid:!1}]}}loadChart(){return ae(this,null,function*(){this.labels=[],this.errorResponse=null;let e={unit:Tr.Type.MINUTES,value:15};this.queryHistoricTimeseriesData(this.service.historyPeriod.value.from,this.service.historyPeriod.value.to,e).then(n=>{this.chartType="line",this.chartObject=this.getChartData();let i=de.fillChart(this.chartType,this.chartObject,n);this.datasets=i.datasets,this.legendOptions=i.legendOptions,this.labels=i.labels,this.setChartLabel(),this.chartObject.yAxes.forEach(a=>{this.options=de.getYAxisOptions(this.options,a,this.translate,this.chartType,this.datasets,!0,this.chartObject.tooltip.formatNumber)}),this.options.scales.x.time.unit=On(this.service,this.service.historyPeriod.value.from,this.service.historyPeriod.value.to).timeFormat,this.options.scales.x.ticks.source="auto",this.options.scales.x.grid={offset:!1},this.options.plugins.tooltip.mode="index",this.options.scales.x.ticks.maxTicksLimit=30,this.options.scales[B.LEFT].min=this.getMinimumAxisValue(this.datasets),this.options.plugins.tooltip.callbacks.labelColor=a=>({borderColor:Pt.changeOpacityFromRGBA(a.dataset.borderColor,1),backgroundColor:a.dataset.backgroundColor}),this.options.scales.x.bounds="ticks",this.options.plugins.tooltip.callbacks.label=a=>{let m=a.dataset.label,u=a.dataset.data[a.dataIndex];return on.getLabel(u,m,this.translate,this.currencyLabel)},this.options.scales[B.LEFT].title.text=this.currencyUnit,this.datasets=this.datasets.map(a=>{let m=a.type==="line"?.2:.5;return a.backgroundColor=Pt.changeOpacityFromRGBA(a.backgroundColor.toString(),m),a.borderColor=Pt.changeOpacityFromRGBA(a.borderColor.toString(),1),a}),this.options.scales.x.offset=!1,this.options.animation=!1})})}getDataset(e,n){let i=e.QuarterlyPrice.map(C=>on.formatPrice(M.multiplySafely(C,1e3))),a=e.StateMachine.map(C=>M.multiplySafely(C,1e3)).map(C=>C===null?null:C<.5?0:C>2.5?3:1),m=i.length,u=Array(m).fill(null);for(let C=0;C<m;C++){let v=i[C],T=a[C];T!==null&&T===n&&(u[C]=v)}return u}getMinimumAxisValue(e){let i=[this.translate.instant("EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.BALANCING"),this.translate.instant("EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.CHARGE_GRID"),this.translate.instant("EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.DELAY_DISCHARGE")].map(m=>{let u=e.find(C=>C.label===m)?.data;return u?u.filter(C=>C!==null):[]}).reduce((m,u)=>m.concat(u),[]);if(i.length===0)return 0;let a=Math.floor(Math.min(...i));return Math.floor(a-a*.05)}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(j),x(ln),x(te),x(De),x(Jo))}}static{this.\u0275cmp=I({type:t,selectors:[["scheduleChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,tx,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,nx,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function ox(t,o){if(t&1&&(s(0,"oe-chart",0),d(1,"scheduleChart",1),l()),t&2){let e=p();c("title",e.component.alias),r(),c("isOnlyChart",!0)}}var M_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title"],[3,"isOnlyChart"]],template:function(n,i){n&1&&f(0,ox,2,2,"oe-chart",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[tt,N_],encapsulation:2})}}return t})();function rx(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function ax(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var F_=(()=>{class t extends de{static getChartData(e,n,i,a){let m=[];return Lt.assertIsDefined(i),m=[{name:"Temperature",powerChannel:new y(i.id,"Temperature")},{name:"ActivePower",powerChannel:new y(i.id,"ActivePower")}],m.push({name:i.id+"/Temperature",powerChannel:new y(i.id,"Temperature")}),m.push({name:i.id+"/ActiveProductionEnergy",energyChannel:new y(i.id,"ActiveProductionEnergy")}),{input:m,output:u=>{let C=[];return i!=null&&(a==="line"&&(C.push({name:i.alias,nameSuffix:v=>v?.result.data[i.id+"/ActiveProductionEnergy"]??null,converter:()=>u.ActivePower?.map(v=>v),yAxisId:B.LEFT,color:U.Colors.BLUE,stack:0,order:1}),C.push({name:n.instant("EDGE.INDEX.WIDGETS.HEAT.TEMPERATURE_UNIT"),nameSuffix:v=>null,converter:()=>u.Temperature?.map(v=>M.multiplySafely(v,100)),yAxisId:B.RIGHT,color:U.Colors.RED,stack:1,order:2})),a==="bar"&&C.push({name:i.alias,nameSuffix:v=>v?.result.data[i.id+"/ActiveProductionEnergy"]??null,converter:()=>u[i.id+"/ActiveProductionEnergy"].map(v=>v),color:U.Colors.BLUE,yAxisId:B.LEFT,stack:0})),C},tooltip:{formatNumber:U.NumberFormat.ZERO_TO_TWO},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT},{unit:Z.TEMPERATURE,position:"right",yAxisId:B.RIGHT,displayGrid:!1}]}}getChartData(){return t.getChartData(this.config,this.translate,this.component,this.chartType)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["controller-heat-chart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,rx,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,ax,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function lx(t,o){if(t&1&&(s(0,"oe-chart",0),d(1,"controller-heat-chart",1),l()),t&2){let e=p();c("title",e.component.alias),r(),c("isOnlyChart",!0)("component",e.component)}}var Vl=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["heat-overview"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title"],[3,"isOnlyChart","component"]],template:function(n,i){n&1&&f(0,lx,2,3,"oe-chart",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[tt,F_],encapsulation:2})}}return t})();function cx(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function mx(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var G_=(()=>{class t extends de{static getChartData(e,n,i,a){let m=e.getComponent(i.snapshot.params.componentId),u=[],C=null,v=y.fromString(Array.isArray(e.getComponentProperties(m.id).outputChannelAddress)?e.getComponentProperties(m.id).outputChannelAddress[0]:e.getComponentProperties(m.id).outputChannelAddress);return m.factoryId==="Controller.IO.ChannelSingleThreshold"&&(C=y.fromString(e.getComponentProperties(m.id).inputChannelAddress),u.push({name:C.toString(),powerChannel:C})),u.push({name:m.id+"output",powerChannel:v,energyChannel:new y(m.id,"CumulatedActiveTime")}),{input:u,output:T=>{let A=[];return A.push({name:bi.METER_ALIAS_OR_ID(m),nameSuffix:b=>b?.result.data[m.id+"/CumulatedActiveTime"]??null,converter:()=>n=="line"?T[m.id+"output"]?.map(b=>M.multiplySafely(1e3,b)):T[m.id+"output"]?.map(b=>M.multiplySafely(b,1e3)),color:U.Colors.YELLOW,stack:0}),C&&A.push(t.getDisplayValue(T,C,a)),A},tooltip:{formatNumber:"1.0-0"},yAxes:t.getYAxes(C,n)}}static getInputChannelLabel(e,n){switch(n.channelId){case"GridActivePower":return e.instant("GENERAL.GRID");case"ProductionActivePower":return e.instant("GENERAL.PRODUCTION");case"EssSoc":return e.instant("GENERAL.SOC");default:return e.instant("EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.OTHER")}}static getYAxes(e,n){let a=[{unit:n==="line"?Z.RELAY:Z.TIME,position:"left",yAxisId:B.LEFT}];if(!e||n!=="line")return a;switch(e.channelId){case"EssSoc":a.push({unit:Z.PERCENTAGE,position:"right",yAxisId:B.RIGHT});break;default:a.push({unit:Z.ENERGY,position:"right",yAxisId:B.RIGHT});break}return a}static getYAxisId(e){if(!e)return B.LEFT;switch(e.channelId){case"EssSoc":default:return B.RIGHT}}static getColor(e){return!e||e.channelId!="EssSoc"?"rgb(0,0,0)":"rgb(189,195,199)"}static getConverter(e,n){return!e||e.channelId!="EssSoc"?()=>n[e.toString()]:()=>n[e.toString()]?.map(i=>M.multiplySafely(i,1e3))}static getDisplayValue(e,n,i){return{name:t.getInputChannelLabel(i,n),converter:t.getConverter(n,e),color:t.getColor(n),yAxisId:B.RIGHT,stack:1}}getChartData(){return t.getChartData(this.config,this.chartType,this.route,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["detailChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,cx,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,mx,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();var dx=()=>[];function ux(t,o){if(t&1&&(s(0,"oe-chart",0),d(1,"detailChart",2),l()),t&2){let e=p();c("title",e.component.alias),r(),c("isOnlyChart",!0)}}function fx(t,o){t&1&&d(0,"oe-footer-subnavigation",1),t&2&&c("backButton",!0)("navigationOptions",H(2,dx))}var P_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:2,vars:2,consts:[[3,"title"],[3,"backButton","navigationOptions"],[3,"isOnlyChart"]],template:function(n,i){n&1&&(f(0,ux,2,2,"oe-chart",0),f(1,fx,1,3,"oe-footer-subnavigation",1)),n&2&&(_(i.isInitialized&&i.component?0:-1),r(),_(i.isInitialized?1:-1))},dependencies:[xn,tt,G_],encapsulation:2})}}return t})();function _x(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function hx(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var L_=(()=>{class t extends de{static getChartData(e,n){let i=e.getComponentsByFactory("Controller.Io.FixDigitalOutput"),a=e.getComponentsByFactory("Controller.IO.ChannelSingleThreshold"),m=[...i,...a],u=[];for(let C of m){let v=y.fromString(Array.isArray(e.getComponentProperties(C.id).outputChannelAddress)?e.getComponentProperties(C.id).outputChannelAddress[0]:e.getComponentProperties(C.id).outputChannelAddress);u.push({name:C.id,powerChannel:v,energyChannel:new y(C.id,"CumulatedActiveTime")})}return{input:u,output:C=>{let v=[];for(let T=0;T<m.length;T++){let A=m[T];v.push({name:bi.METER_ALIAS_OR_ID(A),nameSuffix:b=>b?.result.data[A.id+"/CumulatedActiveTime"]??null,converter:()=>C[A.id].map(b=>M.multiplySafely(b,1e3)),color:U.Colors.SHADES_OF_YELLOW[T%(U.Colors.SHADES_OF_YELLOW.length-1)],stack:0})}return v},tooltip:{formatNumber:"1.0-0"},yAxes:[{unit:n==="line"?Z.RELAY:Z.TIME,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.chartType)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["totalChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,_x,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,hx,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function gx(t,o){if(t&1){let e=W();s(0,"oe-chart",2),g(1,"translate"),Zt("showPhasesChange",function(i){P(e);let a=p();return Qt(a.showPhases,i)||(a.showPhases=i),L(i)}),d(2,"totalChart",3),l()}if(t&2){let e=p();Kt("showPhases",e.showPhases),c("period",e.service.historyPeriod.value)("title",E(1,4,"EDGE.INDEX.WIDGETS.FIX_DIGITAL_OUTPUT")),r(2),c("isOnlyChart",!0)}}function Ex(t,o){if(t&1&&d(0,"oe-footer-subnavigation",1),t&2){let e=p();c("navigationOptions",e.navigationButtons)}}var k_=(()=>{class t extends et{constructor(e,n,i,a){super(e,n,i),this.service=e,this.route=n,this.modalCtrl=i,this.router=a,this.navigationButtons=[]}getChannelAddresses(){let e=this.config.getComponentsByFactory("Controller.Io.FixDigitalOutput"),n=this.config.getComponentsByFactory("Controller.IO.ChannelSingleThreshold"),i=[...e,...n];return this.navigationButtons=i.map(a=>({id:a.id,alias:a.alias,callback:()=>{this.router.navigate(["./"+a.id],{relativeTo:this.route})}})),[]}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(he),x(It))}}static{this.\u0275cmp=I({type:t,selectors:[["overview"]],standalone:!1,features:[S],decls:2,vars:2,consts:[[3,"showPhases","period","title"],[3,"navigationOptions"],[3,"showPhasesChange","showPhases","period","title"],[3,"isOnlyChart"]],template:function(n,i){n&1&&(f(0,gx,3,6,"oe-chart",0),f(1,Ex,1,1,"oe-footer-subnavigation",1)),n&2&&(_(i.isInitialized?0:-1),r(),_(i.isInitialized?1:-1))},dependencies:[xn,tt,L_,V],encapsulation:2})}}return t})();function vx(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function yx(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var V_=(()=>{class t extends de{static getChartData(e,n,i,a,m){let u=e.getComponent(i.properties["meter.id"]),C=[{name:i.id,powerChannel:new y(i.id,"Level")}];u&&u.isEnabled&&C.push({name:u.id+"/ActivePower",powerChannel:y.fromString(u.id+"/ActivePower"),energyChannel:y.fromString(u.id+"/ActiveProductionEnergy")});for(let v of[1,2,3])C.push({name:i.id+v,powerChannel:new y(i.id,"Level"),energyChannel:new y(i.id,"Level"+v+"CumulatedTime")});return{input:C,output:v=>{let T=[];if(m==="line"&&T.push({name:"Level",converter:()=>v[i.id].map(A=>M.multiplySafely(A,1e3)),color:U.Colors.RED,stack:0,yAxisId:B.LEFT}),m==="bar")for(let A of[1,2,3])T.push({name:"Level "+A,nameSuffix:b=>b?.result.data[i.id+"/Level"+A+"CumulatedTime"]??null,converter:()=>v[i.id+A].map(b=>M.multiplySafely(b,1e3)),color:a[A%a.length],stack:0,yAxisId:B.LEFT});return u&&u.isEnabled&&T.push({name:n.instant("GENERAL.CONSUMPTION"),nameSuffix:A=>A?.result.data[u.id+"/ActiveProductionEnergy"],converter:()=>v[u.id+"/ActivePower"]??null,color:U.Colors.YELLOW,stack:1,yAxisId:B.RIGHT}),T},tooltip:{formatNumber:"1.0-2"},yAxes:u&&u.isEnabled?[{unit:Z.ENERGY,position:"right",yAxisId:B.RIGHT},{unit:m==="line"?Z.HEATING_ELEMENT:Z.TIME,position:"left",yAxisId:B.LEFT}]:[{unit:m==="line"?Z.HEATING_ELEMENT:Z.TIME,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.config,this.translate,this.component,de.phaseColors,this.chartType)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["controller-io-heatingelement-chart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,vx,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,yx,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function Ix(t,o){if(t&1&&(s(0,"oe-chart",0),d(1,"controller-io-heatingelement-chart",1),l()),t&2){let e=p();c("title",e.component.alias),r(),c("isOnlyChart",!0)("component",e.component)}}var H_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["controller-io-heatingelement-overview"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title"],[3,"isOnlyChart","component"]],template:function(n,i){n&1&&f(0,Ix,2,3,"oe-chart",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[tt,V_],encapsulation:2})}}return t})();function xx(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function Sx(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var B_=(()=>{class t extends de{static getChartData(e,n,i,a,m){let u=[],C=["rgb(191, 144, 33)","rgb(162, 191, 33)","rgb(86, 191, 33)","rgb(33, 191, 165)","rgb(33, 115, 191)"],v=[{name:"SetActivePowerEquals",powerChannel:y.fromString(e.id+"/Ess0SetActivePowerEquals")}];return e.properties.writeChannels&&(u=e.properties.writeChannels.filter(T=>!T.includes("Ess0SetActivePowerEquals")),u.forEach(T=>{v.push({name:T,powerChannel:y.fromString(e.id+`/${T}`)})})),{input:v,output:T=>{let A=[{name:a.instant("MODBUS_TCP_API_READ_WRITE.SET_ACTIVE_POWER_EQUALS"),converter:()=>T.SetActivePowerEquals,color:"rgb(214, 28, 28)"}];return u&&u.forEach((b,F)=>{let k=b;if(b.includes("Ess0SetActive"))switch(b.replace("Ess0","")){case"SetActivePowerEquals":return a.instant("MODBUS_TCP_API_READ_WRITE.SET_ACTIVE_POWER_EQUALS");case"SetActivePowerGreaterOrEquals":return a.instant("MODBUS_TCP_API_READ_WRITE.SET_ACTIVE_POWER_GREATER_OR_EQUALS");case"SetActivePowerLessOrEquals":return a.instant("MODBUS_TCP_API_READ_WRITE.SET_ACTIVE_POWER_LESS_OR_EQUALS")}A.push({name:k,converter:()=>T[b],color:C[F]})}),A},tooltip:{formatNumber:"1.1-2"},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){return t.getChartData(this.component,this.config,this.chartType,this.translate,this.showPhases)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["modbusTcpApiChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,xx,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,Sx,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function wx(t,o){t&1&&(s(0,"div")(1,"ion-row",2)(2,"ion-item",3),d(3,"ion-icon",4),s(4,"ion-label",5)(5,"ion-row",6)(6,"small",7),h(7," EDGE.INDEX.WIDGETS.INFO_STORAGE_FOR_CHARGE "),l()(),s(8,"ion-row",8)(9,"small",7),h(10," EDGE.INDEX.WIDGETS.INFO_STORAGE_FOR_DISCHARGE "),l()()()()()())}function bx(t,o){if(t&1&&(s(0,"oe-chart",0)(1,"modbusTcpApiChart",1),f(2,wx,11,0,"div"),l()()),t&2){let e=p();c("title",e.component.alias),r(),c("isOnlyChart",!0)("component",e.component),r(),_(e.component&&e.component.factoryId==="Controller.Api.ModbusTcp.ReadWrite"?2:-1)}}var W_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title"],[3,"isOnlyChart","component"],[1,"ion-justify-content-center"],["lines","none",1,"ion-text-center"],["color","primary","size","large","slot","start","name","alert-outline"],[1,"ion-text-wrap"],[1,"ion-text-center",2,"white-space","pre !important","width","100%"],["translate",""],["size","6",1,"ion-text-center",2,"white-space","pre !important","width","100%"]],template:function(n,i){n&1&&f(0,bx,3,4,"oe-chart",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[tt,ie,J,ne,Se,Ne,B_],encapsulation:2})}}return t})();function Dx(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function Rx(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var U_=(()=>{class t extends de{static getChartData(e,n,i){Lt.assertIsDefined(n);let a=e.getPropertyFromComponent(n,"meter.id");return{input:[...jt.THREE_PHASE.map(u=>({name:"ActivePower"+u,powerChannel:new y(a,"ActivePower"+u),converter:Je.ValueConverter.NEGATIVE_AS_ZERO})),{name:"EssSoc",powerChannel:new y("_sum","EssSoc")},{name:"Charge",powerChannel:new y("_sum","EssActivePower"),converter:Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE},{name:"Discharge",powerChannel:new y("_sum","EssActivePower"),converter:Je.ValueConverter.NON_NULL_OR_NEGATIVE},{name:"CHARGE_UNDER",powerChannel:new y(n.id,"_PropertyRechargePower")},{name:"DISCHARGE_OVER",powerChannel:new y(n.id,"_PropertyPeakShavingPower")}],output:u=>[...jt.THREE_PHASE.map((v,T)=>({name:"Phase "+v,color:U.Colors.DEFAULT_PHASES_COLORS[T],converter:()=>u["ActivePower"+v]})),{name:i.instant("EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE_POWER"),color:U.Colors.GREEN,converter:()=>u.CHARGE_UNDER,hideShadow:!0,borderDash:[3,3]},{name:i.instant("EDGE.INDEX.WIDGETS.PEAKSHAVING.PEAKSHAVING_POWER"),color:U.Colors.RED,converter:()=>u.DISCHARGE_OVER,hideShadow:!0,borderDash:[3,3]},{name:i.instant("GENERAL.CHARGE"),color:U.Colors.GREEN,converter:()=>u.Charge},{name:i.instant("GENERAL.DISCHARGE"),color:U.Colors.RED,converter:()=>u.Discharge},{name:i.instant("GENERAL.SOC"),color:U.Colors.GREY,converter:()=>u.EssSoc?.map(v=>M.multiplySafely(v,1e3)),yAxisId:B.RIGHT,hideShadow:!0,borderDash:[10,10]}],tooltip:{formatNumber:U.NumberFormat.ZERO_TO_TWO},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT},{unit:Z.PERCENTAGE,position:"right",yAxisId:B.RIGHT}]}}getChartData(){return t.getChartData(this.config,this.component,this.translate)}loadChart(){let e=On(this.service,this.service.historyPeriod.value.from,this.service.historyPeriod.value.to).resolution.unit;this.loadLineChart(e)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-peakshaving-asymmetric-chart"]],features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,Dx,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,Rx,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,st,Ve,an,Ki,me,_n,Ee,gi],encapsulation:2})}}return t})();function Ox(t,o){if(t&1){let e=W();s(0,"oe-chart",1),O("setShowTotal",function(i){P(e);let a=p();return L(a.setShowTotal(i))}),d(1,"oe-controller-peakshaving-asymmetric-chart",2),l()}if(t&2){let e=p();c("showTotal",e.showTotal)("period",e.service.historyPeriod)("title",e.component.alias),r(),c("isOnlyChart",!0)("component",e.component)}}var z_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["overview"]],features:[vn([{provide:jo,useFactory:()=>(Ze.getByKey(localStorage.LANGUAGE)??Ze.getByBrowserLang(navigator.language)??Ze.DEFAULT).key}]),S],decls:1,vars:1,consts:[[3,"showTotal","period","title"],[3,"setShowTotal","showTotal","period","title"],[3,"isOnlyChart","component"]],template:function(n,i){n&1&&f(0,Ox,2,5,"oe-chart",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[st,Ve,an,Ki,tt,tr,_n,U_],encapsulation:2})}}return t})();function Nx(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function Mx(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var j_=(()=>{class t extends de{static getChartData(e,n,i){Lt.assertIsDefined(n);let a=e.getPropertyFromComponent(n,"meter.id");return{input:[{name:"ActivePower",powerChannel:new y(a,"ActivePower"),converter:Je.ValueConverter.NEGATIVE_AS_ZERO},{name:"EssSoc",powerChannel:new y("_sum","EssSoc")},{name:"Charge",powerChannel:new y("_sum","EssActivePower"),converter:Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE},{name:"Discharge",powerChannel:new y("_sum","EssActivePower"),converter:Je.ValueConverter.NON_NULL_OR_NEGATIVE},{name:"CHARGE_UNDER",powerChannel:new y(n.id,"_PropertyRechargePower")},{name:"DISCHARGE_OVER",powerChannel:new y(n.id,"_PropertyPeakShavingPower")}],output:u=>[{name:i.instant("GENERAL.GRID_BUY_ADVANCED"),color:U.Colors.BLUE_GREY,converter:()=>u.ActivePower},{name:i.instant("EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE_POWER"),color:U.Colors.GREEN,converter:()=>u.CHARGE_UNDER,hideShadow:!0,borderDash:[3,3]},{name:i.instant("EDGE.INDEX.WIDGETS.PEAKSHAVING.PEAKSHAVING_POWER"),color:U.Colors.RED,converter:()=>u.DISCHARGE_OVER,hideShadow:!0,borderDash:[3,3]},{name:i.instant("GENERAL.CHARGE"),color:U.Colors.GREEN,converter:()=>u.Charge},{name:i.instant("GENERAL.DISCHARGE"),color:U.Colors.RED,converter:()=>u.Discharge},{name:i.instant("GENERAL.SOC"),color:U.Colors.GREY,converter:()=>u.EssSoc?.map(v=>M.multiplySafely(v,1e3)),yAxisId:B.RIGHT,borderDash:[10,10]}],tooltip:{formatNumber:U.NumberFormat.ZERO_TO_TWO},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT},{unit:Z.PERCENTAGE,position:"right",yAxisId:B.RIGHT}]}}getChartData(){return t.getChartData(this.config,this.component,this.translate)}loadChart(){let e=On(this.service,this.service.historyPeriod.value.from,this.service.historyPeriod.value.to).resolution.unit;this.loadLineChart(e)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-peakshaving-symmetric-chart"]],features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,Nx,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,Mx,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,st,Et,Ve,an,Ki,me,_n,Ee,gi],encapsulation:2})}}return t})();function Fx(t,o){if(t&1){let e=W();s(0,"oe-chart",1),O("setShowTotal",function(i){P(e);let a=p();return L(a.setShowTotal(i))}),d(1,"oe-controller-peakshaving-symmetric-chart",2),l()}if(t&2){let e=p();c("showTotal",e.showTotal)("period",e.service.historyPeriod)("title",e.component.alias),r(),c("isOnlyChart",!0)("component",e.component)}}var Y_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["overview"]],features:[vn([{provide:jo,useFactory:()=>(Ze.getByKey(localStorage.LANGUAGE)??Ze.getByBrowserLang(navigator.language)??Ze.DEFAULT).key}]),S],decls:1,vars:1,consts:[[3,"showTotal","period","title"],[3,"setShowTotal","showTotal","period","title"],[3,"isOnlyChart","component"]],template:function(n,i){n&1&&f(0,Fx,2,5,"oe-chart",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[st,Ve,an,Ki,tt,tr,_n,j_],encapsulation:2})}}return t})();function Gx(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function Px(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var $_=(()=>{class t extends de{static getChartData(e,n,i){Lt.assertIsDefined(n);let a=e.getPropertyFromComponent(n,"meter.id");return{input:[{name:"ActivePower",powerChannel:new y(a,"ActivePower"),converter:Je.ValueConverter.NEGATIVE_AS_ZERO},{name:"EssSoc",powerChannel:new y("_sum","EssSoc")},{name:"Charge",powerChannel:new y("_sum","EssActivePower"),converter:Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE},{name:"Discharge",powerChannel:new y("_sum","EssActivePower"),converter:Je.ValueConverter.NON_NULL_OR_NEGATIVE},{name:"CHARGE_UNDER",powerChannel:new y(n.id,"_PropertyRechargePower")},{name:"DISCHARGE_OVER",powerChannel:new y(n.id,"_PropertyPeakShavingPower")}],output:u=>[{name:i.instant("GENERAL.GRID_BUY_ADVANCED"),color:U.Colors.BLUE_GREY,converter:()=>u.ActivePower},{name:i.instant("EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE_POWER"),color:U.Colors.GREEN,converter:()=>u.CHARGE_UNDER,hideShadow:!0,borderDash:[3,3]},{name:i.instant("EDGE.INDEX.WIDGETS.PEAKSHAVING.PEAKSHAVING_POWER"),color:U.Colors.RED,converter:()=>u.DISCHARGE_OVER,hideShadow:!0,borderDash:[3,3]},{name:i.instant("GENERAL.CHARGE"),color:U.Colors.GREEN,converter:()=>u.Charge},{name:i.instant("GENERAL.DISCHARGE"),color:U.Colors.RED,converter:()=>u.Discharge},{name:i.instant("GENERAL.SOC"),color:U.Colors.GREY,converter:()=>u.EssSoc?.map(v=>M.multiplySafely(v,1e3)),yAxisId:B.RIGHT,borderDash:[10,10]}],tooltip:{formatNumber:U.NumberFormat.ZERO_TO_TWO},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT},{unit:Z.PERCENTAGE,position:"right",yAxisId:B.RIGHT}]}}getChartData(){return t.getChartData(this.config,this.component,this.translate)}loadChart(){let e=On(this.service,this.service.historyPeriod.value.from,this.service.historyPeriod.value.to).resolution.unit;this.loadLineChart(e)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-peakshaving-timeslot-chart"]],features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,Gx,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,Px,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,st,Et,Ve,an,Ki,me,_n,Ee,gi],encapsulation:2})}}return t})();function Lx(t,o){if(t&1){let e=W();s(0,"oe-chart",1),O("setShowTotal",function(i){P(e);let a=p();return L(a.setShowTotal(i))}),d(1,"oe-controller-peakshaving-timeslot-chart",2),l()}if(t&2){let e=p();c("showTotal",e.showTotal)("period",e.service.historyPeriod)("title",e.component.alias),r(),c("isOnlyChart",!0)("component",e.component)}}var X_=(()=>{class t extends et{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["overview"]],features:[vn([{provide:jo,useFactory:()=>(Ze.getByKey(localStorage.LANGUAGE)??Ze.getByBrowserLang(navigator.language)??Ze.DEFAULT).key}]),S],decls:1,vars:1,consts:[[3,"showTotal","period","title"],[3,"setShowTotal","showTotal","period","title"],[3,"isOnlyChart","component"]],template:function(n,i){n&1&&f(0,Lx,2,5,"oe-chart",0),n&2&&_(i.isInitialized&&i.component?0:-1)},dependencies:[st,Ve,an,Ki,tt,tr,_n,$_],encapsulation:2})}}return t})();var Ii=class t{constructor(o,e,n){this.spinnerId=o,this.service=e,this.translate=n,this.loading=!0,this.labels=[],this.datasets=[],this.options=null,this.colors=[],this.edge=null,this.errorResponse=null,this.hasSubscribed=!1,this.unit=Z.ENERGY,this.formatNumber="1.0-2",this.xAxisType=Fd.TIMESERIES,this.chartAxis=B.LEFT,this.position="left",this.phase1Color={backgroundColor:"rgba(255,127,80,0.05)",borderColor:"rgba(255,127,80,1)"},this.phase2Color={backgroundColor:"rgba(0,0,255,0.1)",borderColor:"rgba(0,0,255,1)"},this.phase3Color={backgroundColor:"rgba(128,128,0,0.1)",borderColor:"rgba(128,128,0,1)"}}static toTooltipTitle(o,e,n,i){let a=On(i,o,e).resolution.unit;return a==Tr.Type.MONTHS?n.toLocaleDateString("default",{month:"long"}):a==Tr.Type.DAYS?n.toLocaleDateString("default",{day:"2-digit",month:"long"}):n.toLocaleString("default",{day:"2-digit",month:"2-digit",year:"2-digit"})+" "+n.toLocaleTimeString("default",{hour12:!1,hour:"2-digit",minute:"2-digit"})}startSpinner(){this.service.startSpinner(this.spinnerId)}stopSpinner(){this.service.stopSpinner(this.spinnerId)}setOptions(o){return new Promise(e=>{let n={position:this.position,unit:this.unit,yAxisId:this.chartAxis},i={input:[],output:()=>[],yAxes:[n],tooltip:{formatNumber:this.formatNumber}},a=this.unit,m=this.formatNumber,u=this.colors,C=this.translate;this.service.getConfig().then(v=>{o=de.getDefaultXAxisOptions(this.xAxisType,this.service,this.labels),o.scales.y={display:!1},o.plugins.tooltip.callbacks.title=A=>{if(A?.length===0)return null;let b=dn.stringToDate(A[0]?.label);return t.toTooltipTitle(this.service.historyPeriod.value.from,this.service.historyPeriod.value.to,b,this.service)},o.plugins.tooltip.callbacks.label=function(A){let b=A.dataset.label,F=A.dataset.data[A.dataIndex],k=A.dataset.unit??null;return b.split(":")[0]+": "+de.getToolTipsSuffix("",F,m,k??a,"line",C,v)},o.plugins.tooltip.callbacks.labelColor=A=>{let b=A.dataset.backgroundColor;return Array.isArray(b)&&(b=b[0]),b||(b=A.dataset.borderColor||"rgba(0, 0, 0, 0.5)"),{borderColor:Pt.changeOpacityFromRGBA(b,1),backgroundColor:Pt.changeOpacityFromRGBA(b,1)}},o.plugins.legend.labels.generateLabels=function(A){let b=[];return A.data.datasets.forEach((F,k)=>{let Q=u[k];Q&&(F.backgroundColor=Q.backgroundColor??F.backgroundColor,F.borderColor=Q.borderColor??F.borderColor,b.push(ke(Li(ke({text:F.label,datasetIndex:k,fillStyle:Q.backgroundColor,fontColor:getComputedStyle(document.documentElement).getPropertyValue("--ion-color-text"),hidden:!A.isDatasetVisible(k),lineWidth:2},F.borderDash&&{lineDash:F.borderDash}),{strokeStyle:Q.borderColor}),U.Plugins.Legend.POINT_STYLE(F))))}),b},o.plugins.legend.onClick=function(A,b,F){let k=this.chart;k.data.datasets.reduce((ve,Re,se)=>(Re.label==b.text&&ve.push({label:Re.label,index:se}),ve),[]).forEach(ve=>{Dd(ve.label,!k.isDatasetVisible(b.datasetIndex));let Re=k.getDatasetMeta(ve.index);Re.hidden=Re.hidden===null?!k.data.datasets[ve.index].hidden:null}),k.update()};let T=On(this.service,this.service.historyPeriod.value.from,this.service.historyPeriod.value.to).timeFormat;switch(o.scales.x.time.unit=T,T){case"hour":o.scales.x.ticks.source="auto",o.scales.x.ticks.maxTicksLimit=31;break;case"day":case"month":o.scales.x.ticks.source="data";break;default:break}this.datasets=this.datasets.map(A=>(A.yAxisID=B.LEFT,A)),o=de.getYAxisOptions(o,n,this.translate,"line",this.datasets,!0,i.tooltip.formatNumber),o=de.applyChartTypeSpecificOptionsChanges("line",o,this.service,i),o.scales[this.chartAxis].stacked=!1,o.scales.x.stacked=!0,o.scales.x.ticks.color=getComputedStyle(document.documentElement).getPropertyValue("--ion-color-chart-xAxis-ticks")}).then(()=>{this.options=o,e()})})}queryHistoricTimeseriesData(o,e,n){let i=n??On(this.service,o,e).resolution;return this.errorResponse=null,new Promise((m,u)=>{this.service.getCurrentEdge().then(C=>{this.service.getConfig().then(v=>{this.setLabel(v),this.getChannelAddresses(C,v).then(T=>{let A=new Fs(dn.maxDate(o,this.edge?.firstSetupProtocol),e,T,i);C.sendRequest(this.service.websocket,A).then(b=>{m(b)}).catch(b=>{this.errorResponse=b,m(new Ic(b.id,{timestamps:[null],data:{null:null}}))})})})})}).then(m=>(M.isDataEmpty(m)&&(this.loading=!1,this.service.stopSpinner(this.spinnerId),this.initializeChart()),oo.normalizeTimestamps(i.unit,m)))}queryHistoricTimeseriesEnergyPerPeriod(o,e,n){let i=On(this.service,o,e).resolution;return this.errorResponse=null,new Promise((m,u)=>{this.service.getCurrentEdge().then(C=>{this.service.getConfig().then(v=>{C.sendRequest(this.service.websocket,new Nd(dn.maxDate(o,this.edge?.firstSetupProtocol),e,n,i)).then(T=>{m(T??new Od(T.id,{timestamps:[null],data:{null:null}}))}).catch(T=>{this.errorResponse=T,m(new Ic("0",{timestamps:[null],data:{null:null}}))})})})}).then(m=>(M.isDataEmpty(m)&&(this.loading=!1,this.service.stopSpinner(this.spinnerId),this.initializeChart()),oo.normalizeTimestamps(i.unit,m)))}createDefaultChartOptions(){return M.deepCopy(Ns)}autoSubscribeChartRefresh(){}unsubscribeChartRefresh(){}initializeChart(){Tc[0].label=this.translate.instant("EDGE.HISTORY.NO_DATA"),this.datasets=Tc,this.labels=[],this.loading=!1,this.stopSpinner()}};function kx(t,o){if(t&1&&d(0,"canvas",3),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)}}var q_=(()=>{class t extends Ii{constructor(e,n,i){super("delayedsellTogrid-chart",e,n),this.service=e,this.translate=n,this.route=i}ngOnChanges(){this.updateChart()}ngOnInit(){this.startSpinner()}ngOnDestroy(){this.unsubscribeChartRefresh()}getChartHeight(){return window.innerHeight/1.3}updateChart(){this.autoSubscribeChartRefresh(),this.startSpinner(),this.loading=!0,this.colors=[],this.queryHistoricTimeseriesData(this.period.from,this.period.to).then(e=>{this.service.getConfig().then(n=>{let i=n.getComponent(this.componentId).properties["meter.id"]+"/ActivePower",a=this.componentId+"/_PropertySellToGridPowerLimit",m=this.componentId+"/_PropertyContinuousSellToGridPower",u=e.result,C=[];for(let T of u.timestamps)C.push(new Date(T));this.labels=C;let v=[];if(i in u.data){let T=u.data[i].map(A=>A==null?null:A<0?A*-1/1e3:0);v.push({label:this.translate.instant("GENERAL.GRID_SELL"),data:T,hidden:!1}),this.colors.push({backgroundColor:"rgba(0,0,0,0.05)",borderColor:"rgba(0,0,0,1)"})}if(a in u.data){let T=u.data[a].map(A=>A==null?null:A==0?0:A/1e3);v.push({label:this.translate.instant("EDGE.INDEX.WIDGETS.DELAYED_SELL_TO_GRID.SELL_TO_GRID_POWER_LIMIT"),data:T,hidden:!1,borderDash:[3,3]}),this.colors.push({backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,223,0,1)"})}if(m in u.data){let T=u.data[m].map(A=>A==null?null:A==0?0:A/1e3);v.push({label:this.translate.instant("EDGE.INDEX.WIDGETS.DELAYED_SELL_TO_GRID.CONTINUOUS_SELL_TO_GRID_POWER"),data:T,hidden:!1,borderDash:[3,3]}),this.colors.push({backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(200,0,0,1)"})}if("_sum/EssActivePower"in u.data){let T;"_sum/ProductionDcActualPower"in u.data&&u.data["_sum/ProductionDcActualPower"].length>0?T=u.data["_sum/ProductionDcActualPower"].map((F,k)=>M.subtractSafely(u.data["_sum/EssActivePower"][k],F)):T=u.data["_sum/EssActivePower"];let A=T.map(F=>F==null?null:F<0?F/-1e3:0);v.push({label:this.translate.instant("GENERAL.CHARGE"),data:A,borderDash:[10,10]}),this.colors.push({backgroundColor:"rgba(0,223,0,0.05)",borderColor:"rgba(0,223,0,1)"});let b=T.map(F=>F==null?null:F>0?F/1e3:0);v.push({label:this.translate.instant("GENERAL.DISCHARGE"),data:b,borderDash:[10,10]}),this.colors.push({backgroundColor:"rgba(200,0,0,0.05)",borderColor:"rgba(200,0,0,1)"})}this.datasets=v,this.loading=!1,this.stopSpinner()}).catch(n=>{console.error(n),this.initializeChart()})}).catch(e=>{console.error(e),this.initializeChart()}).finally(()=>{this.unit=Z.ENERGY,this.setOptions(this.options)})}getChannelAddresses(e,n){return new Promise(i=>{let a=[new y(this.componentId,"_PropertySellToGridPowerLimit"),new y(this.componentId,"_PropertyContinuousSellToGridPower"),new y(n.getComponent(this.componentId).properties["meter.id"],"ActivePower"),new y("_sum","ProductionDcActualPower"),new y("_sum","EssActivePower")];i(a)})}setLabel(){this.options=this.createDefaultChartOptions()}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(te),x(De))}}static{this.\u0275cmp=I({type:t,selectors:[["delayedselltogridgchart"]],inputs:{period:"period",componentId:"componentId"},standalone:!1,features:[S,En],decls:4,vars:5,consts:[[3,"response"],["id","chart-area",1,"semi-transparent-background"],[3,"name"],["baseChart","","type","line",3,"datasets","labels","options"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),s(1,"div",1),d(2,"ngx-spinner",2),f(3,kx,1,3,"canvas",3),l()),n&2&&(c("response",i.errorResponse),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:3))},dependencies:[Ee,ye,me],encapsulation:2})}}return t})();function Hx(t,o){if(t&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),h(3),l(),s(4,"ion-buttons",2)(5,"ion-button",3),d(6,"ion-icon",4),l()()(),s(7,"ion-toolbar",5)(8,"ion-buttons",6),d(9,"pickdate"),l()()(),s(10,"ion-content")(11,"ion-card-content"),d(12,"delayedselltogridgchart",7),l()()),t&2){let e=p();r(3),N(e.component.alias),r(2),c("routerLink","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history"),r(7),c("componentId",e.component.id)("period",e.service.historyPeriod.value)}}var K_=(()=>{class t{static{this.SELECTOR="symmetricpeakshaving-chart-overview"}constructor(e,n,i){this.service=e,this.route=n,this.userService=i,this.edge=null,this.component=null,this.newNavigationUrlSegment="",wt(()=>{let a=this.userService.isNewNavigation();this.newNavigationUrlSegment=a?"/live":""})}ngOnInit(){this.service.getCurrentEdge().then(e=>{this.service.getConfig().then(n=>{this.edge=e,this.component=n.getComponent(this.route.snapshot.params.componentId)})})}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(qn))}}static{this.\u0275cmp=I({type:t,selectors:[["symmetricpeakshaving-chart-overview"]],standalone:!1,decls:1,vars:1,consts:[[2,"--background","var(--ion-color-toolbar-primary)"],[2,"color","var(--ion-title-color)"],["slot","end",2,"color","var(--ion-color-toggle-background)"],[3,"routerLink"],["name","close-outline",2,"color","var(--ion-title-color)"],["color","secondary"],[1,"ion-justify-content-center"],[3,"componentId","period"]],template:function(n,i){n&1&&f(0,Hx,13,4),n&2&&_(i.edge&&i.component?0:-1)},dependencies:[In,Ge,Xe,We,je,xt,ie,St,ct,ji,ii,q_],encapsulation:2})}}return t})();var ce=(()=>{class t{constructor(e,n,i,a,m,u,C,v,T){this.websocket=e,this.route=n,this.service=i,this.modalController=a,this.translate=m,this.dataService=u,this.formBuilder=C,this.router=v,this.userService=T,this.Utils=M,this.Converter=Be,this.isInitialized=!1,this.edge=null,this.config=null,this.component=null,this.stopOnDestroy=new qt,this.formGroup=null,this.isNewNavigation=!1,this.injector=Ro(Oo),this.subscription=[],wt(()=>{let A=this.userService.isNewNavigation();this.newNavigationUrlSegment=A?"/live":""})}ngOnInit(){this.service.getCurrentEdge().then(e=>{this.service.getConfig().then(n=>{this.edge=e,this.config=n,this.component=Qo.Component.of(n.components[this.componentId]),this.isInitialized=!0,this.afterIsInitialized();let i=new Set(this.getChannelAddresses()),a=this.getChannelIds();for(let m of a)i.add(new y(this.componentId,m));this.dataService.getValues(Array.from(i),this.edge,this.componentId),this.subscription.push(wt(()=>{let m=this.dataService.currentValue();this.onCurrentData(m),this.afterOnCurrentData()},{injector:this.injector})),this.formGroup=this.getFormGroup()})})}ngOnDestroy(){this.dataService.unsubscribeFromChannels(this.getChannelAddresses()),this.stopOnDestroy.next(),this.stopOnDestroy.complete(),this.subscription.every(e=>e.destroy())}getFirstValidValueForChannel(e){return ae(this,null,function*(){return new Promise(n=>{wt(()=>{let a=this.dataService.currentValue();n(a.allComponents[e.toString()])},{injector:this.injector}).destroy()})})}subscribeAndGetFirstValidValueForChannel(e){return ae(this,null,function*(){return this.dataService.getValues([e],this.edge,this.componentId),new Promise(n=>{wt(()=>{let a=this.dataService.currentValue();n(a.allComponents[e.toString()])},{injector:this.injector}).destroy()})})}onCurrentData(e){}getChannelAddresses(){return[]}getChannelIds(){return[]}afterIsInitialized(){}afterOnCurrentData(){}getFormGroup(){return null}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(De),x(j),x(he),x(te),x(kt),x(Ft),x(It),x(qn))}}static{this.\u0275dir=Wi({type:t,inputs:{componentId:"componentId"}})}}return t})();var Bx=()=>({name:"oe-grid",color:"normal"});function Wx(t,o){if(t&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),d(2,"oe-flat-widget-percentagebar",1),l()),t&2){let e=p();c("title",E(1,4,"GENERAL.AUTARCHY"))("icon",H(6,Bx))("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/autarchychart"),r(2),c("value",e.autarchyValue)}}var Q_=(()=>{class t extends ce{onCurrentData(e){this.autarchyValue=M.calculateAutarchy(e.allComponents["_sum/GridBuyActiveEnergy"]/1e3,e.allComponents["_sum/ConsumptionActiveEnergy"]/1e3)}getChannelAddresses(){return[new y("_sum","GridBuyActiveEnergy"),new y("_sum","ConsumptionActiveEnergy")]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["autarchyWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon","link"],[3,"value"]],template:function(n,i){n&1&&f(0,Wx,3,7,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,Qi,V],encapsulation:2})}}return t})();var zx=()=>({name:"oe-consumption",color:"warning"});function jx(t,o){if(t&1&&d(0,"oe-flat-widget-line",1),t&2){let e=p(2);c("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS)}}function Yx(t,o){if(t&1&&d(0,"oe-flat-widget-line",2),t&2){let e=o.$implicit,n=p(3);c("name",e.alias)("channelAddress",e.energyChannel.toString())("converter",n.Utils.CONVERT_TO_KILO_WATTHOURS)}}function $x(t,o){if(t&1&&(d(0,"oe-flat-widget-line",2),g(1,"translate")),t&2){let e=o.$implicit,n=p(3);c("name",E(1,3,"EDGE.INDEX.WIDGETS.HEAT.HEATING_ENERGY"))("channelAddress",e.id+"/ActiveProductionEnergy")("converter",n.Utils.CONVERT_TO_KILO_WATTHOURS)}}function Xx(t,o){if(t&1&&d(0,"oe-flat-widget-line",2),t&2){let e=o.$implicit,n=p(3);c("name",e.alias)("channelAddress",e.id+"/ActiveProductionEnergy")("converter",n.Utils.CONVERT_TO_KILO_WATTHOURS)}}function qx(t,o){if(t&1&&(fe(0,Yx,1,3,"oe-flat-widget-line",2,xe),fe(2,$x,2,5,"oe-flat-widget-line",2,xe),fe(4,Xx,1,3,"oe-flat-widget-line",2,xe)),t&2){let e=p(2);_e(e.evcsComponents),r(2),_e(e.heatComponents),r(2),_e(e.consumptionMeterComponents)}}function Kx(t,o){if(t&1&&(d(0,"oe-flat-widget-horizontal-line")(1,"oe-flat-widget-line",3),g(2,"translate")),t&2){let e=p(2);r(),c("name",E(2,3,"GENERAL.OTHER_CONSUMPTION"))("value",e.totalOtherEnergy)("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS)}}function Qx(t,o){if(t&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),f(2,jx,1,1,"oe-flat-widget-line",1)(3,qx,6,0),f(4,Kx,3,5),l()),t&2){let e=p();c("title",E(1,5,"GENERAL.CONSUMPTION"))("icon",H(7,zx))("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/consumptionchart"),r(2),_(e.evcsComponents.length===0&&e.consumptionMeterComponents.length===0&&e.heatComponents.length===0?2:3),r(2),_(e.evcsComponents.length!==0||e.consumptionMeterComponents.length!==0||e.heatComponents.length!==0?4:-1)}}var Z_=(()=>{class t extends ce{constructor(){super(...arguments),this.evcsComponents=[],this.heatComponents=[],this.consumptionMeterComponents=[]}getChannelAddresses(){let e=[new y("_sum","ConsumptionActiveEnergy")];return this.evcsComponents=vi.getComponents(this.config,this.edge),this.heatComponents=this.config?.getComponentsImplementingNature("io.openems.edge.heat.api.Heat").filter(n=>n.factoryId!=="Controller.Heat.Heatingelement"&&!!n.isEnabled),e.push(...this.heatComponents.map(n=>new y(n.id,"ActiveProductionEnergy"))),this.consumptionMeterComponents=this.config?.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(n=>{let i=this.config?.getNatureIdsByFactoryId(n.factoryId),a=i.includes("io.openems.edge.evcs.api.Evcs"),m=i.includes("io.openems.edge.heat.api.Heat");return n.isEnabled&&this.config?.isTypeConsumptionMetered(n)&&a===!1&&m===!1}),e}onCurrentData(e){this.totalOtherEnergy=this.getTotalOtherEnergy(e)}getTotalOtherEnergy(e){let n=0;return this.evcsComponents.forEach(i=>{n+=e.allComponents[i.id+"/"+i.energyChannel]??0}),[...this.consumptionMeterComponents,...this.heatComponents].forEach(i=>{n+=e.allComponents[i.id+"/ActiveProductionEnergy"]??0}),e.allComponents["_sum/ConsumptionActiveEnergy"]-n}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["consumptionWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon","link"],["channelAddress","_sum/ConsumptionActiveEnergy",3,"converter"],[3,"name","channelAddress","converter"],[3,"name","value","converter"]],template:function(n,i){n&1&&f(0,Qx,5,8,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,Ri,we,V],encapsulation:2})}}return t})();var J_=(()=>{class t extends un{static{this.METHOD="queryHistoricTimeseriesExportXlxs"}constructor(e,n){super(t.METHOD,{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,fromDate:io(e,"yyyy-MM-dd"),toDate:io(n,"yyyy-MM-dd")}),this.fromDate=e,this.toDate=n,delete this.fromDate,delete this.toDate}}return t})();function Jx(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function eS(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var eh=(()=>{class t extends de{static getChartData(e,n,i){return{input:e?.widgets.classes.reduce((m,u)=>{let C=[];switch(u){case"Energymonitor":case"Consumption":C.push({name:"Consumption",powerChannel:new y("_sum","ConsumptionActivePower"),energyChannel:new y("_sum","ConsumptionActiveEnergy")});break;case"Common_Autarchy":case"Grid":C.push(ke({name:"GridBuy",powerChannel:new y("_sum","GridActivePower"),energyChannel:new y("_sum","GridBuyActiveEnergy")},n==="line"&&{converter:Je.ValueConverter.NEGATIVE_AS_ZERO}),ke({name:"GridSell",powerChannel:new y("_sum","GridActivePower"),energyChannel:new y("_sum","GridSellActiveEnergy")},n==="line"&&{converter:Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE}));break;case"Storage":C.push({name:"EssSoc",powerChannel:new y("_sum","EssSoc")},{name:"EssCharge",powerChannel:new y("_sum","EssActivePower"),energyChannel:new y("_sum","EssDcChargeEnergy")},{name:"EssDischarge",powerChannel:new y("_sum","EssActivePower"),energyChannel:new y("_sum","EssDcDischargeEnergy")});break;case"Common_Selfconsumption":case"Common_Production":C.push({name:"ProductionActivePower",powerChannel:new y("_sum","ProductionActivePower"),energyChannel:new y("_sum","ProductionActiveEnergy")},{name:"ProductionDcActual",powerChannel:new y("_sum","ProductionDcActualPower"),energyChannel:new y("_sum","ProductionActiveEnergy")});break}return m.push(...C),m},[]),output:m=>[{name:i.instant("GENERAL.PRODUCTION"),nameSuffix:u=>u.result.data["_sum/ProductionActiveEnergy"],converter:()=>m.ProductionActivePower,color:U.Colors.BLUE,stack:0,hiddenOnInit:n!="line",order:1},n==="bar"&&{name:i.instant("GENERAL.DIRECT_CONSUMPTION"),nameSuffix:u=>M.subtractSafely(u.result.data["_sum/ProductionActiveEnergy"],u.result.data["_sum/GridSellActiveEnergy"],u.result.data["_sum/EssDcChargeEnergy"]),converter:()=>m.ProductionActivePower?.map((u,C)=>M.subtractSafely(u,m.GridSell[C],m.EssCharge[C]))?.map(u=>Je.ValueConverter.NEGATIVE_AS_ZERO(u)),color:U.Colors.ORANGE,stack:[1,2],order:2},ke({name:i.instant("GENERAL.CHARGE"),nameSuffix:u=>u.result.data["_sum/EssDcChargeEnergy"],converter:()=>n==="line"?m.EssCharge?.map((u,C)=>Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE(M.subtractSafely(u,m.ProductionDcActual?.[C]))):m.EssCharge,color:U.Colors.GREEN,stack:1},n==="line"&&{order:6}),ke({name:i.instant("GENERAL.DISCHARGE"),nameSuffix:u=>u.result.data["_sum/EssDcDischargeEnergy"],converter:()=>n==="line"?m.EssDischarge?.map((u,C)=>Je.ValueConverter.NEGATIVE_AS_ZERO(M.subtractSafely(u,m.ProductionDcActual?.[C]))):m.EssDischarge,color:U.Colors.RED,stack:2},n==="line"&&{order:5}),ke({name:i.instant("GENERAL.GRID_SELL_ADVANCED"),nameSuffix:u=>u.result.data["_sum/GridSellActiveEnergy"],converter:()=>m.GridSell,color:U.Colors.PURPLE,stack:1},n==="line"&&{order:4}),ke({name:i.instant("GENERAL.GRID_BUY_ADVANCED"),nameSuffix:u=>u.result.data["_sum/GridBuyActiveEnergy"],converter:()=>m.GridBuy,color:U.Colors.BLUE_GREY,stack:2},n==="line"&&{order:2}),ke({name:i.instant("GENERAL.CONSUMPTION"),nameSuffix:u=>u.result.data["_sum/ConsumptionActiveEnergy"],converter:()=>m.Consumption,color:U.Colors.YELLOW,stack:3,hiddenOnInit:n!="line"},n==="line"&&{order:0}),...n==="line"?[{name:i.instant("GENERAL.SOC"),converter:()=>m.EssSoc?.map(u=>M.multiplySafely(u,1e3)),color:"rgb(189, 195, 199)",borderDash:[10,10],yAxisId:B.RIGHT,stack:1}]:[]],tooltip:{formatNumber:"1.0-2",afterTitle:m=>{if(n==="bar"){if(m==="1")return i.instant("GENERAL.PRODUCTION");if(m==="2")return i.instant("GENERAL.CONSUMPTION")}return null}},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT},...n==="line"?[{unit:Z.PERCENTAGE,customTitle:"%",position:"right",yAxisId:B.RIGHT,displayGrid:!1}]:[]],normalizeOutputData:!0}}getChartData(){return t.getChartData(this.config,this.chartType,this.translate)}getChartHeight(){return this.service.deviceHeight/2}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["energychart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,Jx,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,eS,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();var nS=()=>({name:"laptop-outline",color:"normal"});function iS(t,o){if(t&1){let e=W();s(0,"ion-item",0),d(1,"ion-icon",1),s(2,"ion-label"),h(3),g(4,"translate"),l(),s(5,"ion-button",2),O("click",function(){P(e);let i=p();return L(i.exportToXlxs())}),d(6,"ion-icon",3),l()(),d(7,"energychart",4)}t&2&&(r(3),R(" ",E(4,2,"EDGE.INDEX.ENERGYMONITOR.TITLE")," "),r(4),c("isOnlyChart",!0))}function oS(t,o){if(t&1){let e=W();s(0,"oe-flat-widget",6),g(1,"translate"),s(2,"ion-button",7),O("click",function(){P(e);let i=p(2);return L(i.exportToXlxs())}),d(3,"ion-icon",8),l(),d(4,"energychart",4),l()}if(t&2){let e=p(2);re("height",e.getChartHeight(),"px"),c("title",E(1,6,"EDGE.INDEX.ENERGYMONITOR.TITLE"))("icon",H(8,nS)),r(3),c("name","download-outline"),r(),c("isOnlyChart",!0)}}function rS(t,o){if(t&1&&f(0,oS,5,9,"oe-flat-widget",5),t&2){let e=p();_(e.isInitialized?0:-1)}}var th=(()=>{class t extends ce{constructor(){super(...arguments),this.isSmartphoneResolution=this.service.isSmartphoneResolution,this.isApp=Ei.platform!=="web"}static{this.EXCEL_TYPE="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"}static{this.EXCEL_EXTENSION=".xlsx"}getChartHeight(){return this.service.deviceHeight/2}onCurrentData(e){this.autarchyValue=M.calculateAutarchy(e.allComponents["_sum/GridBuyActiveEnergy"]/1e3,e.allComponents["_sum/ConsumptionActiveEnergy"]/1e3)}getChannelAddresses(){return[new y("_sum","GridBuyActiveEnergy"),new y("_sum","ConsumptionActiveEnergy")]}exportToXlxs(){if(this.isApp){this.service.toast(this.translate.instant("APP.FUNCTIONALITY_TEMPORARILY_NOT_AVAILABLE"),"warning");return}this.service.getCurrentEdge().then(e=>{e.sendRequest(this.websocket,new J_(dn.maxDate(this.service.historyPeriod.value.from,this.edge?.firstSetupProtocol),this.service.historyPeriod.value.to)).then(n=>{let a=atob(n.result.payload.replace(/\s/g,"")),m=a.length,u=new ArrayBuffer(m),C=new Uint8Array(u);for(let F=0;F<m;F++)C[F]=a.charCodeAt(F);let v=new Blob([C],{type:t.EXCEL_TYPE}),T="Export-"+e.id+"-",A=this.service.historyPeriod.value.from,b=this.service.historyPeriod.value.to;Rs(A,b)?T+=io(A,"dd.MM.yyyy"):Id(A,b)?T+=io(A,"dd.")+"-"+io(b,"dd.MM.yyyy"):xd(A,b)?T+=io(A,"dd.MM.")+"-"+io(b,"dd.MM.yyyy"):T+=io(A,"dd.MM.yyyy")+"-"+io(b,"dd.MM.yyyy"),T+=t.EXCEL_EXTENSION,wd(v,T)}).catch(n=>{console.warn(n)})})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["energy"]],standalone:!1,features:[S],decls:2,vars:1,consts:[["lines","full","color","light"],["size","large","slot","start","name","laptop-outline","color","primary"],["slot","end",3,"click"],["name","download-outline"],[3,"isOnlyChart"],[1,"no-all-edges-shadow",3,"title","icon","height"],[1,"no-all-edges-shadow",3,"title","icon"],["slot","end","button","",1,"ion-float-right",3,"click"],[3,"name"]],template:function(n,i){n&1&&f(0,iS,8,4)(1,rS,1,1),n&2&&_(i.isSmartphoneResolution?0:1)},dependencies:[pe,Ge,ie,J,ne,eh,V],encapsulation:2})}}return t})();var sS=()=>({name:"oe-grid",color:"dark"});function lS(t,o){if(t&1&&(d(0,"oe-flat-widget-line",1),g(1,"translate")),t&2){let e=p(2);c("name",E(1,2,"GRID_STATES.OFF_GRID"))("converter",e.TIME_CONVERTER)}}function cS(t,o){if(t&1&&(d(0,"oe-flat-widget-line",2),g(1,"translate")),t&2){let e=p(2);c("name",E(1,2,"GRID_STATES.CONSUMPTION_LIMITATION"))("converter",e.TIME_CONVERTER)}}function mS(t,o){if(t&1&&(d(0,"oe-flat-widget-line",3),g(1,"translate")),t&2){let e=p(2);c("name",E(1,2,"GRID_STATES.FEED_IN_LIMITATION"))("converter",e.TIME_CONVERTER)}}function pS(t,o){t&1&&d(0,"oe-flat-widget-horizontal-line")}function dS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),f(2,lS,2,4,"oe-flat-widget-line",1),f(3,cS,2,4,"oe-flat-widget-line",2),f(4,mS,2,4,"oe-flat-widget-line",3),f(5,pS,1,0,"oe-flat-widget-horizontal-line"),d(6,"oe-flat-widget-line",4),g(7,"translate"),d(8,"oe-flat-widget-line",5),g(9,"translate"),l()),t&2){let e=p();c("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/gridchart")("icon",H(17,sS))("title",E(1,11,"GENERAL.GRID")),r(2),_(e.offGridTime>0?2:-1),r(),_(e.restrictionTime14a>0?3:-1),r(),_(e.restrictionTimeRcr>0?4:-1),r(),_(e.restrictionTimeRcr>0||e.offGridTime>0||e.restrictionTime14a>0?5:-1),r(),c("name",E(7,13,"GENERAL.GRID_SELL_ADVANCED"))("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS),r(2),c("name",E(9,15,"GENERAL.GRID_BUY_ADVANCED"))("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS)}}var Bl=class t extends ce{constructor(){super(...arguments),this.restrictionTime14a=null,this.restrictionTimeRcr=null,this.offGridTime=null,this.TIME_CONVERTER=Ir.formatSecondsToDuration}static{this.RESTRICTION_MODE_14A=new y("ctrlEssLimiter14a0","RestrictionMode")}static{this.RESTRICTION_TIME_14A=new y("ctrlEssLimiter14a0","CumulatedRestrictionTime")}static{this.OFF_GRID_TIME=new y("_sum","GridModeOffGridTime")}static{this.RESTRICTON_MODE_RCR=new y("ctrlEssRippleControlReceiver0","RestrictionMode")}static{this.RESTRICTION_TIME_RCR=new y("ctrlEssRippleControlReceiver0","CumulatedRestrictionTime")}getChannelAddresses(){let o=[];return Yt.isControllerEnabled(this.config,"Controller.Ess.Limiter14a")&&o.push(t.RESTRICTION_MODE_14A,t.RESTRICTION_TIME_14A),Yt.isControllerEnabled(this.config,"Controller.Ess.RippleControlReceiver")&&o.push(t.RESTRICTON_MODE_RCR,t.RESTRICTION_TIME_RCR),Yt.isControllerEnabled(this.config,"Controller.Ess.EmergencyCapacityReserve")&&o.push(t.OFF_GRID_TIME),o}onCurrentData(o){this.restrictionTime14a=o.allComponents["ctrlEssLimiter14a0/CumulatedRestrictionTime"],this.restrictionTimeRcr=o.allComponents["ctrlEssRippleControlReceiver0/CumulatedRestrictionTime"],this.offGridTime=o.allComponents["_sum/GridModeOffGridTime"]}static{this.\u0275fac=(()=>{let o;return function(n){return(o||(o=D(t)))(n||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["gridWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"link","icon","title"],["channelAddress","_sum/GridModeOffGridTime",3,"name","converter"],["channelAddress","ctrlEssLimiter14a0/CumulatedRestrictionTime",3,"name","converter"],["channelAddress","ctrlEssRippleControlReceiver0/CumulatedRestrictionTime",3,"name","converter"],["channelAddress","_sum/GridSellActiveEnergy",3,"name","converter"],["channelAddress","_sum/GridBuyActiveEnergy",3,"name","converter"]],template:function(e,n){e&1&&f(0,dS,10,18,"oe-flat-widget",0),e&2&&_(n.isInitialized?0:-1)},dependencies:[pe,Ri,we,V],encapsulation:2})}};var fS=()=>({name:"oe-production",color:"production"});function _S(t,o){if(t&1&&d(0,"oe-flat-widget-line",1),t&2){let e=o.$implicit,n=p(2);c("name",e.alias)("channelAddress",e.id+"/ActiveProductionEnergy")("converter",n.CONVERT_TO_KILO_WATTHOURS)}}function hS(t,o){if(t&1&&d(0,"oe-flat-widget-line",1),t&2){let e=o.$implicit,n=p(2);c("name",e.alias)("channelAddress",e.id+"/ActualEnergy")("converter",n.CONVERT_TO_KILO_WATTHOURS)}}function CS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),fe(2,_S,1,3,"oe-flat-widget-line",1,xe),fe(4,hS,1,3,"oe-flat-widget-line",1,xe),l()),t&2){let e=p();c("title",E(1,3,"GENERAL.PRODUCTION"))("icon",H(5,fS))("routerLink","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/productionchart"),r(2),_e(e.productionMeterComponents),r(2),_e(e.chargerComponents)}}var nh=(()=>{class t extends ce{constructor(){super(...arguments),this.productionMeterComponents=[],this.chargerComponents=[],this.CONVERT_TO_KILO_WATTHOURS=M.CONVERT_TO_KILO_WATTHOURS}getChannelAddresses(){return this.chargerComponents=this.config.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger").filter(e=>e.isEnabled),this.productionMeterComponents=this.config.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(e=>e.isEnabled&&this.config.isProducer(e)),[]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["productionWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon","routerLink"],[3,"name","channelAddress","converter"]],template:function(n,i){n&1&&f(0,CS,6,6,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,ji,ii,V],encapsulation:2})}}return t})();var ES=()=>({name:"oe-consumption",color:"normal"});function vS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),d(2,"oe-flat-widget-percentagebar",1),l()),t&2){let e=p();c("title",E(1,4,"GENERAL.SELF_CONSUMPTION"))("icon",H(6,ES))("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/selfconsumptionchart"),r(2),c("value",e.selfconsumptionValue)}}var ih=(()=>{class t extends ce{onCurrentData(e){this.selfconsumptionValue=M.calculateSelfConsumption(e.allComponents["_sum/GridSellActiveEnergy"],e.allComponents["_sum/ProductionActiveEnergy"])}getChannelAddresses(){return[new y("_sum","GridSellActiveEnergy"),new y("_sum","ProductionActiveEnergy")]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["selfconsumptionWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon","link"],[3,"value"]],template:function(n,i){n&1&&f(0,vS,3,7,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,Qi,V],encapsulation:2})}}return t})();var IS=()=>({name:"cloud-outline",color:"normal"});function xS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),g(3,"formatSecondsToDuration"),d(4,"oe-flat-widget-line",1),g(5,"translate"),g(6,"formatSecondsToDuration"),l()),t&2){let e=p();c("title",e.component.alias)("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/"+e.component.id+"/scheduleChart")("icon",H(15,IS)),r(),c("name",E(2,7,"EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.DELAY_DISCHARGE"))("value",E(3,9,e.delayedActiveTimeOverPeriod)),r(3),c("name",E(5,11,"EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.CHARGE_GRID"))("value",E(6,13,e.chargedConsumptionActiveTimeOverPeriod))}}var oh=(()=>{class t extends ce{constructor(){super(...arguments),this.delayedActiveTimeOverPeriod=null,this.chargedConsumptionActiveTimeOverPeriod=null}getChannelAddresses(){return[new y(this.componentId,"DelayedTime"),new y(this.componentId,"ChargedTime")]}onCurrentData(e){this.delayedActiveTimeOverPeriod=e.allComponents[this.componentId+"/DelayedTime"],this.chargedConsumptionActiveTimeOverPeriod=e.allComponents[this.componentId+"/ChargedTime"]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["timeOfUseTariffWidget"]],inputs:{period:"period"},standalone:!1,features:[S],decls:1,vars:1,consts:[["button","","button","",3,"title","link","icon"],[3,"name","value"]],template:function(n,i){n&1&&f(0,xS,7,16,"oe-flat-widget",0),n&2&&_(i.isInitialized&&i.component?0:-1)},dependencies:[pe,we,Ps,V],encapsulation:2})}}return t})();var AS=()=>({name:"flame",color:"normal"});function wS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),l()),t&2){let e=p();c("title",e.component.alias)("icon",H(8,AS))("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/"+e.component.id+"/heatchart"),r(),c("name",E(2,6,"EDGE.INDEX.WIDGETS.HEAT.HEATING_ENERGY"))("channelAddress",e.component.id+"/ActiveProductionEnergy")("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS)}}var rh=(()=>{class t extends ce{constructor(){super(...arguments),this.FORMAT_SECONDS_TO_DURATION=this.Converter.FORMAT_SECONDS_TO_DURATION(this.translate.getCurrentLang())}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["controller-heat-widget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon","link"],[3,"name","channelAddress","converter"]],template:function(n,i){n&1&&f(0,wS,3,9,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var DS=()=>({name:"power-outline",color:"normal"});function RS(t,o){if(t&1&&d(0,"oe-flat-widget-line",1),t&2){let e=o.$implicit,n=p(2);c("name",e.alias)("channelAddress",e.id+"/CumulatedActiveTime")("converter",n.FORMAT_SECONDS_TO_DURATION)}}function OS(t,o){t&1&&d(0,"oe-flat-widget-horizontal-line")}function NS(t,o){if(t&1&&d(0,"oe-flat-widget-line",1),t&2){let e=o.$implicit,n=p(2);c("name",e.alias)("channelAddress",e.id+"/CumulatedActiveTime")("converter",n.FORMAT_SECONDS_TO_DURATION)}}function MS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),fe(1,RS,1,3,"oe-flat-widget-line",1,xe),f(3,OS,1,0,"oe-flat-widget-horizontal-line"),fe(4,NS,1,3,"oe-flat-widget-line",1,xe),l()),t&2){let e=p();c("title","Laststeuerung")("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/digitaloutputchart")("icon",H(4,DS)),r(),_e(e.singleThresholdControllers),r(2),_(e.singleThresholdControllers.length>0&&e.fixDigitalOutputControllers.length>0?3:-1),r(),_e(e.fixDigitalOutputControllers)}}var ah=(()=>{class t extends ce{constructor(){super(...arguments),this.FORMAT_SECONDS_TO_DURATION=Be.FORMAT_SECONDS_TO_DURATION(this.translate.getCurrentLang()),this.fixDigitalOutputControllers=[],this.singleThresholdControllers=[],this.TextIndentation=ro}afterIsInitialized(){this.fixDigitalOutputControllers=this.config?.getComponentsByFactory("Controller.Io.FixDigitalOutput"),this.singleThresholdControllers=this.config?.getComponentsByFactory("Controller.IO.ChannelSingleThreshold")}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["DigitalOutputWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","","button","",3,"title","link","icon"],[3,"name","channelAddress","converter"]],template:function(n,i){n&1&&f(0,MS,6,5,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,Ri,we],encapsulation:2})}}return t})();var GS=()=>({name:"flame",color:"normal"}),PS=()=>[1,2,3],LS=t=>({level:t});function kS(t,o){if(t&1&&(d(0,"oe-flat-widget-line",1),g(1,"translate")),t&2){let e=o.$implicit,n=p(2);c("name",q(1,3,"EDGE.HISTORY.ACTIVE_DURATION_WITH_LEVEL",be(6,LS,e)))("channelAddress",n.component.id+"/Level"+e+"CumulatedTime")("converter",n.FORMAT_SECONDS_TO_DURATION)}}function VS(t,o){if(t&1&&(d(0,"oe-flat-widget-line",1),g(1,"translate")),t&2){let e=p(2);c("name",E(1,3,"GENERAL.CONSUMPTION"))("channelAddress",e.consumptionMeter.id+"/ActiveProductionEnergy")("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS)}}function HS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),fe(1,kS,2,8,"oe-flat-widget-line",1,xe),f(3,VS,2,5,"oe-flat-widget-line",1),l()),t&2){let e=p();c("link",Jn("/device/",e.edge.id,"/history/",e.componentId,"/heatingelementchart"))("title",e.component.alias)("icon",H(6,GS)),r(),_e(H(7,PS)),r(2),_(e.consumptionMeter&&e.consumptionMeter.isEnabled?3:-1)}}var sh=(()=>{class t extends ce{constructor(){super(...arguments),this.FORMAT_SECONDS_TO_DURATION=this.Converter.FORMAT_SECONDS_TO_DURATION(this.translate.getCurrentLang()),this.consumptionMeter=new Qo.Component}afterIsInitialized(){this.consumptionMeter=this.config?.getComponent(this.component.properties["meter.id"])}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["controller-io-heatingelement-widget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon","link"],[3,"name","channelAddress","converter"]],template:function(n,i){n&1&&f(0,HS,4,8,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var WS=()=>({name:"radio-button-on-outline",color:"normal",size:"large"});function US(t,o){if(t&1&&d(0,"oe-flat-widget-line",1),t&2){let e=o.$implicit,n=p(2);c("name",n.displayName.get(e.id))("channelAddress",e.id+"/CumulatedActiveTime")("converter",n.FORMAT_SECONDS_TO_DURATION)}}function zS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),fe(2,US,1,3,"oe-flat-widget-line",1,xe),l()),t&2){let e=p();c("title",E(1,3,"EDGE.INDEX.WIDGETS.CHANNELTRESHOLD.TITLE"))("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/channelthresholdchart")("icon",H(5,WS)),r(2),_e(e.controllers)}}var lh=(()=>{class t extends ce{constructor(){super(...arguments),this.displayName=new Map,this.activeSecondsOverPeriod=null,this.FORMAT_SECONDS_TO_DURATION=Be.FORMAT_SECONDS_TO_DURATION(this.translate.getCurrentLang()),this.controllers=[]}getChannelAddresses(){this.controllers=this.config.getComponentsByFactory("Controller.ChannelThreshold").concat(this.config.getComponentsImplementingNature("io.openems.impl.controller.channelthreshold.ChannelThresholdController"));let e=[];for(let n of this.controllers){let i=y.fromString(n.properties.outputChannelAddress);this.displayName.set(n.id,this.getDisplayName(n,i)),e.push(new y(n.id,"CumulatedActiveTime"))}return e}getDisplayName(e,n){return e.id===e.alias?n.channelId:e.alias}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["channelthresholdWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","link","icon"],[3,"name","channelAddress","converter"]],template:function(n,i){n&1&&f(0,zS,4,6,"oe-flat-widget",0),n&2&&_(i.isInitialized&&i.controllers?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var YS=()=>({name:"swap-vertical-outline",color:"normal"});function $S(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1)(2,"oe-flat-widget-line",1),l()),t&2){let e=p();c("title",e.component.alias)("routerLink","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/"+e.component.id+"/enerixcontrolchart")("icon",H(11,YS)),r(),c("name","CumulatedNoDischargeTime")("channelAddress",e.component.id+"/CumulatedNoDischargeTime")("converter",e.TIME_CONVERTER)("leftColumnWidth",80),r(),c("name","CumulatedInactiveTime")("channelAddress",e.component.id+"/CumulatedInactiveTime")("converter",e.TIME_CONVERTER)("leftColumnWidth",80)}}var ch=(()=>{class t extends ce{constructor(){super(...arguments),this.TIME_CONVERTER=this.Converter.FORMAT_SECONDS_TO_DURATION("de")}getChannelAddresses(){return[new y(this.component.id,"CumulatedInactiveTime"),new y(this.component.id,"CumulatedNoDischargeTime"),new y(this.component.id,"CumulatedForceChargeTime")]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["enerixControlWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","","button","",3,"title","routerLink","icon"],[3,"name","channelAddress","converter","leftColumnWidth"]],template:function(n,i){n&1&&f(0,$S,3,12,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,ji,ii],encapsulation:2})}}return t})();var qS=()=>({name:"swap-vertical-outline",color:"normal"});function KS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),d(3,"oe-flat-widget-line",1),g(4,"translate"),l()),t&2){let e=p();c("title",e.component.alias)("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/"+e.component.id+"/modbusTcpApi")("icon",H(15,qS)),r(),c("name",E(2,11,"MODBUS_TCP_API_READ_WRITE.CUMULATED_ACTIVE_TIME"))("channelAddress",e.component.id+"/CumulatedActiveTime")("converter",e.TIME_CONVERTER)("leftColumnWidth",80),r(2),c("name",E(4,13,"MODBUS_TCP_API_READ_WRITE.CUMULATED_INACTIVE_TIME"))("channelAddress",e.component.id+"/CumulatedInactiveTime")("converter",e.TIME_CONVERTER)("leftColumnWidth",80)}}var mh=(()=>{class t extends ce{constructor(){super(...arguments),this.TIME_CONVERTER=this.Converter.FORMAT_SECONDS_TO_DURATION("de")}getChannelAddresses(){return[new y(this.component.id,"CumulatedInactiveTime"),new y(this.component.id,"CumulatedActiveTime")]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["modbusTcpApiWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","","button","",3,"title","link","icon"],[3,"name","channelAddress","converter","leftColumnWidth"]],template:function(n,i){n&1&&f(0,KS,5,16,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var ZS=()=>({name:"oe-grid-storage",size:"large",color:"normal"});function JS(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),d(3,"oe-flat-widget-line",1),g(4,"translate"),d(5,"oe-flat-widget-line",1),g(6,"translate"),l()),t&2){let e=p();c("title",e.component.alias)("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/"+e.component.id+"/gridOptimizedChargeChart")("icon",H(21,ZS)),r(),c("name",E(2,15,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.CHARGING_DELAYED"))("channelAddress",e.component.id+"/AvoidLowChargingTime")("converter",e.FORMAT_SECONDS_TO_DURATION)("filter",e.filter),r(2),c("name",E(4,17,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.CHARGE_LIMIT_ACTIVE"))("channelAddress",e.component.id+"/DelayChargeTime")("converter",e.FORMAT_SECONDS_TO_DURATION)("filter",e.filter),r(2),c("name",E(6,19,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.GRID_FEED_IN_LIMITATION_AVOIDED"))("channelAddress",e.component.id+"/SellToGridLimitTime")("converter",e.FORMAT_SECONDS_TO_DURATION)("filter",e.filter)}}var ph=(()=>{class t extends ce{constructor(){super(...arguments),this.FORMAT_SECONDS_TO_DURATION=Be.FORMAT_SECONDS_TO_DURATION(this.translate.getCurrentLang()),this.filter=e=>e>59}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["gridOptimizedChargeWidget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","link","icon"],[3,"name","channelAddress","converter","filter"]],template:function(n,i){n&1&&f(0,JS,7,22,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var Wl=class{constructor(o){this.service=o}subscribeWidgetRefresh(){}unsubscribeWidgetRefresh(){}queryHistoricTimeseriesData(o,e){let n=On(this.service,o,e).resolution;return new Promise((a,m)=>{this.service.getCurrentEdge().then(u=>{this.service.getConfig().then(C=>{this.getChannelAddresses(u,C).then(v=>{let T=new Fs(dn.maxDate(o,u?.firstSetupProtocol),e,v,n);u.sendRequest(this.service.websocket,T).then(A=>{let b=A.result;this.activeQueryData=A.id,Object.keys(b.data).length!=0&&Object.keys(b.timestamps).length!=0?a(A):m(new Rd(A.id,{code:0,message:"Result was empty"}))}).catch(A=>m(A))}).catch(v=>m(v))})})}).then(a=>{if(this.activeQueryData===a.id)return oo.normalizeTimestamps(n.unit,a)})}};function t2(t,o){if(t&1&&(s(0,"ion-card")(1,"ion-item",0),d(2,"ion-icon",1),s(3,"ion-label"),h(4),l()(),s(5,"ion-card-content")(6,"table",2)(7,"tr")(8,"td",3),h(9," EDGE.HISTORY.ACTIVE_DURATION"),l(),s(10,"td",4),h(11),g(12,"formatSecondsToDuration"),l()()()()()),t&2){let e=p();r(4),N(e.component.alias),r(7),R(" ",E(12,2,e.activeSecondsOverPeriod)," ")}}var dh=(()=>{class t extends Wl{static{this.SELECTOR="chpsocWidget"}constructor(e,n){super(e),this.service=e,this.route=n,this.activeSecondsOverPeriod=null,this.edge=null,this.component=null}ngOnInit(){this.service.getCurrentEdge().then(e=>{this.edge=e,this.service.getConfig().then(n=>{this.component=n.getComponent(this.componentId)})})}ngOnDestroy(){this.unsubscribeWidgetRefresh()}ngOnChanges(){this.updateValues()}updateValues(){this.queryHistoricTimeseriesData(this.service.historyPeriod.value.from,this.service.historyPeriod.value.to).then(e=>{this.service.getConfig().then(n=>{let i=e.result,a=y.fromString(n.getComponentProperties(this.componentId).outputChannelAddress);this.activeSecondsOverPeriod=bd(a,i)})})}getChannelAddresses(e,n){return new Promise(i=>{let m=[y.fromString(n.getComponentProperties(this.componentId).outputChannelAddress)];i(m)})}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De))}}static{this.\u0275cmp=I({type:t,selectors:[["chpsocWidget"]],inputs:{period:"period",componentId:"componentId"},standalone:!1,features:[S,En],decls:1,vars:1,consts:[["lines","full","color","light"],["slot","start","size","large","color","primary","name","flame-outline"],[1,"full_width"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"]],template:function(n,i){n&1&&f(0,t2,13,4,"ion-card"),n&2&&_(i.component?0:-1)},dependencies:[Ht,We,ie,J,ne,Ne,Ps],encapsulation:2})}}return t})();function i2(t,o){if(t&1&&(s(0,"ion-card",0)(1,"ion-item",1),d(2,"ion-icon",2),s(3,"ion-label"),h(4),l()(),s(5,"ion-card-content",3)(6,"table",4)(7,"tr")(8,"td",5),h(9," \xA0 "),l()()()()()),t&2){let e=p();c("routerLink","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/"+e.component.id+"/delayedselltogridchart"),r(4),N(e.component.alias)}}var uh=(()=>{class t{static{this.SELECTOR="delayedSellToGridWidget"}constructor(e,n,i){this.service=e,this.route=n,this.userService=i,this.edge=null,this.component=null,this.newNavigationUrlSegment="",wt(()=>{let a=this.userService.isNewNavigation();this.newNavigationUrlSegment=a?"/live":""})}ngOnInit(){this.service.getCurrentEdge().then(e=>{this.edge=e,this.service.getConfig().then(n=>{this.component=n.getComponent(this.componentId)})})}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(De),x(qn))}}static{this.\u0275cmp=I({type:t,selectors:[["delayedSellToGridWidget"]],inputs:{period:"period",componentId:"componentId"},standalone:!1,decls:1,vars:1,consts:[["button","",3,"routerLink"],["lines","full","color","light"],["slot","start","size","large","color","normal","name","trending-down-outline"],[2,"color","var(--ion-card-content-color)"],[1,"full_width"],[1,"align_right",2,"width","35%"]],template:function(n,i){n&1&&f(0,i2,10,2,"ion-card",0),n&2&&_(i.component&&i.edge?0:-1)},dependencies:[Ht,We,ie,J,ne,ji,ii],encapsulation:2})}}return t})();var r2=()=>({name:"flame",color:"normal"});function a2(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),d(3,"oe-flat-widget-line",1),g(4,"translate"),d(5,"oe-flat-widget-line",1),g(6,"translate"),d(7,"oe-flat-widget-line",1),g(8,"translate"),l()),t&2){let e=p();c("title",e.component.alias)("icon",H(27,r2))("link","/device/"+e.edge.id+e.newNavigationUrlSegment+"/history/"+e.component.id+"/heatpumpchart"),r(),c("name",E(2,19,"EDGE.INDEX.WIDGETS.HEAT_PUMP.NORMAL_OPERATION"))("filter",e.FILTER_NULL_WITH_THRESHOLD)("channelAddress",e.component.id+"/RegularStateTime")("converter",e.FORMAT_SECONDS_TO_DURATION),r(2),c("name",E(4,21,"EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_REC"))("filter",e.FILTER_NULL_WITH_THRESHOLD)("channelAddress",e.component.id+"/RecommendationStateTime")("converter",e.FORMAT_SECONDS_TO_DURATION),r(2),c("name",E(6,23,"EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_COM"))("filter",e.FILTER_NULL_WITH_THRESHOLD)("channelAddress",e.component.id+"/ForceOnStateTime")("converter",e.FORMAT_SECONDS_TO_DURATION),r(2),c("name",E(8,25,"EDGE.INDEX.WIDGETS.HEAT_PUMP.LOCK"))("filter",e.FILTER_NULL_WITH_THRESHOLD)("channelAddress",e.component.id+"/LockStateTime")("converter",e.FORMAT_SECONDS_TO_DURATION)}}var fh=(()=>{class t extends ce{constructor(){super(...arguments),this.FORMAT_SECONDS_TO_DURATION=this.Converter.FORMAT_SECONDS_TO_DURATION(this.translate.getCurrentLang()),this.FILTER_NULL_WITH_THRESHOLD=e=>e!==null&&Number.isFinite(e)&&e>59}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["controller-io-heatpump-widget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon","link"],[3,"name","filter","channelAddress","converter"]],template:function(n,i){n&1&&f(0,a2,9,28,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var l2=()=>({name:"trending-down-outline",color:"normal",size:"large"});function c2(t,o){if(t&1&&d(0,"oe-flat-widget",0),t&2){let e=p();c("link",Jn("/device/",e.edge.id,"/history/",e.componentId,"/timeslotpeakshavingchart"))("title",e.component.alias)("icon",H(5,l2))}}var _h=(()=>{class t extends ce{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-peakshaving-timeslot"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","link","icon"]],template:function(n,i){n&1&&f(0,c2,1,6,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe],encapsulation:2})}}return t})();var p2=()=>({name:"oe-storage",color:"success",size:"large"});function d2(t,o){if(t&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),d(2,"oe-flat-widget-line",1),g(3,"translate"),d(4,"oe-flat-widget-line",2),g(5,"translate"),l()),t&2){let e=p();c("link",Ui("/device/",e.edge.id,"/history/storagechart"))("title",E(1,8,"GENERAL.STORAGE_SYSTEM"))("icon",H(14,p2)),r(2),c("name",E(3,10,"GENERAL.CHARGE"))("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS),r(2),c("name",E(5,12,"GENERAL.DISCHARGE"))("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS)}}var hh=(()=>{class t extends ce{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["common-storage-widget"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title","link","icon"],["channelAddress","_sum/EssDcChargeEnergy",3,"name","converter"],["channelAddress","_sum/EssDcDischargeEnergy",3,"name","converter"]],template:function(n,i){n&1&&f(0,d2,6,15,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var f2=()=>({name:"trending-down-outline",color:"normal",size:"large"});function _2(t,o){if(t&1&&d(0,"oe-flat-widget",0),t&2){let e=p();c("link",Jn("/device/",e.edge.id,"/history/",e.componentId,"/symmetricpeakshavingchart"))("title",e.component.alias)("icon",H(5,f2))}}var Ch=(()=>{class t extends ce{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-peakshaving-symmetric"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","link","icon"]],template:function(n,i){n&1&&f(0,_2,1,6,"oe-flat-widget",0),n&2&&_(i.isInitialized&&i.component?0:-1)},dependencies:[pe],encapsulation:2})}}return t})();var C2=()=>({name:"trending-down-outline",color:"normal",size:"large"});function g2(t,o){if(t&1&&d(0,"oe-flat-widget",0),t&2){let e=p();c("link",Jn("/device/",e.edge.id,"/history/",e.componentId,"/asymmetricpeakshavingchart"))("title",e.component.alias)("icon",H(5,C2))}}var gh=(()=>{class t extends ce{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-peakshaving-asymmetric"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","link","icon"]],template:function(n,i){n&1&&f(0,g2,1,6,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe],encapsulation:2})}}return t})();function v2(t,o){t&1&&(s(0,"ion-button",7),d(1,"pickdate"),l())}function y2(t,o){t&1&&(s(0,"ion-col",13),d(1,"common-storage-widget"),l())}function T2(t,o){t&1&&(s(0,"ion-col",13),d(1,"productionWidget"),l())}function I2(t,o){t&1&&(s(0,"ion-col",13),d(1,"gridWidget"),l())}function x2(t,o){t&1&&(s(0,"ion-col",13),d(1,"consumptionWidget"),l())}function S2(t,o){t&1&&(s(0,"ion-col",13),d(1,"selfconsumptionWidget"),l())}function A2(t,o){t&1&&(s(0,"ion-col",13),d(1,"autarchyWidget"),l())}function w2(t,o){t&1&&(s(0,"ion-col",13),d(1,"channelthresholdWidget"),l())}function b2(t,o){t&1&&(s(0,"ion-col",13),d(1,"DigitalOutputWidget"),l())}function D2(t,o){if(t&1&&(Y(0,11),G(1,y2,2,0,"ion-col",12)(2,T2,2,0,"ion-col",12)(3,I2,2,0,"ion-col",12)(4,x2,2,0,"ion-col",12)(5,S2,2,0,"ion-col",12)(6,A2,2,0,"ion-col",12)(7,w2,2,0,"ion-col",12)(8,b2,2,0,"ion-col",12),z()),t&2){let e=o.$implicit;c("ngSwitch",e),r(),c("ngSwitchCase","Storage"),r(),c("ngSwitchCase","Common_Production"),r(),c("ngSwitchCase","Grid"),r(),c("ngSwitchCase","Consumption"),r(),c("ngSwitchCase","Common_Selfconsumption"),r(),c("ngSwitchCase","Common_Autarchy"),r(),c("ngSwitchCase","Controller_ChannelThreshold"),r(),c("ngSwitchCase","Controller_Io_Digital_Outputs")}}function R2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"oe-controller-peakshaving-symmetric",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function O2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"oe-controller-peakshaving-asymmetric",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function N2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"oe-controller-peakshaving-timeslot",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function M2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"delayedSellToGridWidget",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function F2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"gridOptimizedChargeWidget",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function G2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"modbusTcpApiWidget",14),l()),t&2){let e=p(2).$implicit;r(),c("componentId",e.componentId)}}function P2(t,o){t&1&&(Y(0),G(1,G2,2,1,"ion-col",12),z()),t&2&&(r(),c("ngSwitchCase","Controller.Api.ModbusTcp.ReadWrite"))}function L2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"timeOfUseTariffWidget",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function k2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"enerixControlWidget",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function V2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"controller-io-heatingelement-widget",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function H2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"controller-heat-widget",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function B2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"controller-io-heatpump-widget",14),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function W2(t,o){if(t&1&&(s(0,"ion-col",13),d(1,"chpsocWidget",15),l()),t&2){let e=p().$implicit,n=p(3);r(),c("componentId",e.componentId)("period",n.service.historyPeriod.value)}}function U2(t,o){if(t&1&&(Y(0,11),G(1,R2,2,1,"ion-col",12)(2,O2,2,1,"ion-col",12)(3,N2,2,1,"ion-col",12)(4,M2,2,1,"ion-col",12)(5,F2,2,1,"ion-col",12)(6,P2,2,1,"ng-container",1)(7,L2,2,1,"ion-col",12)(8,k2,2,1,"ion-col",12)(9,V2,2,1,"ion-col",12)(10,H2,2,1,"ion-col",12)(11,B2,2,1,"ion-col",12)(12,W2,2,2,"ion-col",12),z()),t&2){let e=o.$implicit,n=p(3);c("ngSwitch",e.name),r(),c("ngSwitchCase","Controller.Symmetric.PeakShaving"),r(),c("ngSwitchCase","Controller.Asymmetric.PeakShaving"),r(),c("ngSwitchCase","Controller.TimeslotPeakshaving"),r(),c("ngSwitchCase","Controller.Ess.DelayedSellToGrid"),r(),c("ngSwitchCase","Controller.Ess.GridOptimizedCharge"),r(),c("ngIf",n.isModbusTcpWidgetAllowed),r(),c("ngSwitchCase","Controller.Ess.Time-Of-Use-Tariff"),r(),c("ngSwitchCase","Controller.Clever-PV"),r(),c("ngSwitchCase","Controller.IO.HeatingElement"),r(),c("ngSwitchCase","io.openems.edge.heat.api.ManagedHeatElement"),r(),c("ngSwitchCase","Controller.Io.HeatPump.SgReady"),r(),c("ngSwitchCase","Controller.CHP.SoC")}}function z2(t,o){if(t&1){let e=W();s(0,"ion-grid")(1,"ion-row")(2,"ion-col",8)(3,"energy",9),O("setErrorResponse",function(i){P(e);let a=p(2);return L(a.setErrorResponse(i))}),l()(),G(4,D2,9,9,"ng-container",10)(5,U2,13,13,"ng-container",10),l()()}if(t&2){let e=p(2);r(3),re("height",e.energyChartHeight),r(),c("ngForOf",e.widgets.classes),r(),c("ngForOf",e.widgets.list)}}function j2(t,o){t&1&&(s(0,"ion-grid")(1,"ion-row",16)(2,"ion-col",17)(3,"ion-card")(4,"ion-item",18),d(5,"ion-icon",19),s(6,"ion-label",20),h(7,"Historische Daten sind derzeit lokal nicht verf\xFCgbar"),l()(),s(8,"ion-card-content")(9,"p"),h(10,'Please setup a Timeseries provider like "Timedata InfluxDB" to record and visualize historic data.'),l()()()()()())}function Y2(t,o){if(t&1){let e=W();s(0,"oe-navigation-view")(1,"ion-buttons",2,0),G(3,v2,2,0,"ion-button",3),l(),s(4,"ion-refresher",4),O("ionRefresh",function(i){P(e);let a=p();return L(a.handleRefresh(i))}),d(5,"ion-refresher-content",5),l(),d(6,"oe-history-data-error",6),s(7,"ion-content"),G(8,z2,6,4,"ion-grid",1)(9,j2,11,0,"ion-grid",1),l()()}if(t&2){let e=p();r(3),c("ngIf",e.navigationService.position()!==null&&e.navigationService.position()!=="disabled"),r(3),c("response",e.errorResponse),r(2),c("ngIf",e.isTimedataAvailable&&e.widgets),r(),c("ngIf",!e.isTimedataAvailable)}}var Eh=(()=>{class t{constructor(e,n,i,a,m){this.service=e,this.translate=n,this.route=i,this.dataService=a,this.navigationService=m,this.isTimedataAvailable=!0,this.socChartHeight="250px",this.energyChartHeight="250px",this.widgets=null,this.edge=null,this.config=null,this.errorResponse=null,this.isModbusTcpWidgetAllowed=!1,this.handleRefresh=u=>this.dataService.refresh(u),wt(()=>{let u=this.service.currentEdge();this.edge=u,this.isModbusTcpWidgetAllowed=er.isModbusTcpApiWidgetAllowed(u)})}ngOnInit(){this.service.getConfig().then(e=>{this.config=e,e.hasStorage(),this.widgets=e.widgets,pt.backend=="OpenEMS Edge"&&e.getComponentsImplementingNature("io.openems.edge.timedata.api.Timedata").filter(n=>n.isEnabled).length==0&&(this.isTimedataAvailable=!1)})}updateOnWindowResize(){let e=Math.min(window.innerHeight-150,window.innerWidth<768?window.innerWidth-150:window.innerWidth-400);this.socChartHeight=Math.max(150,Math.min(200,e))+"px",this.energyChartHeight=Math.max(300,Math.min(600,e))+"px"}setErrorResponse(e){this.errorResponse=e}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(te),x(De),x(kt),x(fn))}}static{this.\u0275cmp=I({type:t,selectors:[["history"]],standalone:!1,decls:1,vars:1,consts:[["header",""],[4,"ngIf"],["header","",1,"ion-justify-content-center"],["size","small","fill","clear","class","ion-justify-content-center",4,"ngIf"],["mode","ios","slot","fixed",3,"ionRefresh"],["refreshingSpinner","crescent"],[3,"response"],["size","small","fill","clear",1,"ion-justify-content-center"],["size","12"],[3,"setErrorResponse"],[3,"ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],["size","12","size-md","6","size-lg","4","size-xl","3",4,"ngSwitchCase"],["size","12","size-md","6","size-lg","4","size-xl","3"],[3,"componentId"],[3,"componentId","period"],[1,"ion-justify-content-center"],["size","12","size-md","8"],["lines","full","color","light"],["slot","start","size","large","color","warning","name","information-circle-outline"],[1,"ion-text-wrap"]],template:function(n,i){n&1&&G(0,Y2,10,4,"oe-navigation-view",1),n&2&&c("ngIf",i.edge)},dependencies:[Q_,Z_,th,Bl,nh,ih,oh,rh,ah,sh,lh,ch,mh,ph,Ee,Hn,yn,ho,Co,li,In,Ge,Xe,Ht,We,Ae,je,Me,ie,J,ne,ia,oa,Se,dh,uh,fh,_h,hh,Ch,gh],encapsulation:2})}}return t})();var vh=(()=>{class t extends kt{constructor(e,n){super(n),this.websocket=e,this.service=n,this.queryChannelsTimeout=null,this.timestamps=[],this.channelAddresses={}}getValues(e,n,i){for(let a of e)this.channelAddresses[a.toString()]=a;this.queryChannelsTimeout==null&&(this.queryChannelsTimeout=setTimeout(()=>{Object.entries(this.channelAddresses).length>0&&this.service.historyPeriod.subscribe(a=>{let m=new Md(dn.maxDate(a.from,n?.firstSetupProtocol),a.to,Object.values(this.channelAddresses));this.activeQueryData=m.id,n.sendRequest(this.websocket,m).then(u=>{if(this.activeQueryData===u.id){let C={},v=u.result;for(let[T,A]of Object.entries(v.data))C[T]=A;this.currentValue.set({allComponents:C}),this.timestamps=u.result.timestamps??[]}}).catch(u=>console.warn(u)).finally(()=>{this.queryChannelsTimeout=null})})},U.REQUEST_TIMEOUT))}unsubscribeFromChannels(e){}refresh(e){this.getValues(Object.values(this.channelAddresses),this.edge,""),setTimeout(()=>{e.target.complete()},1e3)}static{this.\u0275fac=function(n){return new(n||t)(Jt(Ce),Jt(j))}}static{this.\u0275prov=xi({token:t,factory:t.\u0275fac})}}return t})();var wm=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=I({type:t,selectors:[["edge"]],standalone:!1,decls:1,vars:0,template:function(n,i){n&1&&d(0,"ion-router-outlet")},dependencies:[aa],encapsulation:2})}}return t})();var Wt=(()=>{class t{constructor(e,n,i,a,m,u,C){this.websocket=e,this.route=n,this.service=i,this.modalController=a,this.translate=m,this.formBuilder=u,this.ref=C,this.component=null,this.Role=Rt,this.TextIndentation=ro,this.Utils=M,this.Converter=Be,this.isInitialized=!1,this.edge=null,this.config=null,this.stopOnDestroy=new qt,this.formGroup=null,this.subscription=new hs,this.id=la(),C.detach(),setInterval(()=>{this.ref.detectChanges()},0)}ngOnDestroy(){this.edge.unsubscribeFromChannels(this.id,this.websocket,this.getChannelAddresses()),this.subscription.unsubscribe(),this.stopOnDestroy.next(),this.stopOnDestroy.complete()}ngOnInit(){this.service.getCurrentEdge().then(e=>{this.service.getConfig().then(n=>ae(this,null,function*(){this.edge=e,this.config=n,yield this.updateComponent(n);let i=[];if(i=this.getChannelAddresses(),this.component!=null){this.component=Qo.Component.of(n.components[this.component.id]);let a=this.getChannelIds();for(let m of a)i.push(new y(this.component.id,m))}i.length!=0&&this.edge.subscribeChannels(this.websocket,this.id,i),e.currentData.pipe(An(this.stopOnDestroy)).subscribe(a=>{let m={};for(let u of i){let C=u.toString();m[C]=a.channel[C]}this.onCurrentData({allComponents:m})}),this.formGroup=this.getFormGroup(),this.isInitialized=!0,this.onIsInitialized()}))})}updateComponent(e){}onIsInitialized(){}onCurrentData(e){}getChannelAddresses(){return[]}getChannelIds(){return[]}getFormGroup(){return null}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(De),x(j),x(he),x(te),x(Ft),x(ln))}}static{this.\u0275dir=Wi({type:t,inputs:{component:"component"}})}}return t})();var Ul=(()=>{class t extends un{static{this.METHOD="getSchedule"}constructor(){super(t.METHOD,{})}}return t})();var cr;(function(t){t.CONVERT_TO_MODE_LABEL=a=>m=>Be.IF_STRING(m,u=>{switch(u){case n.ZERO:return a.instant("EVSE_SINGLE.HOME.MODE.ZERO");case n.MINIMUM:return a.instant("EVSE_SINGLE.HOME.MODE.MINIMUM");case n.SURPLUS:return a.instant("EVSE_SINGLE.HOME.MODE.SURPLUS");case n.FORCE:return a.instant("EVSE_SINGLE.HOME.MODE.FORCE");default:return Be.HIDE_VALUE(u)}}),t.CONVERT_TO_STATE_MACHINE_LABEL=a=>m=>{switch(m){case o.EV_NOT_CONNECTED:return a.instant("EVSE_SINGLE.HOME.STATE_MACHINE.EV_NOT_CONNECTED");case o.EV_CONNECTED:return a.instant("EVSE_SINGLE.HOME.STATE_MACHINE.EV_CONNECTED");case o.CHARGING:return a.instant("EVSE_SINGLE.HOME.STATE_MACHINE.CHARGING");case o.FINISHED_EV_STOP:return a.instant("EVSE_SINGLE.HOME.STATE_MACHINE.FINISHED_EV_STOP");case o.FINISHED_ENERGY_SESSION_LIMIT:return a.instant("EVSE_SINGLE.HOME.STATE_MACHINE.FINISHED_ENERGY_SESSION_LIMIT");case o.PHASE_SWITCH_TO_THREE_PHASE:return a.instant("EVSE_SINGLE.HOME.STATE_MACHINE.PHASE_SWITCH_TO_THREE_PHASE");case o.PHASE_SWITCH_TO_SINGLE_PHASE:return a.instant("EVSE_SINGLE.HOME.STATE_MACHINE.PHASE_SWITCH_TO_SINGLE_PHASE");default:return"-"}};let o;(function(a){a[a.UNDEFINED=-1]="UNDEFINED",a[a.EV_NOT_CONNECTED=10]="EV_NOT_CONNECTED",a[a.EV_CONNECTED=20]="EV_CONNECTED",a[a.CHARGING=50]="CHARGING",a[a.FINISHED_EV_STOP=60]="FINISHED_EV_STOP",a[a.FINISHED_ENERGY_SESSION_LIMIT=61]="FINISHED_ENERGY_SESSION_LIMIT",a[a.PHASE_SWITCH_TO_THREE_PHASE=91]="PHASE_SWITCH_TO_THREE_PHASE",a[a.PHASE_SWITCH_TO_SINGLE_PHASE=92]="PHASE_SWITCH_TO_SINGLE_PHASE"})(o=t.StateMachine||(t.StateMachine={}));function e(a){switch(a){case"Evse.ChargePoint.Keba.UDP":return pt.images.EVSE.KEBA_P30;case"Evse.ChargePoint.Keba.Modbus":return pt.images.EVSE.KEBA_P40;case"Evse.ChargePoint.HardyBarth":return pt.images.EVSE.HARDY_BARTH;default:return null}}t.getImgUrlByFactoryId=e;let n;(function(a){a.ZERO="ZERO",a.MINIMUM="MINIMUM",a.SURPLUS="SURPLUS",a.FORCE="FORCE"})(n=t.Mode||(t.Mode={}));function i(a,m,u,C,v){let T=[],A=[],b=[],F=Array(a).fill(null),k=Array(a).fill(null),Q=Array(a).fill(null),ve=Array(a).fill(null);for(let se=0;se<a;se++){let ge=on.formatPrice(m[se]),Ue=u[se];b.push(new Date(C[se]));let Ot=Object.keys(t.Mode);if(Ue!==null)switch(Ue){case Ot.indexOf(t.Mode.ZERO):F[se]=ge;break;case Ot.indexOf(t.Mode.MINIMUM):k[se]=ge;break;case Ot.indexOf(t.Mode.SURPLUS):Q[se]=ge;break;case Ot.indexOf(t.Mode.FORCE):ve[se]=ge;break}}return T.push({type:"bar",label:"No Charge",data:F,order:1}),A.push({backgroundColor:"rgba(0,0,0,0.8)",borderColor:"rgba(0,0,0,0.9)"}),T.push({type:"bar",label:"Minimum",data:k,order:1}),A.push({backgroundColor:"rgba(25, 19, 82, 0.8)",borderColor:"rgba(51,102,0,1)"}),T.push({type:"bar",label:"Surplus PV",data:Q,order:1}),A.push({backgroundColor:"rgba(51,102,0,0.8)",borderColor:"rgba(51,102,0,1)"}),T.push({type:"bar",label:"Force Charge",data:ve,order:1}),A.push({backgroundColor:"rgba(0, 204, 204,0.5)",borderColor:"rgba(0, 204, 204,0.7)"}),{colors:A,datasets:T,labels:b}}t.getScheduleChartData=i})(cr||(cr={}));function $2(t,o){if(t&1&&d(0,"canvas",3),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)}}var yh=(()=>{class t extends Ii{constructor(e,n,i){super("schedule-chart",e,n),this.service=e,this.translate=n,this.websocket=i}getChartHeight(){return on.getChartHeight(this.service.isSmartphoneResolution)}ngOnChanges(){return ae(this,null,function*(){this.edge.getConfig(this.websocket).pipe(vt(e=>!!e),pn(1)).subscribe(e=>{let n=e?.getComponent("_meta"),i=e?.getPropertyFromComponent(n,"currency");this.currencyLabel=Di.getCurrencyLabelByCurrency(i),this.currencyUnit=Di.getChartCurrencyUnitLabel(i)}),this.updateChart()})}ngOnInit(){this.service.startSpinner(this.spinnerId)}ngOnDestroy(){this.unsubscribeChartRefresh()}updateChart(){this.autoSubscribeChartRefresh(),this.service.startSpinner(this.spinnerId),this.loading=!0,this.edge.sendRequest(this.websocket,new Ci({componentId:this.component.id,payload:new Ul})).then(e=>{let i=e.result.schedule,{priceArray:a,modeArray:m,timestampArray:u}={priceArray:i.map(v=>v.price),modeArray:i.map(v=>v.mode),timestampArray:i.map(v=>v.timestamp)},C=cr.getScheduleChartData(i.length,a,m,u,this.translate);this.colors=C.colors,this.labels=C.labels,this.datasets=C.datasets,this.loading=!1,this.setLabel(),this.stopSpinner()}).catch(e=>{console.error(e),this.initializeChart()}).finally(()=>ae(this,null,function*(){this.unit=Z.CURRENCY,yield this.setOptions(this.options),this.applyControllerSpecificOptions()}))}setLabel(){this.options=this.createDefaultChartOptions()}getChannelAddresses(){return new Promise(()=>{})}applyControllerSpecificOptions(){this.options.scales.x.time.unit=On(this.service,this.service.historyPeriod.value.from,this.service.historyPeriod.value.to).timeFormat,this.options.scales.x.ticks={source:"auto",autoSkip:!1},this.options.scales.x.ticks.maxTicksLimit=30,this.options.scales.x.offset=!1,this.options.scales.x.ticks.callback=function(n){let i=new Date(n);return i.getMinutes()===0?i.getHours()+":00":""},this.options.plugins.tooltip.mode="index",this.options.plugins.tooltip.callbacks.labelColor=n=>{if(n)return{borderColor:Pt.changeOpacityFromRGBA(n.dataset.borderColor,1),backgroundColor:n.dataset.backgroundColor}},this.options.plugins.tooltip.callbacks.label=n=>{let i=n.dataset.label,a=n.dataset.data[n.dataIndex];return i+": "+Fo.FORMAT_CURRENCY_PER_KWH(a,this.currencyLabel)},this.datasets=this.datasets.map(n=>{let i=n.type==="line"?.2:.5;return n.backgroundColor&&n.borderColor&&(n.backgroundColor=Pt.changeOpacityFromRGBA(n.backgroundColor.toString(),i),n.borderColor=Pt.changeOpacityFromRGBA(n.borderColor.toString(),1)),n});let e={position:"left",unit:this.unit,yAxisId:B.LEFT,customTitle:this.currencyUnit,scale:{dynamicScale:!0}};this.options.scales[B.LEFT]=ke(ke({},this.options.scales[B.LEFT]),U.DEFAULT_Y_SCALE_OPTIONS(e,this.translate,"bar",this.datasets.filter(n=>n.yAxisID===B.LEFT),!0))}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(te),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["scheduleChart"]],inputs:{refresh:"refresh",edge:"edge",component:"component"},standalone:!1,features:[S,En],decls:4,vars:5,consts:[[3,"response"],["id","chart-area",1,"semi-transparent-background"],[3,"name"],["baseChart","","type","line",3,"datasets","labels","options"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),s(1,"div",1),d(2,"ngx-spinner",2),f(3,$2,1,3,"canvas",3),l()),n&2&&(c("response",i.errorResponse),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:3))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function q2(t,o){if(t&1&&d(0,"canvas",3),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)}}var Th=(()=>{class t extends Ii{constructor(e,n,i,a){super("powerSoc-chart",e,n),this.service=e,this.translate=n,this.route=i,this.websocket=a}ngOnChanges(){this.updateChart()}ngOnInit(){this.service.startSpinner(this.spinnerId)}ngOnDestroy(){this.unsubscribeChartRefresh()}getChartHeight(){return on.getChartHeight(this.service.isSmartphoneResolution)}setLabel(){this.options=this.createDefaultChartOptions();let e=this.translate;this.options.plugins={tooltip:{callbacks:{label:function(n){let i=n.dataset.label,a=n.dataset.data[n.dataIndex];return on.getLabel(a,i,e)}}}}}getChannelAddresses(){return new Promise(()=>{})}updateChart(){this.autoSubscribeChartRefresh(),this.service.startSpinner(this.spinnerId),this.loading=!0,this.edge.sendRequest(this.websocket,new Ci({componentId:this.component.id,payload:new Ul})).then(e=>{let i=e.result.schedule,a=[],{gridBuyArray:m,gridSellArray:u,productionArray:C,consumptionArray:v,managedConsumptionArray:T,labels:A}={gridBuyArray:i.map(b=>Je.ValueConverter.NEGATIVE_AS_ZERO(b.grid),1e3),gridSellArray:i.map(b=>Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE(b.grid),1e3),productionArray:i.map(b=>b.production,1e3),consumptionArray:i.map(b=>b.consumption,1e3),managedConsumptionArray:i.map(b=>b.managedConsumption,1e3),labels:i.map(b=>new Date(b.timestamp))};a.push({type:"line",label:this.translate.instant("GENERAL.GRID_BUY"),data:m.map(b=>M.divideSafely(b,1e3)),hidden:!0,order:1}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.BLUE_GREY,.2),borderColor:U.Colors.BLUE_GREY}),a.push({type:"line",label:this.translate.instant("GENERAL.GRID_SELL"),data:u.map(b=>M.divideSafely(b,1e3)),hidden:!0,order:1}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.PURPLE,.2),borderColor:U.Colors.PURPLE}),a.push({type:"line",label:this.translate.instant("GENERAL.PRODUCTION"),data:C.map(b=>M.divideSafely(b,1e3)),hidden:!1,order:1}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.BLUE,.2),borderColor:U.Colors.BLUE}),a.push({type:"line",label:"Consumption",data:v.map(b=>M.divideSafely(b,1e3)),hidden:!0,order:1}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.YELLOW,.2),borderColor:U.Colors.YELLOW}),a.push({type:"line",label:"Managed Consumption",data:T.map(b=>M.divideSafely(b,1e3)),hidden:!1,order:1}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.YELLOW,.2),borderColor:U.Colors.ORANGE}),this.datasets=a,this.loading=!1,this.labels=A,this.setLabel(),this.stopSpinner()}).catch(e=>{console.error(e),this.initializeChart()}).finally(()=>ae(this,null,function*(){yield this.setOptions(this.options),this.applyControllerSpecificOptions()}))}applyControllerSpecificOptions(){let e={position:"left",unit:Z.POWER,yAxisId:B.LEFT};this.options=de.getYAxisOptions(this.options,e,this.translate,"line",U.EMPTY_DATASETS,!0),this.options.scales.x.ticks={source:"auto",autoSkip:!1},this.options.scales.x.ticks.color=getComputedStyle(document.documentElement).getPropertyValue("--ion-color-chart-xAxis-ticks"),this.options.scales.x.ticks.callback=function(n,i,a){let m=new Date(n);return m.getMinutes()===0?m.getHours()+":00":""},this.options.scales[B.LEFT].suggestedMin=0,this.options.scales[B.LEFT].suggestedMax=1}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(te),x(De),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["powerChart"]],inputs:{refresh:"refresh",edge:"edge",component:"component"},standalone:!1,features:[S,En],decls:4,vars:5,consts:[[3,"response"],["id","chart-area",1,"semi-transparent-background"],[3,"name"],["baseChart","","type","line",3,"datasets","labels","options"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),s(1,"div",1),d(2,"ngx-spinner",2),f(3,q2,1,3,"canvas",3),l()),n&2&&(c("response",i.errorResponse),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:3))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function Q2(t,o){if(t&1&&(s(0,"oe-navigation-view",0),d(1,"scheduleChart",1)(2,"powerChart",1),l()),t&2){let e=p();c("title",e.component.alias)("component",e.component),r(),c("refresh",e.refreshChart)("component",e.component)("edge",e.edge),r(),c("refresh",e.refreshChart)("component",e.component)("edge",e.edge)}}var Ih=(()=>{class t extends Wt{constructor(e,n,i,a,m,u,C){super(e,n,i,a,m,u,C),this.websocket=e,this.route=n,this.service=i,this.modalController=a,this.translate=m,this.formBuilder=u,this.ref=C}updateComponent(e){return ae(this,null,function*(){return new Promise(n=>{this.route.params.pipe(vt(i=>i!=null),pn(1)).subscribe(i=>{this.component=e.getComponent(i.componentId),n()})})})}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(De),x(j),x(he),x(te),x(Ft),x(ln))}}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-evse-forecast"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title","component"],[1,"ion-padding",3,"refresh","component","edge"]],template:function(n,i){n&1&&f(0,Q2,3,8,"oe-navigation-view",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[li,yh,Th],styles:[".ion-justify-with-space-between[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%] > ion-col[_ngcontent-%COMP%]:nth-child(2){text-align:right}form[_ngcontent-%COMP%]{align-content:center!important}"]})}}return t})();function Z2(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function J2(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var xh=(()=>{class t extends de{static getChartData(e,n){return Lt.assertIsDefined(e),{input:[{name:"ActivePower",powerChannel:new y(e.id,"ActivePower"),converter:Je.ValueConverter.NON_NULL_OR_NEGATIVE}],output:i=>[{name:n.instant("GENERAL.POWER"),converter:()=>i.ActivePower,color:U.Colors.YELLOW}],tooltip:{formatNumber:U.NumberFormat.ZERO_TO_TWO},yAxes:[{unit:Z.ENERGY,position:"left",yAxisId:B.LEFT}]}}getChartData(){let e=this.config.getComponentFromOtherComponentsProperty(this.component.id,"chargePoint.id")??null;return t.getChartData(e,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-evse-history-chart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,Z2,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,J2,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function tA(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function nA(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var Sh=(()=>{class t extends de{static getChartData(e,n,i){return Lt.assertIsDefined(e),{input:[{name:"ActualMode",powerChannel:new y(e.id,"ActualMode")},...i==null?[]:[{name:"QuarterlyPrice",powerChannel:new y(i.id,"QuarterlyPrice")}]],output:a=>[{name:n.instant("EVSE_SINGLE.HOME.MODE.ZERO"),converter:()=>this.getDataset(a,0),color:U.Colors.BLUE_GREY},{name:n.instant("EVSE_SINGLE.HOME.MODE.MINIMUM"),converter:()=>this.getDataset(a,1),color:U.Colors.GREEN},{name:n.instant("EVSE_SINGLE.HOME.MODE.SURPLUS"),converter:()=>this.getDataset(a,2),color:U.Colors.BLUE},{name:n.instant("EVSE_SINGLE.HOME.MODE.FORCE"),converter:()=>this.getDataset(a,3),color:U.Colors.RED}],tooltip:{formatNumber:U.NumberFormat.ZERO_TO_TWO},yAxes:[{unit:Z.CURRENCY,position:"left",yAxisId:B.LEFT}]}}static getDataset(e,n){let i=e.QuarterlyPrice.map(C=>on.formatPrice(M.multiplySafely(C,1e3)));console.log(e,n);let a=e.ActualMode.map(C=>M.multiplySafely(C,1e3)).map(C=>C===null?null:C<.5?0:C<1.5?1:C>2.5?3:2),m=i.length,u=Array(m).fill(null);for(let C=0;C<m;C++){let v=i[C],T=a[C];T!==null&&T===n&&(u[C]=v)}return u}beforeSetChartLabel(){this.chartType="bar"}getChartData(){let e=this.config.getComponentsByFactory("Controller.Ess.Time-Of-Use-Tariff")?.[0]??null;return t.getChartData(this.component,this.translate,e)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-evse-history-status-chart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,tA,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,nA,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();var oA=[[["","custom-pickdate",""]]],rA=["[custom-pickdate]"],aA=()=>["day","week"];function sA(t,o){t&1&&d(0,"pickdate",3),t&2&&c("historyPeriods",H(1,aA))}function lA(t,o){if(t&1&&d(0,"oe-controller-evse-history-status-chart",5),t&2){let e=p(2);c("component",e.component)}}function cA(t,o){if(t&1&&(s(0,"oe-navigation-view",1)(1,"ion-buttons",2)(2,"div",null,0),ys(4),l(),f(5,sA,1,2,"pickdate",3),l(),d(6,"oe-controller-evse-history-chart",4),f(7,lA,1,1,"oe-controller-evse-history-status-chart",5),l()),t&2){let e=it(3),n=p();c("title",n.component.alias)("component",n.component)("formGroup",n.formGroup),r(5),_(e.children.length?-1:5),r(),c("component",n.component),r(),_(n.showStatusChart?7:-1)}}var Ah=(()=>{class t extends Wt{constructor(e,n,i,a,m,u,C,v){super(e,n,i,a,m,u,C),this.websocket=e,this.route=n,this.service=i,this.modalController=a,this.translate=m,this.formBuilder=u,this.ref=C,this.navigationService=v,this.showNewFooter=!0,this.showStatusChart=!1,this.label=null,this.meterId=null}updateComponent(e){return ae(this,null,function*(){return new Promise(n=>{this.route.params.pipe(vt(i=>i!=null),pn(1)).subscribe(i=>{this.component=e.getComponent(i.componentId),this.meterId=this.config.getComponentFromOtherComponentsProperty(this.component.id,"chargePoint.id")?.id??null;let a=this.config.getComponentsByFactory("Controller.Ess.Time-Of-Use-Tariff")?.[0]??null;this.showStatusChart=a!==null,n()})})})}getFormGroup(){return Lt.assertIsDefined(this.component),this.formBuilder.group({mode:new K(this.component.properties.mode)})}hideFooter(){this.showNewFooter=!this.showNewFooter}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(De),x(j),x(he),x(te),x(Ft),x(ln),x(fn))}}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-evse-history"]],standalone:!1,features:[S],ngContentSelectors:rA,decls:1,vars:1,consts:[["ref",""],[3,"title","component","formGroup"],["header","",1,"ion-justify-content-center"],[3,"historyPeriods"],[1,"ion-padding",3,"component"],[1,"ion-padding","ion-padding-bottom",3,"component"]],template:function(n,i){n&1&&(vs(oA),f(0,cA,8,6,"oe-navigation-view",1)),n&2&&_(i.isInitialized?0:-1)},dependencies:[li,In,Ke,Xe,ot,xh,Sh],styles:[`form{align-content:center!important}
`],encapsulation:2})}}return t})();var mA=()=>({color:"primary",name:"close-circle-outline"}),pA=(t,o)=>({name:t,value:"ZERO",icon:o}),dA=()=>({color:"primary",name:"sunny-outline"}),uA=(t,o)=>({name:t,value:"SURPLUS",icon:o}),fA=()=>({color:"primary",name:"rocket-outline"}),_A=(t,o)=>({name:t,value:"FORCE",icon:o}),hA=(t,o,e)=>[t,o,e];function CA(t,o){if(t&1&&(d(0,"oe-modal-line",8),g(1,"translate")),t&2){let e=p(3);c("name",E(1,3,"EVSE_SINGLE.HOME.POWER"))("converter",e.Converter.POWER_IN_WATT)("channelAddress",e.chargePoint.id+"/ActivePower")}}function gA(t,o){if(t&1&&(s(0,"ion-col",3),d(1,"oe-modal-line",8),g(2,"translate"),d(3,"oe-modal-line",8),g(4,"translate"),f(5,CA,2,5,"oe-modal-line",8),d(6,"oe-modal-line",8),g(7,"translate"),l()),t&2){let e=p(2);r(),c("name",E(2,10,"EVSE_SINGLE.HOME.MODE.LABEL"))("converter",e.CONVERT_TO_MODE_LABEL)("channelAddress",e.component.id+"/_PropertyMode"),r(2),c("name",E(4,12,"EVSE_SINGLE.HOME.STATE_MACHINE.LABEL"))("converter",e.CONVERT_TO_STATE_MACHINE_LABEL)("channelAddress",e.component.id+"/StateMachine"),r(2),_(e.chargePoint?5:-1),r(),c("name",E(7,14,"EVSE_SINGLE.HOME.ENERGY_SINCE_START"))("converter",e.Converter.TO_WATT_HOURS)("channelAddress",e.component.id+"/SessionEnergy")}}function EA(t,o){if(t&1&&(s(0,"oe-navigation-view",0)(1,"ion-grid",1)(2,"ion-row",2)(3,"ion-col",3),d(4,"oe-img",4),l(),f(5,gA,8,16,"ion-col",3),l(),s(6,"ion-row",5)(7,"ion-col",6),d(8,"oe-modal-buttons",7),g(9,"translate"),g(10,"translate"),g(11,"translate"),l()()()()),t&2){let e=p();c("title",e.component.alias)("component",e.component)("formGroup",e.formGroup),r(4),c("img",e.img),r(),_(e.imgDidLoad?-1:5),r(3),c("formGroup",e.formGroup)("component",e.component)("buttons",_i(26,hA,at(15,pA,E(9,8,"EVSE_SINGLE.HOME.MODE.ZERO"),H(14,mA)),at(19,uA,E(10,10,"EVSE_SINGLE.HOME.MODE.SURPLUS"),H(18,dA)),at(23,_A,E(11,12,"EVSE_SINGLE.HOME.MODE.FORCE"),H(22,fA))))}}var bm=(()=>{class t extends Wt{constructor(e,n,i,a,m,u,C){super(e,n,i,a,m,u,C),this.websocket=e,this.route=n,this.service=i,this.modalController=a,this.translate=m,this.formBuilder=u,this.ref=C,this.showNewFooter=!0,this.label=null,this.chargePoint=null,this.img=null,this.CONVERT_TO_MODE_LABEL=cr.CONVERT_TO_MODE_LABEL(this.translate),this.CONVERT_TO_STATE_MACHINE_LABEL=cr.CONVERT_TO_STATE_MACHINE_LABEL(this.translate)}updateComponent(e){return ae(this,null,function*(){return new Promise(n=>{this.route.params.pipe(vt(i=>i!=null),pn(1)).subscribe(i=>{this.component=e.getComponent(i.componentId),this.chargePoint=e.getComponentFromOtherComponentsProperty(this.component.id,"chargePoint.id")??null,n()})})})}onIsInitialized(){let e=cr.getImgUrlByFactoryId(this.chargePoint.factoryId);this.img=e===null?null:{url:e,height:300,width:300}}getFormGroup(){return Lt.assertIsDefined(this.component),this.formBuilder.group({mode:new K(this.component.properties.mode)})}hideFooter(){this.showNewFooter=!this.showNewFooter}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(De),x(j),x(he),x(te),x(Ft),x(ln))}}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-evse-single-home"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title","component","formGroup"],[1,"ion-no-padding"],[1,"ion-justify-content-center","ion-align-items-center","ion-padding"],["size-md","4","size-xs","9"],[3,"img"],[1,"ion-justify-content-center","ion-no-padding"],["size-md","6","size-xs","12",1,"ion-no-padding"],["controlName","mode",1,"oe-modal-buttons-text-size",3,"formGroup","component","buttons"],[3,"name","converter","channelAddress"]],template:function(n,i){n&1&&f(0,EA,12,30,"oe-navigation-view",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[li,Nn,Vt,Hs,Ke,Ae,Me,Se,ot,V],styles:[".oe-modal-buttons-text-size[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{white-space:pre-wrap;font-size:x-small!important}"]})}}return t})();function vA(t,o){}function yA(t,o){if(t&1&&(s(0,"ion-item",3)(1,"ion-label")(2,"ion-text",4)(3,"p"),d(4,"formly-validation-message",5),l()()()()),t&2){let e=p();r(4),c("field",e.field)}}var TA=(()=>{class t extends Bt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-wrapper-ion-form-field"]],standalone:!1,features:[S],decls:4,vars:2,consts:[["fieldComponent",""],[3,"lines"],["lines","none",4,"ngIf"],["lines","none"],["color","danger"],[3,"field"]],template:function(n,i){n&1&&(s(0,"ion-item",1),G(1,vA,0,0,"ng-template",null,0,yt),l(),G(3,yA,5,1,"ion-item",2)),n&2&&(c("lines",i.props.itemLines),r(3),c("ngIf",i.showError))},dependencies:[yn,J,ne,He,Xi],encapsulation:2})}}return t})();function wh(){return{wrappers:[{name:"form-field",component:TA}]}}var mi=(()=>{class t extends ud{constructor(e,n,i){super(e,n,i)}static{this.\u0275fac=function(n){return new(n||t)(x(gs),x(fo),x(Cs))}}static{this.\u0275dir=Wi({type:t,selectors:[["","ionFormlyAttributes",""]],hostBindings:function(n,i){n&1&&O("ionFocus",function(m){return i.onFocus(m)})("ionBlur",function(m){return i.onBlur(m)})("ionChange",function(m){return i.onChange(m)})("ionInput",function(m){return i.onChange(m)})},inputs:{field:[0,"ionFormlyAttributes","field"]},standalone:!1,features:[S]})}}return t})(),Pn=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,st,Ve,rn.forChild(wh())]})}}return t})();function IA(t,o){if(t&1&&d(0,"ion-input",2),t&2){let e=p();c("type",e.props.type||"text")("label",e.props.label)("labelPlacement",e.props.labelPosition)("formControl",e.formControl)("ionFormlyAttributes",e.field)}}function xA(t,o){if(t&1&&d(0,"ion-input",3),t&2){let e=p();c("label",e.props.label)("formControl",e.formControl)("ionFormlyAttributes",e.field)}}var SA=(()=>{class t extends mt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-ion-input"]],standalone:!1,features:[S],decls:3,vars:2,consts:[["numberTmp",""],[3,"type","label","labelPlacement","formControl","ionFormlyAttributes",4,"ngIf","ngIfElse"],[3,"type","label","labelPlacement","formControl","ionFormlyAttributes"],["type","number",3,"label","formControl","ionFormlyAttributes"]],template:function(n,i){if(n&1&&G(0,IA,1,5,"ion-input",1)(1,xA,1,3,"ng-template",null,0,yt),n&2){let a=it(2);c("ngIf",i.props.type!=="number")("ngIfElse",a)}},dependencies:[yn,Ie,Mt,nn,tn,Bn,mi],styles:["[_nghost-%COMP%]{display:inherit}"],changeDetection:0})}}return t})();function bh(){return{types:[{name:"input",component:SA,wrappers:["form-field"]},{name:"string",extends:"input"},{name:"number",extends:"input",defaultOptions:{props:{type:"number"}}},{name:"integer",extends:"input",defaultOptions:{props:{type:"number"}}}]}}var Dh=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,st,Ve,Pn,rn.forChild(bh())]})}}return t})();var AA=(()=>{class t extends mt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-ion-textarea"]],standalone:!1,features:[S],decls:1,vars:6,consts:[[3,"formControl","ionFormlyAttributes","cols","rows","label","labelPlacement"]],template:function(n,i){n&1&&d(0,"ion-textarea",0),n&2&&c("formControl",i.formControl)("ionFormlyAttributes",i.field)("cols",i.props.cols)("rows",i.props.rows)("label",i.props.label)("labelPlacement",i.props.labelPosition)},dependencies:[Ie,Mt,ld,Bn,mi],styles:["[_nghost-%COMP%]{display:inherit}"],changeDetection:0})}}return t})();function Rh(){return{types:[{name:"textarea",component:AA,wrappers:["form-field"]}]}}var Oh=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,st,Ve,Pn,rn.forChild(Rh())]})}}return t})();var wA=(()=>{class t{transform(e,n){return e instanceof ba?this.dispose():e=this.observableOf(e,n),e.pipe(Xr(i=>this.transformOptions(i,n)))}ngOnDestroy(){this.dispose()}transformOptions(e,n){let i=this.transformSelectProps(n),a=[],m={};return e?.forEach(u=>{let C=this.transformOption(u,i);if(C.group){let v=m[C.label];v===void 0?m[C.label]=a.push(C)-1:C.group.forEach(T=>a[v].group.push(T))}else a.push(C)}),a}transformOption(e,n){let i=n.groupProp(e);return Array.isArray(i)?{label:n.labelProp(e),group:i.map(a=>this.transformOption(a,n))}:(e={label:n.labelProp(e),value:n.valueProp(e),disabled:!!n.disabledProp(e)},i?{label:i,group:[e]}:e)}transformSelectProps(e){let n=e?.props||e?.templateOptions||{},i=a=>typeof a=="function"?a:m=>m[a];return{groupProp:i(n.groupProp||"group"),labelProp:i(n.labelProp||"label"),valueProp:i(n.valueProp||"value"),disabledProp:i(n.disabledProp||"disabled")}}dispose(){this._options&&(this._options.complete(),this._options=null),this._subscription&&(this._subscription.unsubscribe(),this._subscription=null)}observableOf(e,n){return this.dispose(),n&&n.options&&n.options.fieldChanges&&(this._subscription=n.options.fieldChanges.pipe(vt(({property:i,type:a,field:m})=>a==="expressionChanges"&&(i.indexOf("templateOptions.options")===0||i.indexOf("props.options")===0)&&m===n&&Array.isArray(m.props.options)&&!!this._options),gp(()=>this._options.next(n.props.options))).subscribe()),this._options=new $r(e),this._options.asObservable()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=ui({name:"formlySelectOptions",type:t,pure:!0})}}return t})(),zl=(()=>{class t extends wA{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275pipe=ui({name:"formlySelectOptions",type:t,pure:!0,standalone:!1})}}return t})(),jl=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({})}}return t})();function bA(t,o){if(t&1&&(s(0,"ion-item",2)(1,"ion-radio",3),h(2),l()()),t&2){let e=o.$implicit,n=p();c("disabled",e.disabled||n.formControl.disabled),r(),c("value",e.value),r(),R(" ",e.label," ")}}var DA=(()=>{class t extends mt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-ion-radio"]],standalone:!1,features:[S],decls:7,vars:9,consts:[[3,"formControl","ionFormlyAttributes"],[3,"disabled",4,"ngFor","ngForOf"],[3,"disabled"],[3,"value"]],template:function(n,i){n&1&&(s(0,"ion-list")(1,"ion-list-header"),h(2),l(),s(3,"ion-radio-group",0),G(4,bA,3,3,"ion-item",1),g(5,"formlySelectOptions"),g(6,"async"),l()()),n&2&&(r(2),N(i.props.label),r(),c("formControl",i.formControl)("ionFormlyAttributes",i.field),r(),c("ngForOf",E(6,7,q(5,4,i.props.options,i.field))))},dependencies:[Hn,Ie,Mt,J,zn,nd,Eo,vo,$e,mi,lt,zl],styles:["[_nghost-%COMP%]{display:inherit}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{flex:1}"],changeDetection:0})}}return t})();function Mh(){return{types:[{name:"radio",component:DA,wrappers:["form-field"]}]}}var Fh=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,st,Ve,Pn,jl,rn.forChild(Mh())]})}}return t})();var RA=(()=>{class t extends mt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-ion-checkbox"]],standalone:!1,features:[S],decls:2,vars:3,consts:[[3,"formControl","ionFormlyAttributes"]],template:function(n,i){n&1&&(s(0,"ion-checkbox",0),h(1),l()),n&2&&(c("formControl",i.formControl)("ionFormlyAttributes",i.field),r(),R(" ",i.props.label," "))},dependencies:[Ie,Mt,zt,ft,mi],styles:["[_nghost-%COMP%]{display:inherit}"],changeDetection:0})}}return t})();function Gh(){return{types:[{name:"checkbox",component:RA,wrappers:["form-field"]},{name:"boolean",extends:"checkbox"}]}}var Ph=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,st,Ve,Pn,rn.forChild(Gh())]})}}return t})();function OA(t,o){if(t&1&&(s(0,"ion-select-option",3),h(1),l()),t&2){let e=o.$implicit;c("value",e.value)("disabled",e.disabled),r(),R(" ",e.label," ")}}function NA(t,o){if(t&1&&(Y(0),s(1,"ion-select",1),G(2,OA,2,3,"ion-select-option",2),l(),z()),t&2){let e=o.$implicit,n=p();r(),re("align-self",n.props.labelPosition==="floating"?"stretch":"")("max-width",n.props.labelPosition==="floating"?100:"","%"),c("formControl",n.formControl)("compareWith",n.props.compareWith)("ionFormlyAttributes",n.field)("multiple",n.props.multiple)("interface",n.props.interface)("okText",n.props.okText)("cancelText",n.props.cancelText)("label",n.props.label)("labelPlacement",n.props.labelPosition),r(),c("ngForOf",e)}}var MA=(()=>{class t extends mt{constructor(){super(...arguments),this.defaultOptions={props:{compareWith(e,n){return e===n}}}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-ion-select"]],standalone:!1,features:[S],decls:3,vars:6,consts:[[4,"ngIf"],[3,"formControl","compareWith","ionFormlyAttributes","multiple","interface","okText","cancelText","label","labelPlacement"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"]],template:function(n,i){n&1&&(G(0,NA,3,14,"ng-container",0),g(1,"formlySelectOptions"),g(2,"async")),n&2&&c("ngIf",E(2,4,q(1,1,i.props.options,i.field)))},dependencies:[Hn,yn,Ie,Mt,jn,Yn,$e,mi,lt,zl],styles:["[_nghost-%COMP%]{display:inherit}"],changeDetection:0})}}return t})();function Lh(){return{types:[{name:"select",component:MA,wrappers:["form-field"]},{name:"enum",extends:"select"}]}}var kh=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,st,Ve,Pn,jl,rn.forChild(Lh())]})}}return t})();var FA=(()=>{class t extends mt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-ion-toggle"]],standalone:!1,features:[S],decls:2,vars:3,consts:[[3,"formControl","ionFormlyAttributes"]],template:function(n,i){n&1&&(s(0,"ion-toggle",0),h(1),l()),n&2&&(c("formControl",i.formControl)("ionFormlyAttributes",i.field),r(),R(" ",i.props.label," "))},dependencies:[Ie,Mt,wi,ft,mi],styles:["[_nghost-%COMP%]{display:inherit}"],changeDetection:0})}}return t})();function GA(){return{types:[{name:"toggle",component:FA,wrappers:["form-field"]}]}}var Vh=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,st,Ve,Pn,rn.forChild(GA())]})}}return t})();var PA=(()=>{class t extends mt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-ion-range"]],standalone:!1,features:[S],decls:5,vars:8,consts:[[3,"min","max","formControl","ionFormlyAttributes","label","labelPlacement"],["slot","start"],["slot","end"]],template:function(n,i){n&1&&(s(0,"ion-range",0)(1,"ion-label",1),h(2),l(),s(3,"ion-label",2),h(4),l()()),n&2&&(c("min",i.props.min)("max",i.props.max)("formControl",i.formControl)("ionFormlyAttributes",i.field)("label",i.props.label)("labelPlacement",i.props.labelPosition),r(2),N(i.props.min),r(2),N(i.props.max))},dependencies:[Ie,Mt,ne,Ai,tn,mi],styles:["[_nghost-%COMP%]{display:inherit}"],changeDetection:0})}}return t})();function LA(){return{types:[{name:"slider",component:PA,wrappers:["form-field"]},{name:"range",extends:"slider"}]}}var Hh=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,st,Ve,Pn,rn.forChild(LA())]})}}return t})();function kA(t,o){if(t&1){let e=W();s(0,"ion-datetime",2)(1,"ion-buttons",3)(2,"ion-button",4),O("click",function(){P(e);let i=p();return L(i.reset())}),h(3),l(),s(4,"ion-button",4),O("click",function(){P(e);let i=p();return L(i.confirm())}),h(5),l()()()}if(t&2){let e=p();c("locale",e.props.locale)("presentation",e.props.presentation)("cancelText",e.props.cancelText)("dayValues",e.props.dayValues)("doneText",e.props.doneText)("hourValues",e.props.hourValues)("minuteValues",e.props.minuteValues)("monthValues",e.props.monthValues)("yearValues",e.props.yearValues)("min",e.props.minDate?e.props.minDate:e.props.min)("max",e.props.maxDate?e.props.maxDate:e.props.max)("formControl",e.formControl)("ionFormlyAttributes",e.field),r(3),N(e.props.cancelText||"Cancel"),r(2),N(e.props.doneText||"Done")}}var VA=(()=>{class t extends mt{constructor(){super(...arguments),this.isOpen=!1,this.defaultOptions={props:{presentation:"month-year"}}}displayFormat(){if(this.props.displayFormat)return this.props.displayFormat;switch(this.props.presentation){case"date-time":case"time-date":return"short";case"time":return"shortTime";case"month":return"MMMM";case"month-year":return"MMMM, y";case"year":return"y";case"date":return"mediumDate"}}confirm(){this.datetime?.confirm(),this.close()}reset(){this.datetime?.reset(),this.close()}close(){this.isOpen=!1,this.formControl.markAsTouched()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-ion-datetime"]],viewQuery:function(n,i){if(n&1&&wn(zi,5),n&2){let a;bn(a=Dn())&&(i.datetime=a.first)}},standalone:!1,features:[S],decls:6,vars:8,consts:[[3,"click","button","detail"],[3,"didDismiss","isOpen","cssClass"],[3,"locale","presentation","cancelText","dayValues","doneText","hourValues","minuteValues","monthValues","yearValues","min","max","formControl","ionFormlyAttributes"],["slot","buttons"],[3,"click"]],template:function(n,i){n&1&&(s(0,"ion-item",0),O("click",function(){return i.isOpen=!0}),s(1,"ion-label"),h(2),g(3,"date"),l()(),s(4,"ion-modal",1),O("didDismiss",function(){return i.close()}),G(5,kA,6,15,"ng-template"),l()),n&2&&(c("button",!0)("detail",!1),r(2),R(" ",i.formControl.value?q(3,5,i.formControl.value,i.displayFormat()):i.props.placeholder," "),r(2),c("isOpen",i.isOpen)("cssClass","ion-datetime-modal ion-datetime-modal-"+i.props.presentation))},dependencies:[Ie,Mt,Ge,Xe,zi,J,ne,cd,$e,mi,$o],styles:[`.ion-datetime-modal{--width: 310px;--border-radius: 8px}.ion-datetime-modal.ion-datetime-modal-time-date{--height: 440px}.ion-datetime-modal.ion-datetime-modal-date{--height: 390px}.ion-datetime-modal.ion-datetime-modal-time{--height: 260px}formly-field-ion-datetime{display:inherit}formly-field-ion-datetime ion-item{flex:1}
`],encapsulation:2,changeDetection:0})}}return t})();function HA(){return{types:[{name:"datetime",component:VA,wrappers:["form-field"]}]}}var Bh=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,st,Ve,Pn,rn.forChild(HA())]})}}return t})();var Wh=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Pn,Dh,Oh,Fh,Ph,kh,Vh,Hh,Bh,Pn]})}}return t})();function BA(t,o){if(t&1&&(s(0,"ion-content",3),h(1),l()),t&2){let e=p();r(),R(" ",e.helpMsg," ")}}var dr=(()=>{class t{constructor(){this.helpMsg=null,this.didPopoverDismiss=new qr,this.uuid=la()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=I({type:t,selectors:[["oe-help-popover-button"]],inputs:{helpMsg:"helpMsg"},outputs:{didPopoverDismiss:"didPopoverDismiss"},decls:4,vars:2,consts:[["lines","none","fill","clear",3,"id"],["name","information-circle-outline","size","small","color","medium"],["side","bottom","alignment","center",3,"didDismiss","trigger"],["text-nowrap","",1,"ion-padding"]],template:function(n,i){n&1&&(s(0,"ion-button",0),d(1,"ion-icon",1),l(),s(2,"ion-popover",2),O("didDismiss",function(){return i.didPopoverDismiss.emit()}),G(3,BA,2,1,"ng-template"),l()),n&2&&(c("id",i.uuid),r(2),c("trigger",i.uuid))},dependencies:[Ve,Ge,je,ie,Yi],encapsulation:2})}}return t})();var UA=(t,o)=>o.value;function zA(t,o){if(t&1){let e=W();s(0,"ion-item",8)(1,"ion-toggle",9),O("keydown.enter",function(){P(e);let i=p().$implicit,a=p(4);return L(a.changeEditMode(i.key,(a.form==null?null:a.form.controls[i.key])??null))})("ionChange",function(){P(e);let i=p().$implicit,a=p(4);return L(a.changeEditMode(i.key,null))}),l()()}if(t&2){let e=p().$implicit;r(),c("formControlName",e.key)}}function jA(t,o){if(t&1&&f(0,zA,2,1,"ion-item",8),t&2){let e,n=o.$implicit;_((e=n.type)==="toggle"?0:-1)}}function YA(t,o){if(t&1&&(s(0,"ion-select-option",12),h(1),l()),t&2){let e=o.$implicit;c("value",e.value),r(),R(" ",e.label," ")}}function $A(t,o){if(t&1&&(s(0,"ion-col")(1,"ion-item",8)(2,"ion-select",11),fe(3,YA,2,2,"ion-select-option",12,UA),l()()()),t&2){let e=p().$implicit,n=p(4);r(2),fi("disabled",n.to.disabled),c("formControlName",e.key)("label",e.name),r(),_e(e.props.options)}}function XA(t,o){if(t&1&&(s(0,"ion-col",10)(1,"ion-row")(2,"ion-col")(3,"ion-item",8)(4,"ion-checkbox",13),h(5),l(),d(6,"oe-help-popover-button",14),l()()()()),t&2){let e=p().$implicit,n=p(4);c("ngClass",(n.nestedGroup==null||n.nestedGroup.controls[e.props.disabledOnFormControl]==null?null:n.nestedGroup.controls[e.props.disabledOnFormControl].value)===!1?"ion-disabled":""),r(4),c("formControlName",e.key)("formlyAttributes",e),r(),R(" ",e.name," "),r(),c("helpMsg",e.props.help)}}function qA(t,o){if(t&1&&f(0,$A,5,4,"ion-col")(1,XA,7,5,"ion-col",10),t&2){let e,n=o.$implicit;_((e=n.type)==="radio-buttons"?0:e==="checkbox"?1:-1)}}function KA(t,o){if(t&1&&(s(0,"ion-row",3)(1,"ion-col",4),d(2,"ion-icon",5),l(),s(3,"ion-col")(4,"ion-row",6)(5,"ion-col")(6,"ion-item",7),h(7),l()(),s(8,"ion-col"),fe(9,jA,1,1,null,null,Kr),l()(),s(11,"ion-row",6),fe(12,qA,2,1,null,null,Kr),l()()()),t&2){let e=p(),n=e.$implicit,i=e.$index;re("background",i%2!==0?"var(--ion-background-color-card-header)":""),r(2),c("name",n.props==null?null:n.props.icon.name)("color",n.props==null?null:n.props.icon.color)("size",n.props==null?null:n.props.icon.size),r(5),R(" ",n.props==null?null:n.props.title," "),r(2),_e(n.fieldGroup),r(3),_e(n.fieldGroup)}}function QA(t,o){if(t&1&&f(0,KA,14,6,"ion-row",2),t&2){let e=o.$implicit;_(e!=null&&e.props?0:-1)}}function ZA(t,o){if(t&1){let e=W();s(0,"ion-grid",0)(1,"form",1),O("ngSubmit",function(){P(e);let i=p();return L(i.onSubmit())}),fe(2,QA,1,1,null,null,xe),l()()}if(t&2){let e=p();r(),c("formGroup",e.form),r(),_e(e.props.options)}}var Uh=(()=>{class t extends Bt{ngOnInit(){let e=this.props.options.map(i=>i.fieldGroup).flat(1),n=Vi.filterFieldPropsWithKey(e,"disabledOnFormControl");if(n)for(let i of n){let a=i.props.disabledOnFormControl,m=Vi.findFormControlsValueSafely(this.form,a);this.updateToggleDependentFields(i.key,m)}}changeEditMode(e,n){n!==null&&(this.form.get(e).setValue(!n.value),this.form.get(e).markAsDirty());let i=Vi.findFormControlsValueSafely(this.form,e),m=this.props.options.map(u=>u.fieldGroup?.map(C=>C)).flat(1).filter(u=>u.props?.disabledOnFormControl==e)?.map(u=>u.key)??[];for(let u of m)this.updateToggleDependentFields(u,i)}updateToggleDependentFields(e,n){n?this.form.get(e).enable():this.form.get(e).disable()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-current-user-alerting"]],features:[S],decls:1,vars:1,consts:[[1,"ion-no-padding"],[3,"ngSubmit","formGroup"],[1,"ion-align-self-start",3,"background"],[1,"ion-align-self-start"],["size","auto",1,"ion-padding","ion-align-self-center"],["size","large","item-left","",1,"ion-margin-start",3,"name","color","size"],[1,"ion-no-padding","ion-align-items-center"],["lines","none",1,"ion-full-width","ion-background-transparent"],["lines","none",1,"ion-background-transparent"],["tabindex","0","label-placement","start","slot","end",3,"keydown.enter","ionChange","formControlName"],["size-md","5","size-lg","5","size-sm","5","size-xs","11",1,"ion-align-self-center","ion-no-padding","ion-no-padding-top",3,"ngClass"],["interface","popover","label-placement","floating","justify","start",1,"custom-ion-popover","ion-background-transparent",3,"formControlName","label"],["labelPlacement","end","justify","start",1,"ion-full-width",3,"value"],["slot","start","labelPlacement","end","justify","start",1,"ion-font-size-smaller",2,"margin-right","5%",3,"formControlName","formlyAttributes"],[3,"helpMsg"]],template:function(n,i){n&1&&f(0,ZA,4,1,"ion-grid",0),n&2&&_(i.props.options?0:-1)},dependencies:[Ve,zt,Ae,Me,ie,J,Se,jn,Yn,wi,ft,$e,Et,Si,Mo,cn,Ie,Ke,st,ot,en,dr,Sr,rn,$i],styles:["ion-accordion.ng-invalid[_ngcontent-%COMP%]{border-bottom-style:solid;border-bottom-color:var(--ion-color-danger);--highlight-color-focused: var(--ion-color-danger);--border-color: var(--ion-color-danger)}ion-item[_ngcontent-%COMP%]   ion-checkbox.ng-invalid[_ngcontent-%COMP%]{border-bottom-style:solid;border-bottom-color:var(--ion-color-danger);--highlight-color-focused: var(--ion-color-danger);--border-color: var(--ion-color-danger)}"]})}}return t})();var JA=(t,o)=>o.key,ew=(t,o)=>o.value;function tw(t,o){if(t&1&&(s(0,"ion-col",8),d(1,"ion-icon",12),l()),t&2){let e=p().$implicit;r(),c("name",e.props==null?null:e.props.icon.name)("color",e.props==null?null:e.props.icon.color)("size",e.props==null?null:e.props.icon.size)}}function nw(t,o){if(t&1){let e=W();s(0,"ion-item",11)(1,"ion-toggle",13),O("keydown.enter",function(){P(e);let i=p().$implicit,a=p().$implicit,m=p(2);return L(m.changeEditMode(a.key,i.key,!0))})("ionChange",function(){P(e);let i=p().$implicit,a=p().$implicit,m=p(2);return L(m.changeEditMode(a.key,i.key,null))}),l()()}if(t&2){let e=p().$implicit;r(),c("formControlName",e.key)}}function iw(t,o){if(t&1&&(s(0,"ion-select-option",16),h(1),l()),t&2){let e=o.$implicit;c("value",e.value),r(),R(" ",e.label," ")}}function ow(t,o){if(t&1&&(s(0,"ion-col")(1,"ion-item",11)(2,"ion-select",15),fe(3,iw,2,2,"ion-select-option",16,ew),l()()()),t&2){let e=p().$implicit;r(2),c("formControlName",e.key)("label",e.name),r(),_e(e.props.options)}}function rw(t,o){if(t&1){let e=W();s(0,"ion-col",14)(1,"ion-row")(2,"ion-col")(3,"ion-item",11)(4,"ion-checkbox",17),O("ionChange",function(){P(e);let i=p(3).$implicit,a=p(2);return L(a.checkValidity(i.key))}),h(5),l(),d(6,"oe-help-popover-button",18),l()()()()}if(t&2){let e=p().$implicit,n=p(4);c("ngClass",(n.nestedGroup==null||n.nestedGroup.controls[e.props.disabledOnFormControl]==null?null:n.nestedGroup.controls[e.props.disabledOnFormControl].value)===!1?"ion-disabled":""),r(4),re("pointer-events",(n.nestedGroup==null||n.nestedGroup.controls[e.props.disabledOnFormControl]==null?null:n.nestedGroup.controls[e.props.disabledOnFormControl].value)===!1?"none":"inherit"),c("formControlName",e.key),r(),R(" ",e.name," "),r(),c("helpMsg",e.props.help)}}function aw(t,o){if(t&1&&f(0,ow,5,2,"ion-col")(1,rw,7,6,"ion-col",14),t&2){let e,n=o.$implicit;_((e=n.type)==="radio-buttons"?0:e==="checkbox"?1:-1)}}function sw(t,o){if(t&1&&(s(0,"ion-row",7),f(1,tw,2,3,"ion-col",8),s(2,"ion-col")(3,"ion-row",9)(4,"ion-col")(5,"ion-item",10),h(6),l()(),s(7,"ion-col"),f(8,nw,2,1,"ion-item",11),l()(),s(9,"ion-row",9),fe(10,aw,2,1,null,null,Kr),l()()()),t&2){let e,n=o.$implicit,i=o.$index,a=p().$index;re("background",a%2===0&&i%2===0||a%2!==0&&i%2!==0?"var(--ion-background-color-card-header)":""),r(),_(n.props.icon?1:-1),r(5),R(" ",n.name," "),r(2),_((e=n.type)==="toggle"?8:-1),r(2),_e(n.fieldGroup)}}function lw(t,o){if(t&1&&(s(0,"ion-row",2)(1,"ion-accordion",3)(2,"ion-item",4)(3,"ion-label"),h(4),l()(),s(5,"div",5),fe(6,sw,12,5,"ion-row",6,JA),l()()()),t&2){let e=o.$implicit,n=o.$index,i=p(2);c("formGroupName",e.key),r(),Qr(i.mailCheckBoxChecked.get(e.key)===!1?"ng-invalid":"ng-valid"),c("value",e.key),r(),c("color",n%2===0?"var(--ion-background-color-card-header)":"light"),r(2),N(e.key),r(2),_e(e.fieldGroup)}}function cw(t,o){if(t&1&&(s(0,"form",0)(1,"ion-accordion-group",1),fe(2,lw,8,6,"ion-row",2,Kr),l()()),t&2){let e=p();c("formGroup",e.form),r(),c("multiple",!0),r(),_e(e.props.options)}}var zh=(()=>{class t extends Bt{constructor(){super(...arguments),this.mailCheckBoxChecked=new Map}ngOnInit(){let e=this.props.options??[];for(let n of e)for(let i of n.fieldGroup??[]){let a=Vi.filterFieldPropsWithKey(i.fieldGroup,"disabledOnFormControl");for(let m of a){let u=m.props.disabledOnFormControl,C=this.form.controls[n.key]?.controls[u]?.value??!1;this.updateToggleDependentFields(n.key,m.key,C)}}}changeEditMode(e,n,i){let a=Vi.findFormControlSafely(this.form,e),m=Vi.findFormControlsValueSafely(a,n),u=i===!0?!m:m;i===!0&&(a.get(n).setValue(u),a.get(n).markAsDirty()),this.checkValidity(e);let v=this.props.options.find(T=>T.key==e).fieldGroup.map(T=>T.fieldGroup).flat(1).filter(T=>T.props?.disabledOnFormControl==n)?.map(T=>T.key)??[];for(let T of v)this.updateToggleDependentFields(e,T,u)}checkValidity(e){let n=Vi.findFormControlSafely(this.form,e);this.mailCheckBoxChecked.set(e,nu.isFormValid(n))}updateToggleDependentFields(e,n,i){let a=this.form.controls[e];i?a.controls[n].enable():a.controls[n].disable()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-other-users-alerting"]],features:[S],decls:1,vars:1,consts:[[3,"formGroup"],[3,"multiple"],[1,"ion-justify-content-center",3,"formGroupName"],[3,"value"],["slot","header","lines","none",3,"color"],["slot","content",1,"ion-no-padding"],[1,"ion-align-self-start","ion-no-padding",3,"background"],[1,"ion-align-self-start","ion-no-padding"],["size","auto",1,"ion-padding","ion-align-self-center"],[1,"ion-no-padding","ion-align-items-center"],["lines","none",1,"ion-full-width","ion-background-transparent"],["lines","none",1,"ion-background-transparent"],["size","large","item-left","",1,"ion-margin-start",3,"name","color","size"],["tabindex","0","label-placement","start","slot","end",3,"keydown.enter","ionChange","formControlName"],["size-md","5","size-lg","5","size-sm","5","size-xs","11",1,"ion-align-self-center","ion-no-padding","ion-no-padding-top",3,"ngClass"],["interface","popover","label-placement","floating","justify","start",1,"custom-ion-popover","ion-background-transparent",3,"formControlName","label"],["labelPlacement","end","justify","start",1,"ion-full-width",3,"value"],["slot","start","justify","start","labelPlacement","end",1,"ion-font-size-smaller",2,"margin-right","5%",3,"ionChange","formControlName"],[3,"helpMsg"]],template:function(n,i){n&1&&f(0,cw,4,2,"form",0),n&2&&_(i.props.options?0:-1)},dependencies:[Ve,Yp,$p,zt,Ae,ie,J,ne,Se,jn,Yn,wi,ft,$e,Et,Si,Mo,cn,Ie,Ke,st,ot,en,As,dr],styles:[`ion-accordion.ng-invalid{border-bottom-style:solid;border-bottom-color:var(--ion-color-danger);--highlight-color-focused: var(--ion-color-danger);--border-color: var(--ion-color-danger)}ion-item ion-checkbox.ng-invalid{border-bottom-style:solid;border-bottom-color:var(--ion-color-danger);--highlight-color-focused: var(--ion-color-danger);--border-color: var(--ion-color-danger)}
`],encapsulation:2})}}return t})();function mw(t,o){if(t&1&&d(0,"oe-modal-line",0)(1,"oe-modal-meter-phases",1),t&2){let e=p();c("name",e.component.alias??e.component.id)("channelAddress",e.component.id+"/ActivePower")("converter",e.Utils.CONVERT_TO_WATT),r(),c("component",e.component)}}var jh=(()=>{class t extends qd{constructor(){super(...arguments),this.Role=Rt,this.Utils=M,this.TextIndentation=ro,this.phases=[{key:"L1",name:"",power:null,current:null,voltage:null},{key:"L2",name:"",power:null,current:null,voltage:null},{key:"L3",name:"",power:null,current:null,voltage:null}]}getChannelAddresses(){let e=[];for(let n of[1,2,3])e.push(new y(this.component.id,"CurrentL"+n),new y(this.component.id,"VoltageL"+n),new y(this.component.id,"ActivePowerL"+n));return e}onCurrentData(e){this.phases.forEach(n=>{let i=e.allComponents[this.component.id+"/ActivePower"+n.key];n.name="Phase "+n.key,n.power=M.absSafely(i),n.current=e.allComponents[this.component.id+"/Current"+n.key],n.voltage=e.allComponents[this.component.id+"/Voltage"+n.key]})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-electricity-meter"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"name","channelAddress","converter"],[3,"component"]],template:function(n,i){n&1&&f(0,mw,2,4),n&2&&_(i.component?0:-1)},dependencies:[Vt,eu],encapsulation:2})}}return t})();function uw(t,o){if(t&1&&(s(0,"oe-modal-line",0),d(1,"oe-modal-line-item",1)(2,"oe-modal-line-item",1)(3,"oe-modal-line-item",2),l()),t&2){let e=p();c("name",e.component.alias??e.component.id),r(),c("channelAddress",e.component.id+"/Voltage")("roleIsAtLeast",e.Role.INSTALLER)("converter",e.Converter.VOLTAGE_IN_MILLIVOLT_TO_VOLT),r(),c("channelAddress",e.component.id+"/Current")("roleIsAtLeast",e.Role.INSTALLER)("converter",e.Converter.CURRENT_IN_MILLIAMPERE_TO_AMPERE),r(),c("channelAddress",e.component.id+"/ActualPower")("converter",e.Utils.CONVERT_TO_WATT)}}var Yh=(()=>{class t{constructor(){this.Role=Rt,this.Utils=M,this.Converter=Be}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=I({type:t,selectors:[["oe-ess-charger"]],inputs:{component:"component"},standalone:!1,decls:1,vars:1,consts:[[3,"name"],[3,"channelAddress","roleIsAtLeast","converter"],[3,"channelAddress","converter"]],template:function(n,i){n&1&&f(0,uw,4,9,"oe-modal-line",0),n&2&&_(i.component?0:-1)},dependencies:[Vt,Ma],encapsulation:2})}}return t})();var Dm=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,Ve,Na,an,Et,gi.forRoot({type:"ball-clip-rotate-multiple"}),_n,nr]})}}return t})();var $h=(()=>{class t extends Bt{ngOnInit(){this.formControl.value||this.formControl.setValue(this.field.props.defaultValue),this.field.props.required?this.secondLabel=this.field.props.description+"*":this.secondLabel=this.field.props.description}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["form-field-checkbox-hyperlink"]],standalone:!1,features:[S],decls:11,vars:6,consts:[[1,"ion-no-padding"],["lines","none"],[2,"white-space","pre-wrap"],["target","_blank",1,"underline",3,"href"],["lines","none",1,"custom-checkbox"],["color","primary","slot","end",3,"formControl","value","required"]],template:function(n,i){n&1&&(s(0,"ion-grid",0)(1,"ion-row")(2,"ion-col")(3,"ion-item",1)(4,"ion-label",2)(5,"a",3),h(6),l(),h(7),l()()(),s(8,"ion-col")(9,"ion-item",4),d(10,"ion-checkbox",5),l()()()()),n&2&&(r(5),c("href",i.props.url,No),r(),N(i.props.label),r(),R("\xA0",i.secondLabel," "),r(3),c("formControl",i.formControl)("value",i.props.value)("required",i.props.required))},dependencies:[Ie,Up,zt,Ae,Me,J,ne,Se,ft,Mt],encapsulation:2,changeDetection:0})}}return t})();var Xh=(()=>{class t extends Bt{constructor(){super(...arguments),this.casesToSubscribe=[]}ngOnInit(){this.getOptions().forEach(e=>{this.form.valueChanges.subscribe(a=>{let m=[],u=this.casesToSubscribe;this.casesToSubscribe=[],u.forEach((C,v)=>{let T=this.form.get(C.field);T&&(this.subscribe(e,T),m.push(v))}),u.forEach((C,v)=>{m.some(T=>T===v)||this.casesToSubscribe.push(C)})});let n=this.form.get(e.field);if(n?this.subscribe(e,n):this.casesToSubscribe.push(e),this.formControl.value)return;let i=this.model[e.field];i&&this.onChange(e,i)})}subscribe(e,n){n.valueChanges.subscribe(i=>{if(this.onChange(e,i))return;let a=this.getOptions();for(let m of a){let u=this.form.getRawValue()[m.field];if(u){for(let C of m.cases)if(C.case==u){this.formControl.setValue(C.defaultValue);return}}}}),this.onChange(e,this.form.getRawValue()[e.field])}getOptions(){return this.props.defaultValueOptions??[]}onChange(e,n){let i=e.cases.find(a=>a.case==n);return i?(i.defaultValue===n||this.formControl.setValue(i.defaultValue),!0):!1}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-wrapper-default-of-cases"]],standalone:!1,features:[S],decls:2,vars:0,consts:[["fieldComponent",""]],template:function(n,i){n&1&&_o(0,null,0)},encapsulation:2})}}return t})();function _w(t,o){if(t&1&&(s(0,"ion-row")(1,"ion-col")(2,"ion-item",3)(3,"ion-label",1),h(4),l()()()()),t&2){let e=p(2);r(2),fi("disabled",e.props.disabled),r(2),N(e.props.description)}}function hw(t,o){if(t&1&&(s(0,"ion-row",2)(1,"ion-col"),d(2,"ion-icon",4),l(),s(3,"ion-col",5)(4,"div"),h(5),l()()()),t&2){let e=p(2);r(5),R(" ",e.props.attributes==null?null:e.props.attributes.infoLine," ")}}function Cw(t,o){if(t&1&&(f(0,_w,5,3,"ion-row"),f(1,hw,6,1,"ion-row",2)),t&2){let e=p();_(e.props.description?0:-1),r(),_(e.props.attributes!=null&&e.props.attributes.infoLine?1:-1)}}function gw(t,o){if(t&1&&(s(0,"ion-row",7)(1,"ion-col")(2,"ion-item",3),d(3,"ion-text",9),l()()()),t&2){let e=p(2).$implicit;r(3),c("innerHtml",e.description,Vn)}}function Ew(t,o){if(t&1&&(s(0,"ion-row",8)(1,"ion-item",10),d(2,"img",11),l()()),t&2){let e=o.$implicit;r(2),c("src",e,No)}}function vw(t,o){if(t&1&&(f(0,gw,4,1,"ion-row",7),fe(1,Ew,3,1,"ion-row",8,xe)),t&2){let e=p().$implicit;_(e.description?0:-1),r(),_e(e.url)}}function yw(t,o){if(t&1){let e=W();s(0,"ion-row",0)(1,"ion-col")(2,"ion-item",3)(3,"ion-label",1),h(4),l(),s(5,"ion-checkbox",6),O("ionChange",function(i){let a=P(e).$index,m=p();return L(m.onCheckboxChange(i,a))}),l()()()(),f(6,vw,3,1)}if(t&2){let e=o.$implicit,n=o.$index,i=p();r(4),N(e.label),r(),c("checked",i.formControl.value[n])("disabled",i.props.disabled),r(),_(i.showContent(n)?6:-1)}}var qh=(()=>{class t extends mt{get steps(){return this.props.steps||[]}ngOnInit(){let e=this.formControl.value;Array.isArray(e)||this.formControl.setValue(Array(this.steps.length).fill(!1))}onCheckboxChange(e,n){let i=this.formControl.value;i[n]=e.detail.checked,this.formControl.setValue(i)}showContent(e){return!this.field.props?.disabled&&!this.formControl.value[e]}isAllTrue(){return this.formControl.value.lastIndexOf(!1)===-1}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["form-field-multi-step"]],standalone:!1,features:[S],decls:10,vars:4,consts:[[1,"ion-no-padding"],[2,"white-space","pre-wrap"],[1,"ion-padding",2,"align-items","center","line-height","1.4"],["lines","none"],["color","primary","name","information-outline","size","small"],["size","11"],["slot","end",3,"ionChange","checked","disabled"],[1,"ion-padding-bottom"],[1,"ion-justify-content-center"],[2,"white-space","pre-line",3,"innerHtml"],["lines","none",1,"ion-padding-bottom"],[1,"center",3,"src"]],template:function(n,i){n&1&&(s(0,"ion-grid",0)(1,"ion-card")(2,"ion-row")(3,"ion-col")(4,"ion-item")(5,"ion-label",1),h(6),l()()()(),f(7,Cw,2,2),fe(8,yw,7,4,null,null,xe),l()()),n&2&&(r(4),fi("disabled",i.props.disabled),r(2),N(i.props.label),r(),_(i.isAllTrue()?-1:7),r(),_e(i.steps))},dependencies:[Ht,zt,Ae,Me,ie,J,ne,Se,He,ft],encapsulation:2})}}return t})();function Tw(t,o){}function Iw(t,o){if(t&1&&(s(0,"ion-item",2)(1,"ion-label")(2,"ion-text",3)(3,"p"),d(4,"formly-validation-message",4),l()()()()),t&2){let e=p();r(4),c("field",e.field)}}var Kh=(()=>{class t extends Bt{get itemLines(){return this.props.description?"none":"inset"}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-wrapper-ion-form-field"]],standalone:!1,features:[S],decls:4,vars:3,consts:[["fieldComponent",""],[3,"lines","disabled"],["lines","none"],["color","danger"],[3,"field"]],template:function(n,i){n&1&&(s(0,"ion-item",1),G(1,Tw,0,0,"ng-template",null,0,yt),l(),f(3,Iw,5,1,"ion-item",2)),n&2&&(c("lines",i.itemLines)("disabled",i.props.readonly),r(3),_(i.showError?3:-1))},dependencies:[Xi,J,ne,He],styles:[`formly-field-ion-toggle,formly-field-ion-checkbox,formly-custom-select,formly-input-serial-number{width:100%}formly-field-ion-toggle ion-toggle{padding:0!important;margin:0!important;transform:none!important}ion-toggle::part(label),ion-checkbox::part(label),ion-radio::part(label){white-space:pre-wrap!important;flex:1;margin-inline-end:0!important}
`],encapsulation:2,changeDetection:0})}}return t})();function xw(t,o){if(t&1){let e=W();s(0,"ion-button",4),O("click",function(){P(e);let i=p();return L(i.onButtonClick())}),h(1),d(2,"ion-icon",5),l()}if(t&2){let e=p();c("disabled",!e.formControl.value),r(),R(" ",e.props.buttonText," ")}}var Qh=(()=>{class t extends mt{onCheckboxChange(e){this.formControl.setValue(e.detail.checked)}onButtonClick(){this.props.onButtonClick&&this.props.onButtonClick()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-checkbox-button"]],standalone:!1,features:[S],decls:5,vars:3,consts:[["lines","none",1,"ion-no-padding","custom-item"],["slot","start","labelPlacement","end",3,"ionChange","checked"],[1,"checkbox-label"],["size","small",1,"ion-text-wrap","button-with-icon",3,"disabled"],["size","small",1,"ion-text-wrap","button-with-icon",3,"click","disabled"],["name","open-outline","slot","start"]],template:function(n,i){n&1&&(s(0,"ion-item",0)(1,"ion-checkbox",1),O("ionChange",function(m){return i.onCheckboxChange(m)}),l(),s(2,"span",2),h(3),l(),f(4,xw,3,2,"ion-button",3),l()),n&2&&(r(),c("checked",i.formControl.value),r(2),N(i.to.label),r(),_(i.props.buttonAvailable?4:-1))},dependencies:[Ge,zt,ie,J,ft],styles:[".custom-item[_ngcontent-%COMP%]{padding-top:50px;display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.button-with-icon[_ngcontent-%COMP%]{padding-left:5%;font-size:small}.checkbox-label[_ngcontent-%COMP%]{margin-left:8px;font-size:1rem;text-align:left}@media (max-width: 768px){.custom-item[_ngcontent-%COMP%]{padding-top:20px;flex-direction:row;justify-content:space-between;gap:.5rem}.button-with-icon[_ngcontent-%COMP%]{text-align:center}.checkbox-label[_ngcontent-%COMP%]{margin-left:8px;text-align:left}}"],changeDetection:0})}}return t})();var Sw=t=>({"disabled-sub-field":t});function Aw(t,o){t&1&&(s(0,"span"),h(1,"*"),l())}function ww(t,o){if(t&1&&(s(0,"ion-content",15),h(1),l()),t&2){let e=p(4);r(),N(e.props.serialNumberField.helpText)}}function bw(t,o){t&1&&(d(0,"ion-icon",13),s(1,"ion-popover",14),G(2,ww,2,1,"ng-template"),l()),t&2&&(r(),c("dismissOnSelect",!0))}function Dw(t,o){if(t&1&&(s(0,"span",11),h(1),l()),t&2){let e=p(3);r(),N(e.props.serialNumberField.prefix)}}function Rw(t,o){if(t&1){let e=W();s(0,"ion-row",8)(1,"ion-col")(2,"ion-item",4)(3,"ion-label"),h(4),f(5,Aw,2,0,"span"),f(6,bw,3,1),l()()(),s(7,"ion-col")(8,"ion-item",10),f(9,Dw,2,1,"span",11),s(10,"ion-input",12),O("ionFocus",function(){P(e);let i=p(2);return L(i.isSerialNumberFocused=!0)})("ionBlur",function(){P(e);let i=p(2);return L(i.isSerialNumberFocused=!1)}),l()()()()}if(t&2){let e=p(2);c("ngClass",be(8,Sw,e.serialNumberFormControl==null?null:e.serialNumberFormControl.disabled)),r(4),R(" ",e.props.serialNumberField.label," "),r(),_(e.props.serialNumberField.required?5:-1),r(),_(e.props.serialNumberField.helpText?6:-1),r(2),c("ngStyle",e.borderColor),r(),_(e.props.serialNumberField.prefix?9:-1),r(),c("formControl",e.serialNumberFormControl)("placeholder",e.props.serialNumberField.placeholder)}}function Ow(t,o){if(t&1&&(s(0,"ion-item",9)(1,"ion-text",16),d(2,"formly-validation-message",17),l()()),t&2){let e=p(2);r(2),c("field",e.field)}}function Nw(t,o){if(t&1){let e=W();Y(0,1),s(1,"ion-row",2)(2,"ion-col",3)(3,"ion-item",4),d(4,"img",5),l()(),s(5,"ion-col")(6,"ion-row")(7,"ion-col")(8,"ion-item",4)(9,"ion-checkbox",6),O("ionChange",function(i){P(e);let a=p();return L(a.updateFormControl(i))}),s(10,"span",7),h(11),l()()()()(),f(12,Rw,11,10,"ion-row",8),s(13,"ion-row")(14,"ion-col"),f(15,Ow,3,1,"ion-item",9),l()()()(),z()}if(t&2){let e=p();r(4),c("src",e.props.url,No),r(5),c("checked",e.value)("value",e.props.value)("disabled",e.props.disabled),r(2),N(e.props.label),r(),_(e.props.serialNumberField?12:-1),r(3),_(e.formControl.hasError("serialNumberRequired")?15:-1)}}function Mw(t,o){if(t&1&&(s(0,"ion-row")(1,"ion-col")(2,"ion-item",20),d(3,"ion-text",21),l()()()),t&2){let e=p(2);r(2),fi("disabled",e.props.disabled),r(),c("innerHTML",e.props.description,Vn)}}function Fw(t,o){if(t&1&&(s(0,"ion-row",19)(1,"ion-item",4),d(2,"img",22),l()()),t&2){let e=p(2);r(2),c("src",e.props.url,No)}}function Gw(t,o){if(t&1){let e=W();s(0,"ion-card")(1,"ion-row")(2,"ion-col")(3,"ion-item")(4,"ion-checkbox",18),O("ionChange",function(i){P(e);let a=p();return L(a.updateFormControl(i))}),s(5,"span",7),h(6),l()()()()(),f(7,Mw,4,3,"ion-row"),f(8,Fw,3,1,"ion-row",19),l()}if(t&2){let e=p();r(4),c("checked",e.value)("value",e.props.value)("disabled",e.props.disabled),r(2),N(e.props.label),r(),_(e.props.description&&e.showContent()?7:-1),r(),_(e.showContent()?8:-1)}}var Zh=(()=>{class t extends Bt{constructor(){super(...arguments),this.serialNumberFormControl=new K,this.isSerialNumberFocused=!1,this.destroy=new qt}get borderColor(){let e="var(--ion-color-dark)";if(this.value===!0){let n=this.model[this.props?.serialNumberField?.key]??null;n!=null&&n!==""?e="var(--highlight-color-valid)":this.serialNumberFormControl.touched?e="var(--highlight-color-invalid)":this.isSerialNumberFocused&&(e="var(--highlight-color-focused)")}return{"border-color":e}}ngOnInit(){this.value=this.formControl.value??this.field.defaultValue,this.formControl.statusChanges.pipe(An(this.destroy)).subscribe(e=>{e==="DISABLED"&&this.value!==!1&&(this.value=!1,this.formControl.setValue(this.value))}),"serialNumberField"in this.props&&this.initializeSerialNumberField()}ngOnDestroy(){this.destroy.next(),this.destroy.complete()}updateFormControl(e){this.value=e.detail.checked,this.formControl.setValue(this.value)}showContent(){return!this.field.props?.disabled&&!this.value&&this.field.props?.url!==void 0}initializeSerialNumberField(){let n=this.props.serialNumberField.key;if(n==null||n===""){console.error("The 'serialNumberField' property must have a 'key' to bind to the model.",this.field);return}this.serialNumberFormControl=new K,this.serialNumberFormControl.setValue(this.model[n],{emitEvent:!1}),this.serialNumberFormControl.valueChanges.pipe(An(this.destroy)).subscribe(i=>{this.model[n]=i,this.formControl.updateValueAndValidity()}),this.formControl.valueChanges.pipe(An(this.destroy)).subscribe(i=>{i?this.serialNumberFormControl.enable({emitEvent:!1}):(this.serialNumberFormControl.disable({emitEvent:!1}),this.serialNumberFormControl.reset(void 0,{emitEvent:!1}))}),this.formControl.value===!0?this.serialNumberFormControl.enable():this.serialNumberFormControl.disable()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-checkbox-with-image"]],standalone:!1,features:[S],decls:3,vars:1,consts:[[1,"ion-no-padding"],[1,"ion-padding-bottom"],[1,"ion-align-items-center"],["size","auto"],["lines","none"],[1,"center-image",3,"src"],[3,"ionChange","checked","value","disabled"],[2,"white-space","pre-wrap"],[1,"ion-padding-top",3,"ngClass"],["lines","none",1,"ion-no-padding"],["lines","none",1,"ion-no-padding","input-box",3,"ngStyle"],[1,"ion-padding-start"],[3,"ionFocus","ionBlur","formControl","placeholder"],["name","help-circle","id","sn-help-icon",1,"help-icon"],["trigger","sn-help-icon","triggerAction","hover","size","auto",3,"dismissOnSelect"],[1,"ion-padding"],["color","danger",1,"ion-font-size-smaller"],[3,"field"],["justify","space-between",3,"ionChange","checked","value","disabled"],[1,"ion-justify-content-center","ion-padding-top"],["lines","none",1,"ion-padding-top"],[2,"white-space","pre-line",3,"innerHTML"],[1,"center",3,"src"]],template:function(n,i){n&1&&(s(0,"ion-grid",0),f(1,Nw,16,7,"ng-container",1)(2,Gw,9,6,"ion-card"),l()),n&2&&(r(),_(i.props.imagePositionToLeft?1:2))},dependencies:[Si,Yo,Xi,Ie,Ht,zt,Ae,je,Me,ie,nn,J,ne,Se,He,Yi,ft,Bn,Mt],styles:[".center-image[_ngcontent-%COMP%]{display:block;margin-left:auto;margin-right:auto;max-width:10rem;height:auto}.input-box[_ngcontent-%COMP%]{border:.1em solid var(--ion-color-dark);border-radius:.125rem;width:100%;padding-left:.5rem;--min-height: auto;--border-color: var(--ion-color-medium);transition:border-color .3s}.disabled-sub-field[_ngcontent-%COMP%]{pointer-events:none;opacity:.5}.help-icon[_ngcontent-%COMP%]{vertical-align:middle;font-size:1.1em;margin-left:.25rem;color:var(--ion-color-medium-shade);cursor:help}"],changeDetection:0})}}return t})();function Pw(t,o){if(t&1&&d(0,"oe-modal-line",11),t&2){let e=p().$implicit;c("filter",e.filter)("textIndent",e.indentation??"0%")("name",e.name)("channelAddress",e.channel)("converter",e.converter)}}function Lw(t,o){if(t&1&&(Y(0),d(1,"oe-modal-line-item",13),z()),t&2){let e=o.$implicit;r(),c("channelAddress",e.channel)("filter",e.filter)("converter",e.converter)}}function kw(t,o){if(t&1&&(s(0,"oe-modal-line",12),G(1,Lw,2,3,"ng-container",3),l()),t&2){let e=p().$implicit;c("filter",e.filter)("textIndent",e.indentation??"0%")("name",e.name),r(),c("ngForOf",e.children)}}function Vw(t,o){if(t&1&&d(0,"oe-modal-info-line",14),t&2){let e=p().$implicit;c("info",e.name)}}function Hw(t,o){t&1&&d(0,"oe-modal-horizontal-line")}function Bw(t,o){if(t&1&&d(0,"oe-modal-value-line",15),t&2){let e=p().$implicit;c("channelsToSubscribe",e.channelsToSubscribe)("textIndent",e.indentation??"0%")("valueCallback",e.value)("filters",e.filter??null)("name",e.name)}}function Ww(t,o){if(t&1&&d(0,"oe-modal-buttons",17),t&2){let e=p(2).$implicit,n=p(3);c("formGroup",n.form)("controlName",e.controlName)("component",n.component)("buttons",e.buttons)("channelAddress",(e.channel==null?null:e.channel.toString())??null)}}function Uw(t,o){if(t&1&&(Y(0),G(1,Ww,1,5,"oe-modal-buttons",16),z()),t&2){let e=p().$implicit,n=p(3);r(),c("ngIf",n.form.controls[e.controlName]!==null)}}function zw(t,o){if(t&1){let e=W();s(0,"ion-fab",18)(1,"ion-fab-button",19),O("click",function(){P(e);let i=p(4);return L(i.onSubmit())}),d(2,"ion-icon",20),l()()}if(t&2){let e=p(4);c("horizontal",e.service.isSmartphoneResolution?"end":"center")}}function jw(t,o){if(t&1&&(Y(0)(1,4),G(2,Pw,1,5,"oe-modal-line",5)(3,kw,2,4,"oe-modal-line",6)(4,Vw,1,1,"oe-modal-info-line",7)(5,Hw,1,0,"oe-modal-horizontal-line",8)(6,Bw,1,5,"oe-modal-value-line",9)(7,Uw,2,1,"ng-container",8)(8,zw,3,1,"ion-fab",10),z()()),t&2){let e=o.$implicit,n=p(3);r(),c("ngSwitch",e.type),r(),c("ngSwitchCase","channel-line"),r(),c("ngSwitchCase","children-line"),r(),c("ngSwitchCase","info-line"),r(),c("ngSwitchCase","horizontal-line"),r(),c("ngSwitchCase","value-from-channels-line"),r(),c("ngSwitchCase","buttons-from-form-control-line"),r(),c("ngIf",n.form==null?null:n.form.dirty)}}function Yw(t,o){if(t&1&&(Y(0),G(1,jw,9,8,"ng-container",3),z()),t&2){let e=o.$implicit;r(),c("ngForOf",e.lines)}}function $w(t,o){if(t&1&&(s(0,"oe-modal",1),d(1,"ngx-spinner",2),G(2,Yw,2,1,"ng-container",3),l()),t&2){let e=p();c("title",e.props.attributes.title),r(2),c("ngForOf",e.props.options)}}var Rm=(()=>{class t extends Bt{constructor(e){super(),this.service=e}onSubmit(){this.field.props.onSubmit(this.form)}static{this.\u0275fac=function(n){return new(n||t)(x(j))}}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-modal"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["name","formly-field-modal"],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"filter","textIndent","name","channelAddress","converter",4,"ngSwitchCase"],[3,"filter","textIndent","name",4,"ngSwitchCase"],[3,"info",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"channelsToSubscribe","textIndent","valueCallback","filters","name",4,"ngSwitchCase"],["vertical","bottom","style","position: fixed",3,"horizontal",4,"ngIf"],[3,"filter","textIndent","name","channelAddress","converter"],[3,"filter","textIndent","name"],[3,"channelAddress","filter","converter"],[3,"info"],[3,"channelsToSubscribe","textIndent","valueCallback","filters","name"],[3,"formGroup","controlName","component","buttons","channelAddress",4,"ngIf"],[3,"formGroup","controlName","component","buttons","channelAddress"],["vertical","bottom",2,"position","fixed",3,"horizontal"],[3,"click"],["size","large","name","checkmark-circle-outline"]],template:function(n,i){n&1&&G(0,$w,3,2,"oe-modal",0),n&2&&c("ngIf",i.props)},encapsulation:2})}}return t})();var Xw=t=>({type:"TEXT",valueConverter:t}),qw=t=>({type:"RANGE",properties:t});function Kw(t,o){if(t&1&&d(0,"oe-modal-line",3),t&2){let e=p().$implicit;c("filter",e.filter)("textIndent",e.indentation??"0%")("name",e.name)("channelAddress",e.channel)("converter",e.converter)}}function Qw(t,o){if(t&1&&d(0,"oe-modal-line-item",9),t&2){let e=o.$implicit;c("channelAddress",e.channel)("filter",e.filter)("converter",e.converter)}}function Zw(t,o){if(t&1&&(s(0,"oe-modal-line",4),fe(1,Qw,1,3,"oe-modal-line-item",9,xe),l()),t&2){let e=p().$implicit;c("filter",e.filter)("textIndent",e.indentation??"0%")("name",e.name),r(),_e(e.children)}}function Jw(t,o){if(t&1&&d(0,"oe-modal-info-line",5),t&2){let e=p().$implicit;c("info",e.name)}}function eb(t,o){t&1&&d(0,"oe-modal-horizontal-line")}function tb(t,o){if(t&1&&d(0,"oe-modal-value-line",6),t&2){let e=p().$implicit;c("channelsToSubscribe",e.channelsToSubscribe)("textIndent",e.indentation??"0%")("valueCallback",e.value)("filters",e.filter??null)("name",e.name)}}function nb(t,o){if(t&1&&d(0,"oe-modal-line",7),t&2){let e=p().$implicit,n=p(3);c("controlName",e.controlName)("formGroup",n.form)("name",e.name)("control",be(4,Xw,e.converter))}}function ib(t,o){if(t&1&&d(0,"oe-modal-buttons",10),t&2){let e=p(2).$implicit,n=p(3);c("formGroup",n.form)("controlName",e.controlName)("component",n.component)("buttons",e.buttons)("channelAddress",(e.channel==null?null:e.channel.toString())??null)}}function ob(t,o){if(t&1&&f(0,ib,1,5,"oe-modal-buttons",10),t&2){let e=p().$implicit,n=p(3);_(n.form.controls[e.controlName]!==null?0:-1)}}function rb(t,o){if(t&1&&d(0,"oe-modal-line",8),t&2){let e=p().$implicit,n=p(3);c("controlName",e.controlName)("control",be(3,qw,e.properties))("formGroup",n.form)}}function ab(t,o){if(t&1&&f(0,Kw,1,5,"oe-modal-line",3)(1,Zw,3,3,"oe-modal-line",4)(2,Jw,1,1,"oe-modal-info-line",5)(3,eb,1,0,"oe-modal-horizontal-line")(4,tb,1,5,"oe-modal-value-line",6)(5,nb,1,6,"oe-modal-line",7)(6,ob,1,1)(7,rb,1,5,"oe-modal-line",8),t&2){let e,n=o.$implicit;_((e=n.type)==="channel-line"?0:e==="children-line"?1:e==="info-line"?2:e==="horizontal-line"?3:e==="value-from-channels-line"?4:e==="value-from-form-control-line"?5:e==="buttons-from-form-control-line"?6:e==="range-button-from-form-control-line"?7:-1)}}function sb(t,o){if(t&1&&fe(0,ab,8,1,null,null,xe),t&2){let e=o.$implicit;_e(e.lines)}}function lb(t,o){if(t&1){let e=W();s(0,"oe-navigation-view",1),O("emitForm",function(i){P(e);let a=p();return L(a.setForm(i))}),d(1,"ngx-spinner",2),fe(2,sb,2,0,null,null,xe),l()}if(t&2){let e=p();c("formGroup",e.form)("component",e.props.options[0].component),r(2),_e(e.props.options)}}var Om=(()=>{class t extends Bt{constructor(e){super(),this.service=e}onSubmit(){this.field.props.onSubmit(this.form)}static{this.\u0275fac=function(n){return new(n||t)(x(j))}}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-navigation"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"formGroup","component"],[3,"emitForm","formGroup","component"],["name","formly-field-modal"],[3,"filter","textIndent","name","channelAddress","converter"],[3,"filter","textIndent","name"],[3,"info"],[3,"channelsToSubscribe","textIndent","valueCallback","filters","name"],[3,"controlName","formGroup","name","control"],[3,"controlName","control","formGroup"],[3,"channelAddress","filter","converter"],[3,"formGroup","controlName","component","buttons","channelAddress"]],template:function(n,i){n&1&&f(0,lb,4,2,"oe-navigation-view",0),n&2&&_(i.props&&i.props.options[0].component?0:-1)},encapsulation:2})}}return t})();function cb(t,o){if(t&1&&(s(0,"ion-item")(1,"ion-label"),h(2),l()()),t&2){let e=p();r(2),N(e.props.label)}}function mb(t,o){if(t&1&&(Y(0),s(1,"ion-card")(2,"ion-row")(3,"ion-col")(4,"ion-item")(5,"ion-label"),h(6),l(),d(7,"ion-radio",3),l()()(),s(8,"ion-row",4)(9,"ion-col")(10,"ion-list",5)(11,"ion-item"),d(12,"ion-img",6),l()()()()(),z()),t&2){let e=o.$implicit;r(6),N(e.label),r(),c("value",e.value),r(5),c("src",e.url)}}var Jh=(()=>{class t extends Bt{constructor(){super(...arguments),this.some=[]}ngOnInit(){this.some=this.props.options,this.value=this.field.defaultValue,this.formControl.getRawValue()&&(this.value=this.formControl.getRawValue())}updateFormControl(){this.formControl.setValue(this.value)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-field-radio-with-image"]],standalone:!1,features:[S],decls:3,vars:3,consts:[[3,"ngModelChange","ionChange","ngModel"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end",3,"value"],[1,"ion-justify-content-center"],["lines","none"],[3,"src"]],template:function(n,i){n&1&&(s(0,"ion-radio-group",0),Zt("ngModelChange",function(m){return Qt(i.value,m)||(i.value=m),m}),O("ionChange",function(){return i.updateFormControl()}),G(1,cb,3,1,"ion-item",1)(2,mb,13,3,"ng-container",2),l()),n&2&&(Kt("ngModel",i.value),r(),c("ngIf",i.props.label),r(),c("ngForOf",i.props.options))},dependencies:[Hn,yn,Ie,Tn,Ht,Ae,Qp,J,ne,zn,Eo,vo,Se,$e],encapsulation:2,changeDetection:0})}}return t})();function pb(t,o){if(t&1&&(s(0,"p",0),h(1),l()),t&2){let e=p();r(),R(" ",e.props.note," ")}}function db(t,o){if(t&1&&(s(0,"p",4),h(1),l()),t&2){let e=p();r(),R(" ",e.to.description," ")}}function ub(t,o){if(t&1&&(s(0,"p"),h(1),g(2,"translate"),l()),t&2){let e=p(2);r(),R(" ",e.props.required?e.props.label+" "+E(2,1,"GENERAL.FORMLY.REQUIRED"):""," ")}}function fb(t,o){if(t&1&&(s(0,"ion-text",5),f(1,ub,3,3,"p"),l()),t&2){let e=p();r(),_(e.formControl.errors!=null&&e.formControl.errors.required?1:-1)}}var eC=(()=>{class t extends mt{constructor(){super(...arguments),this.boundPinFormatter=this.pinFormatter.bind(this)}onChange(e){this.props.change&&this.props.change(this.field)}pinFormatter(e){let n=this.props?.unit||"";return`${e}${n}`}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-range-type"]],standalone:!1,features:[S],decls:8,vars:13,consts:[[1,"ion-padding-top"],[1,"ion-padding-top",3,"ionChange","min","max","step","pin","snaps","formControl","formlyAttributes","pinFormatter"],["slot","start"],["slot","end"],[1,"description-text"],["color","danger"]],template:function(n,i){n&1&&(f(0,pb,2,1,"p",0),s(1,"ion-range",1),O("ionChange",function(m){return i.onChange(m)}),s(2,"ion-label",2),h(3),l(),s(4,"ion-label",3),h(5),l()(),f(6,db,2,1,"p",4),f(7,fb,2,1,"ion-text",5)),n&2&&(_(i.props.note?0:-1),r(),c("min",i.props.min)("max",i.props.max)("step",i.props.step||1)("pin",i.props.pin??(i.props.attributes==null?null:i.props.attributes.pin))("snaps",i.props.snaps||!1)("formControl",i.formControl)("formlyAttributes",i.field)("pinFormatter",i.boundPinFormatter),r(2),N(i.props.min),r(2),N(i.props.max),r(),_(i.to.description?6:-1),r(),_(i.showError?7:-1))},dependencies:[$i,Ie,ne,Ai,He,tn,Mt,V],encapsulation:2})}}return t})();function _b(t,o){if(t&1&&(s(0,"h2"),h(1),l()),t&2){let e=p(2);r(),N(e.to.label)}}function hb(t,o){if(t&1&&(s(0,"p",8),h(1),l()),t&2){let e=p(2);r(),N(e.to.description)}}function Cb(t,o){if(t&1&&(s(0,"ion-item",5)(1,"ion-label"),G(2,_b,2,1,"h2",6)(3,hb,2,1,"p",7),l()()),t&2){let e=p();r(2),c("ngIf",e.to.label),r(),c("ngIf",e.to.description)}}function gb(t,o){if(t&1&&(Y(0),s(1,"ion-radio",10),h(2),l(),z()),t&2){let e=p().$implicit;r(),c("value",e.value),r(),R(" ",e.label," ")}}function Eb(t,o){if(t&1&&(s(0,"ion-radio",11),h(1),l()),t&2){let e=p().$implicit;c("value",e.value),r(),R(" ",e.label," ")}}function vb(t,o){if(t&1&&(s(0,"ion-item"),G(1,gb,3,2,"ng-container",9)(2,Eb,2,2,"ng-template",null,0,yt),l()),t&2){let e=it(3),n=p();r(),c("ngIf",n.to.radioSlot==="start")("ngIfElse",e)}}function yb(t,o){if(t&1&&(s(0,"ion-item",5)(1,"ion-label",12),d(2,"formly-validation-message",13),l()()),t&2){let e=p();r(2),c("field",e.field)}}var tC=(()=>{class t extends mt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-radio"]],standalone:!1,features:[S],decls:6,vars:6,consts:[["end",""],[3,"ngClass"],["lines","none",4,"ngIf"],[3,"formControl","formlyAttributes"],[4,"ngFor","ngForOf"],["lines","none"],[4,"ngIf"],["class","ion-text-secondary",4,"ngIf"],[1,"ion-text-secondary"],[4,"ngIf","ngIfElse"],["justify","start","labelPlacement","end",3,"value"],[3,"value"],["color","danger",1,"ion-text-wrap"],[3,"field"]],template:function(n,i){n&1&&(s(0,"div",1)(1,"ion-list"),G(2,Cb,4,2,"ion-item",2),s(3,"ion-radio-group",3),G(4,vb,4,2,"ion-item",4),l(),G(5,yb,3,1,"ion-item",2),l()()),n&2&&(c("ngClass",i.field.className),r(2),c("ngIf",i.to.label||i.to.description),r(),c("formControl",i.formControl)("formlyAttributes",i.field),r(),c("ngForOf",i.to.options),r(),c("ngIf",i.showError))},dependencies:[Si,Hn,yn,$i,Xi,Ie,J,ne,zn,Eo,vo,$e,Mt],styles:["[_nghost-%COMP%]{width:100%}"]})}}return t})();var Tb=()=>({cssClass:"custom-ion-alert"});function Ib(t,o){if(t&1&&(s(0,"ion-item",2)(1,"ion-label"),h(2),l(),s(3,"ion-text"),h(4),l()(),d(5,"input",3)),t&2){let e=p();r(2),N(e.props.label),r(2),N(e.selectOptions[0]==null?null:e.selectOptions[0].label),r(),c("formControl",e.formControl)("value",e.selectOptions[0]==null?null:e.selectOptions[0].value)}}function xb(t,o){if(t&1&&(s(0,"ion-select-option",4),h(1),l()),t&2){let e=o.$implicit;c("value",e.value),r(),R(" ",e.label," ")}}function Sb(t,o){if(t&1&&(s(0,"ion-select",0),fe(1,xb,2,2,"ion-select-option",4,xe),l()),t&2){let e=p();c("id",e.id)("label",e.props.label+(e.to.required?"*":""))("interfaceOptions",H(7,Tb))("placeholder",e.to.placeholder)("formControl",e.formControl)("formlyAttributes",e.field)("multiple",e.props.multiple??!1),r(),_e(e.selectOptions)}}function Ab(t,o){if(t&1&&(s(0,"p",1),h(1),l()),t&2){let e=p();r(),R(" ",e.to.description," ")}}var nC=(()=>{class t extends mt{get selectOptions(){return this.props.options||[]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-custom-select"]],standalone:!1,features:[S],decls:3,vars:2,consts:[["interface","alert","justify","space-between",3,"id","label","interfaceOptions","placeholder","formControl","formlyAttributes","multiple"],[1,"ion-margin-bottom","ion-text-secondary",2,"font-size","x-small"],["lines","none"],["type","hidden",3,"formControl","value"],[3,"value"]],template:function(n,i){n&1&&(f(0,Ib,6,4)(1,Sb,3,8,"ion-select",0),f(2,Ab,2,1,"p",1)),n&2&&(_((i.selectOptions==null?null:i.selectOptions.length)===1?0:1),r(2),_(i.to.description?2:-1))},dependencies:[$i,Ss,Ie,J,ne,jn,Yn,He,$e,Mt],styles:[`:host formly-custom-select{width:100%}ion-select::part(placeholder),ion-select::part(label){max-width:100%!important;white-space:normal!important;font-size:initial!important}ion-select::part(text){flex:1}.custom-ion-alert .alert-checkbox-label{color:var(--ion-text-color)!important}
`],encapsulation:2})}}return t})();function wb(t,o){if(t&1&&(s(0,"ion-col",11)(1,"div"),h(2),l()()),t&2){let e=p().$implicit;r(2),R(" ",e.description," ")}}function bb(t,o){if(t&1&&(s(0,"ion-row")(1,"ion-col")(2,"ion-item"),d(3,"ion-radio",9),s(4,"ion-grid")(5,"ion-row")(6,"ion-col",10)(7,"ion-text"),h(8),l()(),f(9,wb,3,1,"ion-col",11),l()()()()()),t&2){let e=o.$implicit;r(3),c("value",e.value),r(5),N(e.label),r(),_(e.description?9:-1)}}var iC=(()=>{class t{constructor(e){this.modalCtrl=e,this.initialSelectedValue=null,this.selectedValue=null}ngOnInit(){this.selectedValue=this.initialSelectedValue}onSelected(){this.modalCtrl.dismiss({selectedValue:this.selectedValue})}static{this.\u0275fac=function(n){return new(n||t)(x(he))}}static{this.\u0275cmp=I({type:t,selectors:[["formly-select-modal"]],inputs:{title:"title",options:"options",initialSelectedValue:"initialSelectedValue"},standalone:!1,decls:22,vars:2,consts:[["color","primary",1,"ion-justify-content-center"],["slot","end"],[3,"click"],["name","close",2,"color","var(--ion-title-color)"],[1,"inner-content"],[3,"ngModelChange","ngModel"],["size","12","size-md","4"],["translate","",2,"display","flex",3,"click"],["size","12","size-md","8"],["slot","start",3,"value"],["size","12","size-xs","12","size-sm","5","size-md","4","size-lg","3","size-xl","2"],["size","12","size-xs","12","size-sm","5","size-md","4"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),h(3),l(),s(4,"ion-buttons",1)(5,"ion-button",2),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",3),l()()()(),s(7,"div",4)(8,"ion-grid")(9,"ion-radio-group",5),Zt("ngModelChange",function(m){return Qt(i.selectedValue,m)||(i.selectedValue=m),m}),fe(10,bb,10,3,"ion-row",null,xe),l(),s(12,"ion-row")(13,"ion-col")(14,"ion-grid")(15,"ion-row")(16,"ion-col",6)(17,"ion-button",7),O("click",function(){return i.modalCtrl.dismiss()}),h(18," GENERAL.CANCEL "),l()(),s(19,"ion-col",8)(20,"ion-button",7),O("click",function(){return i.onSelected()}),h(21," GENERAL.OK "),l()()()()()()()()),n&2&&(r(3),N(i.title),r(6),Kt("ngModel",i.selectedValue),r(),_e(i.options))},dependencies:[Ie,Tn,Ge,Xe,Ae,Me,xt,ie,J,Eo,vo,Se,He,St,ct,$e,Ne],encapsulation:2})}}return t})();function Db(t,o){t&1&&(s(0,"span"),h(1,"*"),l())}function Rb(t,o){if(t&1&&(s(0,"span"),d(1,"br"),s(2,"small"),h(3),l()()),t&2){let e=p();r(3),N(e.to.description)}}var oC=(()=>{class t extends Bt{constructor(e){super(),this.modalController=e}onSelectItem(){this.openModal()}openModal(){return ae(this,null,function*(){let e=yield this.modalController.create({component:iC,componentProps:{title:this.props.label,options:this.props.options,initialSelectedValue:this.formControl.value},cssClass:["auto-height","full-width"]});return e.onDidDismiss().then(n=>{if(!n.data)return;let i=n.data.selectedValue;i&&this.formControl.setValue(i)}),yield e.present()})}static{this.\u0275fac=function(n){return new(n||t)(x(he))}}static{this.\u0275cmp=I({type:t,selectors:[["formly-select-extended-wrapper"]],standalone:!1,features:[S],decls:9,vars:6,consts:[[3,"click","disabled","button"],["name","caret-down-outline"]],template:function(n,i){n&1&&(s(0,"ion-item",0),O("click",function(){return i.onSelectItem()}),s(1,"ion-label")(2,"span"),h(3),l(),f(4,Db,2,0,"span"),f(5,Rb,4,1,"span"),l(),s(6,"ion-text"),h(7),l(),d(8,"ion-icon",1),l()),n&2&&(c("disabled",i.formControl.disabled)("button",!i.formControl.disabled),r(3),N(i.to.label),r(),_(i.to.required&&i.to.hideRequiredMarker!==!0?4:-1),r(),_(i.to.description?5:-1),r(2),R(" ",i.formControl.value," "))},dependencies:[ie,J,ne,He],encapsulation:2})}}return t})();function Ob(t,o){t&1&&(s(0,"ion-item"),d(1,"ion-skeleton-text",1),l()),t&2&&(r(),c("animated",!0))}function Nb(t,o){if(t&1&&(s(0,"ion-list"),fe(1,Ob,2,1,"ion-item",null,xe),l()),t&2){let e=p();r(),_e(e.fields)}}function Mb(t,o){if(t&1&&d(0,"formly-form",0),t&2){let e=p();c("form",e.form)("fields",e.fields)("model",e.model)}}var rC=(()=>{class t{constructor(){this.show=!1}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=I({type:t,selectors:[["oe-formly-skeleton-wrapper"]],inputs:{show:"show",fields:"fields",form:"form",model:"model"},standalone:!1,decls:3,vars:2,consts:[[3,"form","fields","model"],[2,"width","100%",3,"animated"]],template:function(n,i){n&1&&(s(0,"div"),f(1,Nb,3,0,"ion-list"),f(2,Mb,1,3,"formly-form",0),l()),n&2&&(r(),_(i.show?-1:1),r(),_(i.show?2:-1))},dependencies:[si,J,zn,rd],encapsulation:2})}}return t})();var Gb=["popoverInstance"],Pb=["triggerItem"];function Lb(t,o){if(t&1){let e=W();s(0,"ion-datetime",4),O("ionChange",function(i){P(e);let a=p();return L(a.handleTimeChange(i))}),l()}if(t&2){let e=p();c("presentation",e.mode)("minuteValues",e.minuteValues)("showDefaultButtons",!0)}}var aC=(()=>{class t{constructor(){this.mode="time",this.displayValue=null,this.borderColor="var(--ion-color-medium-tint)",this.invalid=!1,this.timeChange=new qr,this.popoverEvent=null,this.displayText=null}ngOnChanges(e){("displayValue"in e||"invalid"in e||"mode"in e)&&(this.updateDisplayText(),this.updateBorderColor())}ngAfterViewInit(){this.updateBorderColor()}isValidTime(e){return e==null?!1:/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e)}presentPopover(){this.triggerItem?.nativeElement&&(this.popoverEvent={target:this.triggerItem.nativeElement},this.popoverInstance.present())}handleTimeChange(e){let n=e.detail.value;this.timeChange.emit(this.formatValue(n)),this.popoverInstance.dismiss(),this.updateBorderColor()}updateDisplayText(){this.displayValue===null||this.displayValue===""?this.displayText=this.mode==="date"?"TT.MM.JJJJ":"00:00":this.displayText=this.displayValue}updateBorderColor(){let e="var(--ion-color-medium-tint)";this.mode==="time"&&this.isValidTime(this.displayValue)&&(e=this.invalid?"var(--highlight-color-invalid, var(--ion-color-danger))":"var(--highlight-color-valid, var(--ion-color-success))"),this.borderColor=e}formatValue(e){if(e===null||e==="")return this.mode==="date"?"TT.MM.JJJJ":"00:00";let n=new Date(e);return this.mode==="date"?n.toLocaleDateString("default"):this.mode==="datetime"?`${n.toLocaleTimeString("default",{hour:"2-digit",minute:"2-digit",hourCycle:"h23"})} ${n.toLocaleDateString("default")}`:n.toLocaleTimeString("default",{hour:"2-digit",minute:"2-digit",hourCycle:"h23"})}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=I({type:t,selectors:[["oe-pick-date-time-range"]],viewQuery:function(n,i){if(n&1&&(wn(Gb,5),wn(Pb,5,fo)),n&2){let a;bn(a=Dn())&&(i.popoverInstance=a.first),bn(a=Dn())&&(i.triggerItem=a.first)}},inputs:{control:"control",mode:"mode",displayValue:"displayValue",borderColor:"borderColor",minuteValues:"minuteValues",invalid:"invalid"},outputs:{timeChange:"timeChange"},standalone:!1,features:[En],decls:7,vars:4,consts:[["triggerItem",""],["popoverInstance",""],["button","true","lines","none",1,"time-display-item",3,"click"],["show-backdrop","true",3,"event"],["hourCycle","h23",3,"ionChange","presentation","minuteValues","showDefaultButtons"]],template:function(n,i){if(n&1){let a=W();s(0,"ion-item",2,0),O("click",function(){return P(a),L(i.presentPopover())}),s(2,"ion-label"),h(3),l(),s(4,"ion-popover",3,1),G(6,Lb,1,3,"ng-template"),l()()}n&2&&(re("border-color",i.borderColor),r(3),N(i.displayText),r(),c("event",i.popoverEvent))},dependencies:[zi,J,ne,Yi,$e],styles:[".time-display-item[_ngcontent-%COMP%]{border:.067em;border-radius:1em;border-style:solid;text-align:center}"]})}}return t})();var Nm=t=>({year:t});function Vb(t,o){if(t&1){let e=W();s(0,"ion-row",15)(1,"ion-col")(2,"ion-input",16),g(3,"translate"),O("ionChange",function(i){let a=P(e).$implicit,m=p(2).$index,u=p();return L(u.updateTariffPrice(m,a.key,i.detail.value))})("ionInput",function(i){P(e);let a=p(3);return L(a.sanitizeInput(i))}),l()(),s(4,"ion-col",17),h(5," Cent/kWh "),l()()}if(t&2){let e=o.$implicit,n=p(2).$implicit,i=p();r(2),c("value",n.tariffs[e.key])("label",E(3,2,i.tariffLabels[e.key]))}}function Hb(t,o){if(t&1&&(fe(0,Vb,6,4,"ion-row",15,xe),g(2,"keyvalue")),t&2){let e=p().$implicit;_e(E(2,0,e==null?null:e.tariffs))}}function Bb(t,o){if(t&1){let e=W();s(0,"div",22)(1,"oe-pick-date-time-range",25),g(2,"timedisplay"),O("timeChange",function(i){let a=P(e).$implicit,m=p(3).$index,u=p().$index,C=p();return L(C.updateTimeRange(u,m,a.originalIndex,"from",i))}),l(),s(3,"span",26),h(4,"\xA0\u2013\xA0"),l(),s(5,"oe-pick-date-time-range",25),g(6,"timedisplay"),O("timeChange",function(i){let a=P(e).$implicit,m=p(3).$index,u=p().$index,C=p();return L(C.updateTimeRange(u,m,a.originalIndex,"to",i))}),l(),s(7,"ion-button",27),O("click",function(){let i=P(e).$implicit,a=p(3).$index,m=p().$index,u=p();return L(u.removeTimeRange(m,a,i.originalIndex))}),d(8,"ion-icon",28),l()()}if(t&2){let e=o.$implicit,n=p(5);r(),c("mode","time")("displayValue",E(2,8,e.from))("minuteValues","0,15,30,45")("invalid",n.isTimeRangeInvalid(e)),r(4),c("mode","time")("displayValue",E(6,10,e.to))("minuteValues","0,15,30,45")("invalid",n.isTimeRangeInvalid(e))}}function Wb(t,o){if(t&1){let e=W();s(0,"div",22)(1,"oe-pick-date-time-range",25),g(2,"timedisplay"),O("timeChange",function(i){let a=P(e).$implicit,m=p(3).$index,u=p().$index,C=p();return L(C.updateTimeRange(u,m,a.originalIndex,"from",i))}),l(),s(3,"span",26),h(4,"\xA0\u2013\xA0"),l(),s(5,"oe-pick-date-time-range",25),g(6,"timedisplay"),O("timeChange",function(i){let a=P(e).$implicit,m=p(3).$index,u=p().$index,C=p();return L(C.updateTimeRange(u,m,a.originalIndex,"to",i))}),l(),s(7,"ion-button",27),O("click",function(){let i=P(e).$implicit,a=p(3).$index,m=p().$index,u=p();return L(u.removeTimeRange(m,a,i.originalIndex))}),d(8,"ion-icon",28),l()()}if(t&2){let e=o.$implicit,n=p(5);r(),c("mode","time")("displayValue",E(2,8,e.from))("minuteValues","0,15,30,45")("invalid",n.isTimeRangeInvalid(e)),r(4),c("mode","time")("displayValue",E(6,10,e.to))("minuteValues","0,15,30,45")("invalid",n.isTimeRangeInvalid(e))}}function Ub(t,o){if(t&1){let e=W();s(0,"ion-col",20)(1,"div",21)(2,"h4"),h(3),g(4,"translate"),l(),fe(5,Bb,9,12,"div",22,Es().trackByScheduleOriginalIndex,!0),s(7,"ion-button",23),O("click",function(){P(e);let i=p(2).$index,a=p().$index,m=p();return L(m.addTimeRange(a,i,"low"))}),d(8,"ion-icon",24),h(9),g(10,"translate"),l()(),s(11,"div",21)(12,"h4"),h(13),g(14,"translate"),l(),fe(15,Wb,9,12,"div",22,Es().trackByScheduleOriginalIndex,!0),s(17,"ion-button",23),O("click",function(){P(e);let i=p(2).$index,a=p().$index,m=p();return L(m.addTimeRange(a,i,"high"))}),d(18,"ion-icon",24),h(19),g(20,"translate"),l()()()}if(t&2){let e=p(2).$implicit;r(3),R("",E(4,4,"FORMLY_FORM.TARIFF_TABLE.TARIFFS.LOW")," (NT)"),r(2),_e(e.lowSchedules),r(4),R(" ",E(10,6,"FORMLY_FORM.TARIFF_TABLE.ADD_TIME_SLOT")," "),r(4),R("",E(14,8,"FORMLY_FORM.TARIFF_TABLE.TARIFFS.HIGH")," (HT)"),r(2),_e(e.highSchedules),r(4),R(" ",E(20,10,"FORMLY_FORM.TARIFF_TABLE.ADD_TIME_SLOT")," ")}}function zb(t,o){if(t&1){let e=W();s(0,"ion-col",18),O("click",function(){P(e);let i=p().$implicit,a=p(2);return L(a.toggleQuarterVisibilityByKey(i.key))}),s(1,"ion-button",19),d(2,"ion-icon",9),l(),h(3),l(),f(4,Ub,21,12,"ion-col",20)}if(t&2){let e=p().$implicit,n=p(2);r(2),c("name",n.isQuarterExpandedByKey(e.key)?"chevron-down-outline":"chevron-forward-outline"),r(),Ts(" Q",e.quarter," - ",e.formattedDateRange," "),r(),_(n.isQuarterExpandedByKey(e.key)?4:-1)}}function jb(t,o){if(t&1&&(s(0,"ion-row",10),f(1,zb,5,4),l()),t&2){let e=o.$implicit;r(),_(e?1:-1)}}function Yb(t,o){if(t&1){let e=W();s(0,"ion-button",29),O("click",function(){P(e);let i=p().$index,a=p();return L(a.removeYear(i))}),h(1),g(2,"translate"),l()}if(t&2){let e=p().$implicit;r(),R(" ",q(2,1,"FORMLY_FORM.TARIFF_TABLE.REMOVE_YEAR",be(4,Nm,e.year))," ")}}function $b(t,o){if(t&1){let e=W();s(0,"ion-button",30),O("click",function(){P(e);let i=p(2);return L(i.addYear())}),h(1),g(2,"translate"),l()}if(t&2){let e=p().$implicit;r(),R(" ",q(2,1,"FORMLY_FORM.TARIFF_TABLE.ADD_YEAR",be(4,Nm,e.year+1))," ")}}function Xb(t,o){if(t&1){let e=W();s(0,"div",0)(1,"ion-item",2)(2,"ion-label",3)(3,"h2"),h(4),g(5,"translate"),l(),s(6,"p"),h(7),l()()(),s(8,"ion-grid",4)(9,"div",5)(10,"ion-row",6)(11,"ion-col",7)(12,"ion-button",8),O("click",function(){P(e);let i=p();return L(i.togglePriceItems=!i.togglePriceItems)}),d(13,"ion-icon",9),l()(),s(14,"ion-col"),h(15),g(16,"translate"),l()(),f(17,Hb,3,2),l(),fe(18,jb,2,1,"ion-row",10,Es().trackByQuarterKey,!0),l(),s(20,"div",11)(21,"ion-toolbar")(22,"ion-buttons",12),f(23,Yb,3,6,"ion-button",13),f(24,$b,3,6,"ion-button",14),l()()()()}if(t&2){let e=o.$implicit,n=p();r(4),N(q(5,7,"FORMLY_FORM.TARIFF_TABLE.TITLE",be(12,Nm,e.year))),r(3),N(n.props.description),r(6),c("name",n.togglePriceItems?"chevron-down-outline":"chevron-forward-outline"),r(2),R(" ",E(16,10,"FORMLY_FORM.TARIFF_TABLE.PRICE_ITEMS")," "),r(2),_(n.togglePriceItems?17:-1),r(),_e(e.quarters),r(5),_(n.tariffData.length>1?23:-1),r(),_(n.tariffData.length>1?-1:24)}}var sC=(()=>{class t extends mt{constructor(e,n){super(),this.translate=e,this.service=n,this.tariffData=[],this.expandedQuarters={},this.currentYear=new Date().getFullYear(),this.togglePriceItems=!0,this.tariffLabels={low:"FORMLY_FORM.TARIFF_TABLE.TARIFFS.LOW",standard:"FORMLY_FORM.TARIFF_TABLE.TARIFFS.STANDARD",high:"FORMLY_FORM.TARIFF_TABLE.TARIFFS.HIGH"}}static cleanTariffData(e){return structuredClone(e).reduce((i,a)=>{let m=a.quarters.map(u=>Jd.excludeProperties(u,["formattedDateRange","key"]));return a.quarters=m,i.push(a),i},[])}ngOnInit(){this.parseInitialData(),this.initializeForm()}ngOnChanges(e){e.props&&this.parseInitialData()}addYear(){let n=(this.tariffData[this.tariffData.length-1]?.year||this.currentYear-1)+1;this.tariffData.push({year:n,tariffs:{low:0,standard:0,high:0},quarters:this.createQuartersForYear(n)}),this.tariffData[this.tariffData.length-1].quarters.forEach(i=>this.updateFilteredSchedules(i)),this.updateFormControl()}removeYear(e){this.tariffData.length>1&&(this.tariffData.splice(e,1),this.updateFormControl())}toggleQuarterVisibilityByKey(e){this.expandedQuarters[e]=!this.expandedQuarters[e]}isQuarterExpandedByKey(e){return!!this.expandedQuarters[e]}updateTariffPrice(e,n,i){let a=Math.max(0,Number(i));this.tariffData[e].tariffs[n]=a,this.updateFormControl()}removeTimeRange(e,n,i){let a=this.tariffData[e];if(!a){console.error(`Attempted to remove time range from non-existent year: Index ${e}`),this.service.toast("Error: Year data not found for removal.","danger");return}let m=a.quarters[n];if(!m){console.error(`Attempted to remove time range from non-existent quarter: Year Index ${e}, Quarter Index ${n}`),this.service.toast("Error: Quarter data not found for removal.","danger");return}let u=m.dailySchedule;if(!u||!Array.isArray(u)){console.error(`Attempted to remove time range from missing or invalid daily schedule array: Year Index ${e}, Quarter Index ${n}`),this.service.toast("Error: Daily schedule not found or is invalid.","danger");return}i>=0&&i<u.length?(u.splice(i,1),this.updateFilteredSchedules(m),this.updateFormControl()):(console.error(`Attempted to remove time range with invalid schedule index: Index ${i}, Array Length ${u.length}`),this.service.toast("Error: Invalid time slot index for removal.","danger"))}updateTimeRange(e,n,i,a,m){let u=this.tariffData[e]?.quarters[n];if(!u||!u.dailySchedule){console.error(`Cannot update time range: Quarter or dailySchedule missing. Year Index ${e}, Quarter Index ${n}`),this.service.toast("Error: Could not update time slot.","danger");return}let C=u.dailySchedule[i];C?(C[a]=m,this.updateFormControl()):(console.error(`Cannot update time range: Schedule not found at index ${i}.`),this.service.toast("Error: Time slot not found for update.","danger"))}isTimeRangeInvalid(e){let n=e.from.includes("T")?e.from.substring(11,16):e.from,i=e.to.includes("T")?e.to.substring(11,16):e.to;if(n&&i&&n.includes(":")&&i.includes(":")){let a=n>=i&&i!=="00:00";return a&&this.service.toast(this.translate.instant("FORMLY_FORM.TARIFF_TABLE.ERROR_MESSAGES.INVALID_TIME_INPUT"),"danger",5e3),a}return!1}getQuarterDates(e,n){switch(n){case 1:return[new Date(e,0,1),new Date(e,2,31)];case 2:return[new Date(e,3,1),new Date(e,5,30)];case 3:return[new Date(e,6,1),new Date(e,8,30)];case 4:return[new Date(e,9,1),new Date(e,11,31)];default:return[new Date,new Date]}}getSchedulesForTariff(e,n){return e.filter(i=>i.tariff===n)}addTimeRange(e,n,i){let a=this.tariffData[e]?.quarters[n];a?(a.dailySchedule||(a.dailySchedule=[]),a.dailySchedule.push(this.createDailySchedule(i,this.translate.instant("GENERAL.FROM"),this.translate.instant("GENERAL.TO"),a.dailySchedule.length)),this.updateFilteredSchedules(a),this.updateFormControl()):(console.error(`Attempted to add time range to non-existent quarter: Year Index ${e}, Quarter Index ${n}`),this.service.toast("Error: Could not find quarter","danger",3e3))}trackByScheduleOriginalIndex(e,n){return n.originalIndex}trackByQuarterKey(e,n){return n.key}sanitizeInput(e){let n=e.target,i=n.value,a=i.replace(/[^\d.]/g,"");a!==i&&(n.value=a)}updateFormControl(){let e=t.cleanTariffData(this.tariffData);this.formControl.setValue(e),this.formControl.markAsDirty()}createQuartersForYear(e){let n=[];for(let i=1;i<=4;i++){let[a,m]=this.getQuarterDates(e,i),u=`y${e}_q${i}`,C={quarter:i,dailySchedule:[],formattedDateRange:dn.formatQuarterDateRange(a,m,this.translate.instant("GENERAL.DATE_FORMAT")),key:u};n.push(C)}return n}createDailySchedule(e,n,i,a){return{tariff:e,from:n,to:i,originalIndex:a}}parseInitialData(){let e=this.formControl.value;Array.isArray(e)&&e.every(n=>typeof n=="object"&&n!==null&&"year"in n&&"tariffs"in n&&"quarters"in n)?this.tariffData=e:(console.warn("Initial form control value is not in the expected tariffData format. Initializing with default year."),this.tariffData=[]),this.tariffData.length===0?this.addYear():(this.tariffData.forEach(n=>{n.quarters=n.quarters||[],n.quarters=n.quarters.map(i=>{if(!i){console.warn(`Found null/undefined quarter for year ${n.year}. Replacing with default.`);let u=1,[C,v]=this.getQuarterDates(n.year,u);return{quarter:u,dailySchedule:[],formattedDateRange:dn.formatQuarterDateRange(C,v,this.translate.instant("GENERAL.DATE_FORMAT")),key:`y${n.year}_q${u}`}}i.key=`y${n.year}_q${i.quarter}`;let[a,m]=this.getQuarterDates(n.year,i.quarter);return i.formattedDateRange=dn.formatQuarterDateRange(a,m,this.translate.instant("GENERAL.DATE_FORMAT")),i.dailySchedule=i.dailySchedule||[],i.dailySchedule.forEach((u,C)=>{(u.originalIndex===void 0||u.originalIndex===null)&&(u.originalIndex=C)}),this.updateFilteredSchedules(i),i})}),this.updateFormControl()),this.initializeForm()}initializeForm(){this.tariffData.forEach(e=>{e.quarters.forEach(n=>{n.key&&(this.expandedQuarters[n.key]=!1)})})}updateFilteredSchedules(e){let n=e.dailySchedule||[];e.lowSchedules=n.filter(i=>i.tariff==="low"),e.highSchedules=n.filter(i=>i.tariff==="high")}static{this.\u0275fac=function(n){return new(n||t)(x(te),x(j))}}static{this.\u0275cmp=I({type:t,selectors:[["formly-tariff-table"]],standalone:!1,features:[S,En],decls:3,vars:1,consts:[[1,"year-section"],["type","hidden",3,"formControl"],["lines","full"],[1,"ion-text-center"],[1,"tariff-grid"],[1,"price-items-container"],[1,"ion-align-items-center","tariff-grid-header-row","price-items-toggle-row"],["size","auto"],["fill","clear","size","small",1,"expand-button",3,"click"],["slot","icon-only",3,"name"],[1,"quarter-row"],[1,"year-actions"],["slot","start"],["fill","clear","color","danger"],["fill","clear","color","success"],[1,"ion-align-items-center","tariff-price-row"],["type","number","min","0","labelPlacement","floating","placeholder","0.00",1,"tariff-input","input-text-right",3,"ionChange","ionInput","value","label"],["size","auto",1,"input-unit"],["size","12",1,"quarter-label-col",3,"click"],["fill","clear","size","small",1,"expand-button"],["size","12",1,"quarter-details-col"],[1,"tariff-section"],[1,"time-range-row"],["fill","outline","size","small",1,"add-time-btn",3,"click"],["name","add-circle-outline","slot","start"],[1,"ion-padding","time-input",3,"timeChange","mode","displayValue","minuteValues","invalid"],[1,"time-separator"],["fill","clear","size","small",1,"remove-time-btn",3,"click"],["name","trash-outline","slot","icon-only","color","danger"],["fill","clear","color","danger",3,"click"],["fill","clear","color","success",3,"click"]],template:function(n,i){n&1&&(fe(0,Xb,25,14,"div",0,xe),d(2,"input",1)),n&2&&(_e(i.tariffData),r(2),c("formControl",i.formControl))},dependencies:[Ss,Ie,Ge,Xe,Ae,Me,ie,nn,J,ne,Se,ct,tn,Mt,aC,bp,zd,V],styles:[".remove-time-btn[_ngcontent-%COMP%], .expand-button[_ngcontent-%COMP%]{min-width:auto;--padding-start: .2rem;--padding-end: .2rem}.tariff-input[_ngcontent-%COMP%]{flex:1;min-width:0;--padding-start: .3rem;--padding-end: .3rem}.year-section[_ngcontent-%COMP%]{margin-bottom:2rem;border:1px solid var(--ion-color-medium-shade);padding:1rem;border-radius:8px}.year-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.tariff-grid[_ngcontent-%COMP%]{width:100%;border:1px solid var(--ion-color-dark);margin:1rem auto;max-width:800px}.price-items-container[_ngcontent-%COMP%]{background-color:var(--ion-color-light-shade);border-bottom:1px solid var(--ion-color-dark);border-top:none;padding-bottom:.5rem;color:var(--ion-text-color)}.tariff-grid-header-row[_ngcontent-%COMP%]{background-color:transparent;border-bottom:none;padding:.5rem}.tariff-price-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--ion-border-color);text-align:left;white-space:nowrap;background-color:transparent}.tariff-input[_ngcontent-%COMP%]{text-align:right}.input-unit[_ngcontent-%COMP%]{white-space:nowrap;font-size:.9em;color:var(--ion-color-medium-shade)}.quarter-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--ion-border-color);text-align:left;white-space:nowrap}.quarter-label-col[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;cursor:pointer;-webkit-user-select:none;user-select:none;white-space:normal;word-break:break-word}.expand-button[_ngcontent-%COMP%]{height:auto;font-size:1.2em}.tariff-section[_ngcontent-%COMP%]{padding-left:10%;margin-top:1rem;margin-bottom:1rem}.time-range-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;gap:.5rem;margin-bottom:.5rem}.time-range-row[_ngcontent-%COMP%]   .time-input[_ngcontent-%COMP%]{min-width:90px;max-width:120px;flex:1 1 auto;--padding-start: .3rem;--padding-end: .3rem}.time-range-row[_ngcontent-%COMP%]   .time-separator[_ngcontent-%COMP%]{white-space:nowrap}.remove-time-btn[_ngcontent-%COMP%]{margin-left:.25rem}.add-time-btn[_ngcontent-%COMP%]{text-wrap:auto;display:inline-block;padding:2%;margin-top:.5rem}.year-actions[_ngcontent-%COMP%]{margin-top:1.5rem}.year-actions[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: transparent;--border-width: 0;padding:0}.year-actions[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:flex-end;gap:.5rem}@media (max-width: 768px){.year-section[_ngcontent-%COMP%]{padding:.5rem}.tariff-grid[_ngcontent-%COMP%]{margin:.5rem auto}.tariff-input[_ngcontent-%COMP%]{font-size:.9rem}.tariff-price-row[_ngcontent-%COMP%]{flex-direction:row;align-items:center;flex-wrap:wrap}.tariff-price-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{width:auto;text-align:left;white-space:nowrap;padding:.25rem}.tariff-price-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]:first-child{display:flex;align-items:center;gap:.5rem;flex-grow:1}.tariff-price-row[_ngcontent-%COMP%]   .input-unit[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0;flex-shrink:0}.input-unit[_ngcontent-%COMP%]{font-size:.8rem}.quarter-label-col[_ngcontent-%COMP%]{font-size:.95rem}.expand-button[_ngcontent-%COMP%]{font-size:1rem}.quarter-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{font-size:.85rem}.time-range-row[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.time-range-row[_ngcontent-%COMP%]   .time-input[_ngcontent-%COMP%]{width:100%;max-width:none;text-align:left}.time-range-row[_ngcontent-%COMP%]   .time-separator[_ngcontent-%COMP%]{margin-left:0}.time-range-row[_ngcontent-%COMP%]   .remove-time-btn[_ngcontent-%COMP%]{margin-left:0;margin-top:.5rem}.year-actions[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]{justify-content:space-between}}"]})}}return t})();function qb(t,o){if(t&1&&d(0,"oe-help-popover-button",3),t&2){let e=p();c("helpMsg",e.props.helpMsg)}}function Kb(t,o){if(t&1&&h(0),t&2){let e=p();R(" ",e.props.description," ")}}var lC=(()=>{class t extends mt{ngOnInit(){this.value=this.formControl.value??this.field.defaultValue,this.formControl.statusChanges.subscribe(e=>{e==="DISABLED"&&this.value!==!1&&(this.value=!1,this.formControl.setValue(this.value),this.formControl.markAsDirty())})}updateFormControl(e){this.value=e.detail.checked,this.formControl.setValue(this.value),this.formControl.markAsDirty()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["help-popover-label-with-description-and-checkbox"]],standalone:!1,features:[S],decls:11,vars:6,consts:[[1,"ion-no-padding"],["lines","none"],[1,"ion-item-label-min-content"],[3,"helpMsg"],["slot","end",3,"ionChange","checked","value","disabled"]],template:function(n,i){n&1&&(s(0,"ion-grid",0)(1,"ion-row")(2,"ion-col")(3,"ion-item",1)(4,"ion-label",2),h(5),l(),f(6,qb,1,1,"oe-help-popover-button",3),l()(),s(7,"ion-col")(8,"ion-item",1)(9,"ion-checkbox",4),O("ionChange",function(m){return i.updateFormControl(m)}),f(10,Kb,1,1),l()()()()()),n&2&&(r(5),N(i.props.label),r(),_(i.props.helpMsg?6:-1),r(3),c("checked",i.value)("value",i.props.value)("disabled",i.props.disabled),r(),_(i.props.description?10:-1))},dependencies:[zt,Ae,Me,J,ne,Se,ft,dr],encapsulation:2,changeDetection:0})}}return t})();function Qb(t,o){if(t&1&&d(0,"ion-input",0),t&2){let e=p();c("placeholder",ki(e.props.placeholder))("type",e.props.type||"text")("formControl",e.formControl)("min",e.props.min)("label",e.props.label+(e.props.required&&e.props.hideRequiredMarker!==!0?"*":""))("helperText",e.props.description)("step",e.props.step)}}function Zb(t,o){if(t&1&&d(0,"ion-input",1),t&2){let e=p();c("placeholder",ki(e.props.placeholder))("type",e.props.type||"text")("formControl",e.formControl)("formlyAttributes",e.field)("label",e.props.label+(e.props.required&&e.props.hideRequiredMarker!==!0?"*":""))("helperText",e.props.description)}}var cC=(()=>{class t extends mt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-input-section"]],standalone:!1,features:[S],decls:2,vars:1,consts:[["labelPlacement","floating",2,"width","100%","float","right","text-align","right",3,"placeholder","type","formControl","min","label","helperText","step"],["labelPlacement","floating",2,"text-align","right",3,"placeholder","type","formControl","formlyAttributes","label","helperText"]],template:function(n,i){n&1&&f(0,Qb,1,8,"ion-input",0)(1,Zb,1,7,"ion-input",1),n&2&&_(i.props.type==="number"?0:1)},dependencies:[$i,Ie,nn,Bn,Mt],encapsulation:2})}}return t})();var Yl;(function(t){function o(e,n){let i="var(--ion-color-dark)";return e.invalid&&e.touched?i="var(--highlight-color-invalid)":e.valid?i="var(--highlight-color-valid)":n&&(i="var(--highlight-color-focused)"),{"border-bottom-color":i}}t.getBorderBottomColor=o})(Yl||(Yl={}));var Jb=t=>({"disabled-field":t}),eD=t=>({"margin-left":t,"max-width":"none"}),tD=t=>({"input-box":t});function nD(t,o){t&1&&(s(0,"span"),h(1,"*"),l())}function iD(t,o){if(t&1&&(s(0,"span"),d(1,"br"),s(2,"small"),h(3),l()()),t&2){let e=p();r(3),N(e.to.description)}}function oD(t,o){if(t&1&&(s(0,"span"),h(1),l()),t&2){let e=p();re("color","var(--ion-color-text)"),r(),N(e.to.prefix)}}function rD(t,o){if(t&1&&(s(0,"ion-item",2)(1,"ion-label",8)(2,"ion-text",9),d(3,"formly-validation-message",10),l()()()),t&2){let e=p();r(3),c("field",e.field)}}function aD(t,o){if(t&1){let e=W();s(0,"ion-checkbox",11),O("ionChange",function(i){P(e);let a=p();return L(a.onCheckboxChange(i.detail.checked))}),h(1),l()}if(t&2){let e=p();c("checked",e.props.checkbox.value),r(),R(" ",e.props.checkbox.label," ")}}var mC=(()=>{class t extends Bt{constructor(){super(...arguments),this.isFocused=!1}get borderBottomColor(){return Yl.getBorderBottomColor(this.formControl,this.isFocused)}setFocus(e){this.isFocused=e}onCheckboxChange(e){this.props.checkbox.value=e,this.props.checkbox.updateFn&&this.props.checkbox.updateFn(e)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-input-serial-number"]],standalone:!1,features:[S],decls:15,vars:20,consts:[[3,"ngClass"],["size","12","size-md","6"],["lines","none"],[3,"position","ngStyle"],["lines","none",1,"ion-no-padding","input-box-wrapper",2,"align-items","baseline",3,"ngClass","ngStyle"],[3,"color"],["text-left","",3,"ionFocus","ionBlur","formControl","type","formlyAttributes"],["color","primary","alignment","start","labelPlacement","end",1,"ion-padding-top",3,"checked"],[1,"ion-text-wrap"],["color","danger",1,"ion-font-size-smaller"],[3,"field"],["color","primary","alignment","start","labelPlacement","end",1,"ion-padding-top",3,"ionChange","checked"]],template:function(n,i){n&1&&(s(0,"ion-grid",0)(1,"ion-row")(2,"ion-col",1)(3,"ion-item",2)(4,"ion-label",3)(5,"span"),h(6),l(),f(7,nD,2,0,"span"),f(8,iD,4,1,"span"),l()()(),s(9,"ion-col",1)(10,"ion-item",4),f(11,oD,2,3,"span",5),s(12,"ion-input",6),O("ionFocus",function(){return i.setFocus(!0)})("ionBlur",function(){return i.setFocus(!1)}),l()(),f(13,rD,4,1,"ion-item",2),f(14,aD,2,2,"ion-checkbox",7),l()()()),n&2&&(c("ngClass",be(14,Jb,i.formControl.disabled)),r(4),c("position",i.to.labelPosition)("ngStyle",be(16,eD,i.props!=null&&i.props.boxBorder?"15%":"auto")),r(2),N(i.to.label),r(),_(i.to.required&&i.to.hideRequiredMarker!==!0?7:-1),r(),_(i.to.description?8:-1),r(2),c("ngClass",be(18,tD,i.props.boxBorder))("ngStyle",i.borderBottomColor),r(),_(i.to.prefix?11:-1),r(),c("formControl",i.formControl)("type",i.props.type||"text")("formlyAttributes",i.field),r(),_(i.showError?13:-1),r(),_(i.props.checkbox?14:-1))},dependencies:[Si,Yo,$i,Xi,Ie,zt,Ae,Me,nn,J,ne,Se,He,ft,Bn,Mt],styles:[".input-box-wrapper[_ngcontent-%COMP%]{border-bottom:1px solid var(--ion-color-dark)}.input-box[_ngcontent-%COMP%]{border:1px solid var(--ion-color-dark);border-bottom:1px solid var(--ion-color-dark);border-radius:2px;width:100%;padding-left:2px}.input-box[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--min-height: auto}.disabled-field[_ngcontent-%COMP%]{pointer-events:none;opacity:.5}.disabled-field[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], .disabled-field[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.text-center[_ngcontent-%COMP%]{text-align:center}@media (max-width: 768px){.text-center[_ngcontent-%COMP%]{text-align:--webkit-center}.input-box[_ngcontent-%COMP%]{max-width:90%}}@media (max-width: 480px){.input-box[_ngcontent-%COMP%]{max-width:100%}}"]})}}return t})();function sD(t,o){}var pC=(()=>{class t extends Bt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-wrapper-panel"]],standalone:!1,features:[S],decls:8,vars:1,consts:[["fieldComponent",""],["lines","none",1,"ion-no-padding"]],template:function(n,i){n&1&&(s(0,"ion-item",1)(1,"ion-grid")(2,"ion-row")(3,"ion-col")(4,"ion-label"),h(5),l(),G(6,sD,0,0,"ng-template",null,0,yt),l()()()()),n&2&&(r(5),N(i.to.label))},dependencies:[Ae,Me,J,ne,Se],encapsulation:2})}}return t})();function lD(t,o){if(t&1){let e=W();s(0,"ion-item",4),d(1,"formly-field",6),s(2,"ion-icon",5),O("click",function(){let i=P(e).$implicit,a=p(2);return L(a.add(i.key))}),l(),s(3,"ion-icon",7),O("click",function(){let i=P(e).$index,a=p(2);return L(a.remove(i))}),l()()}if(t&2){let e=o.$implicit;r(),c("field",e)}}function cD(t,o){if(t&1){let e=W();s(0,"ion-col",3)(1,"ion-item",4)(2,"ion-icon",5),O("click",function(){P(e);let i=p();return L(i.add(-1))}),l()(),fe(3,lD,4,1,"ion-item",4,xe),l()}if(t&2){let e=p();r(3),_e(e.field.fieldGroup)}}function mD(t,o){if(t&1){let e=W();s(0,"ion-col")(1,"ion-item")(2,"ion-icon",8),O("click",function(){P(e);let i=p();return L(i.add())}),l()()()}}var dC=(()=>{class t extends fd{add(e,n){e=Number(e)+1,super.add(e,n),this.formControl.markAsDirty()}remove(e){super.remove(e),this.formControl.markAsDirty()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-repeat-section"]],standalone:!1,features:[S],decls:7,vars:2,consts:[[1,"ion-no-padding"],["size","12","size-md","12","size-xl","4",1,"ion-no-padding"],["lines","none"],["size","12","size-md","12","size-xl","8",1,"ion-no-padding"],["lines","none",1,"noPadding"],["name","add-outline","slot","end",1,"ion-no-padding;","ion-no-margin",3,"click"],["slot","end",3,"field"],["name","trash-outline","slot","end",1,"ion-no-padding;","ion-no-margin",3,"click"],["name","add-outline",3,"click"]],template:function(n,i){n&1&&(s(0,"ion-grid",0)(1,"ion-row")(2,"ion-col",1)(3,"ion-item",2),h(4),l()(),f(5,cD,5,0,"ion-col",3)(6,mD,3,0,"ion-col"),l()()),n&2&&(r(4),N(i.to.label),r(),_(i.field.fieldGroup.length>0?5:6))},dependencies:[dd,Ae,Me,ie,J,Se],encapsulation:2})}}return t})();var uC=(()=>{class t extends un{static{this.METHOD="getStateChannelsOfComponent"}constructor(e){super(t.METHOD,e),this.params=e}}return t})();function pD(t,o){t&1&&d(0,"ion-icon",8)}function dD(t,o){t&1&&d(0,"ion-icon",9)}function uD(t,o){t&1&&d(0,"ion-icon",10)}function fD(t,o){t&1&&d(0,"ion-icon",11)}function _D(t,o){if(t&1&&(s(0,"ion-item",5),d(1,"ion-icon",6),s(2,"ion-label",7),h(3),g(4,"translate"),l(),f(5,pD,1,0,"ion-icon",8)(6,dD,1,0,"ion-icon",9)(7,uD,1,0,"ion-icon",10)(8,fD,1,0,"ion-icon",11),l()),t&2){let e;r(3),R(" ",E(4,2,"GENERAL.TOTAL_STATE")," "),r(2),_((e=o.state)===0?5:e===1?6:e===2?7:e===3?8:-1)}}function hD(t,o){if(t&1&&(s(0,"span"),h(1),l()),t&2){let e=p(2).$implicit;r(),R(" ",e.id)}}function CD(t,o){t&1&&(s(0,"small"),h(1," ("),s(2,"span",1),h(3,"GENERAL.COMPONENT_INACTIVE"),l(),h(4,") "),l())}function gD(t,o){t&1&&(s(0,"p",17),h(1),l()),t&2&&(r(),N(o.name))}function ED(t,o){t&1&&(s(0,"ion-text",20),h(1," GENERAL.INFO\xA0 "),l())}function vD(t,o){t&1&&(s(0,"ion-text",21),h(1," GENERAL.WARNING\xA0 "),l())}function yD(t,o){t&1&&(s(0,"ion-text",22),h(1," GENERAL.FAULT\xA0 "),l())}function TD(t,o){if(t&1&&(s(0,"ion-text"),h(1),l()),t&2){let e=p(3).$implicit,n=p(7);r(),R(" ",n.channels[e.componentId][e.channelId].text," ")}}function ID(t,o){if(t&1&&h(0),t&2){let e=p(3).$implicit;R(" ",e.channelId.toString()," ")}}function xD(t,o){if(t&1&&(s(0,"ion-label",15),f(1,ED,2,0,"ion-text",20)(2,vD,2,0,"ion-text",21)(3,yD,2,0,"ion-text",22),f(4,TD,2,1,"ion-text")(5,ID,1,1),l()),t&2){let e,n=p(2).$implicit,i=p(7);r(),_((e=i.channels[n.componentId][n.channelId].level)==="INFO"?1:e==="WARNING"?2:e==="FAULT"?3:-1),r(3),_(i.channels[n.componentId][n.channelId].text.length>0?4:5)}}function SD(t,o){if(t&1&&f(0,xD,6,2,"ion-label",15),t&2){let e=p().$implicit,n=p(5);_(n.channel[e.toString()]===1?0:-1)}}function AD(t,o){if(t&1&&f(0,SD,1,1),t&2){let e=o.$implicit,n=p(3).$implicit;_(e.componentId===n.id&&e.channelId!=="State"?0:-1)}}function wD(t,o){if(t&1&&fe(0,AD,1,1,null,null,xe),t&2){let e=p(6);_e(e.subscribedInfoChannels)}}function bD(t,o){if(t&1){let e=W();s(0,"ion-icon",23),O("click",function(){P(e);let i=p(2).$implicit,a=p(4);return i.showProperties=!i.showProperties,L(a.subscribeInfoChannels(i))}),l()}}function DD(t,o){if(t&1){let e=W();s(0,"ion-icon",24),O("click",function(){P(e);let i=p(2).$implicit,a=p(4);return i.showProperties=!i.showProperties,L(a.unsubscribeInfoChannels(i))}),l()}}function RD(t,o){t&1&&d(0,"ion-icon",8)}function OD(t,o){t&1&&d(0,"ion-icon",9)}function ND(t,o){t&1&&d(0,"ion-icon",10)}function MD(t,o){t&1&&d(0,"ion-icon",11)}function FD(t,o){if(t&1&&(s(0,"ion-item",14)(1,"ion-label",15)(2,"ion-text",16)(3,"h3"),h(4),f(5,hD,2,1,"span"),f(6,CD,5,0,"small"),l()(),f(7,gD,2,1,"p",17),f(8,wD,2,0),l(),f(9,bD,1,0,"ion-icon",18),f(10,DD,1,0,"ion-icon",19),f(11,RD,1,0,"ion-icon",8)(12,OD,1,0,"ion-icon",9)(13,ND,1,0,"ion-icon",10)(14,MD,1,0,"ion-icon",11),l()),t&2){let e,n,i=p().$implicit,a=p(2),m=p(2);r(4),R("",i.alias," "),r(),_(i.id!==i.alias?5:-1),r(),_(i.isEnabled?-1:6),r(),_((e=m.config.factories[i.factoryId])?7:-1,e),r(),_(i.showProperties?8:-1),r(),_((a.channel[i.id+"/State"]??-1)>0&&!i.showProperties?9:-1),r(),_(i.showProperties?10:-1),r(),_((n=a.channel[i.id+"/State"])===0?11:n===1?12:n===2?13:n===3?14:-1)}}function GD(t,o){if(t&1&&f(0,FD,15,8,"ion-item",14),t&2){let e=o.$implicit;_(e.id!=="_sum"?0:-1)}}function PD(t,o){if(t&1&&(s(0,"ion-item-group")(1,"ion-item",12),d(2,"ion-icon",13),s(3,"ion-label",7),h(4),l()()(),fe(5,GD,1,1,null,null,xe)),t&2){let e=o.$implicit;r(2),c("name",ki(e.category.icon)),r(2),R(" ",e.category.title," "),r(),_e(e.components)}}function LD(t,o){if(t&1&&(s(0,"ion-content")(1,"ion-card-content"),f(2,_D,9,4,"ion-item",5),s(3,"ion-list"),fe(4,PD,7,3,null,null,xe),l()()()),t&2){let e,n=p(2);r(2),_((e=o.summary.system)?2:-1,e),r(2),_e(n.components)}}function kD(t,o){if(t&1&&(f(0,LD,6,1,"ion-content"),g(1,"async")),t&2){let e,n=p();_((e=E(1,1,n.edge.currentData))?0:-1,e)}}var $l=(()=>{class t{static{this.SELECTOR="statussingle"}constructor(e,n,i){this.modalCtrl=e,this.service=n,this.websocket=i,this.subscribedInfoChannels=[],this.onInfoChannels=[],this.channels={},this.stopOnDestroy=new qt}ngOnDestroy(){this.edge?.unsubscribeChannels(this.websocket,t.SELECTOR),this.stopOnDestroy.next(),this.stopOnDestroy.complete()}ngOnInit(){return ae(this,null,function*(){this.config=yield this.service.getConfig(),this.components=this.config.listActiveComponents([],this.service.translate),this.components.forEach(e=>{e.components.forEach(n=>{n.showProperties=!1,this.subscribedInfoChannels.push(new y(n.id,"State"))})}),this.service.getCurrentEdge().then(e=>{this.edge=e,e.subscribeChannels(this.websocket,t.SELECTOR,this.subscribedInfoChannels)})})}subscribeInfoChannels(e){return ae(this,null,function*(){let n=yield this.getStateChannels(e.id);for(let i of Object.keys(n)){let a=new y(e.id,i);this.subscribedInfoChannels.push(a),this.onInfoChannels.push(a)}this.channels[e.id]=n,this.edge?.subscribeChannels(this.websocket,t.SELECTOR,this.subscribedInfoChannels)})}unsubscribeInfoChannels(e){delete this.channels[e.id],this.onInfoChannels.forEach(n=>{this.subscribedInfoChannels.forEach((i,a)=>{n.channelId==i.channelId&&e.id==i.componentId&&this.subscribedInfoChannels.splice(a,1)})}),this.onInfoChannels=this.onInfoChannels.filter(n=>n.componentId!=e.id),this.edge?.subscribeChannels(this.websocket,t.SELECTOR,this.subscribedInfoChannels)}getStateChannels(e){return new Promise((n,i)=>{if(er.hasChannelsInEdgeConfig(this.edge)){let a={};for(let[m,u]of Object.entries(this.config.components[e].channels))u.category==="STATE"&&(a[m]={text:u.text,level:u.level});n(a);return}this.edge.sendRequest(this.websocket,new Ci({componentId:"_componentManager",payload:new uC({componentId:e})})).then(a=>{let m={};for(let u of a.result.channels)m[u.id]={text:u.text,level:u.level};n(m)}).catch(i)})}static{this.\u0275fac=function(n){return new(n||t)(x(he),x(j),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["statussingle"]],standalone:!1,decls:8,vars:1,consts:[[1,"ion-justify-content-center",2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["translate",""],["slot","end"],[3,"click"],["name","close",2,"color","var(--ion-title-color)"],["lines","full"],["color","primary","name","analytics-outline"],[1,"ion-padding-start"],["color","success","name","checkmark-circle-outline"],["color","success","name","information-outline"],["color","warning","name","warning-outline"],["color","danger","name","alert-circle-outline"],["lines","inset"],[1,"normal-icon",3,"name"],["lines","none"],[1,"ion-text-wrap"],["color","primary"],[1,"custom-channels-text"],["name","arrow-down-circle-outline","color","primary",2,"cursor","pointer"],["name","arrow-up-circle-outline","color","primary",2,"cursor","pointer"],["color","success","translate",""],["color","warning","translate",""],["color","danger","translate",""],["name","arrow-down-circle-outline","color","primary",2,"cursor","pointer",3,"click"],["name","arrow-up-circle-outline","color","primary",2,"cursor","pointer",3,"click"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),h(3,"GENERAL.SYSTEM_STATE"),l(),s(4,"ion-buttons",2)(5,"ion-button",3),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",4),l()()()(),f(7,kD,2,3)),n&2&&(r(7),_(i.edge&&i.components?7:-1))},dependencies:[Ge,Xe,We,je,xt,ie,J,td,ne,zn,He,St,ct,Ne,lt,V],encapsulation:2})}}return t})();var VD=t=>({text:t}),_C=()=>({color:"var(--ion-menu-color)"});function HD(t,o){if(t&1&&(s(0,"oe-flat-button",8),d(1,"ion-icon",9),l()),t&2){let e=p(3);c("link",be(2,VD,e.backUrl)),r(),c("ngStyle",H(4,_C))}}function BD(t,o){if(t&1&&(s(0,"ion-buttons",2),f(1,HD,2,5,"oe-flat-button",8),l()),t&2){let e=p(2);r(),_(e.showBackButton?1:-1)}}function WD(t,o){if(t&1){let e=W();s(0,"ion-buttons",2)(1,"ion-button",10),O("keydown.enter",function(){P(e);let i=p(2);return L(i.toggleMenu())})("click",function(){P(e);let i=p(2);return L(i.toggleMenu())}),d(2,"ion-icon",11),l()()}}function UD(t,o){if(t&1&&(s(0,"ion-title",3),h(1),l()),t&2){let e=p(2);r(),R(" ",e.service.currentPageTitle," ")}}function zD(t,o){if(t&1){let e=W();s(0,"ion-segment",13),O("ionChange",function(i){P(e);let a=p(3);return L(a.segmentChanged(i))}),Zt("ngModelChange",function(i){P(e);let a=p(3);return Qt(a.currentPage,i)||(a.currentPage=i),L(i)}),s(1,"ion-segment-button",14)(2,"ion-label",15),h(3),g(4,"translate"),l()(),s(5,"ion-segment-button",16)(6,"ion-label",15),h(7),g(8,"translate"),l()()()}if(t&2){let e=p(3);Kt("ngModel",e.currentPage),r(3),N(E(4,3,"GENERAL.LIVE")),r(4),N(E(8,5,"GENERAL.HISTORY"))}}function jD(t,o){if(t&1&&f(0,zD,9,7,"ion-segment",12),t&2){let e=p(2);_((e.currentPage==="IndexLive"||e.currentPage==="IndexHistory")&&e.navigationService.position()!==null&&e.navigationService.position()==="disabled"?0:-1)}}function YD(t,o){t&1&&d(0,"ion-icon",19)}function $D(t,o){if(t&1&&d(0,"ion-icon",20),t&2){let e=p(4);c("name",e.roleIsAtLeast("admin")?"information-outline":"checkmark-circle-outline")}}function XD(t,o){t&1&&d(0,"ion-icon",21)}function qD(t,o){t&1&&d(0,"ion-icon",22)}function KD(t,o){if(t&1){let e=W();s(0,"ion-button",18),O("keydown.enter",function(){P(e);let i=p(5);return L(i.presentSingleStatusModal())})("click",function(){P(e);let i=p(5);return L(i.presentSingleStatusModal())}),f(1,YD,1,0,"ion-icon",19)(2,$D,1,1,"ion-icon",20)(3,XD,1,0,"ion-icon",21)(4,qD,1,0,"ion-icon",22),l()}if(t&2){let e,n=p();r(),_((e=n.state)===0?1:e===1?2:e===2?3:e===3?4:-1)}}function QD(t,o){t&1&&f(0,KD,5,1,"ion-button",17),t&2&&_(o.state!==null?0:-1)}function ZD(t,o){if(t&1&&f(0,QD,1,1),t&2){let e;_((e=o.summary.system)?0:-1,e)}}function JD(t,o){if(t&1){let e=W();s(0,"ion-button",23),O("click",function(){P(e);let i=p(3);return L(i.isSystemLogEnabled=!i.isSystemLogEnabled)}),d(1,"ion-icon",24),l()}t&2&&(r(),c("ngStyle",H(1,_C)))}function eR(t,o){if(t&1&&(s(0,"ion-buttons",6),f(1,ZD,1,1),g(2,"async"),f(3,JD,2,2,"ion-button"),l()),t&2){let e,n=o,i=p(2);r(),_((e=E(2,2,n.currentData))?1:-1,e),r(2),_(i.environment.debugMode&&n.roleIsAtLeast("owner")?3:-1)}}function tR(t,o){t&1&&(s(0,"ion-toolbar",7)(1,"ion-buttons",25),d(2,"pickdate"),l()())}function nR(t,o){if(t&1&&(s(0,"ion-header",null,0)(2,"ion-toolbar",1),f(3,BD,2,1,"ion-buttons",2),f(4,WD,3,0,"ion-buttons",2),f(5,UD,2,1,"ion-title",3),s(6,"ion-title",4),h(7),l(),f(8,jD,1,1),d(9,"ion-title",5),f(10,eR,4,4,"ion-buttons",6),l(),f(11,tR,3,0,"ion-toolbar",7),l()),t&2){let e,n,i=p();r(3),_(i.backUrl?3:-1),r(),_(i.enableSideMenu&&i.navigationService.position()!==null?4:-1),r(),_(i.currentPage!=="IndexLive"&&i.currentPage!=="IndexHistory"?5:-1),r(2),R(" ",i.service.currentPageTitle," "),r(),_((e=i.service.currentEdge())?8:-1,e),r(2),_((n=i.service.currentEdge())?10:-1,n),r(),_(i.currentPage==="IndexHistory"&&i.navigationService.position()!=="left"?11:-1)}}var hC=(()=>{class t{constructor(e,n,i,a,m,u,C,v,T){this.cdRef=e,this.menu=n,this.modalCtrl=i,this.router=a,this.service=m,this.websocket=u,this.navigationService=C,this.routeService=v,this.navCtrl=T,this.environment=pt,this.backUrl="/",this.enableSideMenu=!1,this.currentPage="Other",this.isSystemLogEnabled=!1,this.isHeaderAllowed=!1,this.showBackButton=!1,this.ngUnsubscribe=new qt,this._customBackUrl=null,wt(()=>{let A=C.currentNode(),b=v.currentUrl();A&&A.getParents()&&A.getParents().length>0?this.showBackButton=!1:this.showBackButton=!0,this.updateUrl(this.router.routerState.snapshot.url)})}set customBackUrl(e){e&&(this._customBackUrl=e,this.updateBackUrl(e))}ngOnInit(){this.updateUrl(this.router.routerState.snapshot.url),this.router.events.pipe(An(this.ngUnsubscribe),vt(e=>e instanceof ea)).subscribe(e=>{window.scrollTo(0,0),this.updateUrl(e.urlAfterRedirects)})}ngAfterViewChecked(){this.cdRef.detectChanges()}updateUrl(e){this.updateBackUrl(e),this.updateEnableSideMenu(e),this.updateCurrentPage(e),this.isHeaderAllowed=this.isAllowedForView(e)}updateEnableSideMenu(e){let n=e.split("/"),i=n.pop();if(i=="user"||i=="settings"||i=="changelog"||i=="login"||i=="index"||n.length>3){if(this.navigationService.position()!="disabled"){this.enableSideMenu=!0;return}this.enableSideMenu=!1}else this.enableSideMenu=!0}updateCurrentPage(e){let n=e.split("/"),i=n.pop();n.length>=4&&(i=n[3]),(i=="history"||i=="live")&&n.length==3?i=="history"?this.currentPage="IndexHistory":this.currentPage="IndexLive":i=="settings"&&n.length>1?this.currentPage="EdgeSettings":this.currentPage="Other"}segmentChanged(e){e.detail.value=="IndexLive"&&(this.router.navigate(["/device/"+this.service.currentEdge().id+"/live"],{replaceUrl:!0}),this.cdRef.detectChanges()),e.detail.value=="IndexHistory"&&(this.router.navigate(["/device/"+this.service.currentEdge().id+"/history"]),this.cdRef.detectChanges())}presentSingleStatusModal(){return ae(this,null,function*(){return yield(yield this.modalCtrl.create({component:$l})).present()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}toggleMenu(){this.menu.toggle()}updateBackUrl(e){if(this._customBackUrl){this.backUrl=this._customBackUrl;return}if(e==="/login"||e==="/overview"||e==="/index"){this.backUrl=!1;return}let n=this.service.currentEdge();if(e==="/user"&&n!=null){this.backUrl="/device/"+n.id+"/live";return}if(e==="/user"){this.backUrl="/overview";return}if(e==="/changelog"&&n!=null){this.backUrl="/device/"+n.id+"/settings/profile";return}let i=e.split("/"),a="/",m=i.pop();if((m=="history"||m=="live")&&i.length==3){this.backUrl=!1;return}if(m==="live"&&i.length==3&&this.environment.backend==="OpenEMS Edge"){this.backUrl=!1;return}m==="live"&&i.pop(),i.slice(-3,-1).join("/")==="settings/app"&&i.pop(),a=i.join("/")||"/",a==="/device"&&(a="/"),this.backUrl=a}isAllowedForView(e){let n=e.split("?")[0];if(e.includes("/history/"))return!1;switch(n){case"/login":case"/index":case"/demo":return!1;default:return!0}}static{this.\u0275fac=function(n){return new(n||t)(x(ln),x(yr),x(he),x(It),x(j),x(Ce),x(fn),x(Ko),x(Xo))}}static{this.\u0275cmp=I({type:t,selectors:[["app-header"]],viewQuery:function(n,i){if(n&1&&wn(In,5),n&2){let a;bn(a=Dn())&&(i.PickDateComponent=a.first)}},inputs:{customBackUrl:"customBackUrl"},standalone:!1,decls:1,vars:1,consts:[["appHeader",""],["mode","md",2,"--background","var(--ion-color-toolbar-primary)"],["slot","start"],["slot","start",1,"ion-hide-md-up",2,"color","var(--ion-title-color)"],["slot","start",1,"ion-hide-md-down",2,"color","var(--ion-title-color)"],["slot","end",1,"ion-hide-md-down"],["slot","end",1,"ion-padding-end"],["color","secondary"],["color","light",3,"link"],["name","arrow-back-outline",3,"ngStyle"],[1,"custom-menu-button",3,"keydown.enter","click"],["slot","icon-only","name","menu"],["mode","md",1,"ion-justify-content-center",3,"ngModel"],["mode","md",1,"ion-justify-content-center",3,"ionChange","ngModelChange","ngModel"],["tabindex","0","value","IndexLive",1,"focus-visible",2,"--indicator-color","var(--ion-segment-button-color)","--color","var(--ion-color-primary)","color","var(--ion-color-primary)","min-width","fit-content"],[2,"color","var(--ion-color-header-contrast)"],["value","IndexHistory",2,"--indicator-color","var(--ion-segment-button-color)","--color","var(--ion-color-primary)","color","var(--ion-text-color)","min-width","fit-content"],["fill","solid","shape","round",1,"ion-toolbar-button"],["fill","solid","shape","round",1,"ion-toolbar-button",3,"keydown.enter","click"],["color","success","name","checkmark-circle-outline",2,"font-size","1.438rem","filter","drop-shadow(0 0.063rem 0.063rem var(--ion-color-success))"],["color","success","size","medium",2,"font-size","1.438rem","filter","drop-shadow(0 0.063rem 0.063rem var(--ion-color-success))",3,"name"],["color","warning","name","warning-outline",2,"font-size","1.438rem","filter","drop-shadow(0 0.063rem 0.063rem var(--ion-color-warning))"],["color","danger","name","alert-circle-outline",2,"font-size","1.438rem","filter","drop-shadow(0 0.063rem 0.063rem var(--ion-color-danger))"],[3,"click"],["name","bug-outline",3,"ngStyle"],[1,"ion-justify-content-center"]],template:function(n,i){n&1&&f(0,nR,12,7,"ion-header"),n&2&&_(i.isHeaderAllowed?0:-1)},dependencies:[In,Yo,Ie,Tn,Ge,Xe,xt,ie,ne,ri,ai,St,ct,$e,qi,lt,V],encapsulation:2})}}return t})();var oR=t=>({text:t}),CC=()=>({color:"var(--ion-menu-color)"});function rR(t,o){if(t&1&&(s(0,"oe-flat-button",8),d(1,"ion-icon",9),l()),t&2){let e=p(3);c("link",be(2,oR,e.backUrl)),r(),c("ngStyle",H(4,CC))}}function aR(t,o){if(t&1&&(s(0,"ion-buttons",2),f(1,rR,2,5,"oe-flat-button",8),l()),t&2){let e=p(2);r(),_(e.showBackButton?1:-1)}}function sR(t,o){if(t&1){let e=W();s(0,"ion-buttons",2)(1,"ion-button",10),O("keydown.enter",function(){P(e);let i=p(2);return L(i.toggleMenu())})("click",function(){P(e);let i=p(2);return L(i.toggleMenu())}),d(2,"ion-icon",11),l()()}}function lR(t,o){if(t&1&&(s(0,"ion-title",3),h(1),l()),t&2){let e=p(2);r(),R(" ",e.service.currentPageTitle," ")}}function cR(t,o){if(t&1){let e=W();s(0,"ion-segment",13),O("ionChange",function(i){P(e);let a=p(3);return L(a.segmentChanged(i))}),Zt("ngModelChange",function(i){P(e);let a=p(3);return Qt(a.currentPage,i)||(a.currentPage=i),L(i)}),s(1,"ion-segment-button",14)(2,"ion-label",15),h(3),g(4,"translate"),l()(),s(5,"ion-segment-button",16)(6,"ion-label",15),h(7),g(8,"translate"),l()()()}if(t&2){let e=p(3);Kt("ngModel",e.currentPage),r(3),N(E(4,3,"GENERAL.LIVE")),r(4),N(E(8,5,"GENERAL.HISTORY"))}}function mR(t,o){if(t&1&&f(0,cR,9,7,"ion-segment",12),t&2){let e=p(2);_((e.currentPage==="IndexLive"||e.currentPage==="IndexHistory")&&e.navigationService.position()!==null&&e.navigationService.position()==="disabled"?0:-1)}}function pR(t,o){t&1&&d(0,"ion-icon",19)}function dR(t,o){if(t&1&&d(0,"ion-icon",20),t&2){let e=p(4);c("name",e.roleIsAtLeast("admin")?"information-outline":"checkmark-circle-outline")}}function uR(t,o){t&1&&d(0,"ion-icon",21)}function fR(t,o){t&1&&d(0,"ion-icon",22)}function _R(t,o){if(t&1){let e=W();s(0,"ion-button",18),O("keydown.enter",function(){P(e);let i=p(5);return L(i.presentSingleStatusModal())})("click",function(){P(e);let i=p(5);return L(i.presentSingleStatusModal())}),f(1,pR,1,0,"ion-icon",19)(2,dR,1,1,"ion-icon",20)(3,uR,1,0,"ion-icon",21)(4,fR,1,0,"ion-icon",22),l()}if(t&2){let e,n=p();r(),_((e=n.state)===0?1:e===1?2:e===2?3:e===3?4:-1)}}function hR(t,o){t&1&&f(0,_R,5,1,"ion-button",17),t&2&&_(o.state!==null?0:-1)}function CR(t,o){if(t&1&&f(0,hR,1,1),t&2){let e;_((e=o.summary.system)?0:-1,e)}}function gR(t,o){if(t&1){let e=W();s(0,"ion-button",23),O("click",function(){P(e);let i=p(3);return L(i.isSystemLogEnabled=!i.isSystemLogEnabled)}),d(1,"ion-icon",24),l()}t&2&&(r(),c("ngStyle",H(1,CC)))}function ER(t,o){if(t&1&&(s(0,"ion-buttons",6),f(1,CR,1,1),g(2,"async"),f(3,gR,2,2,"ion-button"),l()),t&2){let e,n=o,i=p(2);r(),_((e=E(2,2,n.currentData))?1:-1,e),r(2),_(i.environment.debugMode&&n.roleIsAtLeast("owner")?3:-1)}}function vR(t,o){t&1&&(s(0,"ion-toolbar",7)(1,"ion-buttons",25),d(2,"pickdate"),l()())}function yR(t,o){if(t&1&&(s(0,"ion-header",null,0)(2,"ion-toolbar",1),f(3,aR,2,1,"ion-buttons",2),f(4,sR,3,0,"ion-buttons",2),f(5,lR,2,1,"ion-title",3),s(6,"ion-title",4),h(7),l(),f(8,mR,1,1),d(9,"ion-title",5),f(10,ER,4,4,"ion-buttons",6),l(),f(11,vR,3,0,"ion-toolbar",7),l()),t&2){let e,n,i=p();r(3),_(i.backUrl?3:-1),r(),_(i.enableSideMenu&&i.navigationService.position()!==null?4:-1),r(),_(i.currentPage!=="IndexLive"&&i.currentPage!=="IndexHistory"?5:-1),r(2),R(" ",i.service.currentPageTitle," "),r(),_((e=i.service.currentEdge())?8:-1,e),r(2),_((n=i.service.currentEdge())?10:-1,n),r(),_(i.currentPage==="IndexHistory"&&i.navigationService.position()!=="left"?11:-1)}}var gC=(()=>{class t{constructor(e,n,i,a,m,u,C,v,T,A){this.cdRef=e,this.menu=n,this.modalCtrl=i,this.router=a,this.routeService=m,this.service=u,this.websocket=C,this.navigationService=v,this.navCtrl=T,this.menuCtrl=A,this.environment=pt,this.backUrl="/",this.currentPage="Other",this.isSystemLogEnabled=!1,this.isHeaderAllowed=!0,this.showBackButton=!1,this.ngUnsubscribe=new qt,this._customBackUrl=null,wt(()=>{this.showBackButton=this.navigationService.headerOptions().showBackButton})}set customBackUrl(e){e&&(this._customBackUrl=e,this.updateBackUrl(e))}ngOnInit(){this.updateUrl(this.router.routerState.snapshot.url),this.router.events.pipe(An(this.ngUnsubscribe),vt(e=>e instanceof ea)).subscribe(e=>{window.scrollTo(0,0),this.updateUrl(e.urlAfterRedirects)})}ngAfterViewChecked(){this.cdRef.detectChanges()}updateUrl(e){this.updateBackUrl(e),this.updateEnableSideMenu(e),this.updateCurrentPage(e)}updateEnableSideMenu(e){let n=e.split("/"),i=n.pop();i=="user"||i=="settings"||i=="changelog"||i=="login"||i=="index"||n.length>3?this.enableSideMenu=!1:this.enableSideMenu=!0}updateBackUrl(e){if(this._customBackUrl){this.backUrl=this._customBackUrl;return}if(e==="/login"||e==="/overview"||e==="/index"){this.backUrl=!1;return}let n=this.service.currentEdge();if(e==="/user"&&n!=null){this.backUrl="/device/"+n.id+"/live";return}if(e==="/user"){this.backUrl="/overview";return}if(e==="/changelog"&&n!=null){this.backUrl="/device/"+n.id+"/settings/profile";return}let i=e.split("/"),a="/",m=i.pop();if((m=="history"||m=="live")&&i.length==3){this.backUrl=!1;return}if(m==="live"&&i.length==3&&this.environment.backend==="OpenEMS Edge"){this.backUrl=!1;return}m==="live"&&i.pop(),i.slice(-3,-1).join("/")==="settings/app"&&i.pop(),a=i.join("/")||"/",a==="/device"&&(a="/"),this.backUrl=a}updateCurrentPage(e){let n=e.split("/"),i=n.pop();n.length>=4&&(i=n[3]),(i=="history"||i=="live")&&n.length==3?i=="history"?this.currentPage="IndexHistory":this.currentPage="IndexLive":i=="settings"&&n.length>1?this.currentPage="EdgeSettings":this.currentPage="Other"}segmentChanged(e){e.detail.value=="IndexLive"&&(this.navCtrl.navigateRoot(["/device/"+this.service.currentEdge().id+"/live"],{replaceUrl:!0}),this.cdRef.detectChanges()),e.detail.value=="IndexHistory"&&(this.navCtrl.navigateRoot(["/device/"+this.service.currentEdge().id+"/history"]),this.cdRef.detectChanges())}presentSingleStatusModal(){return ae(this,null,function*(){return yield(yield this.modalCtrl.create({component:$l})).present()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}toggleMenu(){this.menu.toggle()}static{this.\u0275fac=function(n){return new(n||t)(x(ln),x(yr),x(he),x(It),x(Ko),x(j),x(Ce),x(fn),x(Xo),x(yr))}}static{this.\u0275cmp=I({type:t,selectors:[["header"]],viewQuery:function(n,i){if(n&1&&wn(In,5),n&2){let a;bn(a=Dn())&&(i.PickDateComponent=a.first)}},inputs:{customBackUrl:"customBackUrl"},standalone:!1,decls:1,vars:1,consts:[["appHeader",""],["mode","md",2,"--background","var(--ion-color-toolbar-primary)"],["slot","start"],["slot","start",1,"ion-hide-md-up",2,"color","var(--ion-title-color)"],["slot","start",1,"ion-hide-md-down",2,"color","var(--ion-title-color)"],["slot","end",1,"ion-hide-md-down"],["slot","end",1,"ion-padding-end"],["color","secondary"],["color","light",3,"link"],["name","arrow-back-outline",3,"ngStyle"],[1,"custom-menu-button",3,"keydown.enter","click"],["slot","icon-only","name","menu"],["mode","md",1,"ion-justify-content-center",3,"ngModel"],["mode","md",1,"ion-justify-content-center",3,"ionChange","ngModelChange","ngModel"],["tabindex","0","value","IndexLive",1,"focus-visible",2,"--indicator-color","var(--ion-segment-button-color)","--color","var(--ion-color-primary)","color","var(--ion-color-primary)","min-width","fit-content"],[2,"color","var(--ion-color-header-contrast)"],["value","IndexHistory",2,"--indicator-color","var(--ion-segment-button-color)","--color","var(--ion-color-primary)","color","var(--ion-text-color)","min-width","fit-content"],["fill","solid","shape","round",1,"ion-toolbar-button"],["fill","solid","shape","round",1,"ion-toolbar-button",3,"keydown.enter","click"],["color","success","name","checkmark-circle-outline",2,"font-size","1.438rem","filter","drop-shadow(0 0.063rem 0.063rem var(--ion-color-success))"],["color","success","size","medium",2,"font-size","1.438rem","filter","drop-shadow(0 0.063rem 0.063rem var(--ion-color-success))",3,"name"],["color","warning","name","warning-outline",2,"font-size","1.438rem","filter","drop-shadow(0 0.063rem 0.063rem var(--ion-color-warning))"],["color","danger","name","alert-circle-outline",2,"font-size","1.438rem","filter","drop-shadow(0 0.063rem 0.063rem var(--ion-color-danger))"],[3,"click"],["name","bug-outline",3,"ngStyle"],[1,"ion-justify-content-center"]],template:function(n,i){n&1&&f(0,yR,12,7,"ion-header"),n&2&&_(i.isHeaderAllowed?0:-1)},dependencies:[In,Yo,Ie,Tn,Ge,Xe,xt,ie,ne,ri,ai,St,ct,$e,qi,lt,V],encapsulation:2})}}return t})();var EC=(()=>{class t{constructor(e,n){this.el=e,this.logger=n}ngOnInit(){Ls.getPlatform()==="ios"&&setTimeout(()=>{try{this.el.nativeElement.children[0].addEventListener("change",e=>{this.el.nativeElement.value=e.target.value})}catch{console.error("Android Autofill Directive inactive")}},100)}static{this.\u0275fac=function(n){return new(n||t)(x(fo),x(Jo))}}static{this.\u0275dir=Wi({type:t,selectors:[["","appAutofill",""]],standalone:!1})}}return t})();var xa=(()=>{class t{constructor(e,n){this.templateRef=e,this.vcRef=n,this.context={$implicit:null,ngVar:null},this.hasView=!1}set ngVar(e){this.context.$implicit=this.context.ngVar=e,this.hasView||(this.vcRef.createEmbeddedView(this.templateRef,this.context),this.hasView=!0)}static{this.\u0275fac=function(n){return new(n||t)(x(vp),x(Tp))}}static{this.\u0275dir=Wi({type:t,selectors:[["","ngVar",""]],inputs:{ngVar:"ngVar"},standalone:!1})}}return t})();var Mm=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({providers:[xa,EC],imports:[Te]})}}return t})();function IR(t){return/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t.value)?null:{ip:!0}}function xR(t){return/^(255)\.(0|128|192|224|240|248|252|254|255)\.(0|128|192|224|240|248|252|254|255)\.(0|128|192|224|240|248|252|254|255)/.test(t.value)?null:{subnetmask:!0}}function SR(t,o){return`"${o.formControl.value}" is not a valid IP Address`}function AR(t,o){return`"${o.formControl.value}" is not a valid Subnetmask`}var ue=(()=>{class t{constructor(e){this.injector=e,t.injector=e}static{this.\u0275fac=function(n){return new(n||t)(Jt(Oo))}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({providers:[Zo,Jo,Ko,j,M,Ce],imports:[tr,lo,Et,Fa,Mm,rn.forRoot({wrappers:[{name:"form-field",component:Kh},{name:"input-serial-number",component:mC},{name:"formly-select-extended-wrapper",component:oC},{name:"formly-field-radio-with-image",component:Jh},{name:"form-field-checkbox-hyperlink",component:$h},{name:"formly-wrapper-default-of-cases",component:Xh},{name:"panel",component:pC},{name:"formly-field-modal",component:Rm},{name:"formly-field-navigation",component:Om},{name:"formly-field-checkbox-with-image",component:Zh},{name:"formly-current-user-alerting",component:Uh},{name:"formly-other-users-alerting",component:zh}],types:[{name:"help-popover-label-with-description-and-checkbox",component:lC},{name:"input",component:cC},{name:"repeat",component:dC},{name:"multi-step",component:qh},{name:"select",component:nC},{name:"checkbox-button",component:Qh},{name:"radio",component:tC},{name:"tariff-table",component:sC},{name:"range",component:eC}],validators:[{name:"ip",validation:IR},{name:"subnetmask",validation:xR}],validationMessages:[{name:"ip",message:SR},{name:"subnetmask",message:AR}]}),Mo,_n,Ve,Dm,gi.forRoot({type:"ball-clip-rotate-multiple"}),Na,st,na,an,dr,qi,lo,Et,Fa,Mm,Wh,rn,Mo,_n,Ve,Dm,Sr,gi,Na,st,na,an]})}}return t})();Cc(Rm,function(){return[Hn,yn,ho,Co,Nn,Mn,Vt,sn,Sn,Ma,Ac,me,Ke,Wn,Un,ie,ot]},[]);Cc(Om,function(){return[li,Nn,Mn,Vt,sn,Ma,Ac,me,Ke,ot]},[]);var eo=(()=>{class t{constructor(){this.SKIP_COUNT=2,this.fields=[],this.form=new hi({}),this.formlyWrapper="formly-field-modal",this.stopOnDestroy=new qt,this.skipCurrentData=!1,this.injector=Ro(Oo),this.subscription=null;let e=ue.injector.get(j);this.translate=ue.injector.get(te),this.dataService=Ro(kt);let n=Ro(Ce);e.getCurrentEdge().then(i=>ae(this,null,function*(){i.getConfig(e.websocket).pipe(vt(a=>!!a),pn(1)).subscribe(()=>this.subscribeChannels(e)),i.getConfig(e.websocket).pipe(vt(a=>!!a),An(this.stopOnDestroy)).subscribe(a=>{let m=this.generateView(a,i.role,this.translate);this.form=this.getFormGroup(),this.fields=[{type:"input",props:{attributes:{title:m.title},required:!0,options:[{lines:m.lines,component:m.component}],onSubmit:u=>{this.applyChanges(u,e,n,m.component??null,m.edge??null)}},className:"ion-full-height",wrappers:[this.formlyWrapper],form:this.form}]})}))}ngOnDestroy(){return ae(this,null,function*(){this.stopOnDestroy.next(),this.stopOnDestroy.complete(),this.dataService?.unsubscribeFromChannels(yield this.getChannelAddresses())})}subscribeChannels(e){return ae(this,null,function*(){let n=yield this.getChannelAddresses(),i=yield e.getCurrentEdge();Lt.assertIsDefined(i),this.dataService.getValues(n,i),this.fetchCurrentData(e)})}fetchCurrentData(e){return ae(this,null,function*(){let n=0;this.subscription=wt(()=>{let i=this.dataService.currentValue();if(this.skipCurrentData&&n<this.SKIP_COUNT){n++;return}this.skipCurrentData=!1,e.stopSpinner("formly-field-modal"),n=0,this.onCurrentData(i)},{injector:this.injector})})}onCurrentData(e){}getChannelAddresses(){return ae(this,null,function*(){return[]})}applyChanges(e,n,i,a,m){Lt.assertIsDefined(a),Lt.assertIsDefined(m);let u=[];n.startSpinner("formly-field-modal");for(let C in e.controls){let v=e.controls[C];e.controls[C],!v.pristine&&u.push({name:C,value:e.value[C]})}if(!m||!a)throw new Error("Either edge or component not provided");m.updateComponentConfig(i,a.id,u).then(()=>{n.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(C=>{n.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+C.error.message,"danger")}).finally(()=>{this.skipCurrentData=!0,e.markAsPristine(),n.stopSpinner("formly-field-modal")})}getFormGroup(){return new hi({})}setFormControlSafely(e,n,i,a){if(this.skipCurrentData||e.dirty||e.touched||!a||i.allComponents[a.toString()]==null)return;let m=Vi.findFormControlsValueSafely(e,n),u=i.allComponents[a.toString()];u!=null&&m!==u&&(e.controls[n].setValue(u),e.controls[n].markAsTouched())}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275dir=Wi({type:t})}}return t})();var yC=(()=>{class t extends eo{constructor(e,n){super(),this.route=e,this.service=n,this.formlyWrapper="formly-field-navigation",this.component=null,this.energySessionLimitChannel=null}static generateView(e,n,i){Lt.assertIsDefined(n),Lt.assertIsDefined(i);let a=[{type:"value-from-form-control-line",name:e.instant("EVSE_SINGLE.SETTINGS.ENERGY_LIMIT"),controlName:"manualEnergySessionLimit",converter:Be.WATT_HOURS_IN_KILO_WATT_HOURS},{type:"range-button-from-form-control-line",controlName:"manualEnergySessionLimit",properties:{tickMin:0,tickMax:1e5,step:1e3,tickFormatter:m=>Be.WATT_HOURS_IN_KILO_WATT_HOURS(m),pinFormatter:m=>Be.WATT_HOURS_IN_KILO_WATT_HOURS(m)}}];return{title:bi.METER_ALIAS_OR_ID(n),lines:a,component:n,edge:i}}onCurrentData(e){this.setFormControlSafely(this.form,"manualEnergySessionLimit",e,this.energySessionLimitChannel)}generateView(e,n){this.component=e.getComponent(this.route.snapshot.params.componentId);let i=this.service.currentEdge();return t.generateView(this.translate,this.component,i)}getFormGroup(){return Object.keys(this.form.controls).length>0?this.form:new hi({manualEnergySessionLimit:new K(null)})}getChannelAddresses(){return ae(this,null,function*(){let n=(yield this.service.getConfig()).getComponent(this.route.snapshot.params.componentId);return!n||!n.id?[]:(this.energySessionLimitChannel=new y(n.id,"_PropertyManualEnergySessionLimit"),[this.energySessionLimitChannel])})}static{this.\u0275fac=function(n){return new(n||t)(x(De),x(j))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[vn([{provide:kt,useClass:ci}]),S],decls:1,vars:2,consts:[[2,"display","block","height","inherit",3,"form","fields"]],template:function(n,i){n&1&&d(0,"formly-form",0),n&2&&c("form",i.form)("fields",i.fields)},dependencies:[si],styles:["formly-form{height:100%!important}"]})}}return t})();function wR(t,o){if(t&1&&(s(0,"oe-navigation-view",0),d(1,"app-update"),l()),t&2){let e=p();c("title",e.component.alias)("component",e.component)}}var TC=(()=>{class t extends Wt{updateComponent(e){return ae(this,null,function*(){return new Promise(n=>{this.route.params.pipe(vt(i=>i!=null),pn(1)).subscribe(i=>{this.component=e.getComponent(i.componentId),n()})})})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title","component"]],template:function(n,i){n&1&&f(0,wR,2,2,"oe-navigation-view",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[li,da],encapsulation:2})}}return t})();var bR=()=>({color:"primary",name:"power-outline"}),DR=(t,o)=>({name:t,value:"OFF",icon:o}),RR=()=>({color:"primary",name:"caret-down-circle-outline"}),OR=t=>({name:"Low",value:"MANUAL_LOW",icon:t}),NR=()=>({color:"primary",name:"caret-up-circle-outline"}),MR=t=>({name:"High",value:"MANUAL_HIGH",icon:t}),FR=()=>({color:"primary",name:"timer-outline"}),GR=(t,o)=>({name:t,value:"AUTOMATIC",icon:o}),PR=(t,o,e,n)=>[t,o,e,n];function LR(t,o){if(t&1&&d(0,"oe-modal-horizontal-line")(1,"oe-modal-line",6),t&2){let e=p(2);r(),c("converter",e.Utils.CONVERT_WATT_TO_KILOWATT)("channelAddress",e.component.id+"/ActivePower")}}function kR(t,o){if(t&1&&d(0,"oe-modal-line",3),t&2){let e=p(2);c("converter",e.Utils.CONVERT_DEZIDEGREE_CELSIUS_TO_DEGREE_CELSIUS)("channelAddress",e.component.id+"/FloorTarget")}}function VR(t,o){if(t&1&&d(0,"oe-modal-line",5),t&2){let e=p(2);c("converter",e.Utils.CONVERT_DEZIDEGREE_CELSIUS_TO_DEGREE_CELSIUS)("channelAddress",e.component.id+"/AmbientTarget")}}function HR(t,o){if(t&1&&d(0,"oe-modal-horizontal-line")(1,"oe-modal-line",7),t&2){let e=p(2);r(),c("channelAddress",e.component.id+"/_PropertySchedule")}}function BR(t,o){if(t&1&&(s(0,"oe-navigation-view",0),d(1,"oe-modal-buttons",1),g(2,"translate"),g(3,"translate"),f(4,LR,2,2),d(5,"oe-modal-horizontal-line")(6,"oe-modal-line",2),f(7,kR,1,2,"oe-modal-line",3),d(8,"oe-modal-horizontal-line")(9,"oe-modal-line",4),f(10,VR,1,2,"oe-modal-line",5),f(11,HR,2,1),l()),t&2){let e=p();c("title",e.component.alias)("component",e.component)("formGroup",e.formGroup),r(),c("formGroup",e.formGroup)("component",e.component)("buttons",Zr(32,PR,at(19,DR,E(2,14,"GENERAL.OFF"),H(18,bR)),be(23,OR,H(22,RR)),be(26,MR,H(25,NR)),at(29,GR,E(3,16,"GENERAL.AUTOMATIC"),H(28,FR)))),r(3),_(e.formGroup.value.mode!=="OFF"?4:-1),r(2),c("converter",e.Utils.CONVERT_DEZIDEGREE_CELSIUS_TO_DEGREE_CELSIUS)("channelAddress",e.component.id+"/FloorActual"),r(),_(e.formGroup.value.mode!=="OFF"?7:-1),r(2),c("converter",e.Utils.CONVERT_DEZIDEGREE_CELSIUS_TO_DEGREE_CELSIUS)("channelAddress",e.component.id+"/AmbientActual"),r(),_(e.formGroup.value.mode!=="OFF"?10:-1),r(),_(e.formGroup.value.mode==="AUTOMATIC"?11:-1)}}var Fm=(()=>{class t extends Wt{constructor(e,n,i,a,m,u,C){super(e,n,i,a,m,u,C),this.websocket=e,this.route=n,this.service=i,this.modalController=a,this.translate=m,this.formBuilder=u,this.ref=C}updateComponent(e){return ae(this,null,function*(){return new Promise(n=>{this.route.params.pipe(vt(i=>i!=null),pn(1)).subscribe(i=>{this.component=e.getComponent(i.componentId),n()})})})}getFormGroup(){return this.formBuilder.group({mode:new K(this.component.properties.mode)})}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(De),x(j),x(he),x(te),x(Ft),x(ln))}}static{this.\u0275cmp=I({type:t,selectors:[["heatingelement-modal"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title","component","formGroup"],["controlName","mode",3,"formGroup","component","buttons"],["name","Floor Actual",3,"converter","channelAddress"],["name","Floor Target",3,"converter","channelAddress"],["name","Ambient Actual",3,"converter","channelAddress"],["name","Ambient Target",3,"converter","channelAddress"],["name","Power Consumption",3,"converter","channelAddress"],[3,"channelAddress"]],template:function(n,i){n&1&&f(0,BR,12,37,"oe-navigation-view",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[li,Nn,Vt,sn,Ke,ot,V],encapsulation:2})}}return t})();var IC=(()=>{class t extends eo{static generateView(e){return{title:e.instant("GENERAL.AUTARCHY"),lines:[{type:"info-line",name:e.instant("EDGE.INDEX.WIDGETS.AUTARCHY_INFO")}]}}generateView(e,n){return t.generateView(this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[vn([{provide:kt,useClass:ci}]),S],decls:1,vars:2,consts:[[2,"display","block","height","inherit",3,"form","fields"]],template:function(n,i){n&1&&d(0,"formly-form",0),n&2&&c("form",i.form)("fields",i.fields)},dependencies:[si],encapsulation:2})}}return t})();var WR=()=>({name:"oe-grid",color:"normal"});function UR(t,o){if(t&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),d(2,"oe-flat-widget-percentagebar",1),l()),t&2){let e=p();c("title",E(1,4,"GENERAL.AUTARCHY"))("icon",H(6,WR))("modalComponent",e.modalComponent),r(2),c("value",e.percentageValue)}}var xC=(()=>{class t extends ce{constructor(){super(...arguments),this.modalComponent=null}getModalComponent(){return{component:IC}}getChannelAddresses(){return[new y("_sum","GridActivePower"),new y("_sum","ConsumptionActivePower")]}onCurrentData(e){this.percentageValue=M.calculateAutarchy(e.allComponents["_sum/GridActivePower"],e.allComponents["_sum/ConsumptionActivePower"])}afterIsInitialized(){this.modalComponent=this.getModalComponent()}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Common_Autarchy"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon","modalComponent"],[3,"value"]],template:function(n,i){n&1&&f(0,UR,3,7,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,Qi,V],encapsulation:2})}}return t})();var SC=(()=>{class t extends eo{static generateView(e,n){let i=e.getComponentsImplementingNature("io.openems.edge.evcs.api.Evcs").filter(C=>C.factoryId!="Evcs.Cluster.SelfConsumption"&&C.factoryId!="Evcs.Cluster.PeakShaving"&&!e.factories[C.factoryId].natureIds.includes("io.openems.edge.meter.api.ElectricityMeter")&&!!C.isEnabled),a=e.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(C=>C.isEnabled&&e.isTypeConsumptionMetered(C)),m=[];m.push({type:"channel-line",name:n.instant("GENERAL.TOTAL"),channel:"_sum/ConsumptionActivePower",converter:Be.ONLY_POSITIVE_POWER_AND_NEGATIVE_AS_ZERO}),jt.THREE_PHASE.forEach(C=>{m.push({type:"channel-line",name:n.instant("GENERAL.PHASE")+" "+C,indentation:ro.SINGLE,channel:"_sum/ConsumptionActivePower"+C,converter:Be.ONLY_POSITIVE_POWER_AND_NEGATIVE_AS_ZERO})}),i.length>0&&m.push({type:"horizontal-line"}),i.forEach((C,v)=>{m.push({type:"channel-line",name:bi.METER_ALIAS_OR_ID(C),channel:C.id+"/ChargePower",converter:Be.ONLY_POSITIVE_POWER_AND_NEGATIVE_AS_ZERO}),v<i.length-1&&m.push({type:"horizontal-line"})}),a.length>0&&m.push({type:"horizontal-line"}),a.forEach((C,v)=>{m.push({type:"channel-line",name:bi.METER_ALIAS_OR_ID(C),channel:C.id+"/ActivePower",converter:Be.ONLY_POSITIVE_POWER_AND_NEGATIVE_AS_ZERO}),jt.THREE_PHASE.forEach(T=>{m.push({type:"channel-line",name:"Phase "+T,channel:C.id+"/ActivePower"+T,indentation:ro.SINGLE,converter:Be.ONLY_POSITIVE_POWER_AND_NEGATIVE_AS_ZERO})}),v<a.length-1&&m.push({type:"horizontal-line"})}),m.push({type:"horizontal-line"});let u=[new y("_sum","ConsumptionActivePower")];return i.forEach(C=>u.push(new y(C.id,"ChargePower"))),a.forEach(C=>{u.push(new y(C.id,"ActivePower"))}),m.push({type:"value-from-channels-line",name:n.instant("GENERAL.OTHER_CONSUMPTION"),value:C=>Be.ONLY_POSITIVE_POWER_AND_NEGATIVE_AS_ZERO(Be.CALCULATE_CONSUMPTION_OTHER_POWER(i,a,C)),channelsToSubscribe:u}),m.push({type:"info-line",name:n.instant("EDGE.INDEX.WIDGETS.PHASES_INFO")}),{title:n.instant("GENERAL.CONSUMPTION"),lines:m}}generateView(e){return t.generateView(e,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[vn([{provide:kt,useClass:ci}]),S],decls:1,vars:2,consts:[[2,"display","block","height","inherit",3,"form","fields"]],template:function(n,i){n&1&&d(0,"formly-form",0),n&2&&c("form",i.form)("fields",i.fields)},dependencies:[si],encapsulation:2})}}return t})();var jR=()=>({name:"oe-consumption",color:"warning"});function YR(t,o){if(t&1&&d(0,"oe-flat-widget-line",3),t&2){let e=o.$implicit,n=p(3);c("name",e.alias)("channelAddress",e.powerChannel.toString())("converter",n.CONVERT_WATT_TO_KILOWATT)}}function $R(t,o){if(t&1&&fe(0,YR,1,3,"oe-flat-widget-line",3,xe),t&2){let e=p(2);_e(e.evcss)}}function XR(t,o){if(t&1&&d(0,"oe-flat-widget-line",3),t&2){let e=o.$implicit,n=p(3);c("name",e.alias)("channelAddress",e.id+"/ActivePower")("converter",n.CONVERT_WATT_TO_KILOWATT)}}function qR(t,o){if(t&1&&fe(0,XR,1,3,"oe-flat-widget-line",3,xe),t&2){let e=p(2);_e(e.consumptionMeters)}}function KR(t,o){if(t&1&&(d(0,"oe-flat-widget-horizontal-line")(1,"oe-flat-widget-line",4),g(2,"translate")),t&2){let e=p(2);r(),c("name",E(2,3,"GENERAL.OTHER_CONSUMPTION"))("value",e.otherPower)("converter",e.CONVERT_WATT_TO_KILOWATT)}}function QR(t,o){if(t&1&&d(0,"oe-flat-widget-line",2),t&2){let e=p(2);c("value",e.sumActivePower)("converter",e.CONVERT_WATT_TO_KILOWATT)}}function ZR(t,o){if(t&1&&(Y(0,0),s(1,"oe-flat-widget",1),g(2,"translate"),f(3,$R,2,0),f(4,qR,2,0),f(5,KR,3,5)(6,QR,1,2,"oe-flat-widget-line",2),l(),z()),t&2){let e=p();r(),c("icon",H(8,jR))("title",E(2,6,"GENERAL.CONSUMPTION"))("modalComponent",e.modalComponent),r(2),_(e.evcss.length>0?3:-1),r(),_(e.consumptionMeters.length>0?4:-1),r(),_(e.evcss.length!==0||e.consumptionMeters.length!==0?5:6)}}var AC=(()=>{class t extends ce{constructor(){super(...arguments),this.evcss=null,this.consumptionMeters=null,this.sumActivePower=0,this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:SC}}getChannelAddresses(){let e=[new y("_sum","ConsumptionActivePower"),new y("_sum","ConsumptionActivePowerL1"),new y("_sum","ConsumptionActivePowerL2"),new y("_sum","ConsumptionActivePowerL3")];this.consumptionMeters=this.config?.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(n=>{let a=(this.config?.getNatureIdsByFactoryId(n.factoryId)).includes("io.openems.edge.evcs.api.Evcs");return n.isEnabled&&this.config?.isTypeConsumptionMetered(n)&&a===!1});for(let n of this.consumptionMeters)e.push(new y(n.id,"ActivePower"),new y(n.id,"ActivePowerL1"),new y(n.id,"ActivePowerL2"),new y(n.id,"ActivePowerL3"));this.evcss=vi.getComponents(this.config,this.edge);for(let n of this.evcss)e.push(n.powerChannel);return e}onCurrentData(e){this.evcsSumOfChargePower=0;let n=0;this.sumActivePower=e.allComponents["_sum/ConsumptionActivePower"];for(let i of this.evcss)e.allComponents[i.powerChannel.toString()]&&(this.evcsSumOfChargePower+=e.allComponents[i.powerChannel.toString()]);for(let i of this.consumptionMeters)e.allComponents[i.id+"/ActivePower"]&&(n+=e.allComponents[i.id+"/ActivePower"]);this.otherPower=M.subtractSafely(this.sumActivePower,M.addSafely(this.evcsSumOfChargePower,n))}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["consumption"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[1,"all-edges-shadow"],["button","",3,"icon","title","modalComponent"],[3,"value","converter"],[3,"name","channelAddress","converter"],[3,"name","value","converter"]],template:function(n,i){n&1&&f(0,ZR,7,9,"ng-container",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,Ri,we,V],encapsulation:2})}}return t})();var wC=(()=>{class t extends eo{static generateView(e,n,i){let a=[{type:"channel-line",name:i.instant("GENERAL.OFF_GRID"),channel:"_sum/GridMode",filter:Vs.GRID_MODE_IS_OFF_GRID,converter:Be.HIDE_VALUE}],m=Object.values(e.components).filter(u=>e?.isTypeGrid(u));m.length>1&&(t.getLines(e,i,a),a.push({type:"channel-line",name:i.instant("GENERAL.GRID_SELL_ADVANCED"),channel:"_sum/GridActivePower",converter:Be.GRID_SELL_POWER_OR_ZERO},{type:"channel-line",name:i.instant("GENERAL.GRID_BUY_ADVANCED"),channel:"_sum/GridActivePower",converter:Be.GRID_BUY_POWER_OR_ZERO},{type:"horizontal-line"}));for(let u of m)m.length===1?(t.getLines(e,i,a),a.push({type:"channel-line",name:i.instant("GENERAL.GRID_SELL_ADVANCED"),channel:u.id+"/ActivePower",converter:Be.GRID_SELL_POWER_OR_ZERO},{type:"channel-line",name:i.instant("GENERAL.GRID_BUY_ADVANCED"),channel:u.id+"/ActivePower",converter:Be.GRID_BUY_POWER_OR_ZERO})):a.push({type:"channel-line",name:bi.SUFFIX_FOR_GRID_SELL_OR_GRID_BUY(i,u.alias),channel:u.id+"/ActivePower",converter:Be.POWER_IN_WATT}),a.push(...t.generatePhasesView(u,i,n),{type:"horizontal-line"});return m.length>0&&a.push({type:"info-line",name:i.instant("EDGE.INDEX.WIDGETS.PHASES_INFO")}),{title:i.instant("GENERAL.GRID"),lines:a}}static generatePhasesView(e,n,i){return jt.THREE_PHASE.map(a=>({type:"children-line",name:{channel:y.fromString(e.id+"/ActivePower"+a),converter:bi.SUFFIX_FOR_GRID_SELL_OR_GRID_BUY(n,n.instant("GENERAL.PHASE")+" "+a)},indentation:ro.SINGLE,children:t.generatePhasesLineItems(i,a,e)}))}static generatePhasesLineItems(e,n,i){let a=[];return Rt.isAtLeast(e,Rt.INSTALLER)&&a.push({type:"item",channel:i.id+"/Voltage"+n,converter:Be.VOLTAGE_IN_MILLIVOLT_TO_VOLT},{type:"item",channel:i.id+"/Current"+n,converter:Be.CURRENT_IN_MILLIAMPERE_TO_ABSOLUTE_AMPERE}),a.push({type:"item",channel:i.id+"/ActivePower"+n,converter:Be.POSITIVE_POWER}),a}static getLines(e,n,i){let a=Yt.isControllerEnabled(e,"Controller.Ess.Limiter14a"),m="4,2 kW",u=Yt.isControllerEnabled(e,"Controller.Ess.RippleControlReceiver"),C=e.getComponentIdsByFactory("Controller.Ess.Limiter14a")?.[0]??null,v=e.getComponentIdsByFactory("Controller.Ess.RippleControlReceiver")?.[0]??null;i.push({type:"value-from-channels-line",name:n.instant("GENERAL.STATE"),value:T=>Be.GRID_STATE_TO_MESSAGE(n,T),channelsToSubscribe:[...this.getChannelsFromController(e)]}),u&&i.push({type:"value-from-channels-line",name:n.instant("GRID_STATES.FEED_IN_LIMITATION"),value:T=>{let A=Ll(T.allComponents[v+"/RestrictionMode"])??0;return A+" % ("+n.instant("GRID_STATES.RIPPLE_CONTROL_RECEIVER")+" "+(100-A)+"%)"},channelsToSubscribe:[new y(v,"RestrictionMode")],filter:T=>{let A=T?.allComponents[v+"/RestrictionMode"]??null;return A==null?!0:A!==xr.NO_RESTRICTION}}),a&&i.push({type:"value-from-channels-line",name:n.instant("GRID_STATES.FEED_IN_DESCRIPITON"),value:T=>T.allComponents[C+"/RestrictionMode"]==yo.ON?m:"-",channelsToSubscribe:[new y(C,"RestrictionMode")],filter:T=>{let A=T?.allComponents[C+"/RestrictionMode"]??null;return A==null?!0:A!==yo.OFF}}),(a||u)&&i.push({type:"horizontal-line"})}static getChannelsFromController(e){let n=[new y("_sum","GridMode")],i=Yt.isControllerEnabled(e,"Controller.Ess.Limiter14a"),a=Yt.isControllerEnabled(e,"Controller.Ess.RippleControlReceiver"),m=e.getComponentIdsByFactory("Controller.Ess.Limiter14a")[0],u=e.getComponentIdsByFactory("Controller.Ess.RippleControlReceiver")[0];return i&&n.push(new y(m,"RestrictionMode")),a&&n.push(new y(u,"RestrictionMode")),n}generateView(e,n){return t.generateView(e,n,this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[vn([{provide:kt,useClass:ci}]),S],decls:1,vars:2,consts:[[2,"display","block","height","inherit",3,"form","fields"]],template:function(n,i){n&1&&d(0,"formly-form",0),n&2&&c("form",i.form)("fields",i.fields)},dependencies:[si],encapsulation:2})}}return t})();function eO(t,o){if(t&1&&(d(0,"oe-flat-widget-line",3),g(1,"translate"),d(2,"oe-flat-widget-horizontal-line")),t&2){let e=p();c("name",E(1,3,"GENERAL.STATE"))("value",e.gridState)("leftColumnWidth",10)}}function tO(t,o){t&1&&(d(0,"oe-flat-widget-line",2),g(1,"translate")),t&2&&c("name",E(1,1,"GENERAL.OFF_GRID"))}var Xl=class t extends ce{constructor(){super(...arguments),this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.GridMode=Oa,this.icon=null,this.isActivated=!1,this.modalComponent=null}static{this.RESTRICTION_MODE_14A=new y("ctrlEssLimiter14a0","RestrictionMode")}static{this.GRID_ACTIVE_POWER=new y("_sum","GridActivePower")}static{this.GRID_MODE=new y("_sum","GridMode")}static{this.RESTRICTION_MODE_RCR=new y("ctrlEssRippleControlReceiver0","RestrictionMode")}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:wC,componentProps:{edge:this.edge}}}getChannelAddresses(){let o=[t.GRID_ACTIVE_POWER,t.GRID_MODE,new y("_sum","GridActivePowerL1"),new y("_sum","GridActivePowerL2"),new y("_sum","GridActivePowerL3")];return Yt.isControllerEnabled(this.config,"Controller.Ess.Limiter14a")&&o.push(t.RESTRICTION_MODE_14A),Yt.isControllerEnabled(this.config,"Controller.Ess.RippleControlReceiver")&&o.push(t.RESTRICTION_MODE_RCR),o}onCurrentData(o){this.isActivated=Yt.isControllerEnabled(this.config,"Controller.Ess.Limiter14a")||Yt.isControllerEnabled(this.config,"Controller.Ess.RippleControlReceiver"),this.gridMode=o.allComponents[t.GRID_MODE.toString()],this.gridState=Be.GRID_STATE_TO_MESSAGE(this.translate,o);let e=o.allComponents[t.GRID_ACTIVE_POWER.toString()];this.gridBuyPower=e,this.gridSellPower=M.multiplySafely(e,-1),this.icon=Yt.getCurrentGridIcon(o)}static{this.\u0275fac=(()=>{let o;return function(n){return(o||(o=D(t)))(n||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["grid"]],standalone:!1,features:[S],decls:8,vars:17,consts:[[3,"icon","title","modalComponent"],[3,"name","value","converter"],[3,"name"],[3,"name","value","leftColumnWidth"]],template:function(e,n){e&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),f(2,eO,3,5),d(3,"oe-flat-widget-line",1),g(4,"translate"),d(5,"oe-flat-widget-line",1),g(6,"translate"),f(7,tO,2,3,"oe-flat-widget-line",2),l()),e&2&&(c("icon",n.icon)("title",E(1,11,"GENERAL.GRID"))("modalComponent",n.modalComponent),r(2),_(n.isActivated?2:-1),r(),c("name",E(4,13,"GENERAL.GRID_SELL_ADVANCED"))("value",n.gridSellPower)("converter",n.CONVERT_WATT_TO_KILOWATT),r(2),c("name",E(6,15,"GENERAL.GRID_BUY_ADVANCED"))("value",n.gridBuyPower)("converter",n.CONVERT_WATT_TO_KILOWATT),r(2),_(n.gridMode===n.GridMode.OFF_GRID?7:-1))},dependencies:[pe,Ri,we,V],encapsulation:2})}};var iO=()=>["L1","L2","L3"];function oO(t,o){if(t&1&&(d(0,"oe-modal-line",2),g(1,"translate"),d(2,"oe-modal-horizontal-line")),t&2){let e=p(2);c("name",E(1,2,"GENERAL.TOTAL"))("converter",e.CONVERT_TO_WATT)}}function rO(t,o){if(t&1&&d(0,"oe-electricity-meter",3)(1,"oe-modal-horizontal-line"),t&2){let e=o.$implicit;c("component",e)}}function aO(t,o){if(t&1&&fe(0,rO,2,1,null,null,xe),t&2){let e=p(2);_e(e.productionMeters)}}function sO(t,o){if(t&1&&(d(0,"oe-modal-line",5),g(1,"translate")),t&2){let e=o.$implicit,n=p(3);c("textIndent",n.TextIndentation.SINGLE)("name",E(1,4,"GENERAL.PHASE")+"\xA0"+e)("channelAddress","_sum/ProductionAcActivePower"+e)("converter",n.CONVERT_TO_WATT)}}function lO(t,o){if(t&1&&d(0,"oe-electricity-meter",3)(1,"oe-modal-horizontal-line",6),t&2){let e=o.$implicit,n=o.$index,i=p(3);c("component",e),r(),c("index",n)("components",i.productionMeters)}}function cO(t,o){t&1&&d(0,"oe-modal-horizontal-line")}function mO(t,o){if(t&1&&(d(0,"oe-modal-line",4),g(1,"translate"),fe(2,sO,2,6,"oe-modal-line",5,xe),d(4,"oe-modal-horizontal-line"),fe(5,lO,2,3,null,null,xe),f(7,cO,1,0,"oe-modal-horizontal-line")),t&2){let e=p(2);c("converter",e.CONVERT_TO_WATT)("name",E(1,4,"GENERAL.TOTAL")+(e.chargerComponents.length>0?"\xA0AC":""))("channelAddress","_sum/ProductionAcActivePower"),r(2),_e(H(6,iO)),r(3),_e(e.productionMeters),r(2),_(e.chargerComponents.length>0?7:-1)}}function pO(t,o){if(t&1&&(d(0,"oe-modal-line",7),g(1,"translate"),d(2,"oe-modal-horizontal-line")),t&2){let e=p(2);c("name",E(1,3,"GENERAL.TOTAL")+(e.productionMeters.length>0?"\xA0DC":""))("channelAddress","_sum/ProductionDcActualPower")("converter",e.CONVERT_TO_WATT)}}function dO(t,o){if(t&1&&d(0,"oe-ess-charger",3)(1,"oe-modal-horizontal-line",6),t&2){let e=o.$implicit,n=o.$index,i=p(2);c("component",e),r(),c("index",n)("components",i.chargerComponents)}}function uO(t,o){if(t&1&&(s(0,"oe-modal",0),g(1,"translate"),f(2,oO,3,4),f(3,aO,2,0),f(4,mO,8,7),f(5,pO,3,5),fe(6,dO,2,3,null,null,xe),d(8,"oe-modal-info-line",1),g(9,"translate"),l()),t&2){let e=p();c("title",E(1,6,"GENERAL.PRODUCTION")),r(2),_((e.productionMeters==null?null:e.productionMeters.length)>0&&(e.chargerComponents==null?null:e.chargerComponents.length)>0?2:-1),r(),_((e.productionMeters==null?null:e.productionMeters.length)===1?3:-1),r(),_(e.productionMeters.length>1?4:-1),r(),_(e.chargerComponents.length>1?5:-1),r(),_e(e.chargerComponents),r(2),c("info",E(9,8,"EDGE.INDEX.WIDGETS.PHASES_INFO"))}}var bC=(()=>{class t extends Wt{constructor(){super(...arguments),this.isLastElement=M.isLastElement,this.CONVERT_TO_WATT=M.CONVERT_TO_WATT,this.productionMeters=[],this.chargerComponents=[],this.isAsymmetric=!1}getChannelAddresses(){let e=[];return this.chargerComponents=this.config.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger").filter(n=>n.isEnabled),this.config.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(n=>n.isEnabled&&this.config.isProducer(n)).forEach(n=>{e.push(new y(n.id,"ActivePower")),e.push(new y(n.id,"ActivePowerL1")),e.push(new y(n.id,"ActivePowerL2")),e.push(new y(n.id,"ActivePowerL3")),this.productionMeters.push(n)}),e}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title"],[3,"info"],["channelAddress","_sum/ProductionActivePower",3,"name","converter"],[3,"component"],["margin_bottom","2",3,"converter","name","channelAddress"],[3,"textIndent","name","channelAddress","converter"],[3,"index","components"],[3,"name","channelAddress","converter"]],template:function(n,i){n&1&&f(0,uO,10,10,"oe-modal",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[Mn,Vt,sn,Sn,jh,Yh,V],encapsulation:2})}}return t})();var fO=()=>({name:"oe-production",color:"production"});function _O(t,o){if(t&1&&d(0,"oe-flat-widget-line",1),t&2){let e=o.$implicit,n=p();c("name",e.alias)("channelAddress",e.id+"/ActivePower")("converter",n.CONVERT_WATT_TO_KILOWATT)}}function hO(t,o){if(t&1&&d(0,"oe-flat-widget-line",1),t&2){let e=o.$implicit,n=p();c("name",e.alias)("channelAddress",e.id+"/ActualPower")("converter",n.CONVERT_WATT_TO_KILOWATT)}}var DC=(()=>{class t extends ce{constructor(){super(...arguments),this.productionMeterComponents=[],this.chargerComponents=[],this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:bC}}getChannelAddresses(){return this.chargerComponents=this.config.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger").filter(e=>e.isEnabled),this.productionMeterComponents=this.config.getComponentsImplementingNature("io.openems.edge.meter.api.ElectricityMeter").filter(e=>e.isEnabled&&this.config.isProducer(e)),[]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Common_Production"]],standalone:!1,features:[S],decls:6,vars:6,consts:[[3,"title","icon","modalComponent"],[3,"name","channelAddress","converter"]],template:function(n,i){n&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),fe(2,_O,1,3,"oe-flat-widget-line",1,xe),fe(4,hO,1,3,"oe-flat-widget-line",1,xe),l()),n&2&&(c("title",E(1,3,"GENERAL.PRODUCTION"))("icon",H(5,fO))("modalComponent",i.modalComponent),r(2),_e(i.productionMeterComponents),r(2),_e(i.chargerComponents))},dependencies:[pe,we,V],encapsulation:2})}}return t})();var RC=(()=>{class t extends eo{static generateView(e){return{title:e.instant("GENERAL.SELF_CONSUMPTION"),lines:[{type:"info-line",name:e.instant("EDGE.INDEX.WIDGETS.SELFCONSUMPTION_INFO")}]}}generateView(e,n){return t.generateView(this.translate)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[vn([{provide:kt,useClass:ci}]),S],decls:1,vars:2,consts:[[2,"display","block","height","inherit",3,"form","fields"]],template:function(n,i){n&1&&d(0,"formly-form",0),n&2&&c("form",i.form)("fields",i.fields)},dependencies:[si],encapsulation:2})}}return t})();var gO=()=>({name:"oe-consumption",color:"normal"}),OC=(()=>{class t extends ce{constructor(){super(...arguments),this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:RC}}getChannelAddresses(){return[new y("_sum","GridActivePower"),new y("_sum","ProductionActivePower")]}onCurrentData(e){this.calculatedSelfConsumption=M.calculateSelfConsumption(M.multiplySafely(e.allComponents["_sum/GridActivePower"],-1),e.allComponents["_sum/ProductionActivePower"])}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Common_Selfconsumption"]],standalone:!1,features:[S],decls:3,vars:7,consts:[[3,"icon","title","modalComponent"],[3,"value"]],template:function(n,i){n&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),d(2,"oe-flat-widget-percentagebar",1),l()),n&2&&(c("icon",H(6,gO))("title",E(1,4,"GENERAL.SELF_CONSUMPTION"))("modalComponent",i.modalComponent),r(2),c("value",i.calculatedSelfConsumption))},dependencies:[pe,Qi,V],encapsulation:2})}}return t})();var vO=()=>({name:"information-outline",size:"large"});function yO(t,o){if(t&1&&(s(0,"div"),d(1,"oe-modal-line",3),l()),t&2){let e=p().$implicit,n=p(2);r(),c("name",n.getTranslatedChannel(e))}}function TO(t,o){if(t&1&&(d(0,"oe-modal-line",3),g(1,"translate"),d(2,"oe-modal-line",4),g(3,"translate"),f(4,yO,2,1,"div"),d(5,"oe-modal-horizontal-line")),t&2){let e=o.$implicit,n=o.$index,i=p(2);c("name",E(1,5,"MODBUS_TCP_API_READ_WRITE.REGISTER")+i.formattedWriteChannels[n]),r(2),c("name",E(3,7,"MODBUS_TCP_API_READ_WRITE.LIMITATION"))("value",i.writeChannelValues[n])("converter",i.Converter.POWER_IN_WATT),r(2),_(i.getTranslatedChannel(e)!==null?4:-1)}}function IO(t,o){if(t&1){let e=W();s(0,"oe-modal",0),d(1,"oe-modal-line",1),g(2,"translate"),d(3,"oe-modal-horizontal-line")(4,"oe-modal-line",2),g(5,"translate"),d(6,"oe-modal-line",3),g(7,"translate"),d(8,"oe-modal-line",4),g(9,"translate"),d(10,"oe-modal-line",5),g(11,"translate"),d(12,"oe-modal-line",3),g(13,"translate"),d(14,"oe-modal-horizontal-line"),fe(15,TO,6,9,null,null,xe),d(17,"oe-modal-info-line",6),g(18,"translate"),s(19,"div",7)(20,"ion-button",8),O("click",function(){P(e);let i=p();return L(i.getModbusProtocol(i.component.id,"tcp"))}),h(21),g(22,"translate"),l()(),d(23,"oe-modal-horizontal-line"),l()}if(t&2){let e=p();c("title",e.component.alias)("component",e.component),r(),c("name",E(2,16,"MODBUS_TCP_API_READ_WRITE.CURRENT_STATE"))("value",e.overrideStatus)("leftColumnWidth",50),r(3),c("name",E(5,18,"MODBUS_TCP_API_READ_WRITE.ACTIVE_POWER_LIMITATIONS")),r(2),c("name",E(7,20,"MODBUS_TCP_API_READ_WRITE.REGISTER")+"(SetActivePowerEquals/706)"),r(2),c("name",E(9,22,"MODBUS_TCP_API_READ_WRITE.LIMITATION"))("value",e.activePowerEqualsValue)("converter",e.Converter.POWER_IN_WATT),r(2),c("name",E(11,24,"MODBUS_TCP_API_READ_WRITE.ACTUAL_VALUE"))("converter",e.Converter.POWER_IN_WATT),r(2),c("name",E(13,26,"MODBUS_TCP_API_READ_WRITE.SET_ACTIVE_POWER_EQUALS")),r(3),_e(e.writeChannels),r(2),c("info",E(18,28,"MODBUS_TCP_API_READ_WRITE.INFO_TEXT"))("icon",H(32,vO)),r(4),R("",E(22,30,"MODBUS_TCP_API_READ_WRITE.DOWNLOAD_PROTOCOL")," ")}}var MC=(()=>{class t extends Wt{constructor(e,n,i,a,m,u,C,v){super(e,n,i,a,m,u,C),this.websocket=e,this.route=n,this.service=i,this.modalController=a,this.translate=m,this.formBuilder=u,this.ref=C,this.platFormService=v,this.CONVERT_TO_WATT=Be.POWER_IN_WATT,this.writeChannelValues=[],this.writeChannels=[],this.overrideStatus=null,this.formattedWriteChannels=null,this.activePowerEqualsChannel=null,this.activePowerEqualsValue=null,this.channelRegisters=ks,this.profile=new au(this.service,this.route,null,this.translate,this.websocket,this.platFormService)}getChannelAddresses(){this.activePowerEqualsChannel=new y(this.component.id,"Ess0SetActivePowerEquals");let e=this.config.components[this.component.id]?.properties.writeChannels||[];return this.writeChannels=e.map(n=>new y(this.component.id,n)),[...this.writeChannels,this.activePowerEqualsChannel,new y(this.component.id,"OverrideStatus")]}onIsInitialized(){this.edge.getConfig(this.websocket).subscribe(e=>{let n=(e.components[this.component.id]?.properties?.writeChannels||[]).map(i=>new y(this.component.id,i));this.writeChannels=n.filter(i=>!i.channelId.includes("Ess0SetActivePowerEquals")),this.getFormatChannelNames(),this.edge.subscribeChannels(this.websocket,this.component.id,this.writeChannels)})}getModbusProtocol(e,n){return this.profile.getModbusProtocol(e,n)}onCurrentData(e){this.activePowerEqualsValue=this.edge.currentData.value.channel[this.activePowerEqualsChannel.toString()],this.writeChannelValues=this.writeChannels?.map(n=>this.edge.currentData.value.channel[n.toString()])||[],this.overrideStatus=this.getTranslatedState(e.allComponents[this.component.id+"/OverrideStatus"])}getTranslatedChannel(e){if(e.channelId.includes("Ess0SetActive"))switch(e.channelId.replace("Ess0","")){case"SetActivePowerEquals":return this.translate.instant("MODBUS_TCP_API_READ_WRITE.SET_ACTIVE_POWER_EQUALS");case"SetActivePowerGreaterOrEquals":return this.translate.instant("MODBUS_TCP_API_READ_WRITE.SET_ACTIVE_POWER_GREATER_OR_EQUALS");case"SetActivePowerLessOrEquals":return this.translate.instant("MODBUS_TCP_API_READ_WRITE.SET_ACTIVE_POWER_LESS_OR_EQUALS")}}getTranslatedState(e){switch(e){case ma.ACTIVE:return this.translate.instant("MODBUS_TCP_API_READ_WRITE.OVERRIDING");case ma.ERROR:return this.translate.instant("EVCS.error");default:return this.translate.instant("MODBUS_TCP_API_READ_WRITE.NOT_OVERRIDING")}}getFormatChannelNames(){this.formattedWriteChannels=[],this.writeChannels.forEach(e=>{let n=`(${e.channelId})`;for(let i in ks)if(e.channelId.includes(i)&&e.channelId.startsWith("Ess0")){n=`(${i}/${ks[i]})`;break}this.formattedWriteChannels.push(n)})}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(De),x(j),x(he),x(te),x(Ft),x(ln),x(Ei))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["helpKey","CONTROLLER_API_MODBUSTCP_READWRITE",3,"title","component"],[3,"name","value","leftColumnWidth"],[2,"font-weight","bold",3,"name"],[3,"name"],[3,"name","value","converter"],["channelAddress","_sum/EssActivePower",3,"name","converter"],[2,"font-size","small",3,"info","icon"],[2,"display","flex","justify-content","flex-end"],["size","small",2,"font-size","small",3,"click"]],template:function(n,i){n&1&&f(0,IO,24,33,"oe-modal",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[Mn,Vt,sn,Sn,Ge,V],encapsulation:2})}}return t})();var xO=()=>({name:"swap-vertical-outline",color:"normal"});function SO(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("icon",H(8,xO))("title",e.component.alias),r(),c("name",E(2,6,"MODBUS_TCP_API_READ_WRITE.CURRENT_STATE"))("value",e.overrideStatus)("leftColumnWidth",10)}}var FC=(()=>{class t extends ce{constructor(){super(...arguments),this.overrideStatus=null,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:MC,componentProps:{component:this.component}}}getChannelAddresses(){return[new y(this.component.id,"OverrideStatus")]}onCurrentData(e){this.overrideStatus=this.getTranslatedState(e.allComponents[this.component.id+"/OverrideStatus"])}getTranslatedState(e){switch(e){case ma.ACTIVE:return this.translate.instant("MODBUS_TCP_API_READ_WRITE.OVERRIDING");case ma.ERROR:return this.translate.instant("EVCS.error");default:return this.translate.instant("MODBUS_TCP_API_READ_WRITE.NOT_OVERRIDING")}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Api_ModbusTcp"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"modalComponent","icon","title"],[3,"name","value","leftColumnWidth"]],template:function(n,i){n&1&&f(0,SO,3,9,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var wO=()=>({color:"primary",name:"play-outline"}),bO=(t,o)=>({name:t,value:"REMOTE_CONTROL",icon:o}),DO=()=>({color:"danger",name:"stop-circle-outline"}),RO=(t,o)=>({name:t,value:"OFF",icon:o}),OO=(t,o)=>[t,o];function NO(t,o){if(t&1&&(Y(0),d(1,"oe-modal-horizontal-line")(2,"oe-modal-line",1),g(3,"translate"),g(4,"translate"),d(5,"oe-modal-horizontal-line"),z()),t&2){let e=p(2);r(2),c("name",E(3,3,"GENERAL.STATE"))("value",E(4,5,e.controlMode))("converter",e.CONVERT_ENERIX_CONTROL_STATE)}}function MO(t,o){t&1&&(d(0,"oe-modal-horizontal-line")(1,"oe-modal-line",4),g(2,"translate"),d(3,"oe-modal-info-line",5),g(4,"translate")),t&2&&(r(),c("name",E(2,2,"EDGE.INDEX.WIDGETS.ENERIX_CONTROL.NOTE")),r(2),c("info",E(4,4,"EDGE.INDEX.WIDGETS.ENERIX_CONTROL.OVERWRITE_INFO")))}function FO(t,o){if(t&1&&(d(0,"oe-modal-line",1),g(1,"translate"),d(2,"oe-modal-line",2),g(3,"translate"),d(4,"oe-modal-horizontal-line")(5,"oe-modal-buttons",3),g(6,"translate"),g(7,"translate"),f(8,MO,5,6),d(9,"oe-modal-horizontal-line")),t&2){let e=p(2);c("name",E(1,9,"EDGE.INDEX.WIDGETS.ENERIX_CONTROL.OVERWRITE_MODE"))("value",e.controlMode)("converter",e.CONVERT_ENERIX_CONTROL_STATE),r(2),c("name",E(3,11,"GENERAL.STATE"))("value",e.overwriteLabel),r(3),c("formGroup",e.formGroup)("component",e.component)("buttons",at(25,OO,at(18,bO,E(6,13,"GENERAL.ON"),H(17,wO)),at(22,RO,E(7,15,"GENERAL.OFF"),H(21,DO)))),r(3),_(e.formGroup.value.mode==="REMOTE_CONTROL"?8:-1)}}function GO(t,o){if(t&1&&(s(0,"oe-modal",0),f(1,NO,6,7,"ng-container")(2,FO,10,28),l()),t&2){let e=p();c("title",e.component.alias)("component",e.component)("formGroup",e.formGroup),r(),_(e.readOnly?1:2)}}var GC=(()=>{class t extends Wt{constructor(){super(...arguments),this.CONVERT_ENERIX_CONTROL_STATE=Be.CONVERT_ENERIX_CONTROL_STATE(this.translate),this.propertyMode=null,this.controlModeNumber=null,this.controlMode=null,this.readOnly=!0,this.overwriteLabel=null,this.unableToSend=null}static{this.PROPERTY_MODE="_PropertyMode"}static{this.PROPERTY_READ_ONLY="_PropertyReadOnly"}getChannelAddresses(){return this.component?[new y(this.component.id,t.PROPERTY_MODE),new y(this.component.id,t.PROPERTY_READ_ONLY),new y(this.component.id,"ControlMode"),new y(this.component.id,"UnableToSend")]:[]}onCurrentData(e){if(!this.component)return[];if(this.propertyMode=e.allComponents[this.component.id+"/"+t.PROPERTY_MODE],this.controlModeNumber=e.allComponents[this.component.id+"/ControlMode"],this.readOnly=e.allComponents[this.component.id+"/"+t.PROPERTY_READ_ONLY],this.unableToSend=e.allComponents[this.component.id+"/UnableToSend"],this.readOnly){this.controlMode=this.unableToSend?fr.disconnected:fr.connected;return}else{if(this.controlModeNumber===null)return;switch(this.controlModeNumber){case as.idle:this.controlMode=this.component.properties.mode==="REMOTE_CONTROL"?fr.on:fr.off;break;case as.noDischarge:this.controlMode=fr.noDischarge;break;case as.forceCharge:this.controlMode=fr.forceCharge;break;default:this.controlMode=fr.off;break}this.controlModeNumber!=as.idle?this.overwriteLabel=this.translate.instant("EDGE.INDEX.WIDGETS.ENERIX_CONTROL.OVERWRITE"):this.overwriteLabel=this.translate.instant("EDGE.INDEX.WIDGETS.ENERIX_CONTROL.NO_OVERWRITE")}}getFormGroup(){return this.formBuilder.group({mode:new K(this.component?.properties.mode)})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title","component","formGroup"],[3,"name","value","converter"],[3,"name","value"],["controlName","mode",3,"formGroup","component","buttons"],[2,"font-weight","bold",3,"name"],[3,"info"]],template:function(n,i){n&1&&f(0,GO,3,4,"oe-modal",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[Nn,Mn,Vt,sn,Sn,Ke,ot,V],encapsulation:2})}}return t})(),as=(function(t){return t[t.idle=0]="idle",t[t.noDischarge=1]="noDischarge",t[t.forceCharge=2]="forceCharge",t})(as||{}),fr=(function(t){return t[t.on=0]="on",t[t.off=1]="off",t[t.noDischarge=2]="noDischarge",t[t.forceCharge=3]="forceCharge",t[t.disconnected=4]="disconnected",t[t.connected=5]="connected",t})(fr||{});var PO=()=>({name:"swap-vertical-outline",color:"normal"});function LO(t,o){if(t&1&&(Y(0),d(1,"oe-flat-widget-line",1),g(2,"translate"),g(3,"translate"),z()),t&2){let e=p(2);r(),c("name",E(2,3,"GENERAL.STATE"))("value",E(3,5,e.controlMode))("converter",e.CONVERT_ENERIX_CONTROL_STATE)}}function kO(t,o){if(t&1&&(d(0,"oe-flat-widget-line",1),g(1,"translate"),g(2,"translate"),d(3,"oe-flat-widget-line",2),g(4,"translate")),t&2){let e=p(2);c("name",E(1,5,"EDGE.INDEX.WIDGETS.ENERIX_CONTROL.OVERWRITE_MODE"))("value",E(2,7,e.controlMode))("converter",e.CONVERT_ENERIX_CONTROL_STATE),r(3),c("name",E(4,9,"GENERAL.STATE"))("value",e.overwriteLabel)}}function VO(t,o){if(t&1&&(Y(0),s(1,"oe-flat-widget",0),f(2,LO,4,7,"ng-container")(3,kO,5,11),l(),z()),t&2){let e=p();r(),c("modalComponent",e.modalComponent)("icon",H(4,PO))("title",e.component.alias),r(),_(e.readOnly?2:3)}}var PC=(()=>{class t extends ce{constructor(){super(...arguments),this.CONVERT_ENERIX_CONTROL_STATE=Be.CONVERT_ENERIX_CONTROL_STATE(this.translate),this.controlModeNumber=null,this.controlMode=null,this.readOnly=null,this.overwriteLabel=null,this.unableToSend=null,this.modalComponent=null}static{this.PROPERTY_READ_ONLY="_PropertyReadOnly"}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:GC,componentProps:{component:this.component}}}getChannelAddresses(){return this.component?[new y(this.component.id,t.PROPERTY_READ_ONLY),new y(this.component.id,"ControlMode"),new y(this.component.id,"UnableToSend")]:[]}onCurrentData(e){let n=this.component.id,i=e.allComponents;if(this.readOnly=i[`${n}/${t.PROPERTY_READ_ONLY}`],this.controlModeNumber=i[`${n}/ControlMode`],this.unableToSend=i[`${n}/UnableToSend`],this.readOnly){this.controlMode=this.unableToSend?_r.DISCONNECTED:_r.CONNECTED;return}else{if(this.controlModeNumber===null)return;this.controlMode=this.mapControlMode(this.controlModeNumber),this.overwriteLabel=this.getOverwriteLabel(this.controlModeNumber)}}mapControlMode(e){switch(e){case ss.IDLE:return this.component.properties.mode==="REMOTE_CONTROL"?_r.ON:_r.OFF;case ss.NO_DISCHARGE:return _r.NO_DISCHARGE;case ss.FORCE_CHARGE:return _r.FORCE_CHARGE;default:return _r.OFF}}getOverwriteLabel(e){return e!==ss.IDLE?this.translate.instant("EDGE.INDEX.WIDGETS.ENERIX_CONTROL.OVERWRITE"):this.translate.instant("EDGE.INDEX.WIDGETS.ENERIX_CONTROL.NO_OVERWRITE")}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_EnerixControl"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"modalComponent","icon","title"],[3,"name","value","converter"],[3,"name","value"]],template:function(n,i){n&1&&f(0,VO,4,5,"ng-container"),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})(),ss=(function(t){return t[t.IDLE=0]="IDLE",t[t.NO_DISCHARGE=1]="NO_DISCHARGE",t[t.FORCE_CHARGE=2]="FORCE_CHARGE",t})(ss||{}),_r=(function(t){return t[t.ON=0]="ON",t[t.OFF=1]="OFF",t[t.NO_DISCHARGE=2]="NO_DISCHARGE",t[t.FORCE_CHARGE=3]="FORCE_CHARGE",t[t.DISCONNECTED=4]="DISCONNECTED",t[t.CONNECTED=5]="CONNECTED",t})(_r||{});var BO=()=>({color:"success",name:"play-outline"}),WO=(t,o)=>({name:t,value:"MANUAL_ON",icon:o}),UO=()=>({color:"danger",name:"power-outline"}),zO=(t,o)=>({name:t,value:"MANUAL_OFF",icon:o}),jO=(t,o)=>[t,o],YO=()=>({type:"INPUT"});function $O(t,o){if(t&1&&d(0,"oe-modal-line",2),t&2){let e=p(2);c("name",e.chargeDischargePower.name)("value",e.chargeDischargePower.value)("converter",e.CONVERT_TO_WATT)}}function XO(t,o){if(t&1&&(d(0,"oe-modal-line",5),g(1,"translate"),d(2,"oe-modal-horizontal-line")),t&2){let e=p(2);c("name",E(1,3,"GENERAL.POWER"))("formGroup",e.formGroup)("control",H(5,YO))}}function qO(t,o){if(t&1&&(s(0,"oe-modal",0),d(1,"oe-modal-line",1),g(2,"translate"),f(3,$O,1,3,"oe-modal-line",2),d(4,"oe-modal-horizontal-line")(5,"oe-modal-buttons",3),g(6,"translate"),g(7,"translate"),d(8,"oe-modal-horizontal-line"),f(9,XO,3,6),d(10,"oe-modal-info-line",4),g(11,"translate"),g(12,"translate"),l()),t&2){let e=p();c("title",e.component.alias)("component",e.component)("formGroup",e.formGroup),r(),c("name",E(2,12,"GENERAL.STATE"))("channelAddress",e.component.id+"/_PropertyMode")("converter",e.CONVERT_MANUAL_ON_OFF),r(2),_(e.formGroup.value.mode==="MANUAL_ON"?3:-1),r(2),c("formGroup",e.formGroup)("component",e.component)("buttons",at(30,jO,at(23,WO,E(6,14,"GENERAL.ON"),H(22,BO)),at(27,zO,E(7,16,"GENERAL.OFF"),H(26,UO)))),r(4),_(e.formGroup.value.mode==="MANUAL_ON"?9:-1),r(),c("info",E(11,18,"EDGE.INDEX.WIDGETS.INFO_STORAGE_FOR_CHARGE")+". "+E(12,20,"EDGE.INDEX.WIDGETS.INFO_STORAGE_FOR_DISCHARGE"))}}var LC=(()=>{class t extends Wt{constructor(){super(...arguments),this.CONVERT_TO_WATT=M.CONVERT_TO_WATT,this.CONVERT_MANUAL_ON_OFF=M.CONVERT_MANUAL_ON_OFF(this.translate)}getChannelAddresses(){return[new y(this.component.id,"_PropertyPower")]}onCurrentData(e){this.chargeDischargePower=M.convertChargeDischargePower(this.translate,e.allComponents[this.component.id+"/_PropertyPower"])}getFormGroup(){return this.formBuilder.group({mode:new K(this.component.properties.mode),power:new K(this.component.properties.power)})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title","component","formGroup"],[3,"name","channelAddress","converter"],[3,"name","value","converter"],["controlName","mode",3,"formGroup","component","buttons"],[3,"info"],["controlName","power",3,"name","formGroup","control"]],template:function(n,i){n&1&&f(0,qO,13,33,"oe-modal",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[Nn,Mn,Vt,sn,Sn,Ke,ot,V],encapsulation:2})}}return t})();var KO=()=>({name:"swap-vertical-outline",color:"normal"});function QO(t,o){if(t&1&&d(0,"oe-flat-widget-line",1),t&2){let e=p(2);c("name",e.chargeDischargePower.name)("value",e.chargeDischargePower.value)("converter",e.CONVERT_WATT_TO_KILOWATT)}}function ZO(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),f(3,QO,1,3,"oe-flat-widget-line",1),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("icon",H(9,KO))("title",e.component.alias),r(),c("name",E(2,7,"GENERAL.STATE"))("value",e.propertyMode)("converter",e.CONVERT_MANUAL_ON_OFF),r(2),_(e.propertyMode==="MANUAL_ON"?3:-1)}}var kC=(()=>{class t extends ce{constructor(){super(...arguments),this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.CONVERT_MANUAL_ON_OFF=M.CONVERT_MANUAL_ON_OFF(this.translate),this.propertyMode=null,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:LC,componentProps:{component:this.component}}}getChannelAddresses(){return[new y(this.component.id,"_PropertyPower"),new y(this.component.id,"_PropertyMode")]}onCurrentData(e){this.chargeDischargePower=M.convertChargeDischargePower(this.translate,e.allComponents[this.component.id+"/_PropertyPower"]),this.propertyMode=e.allComponents[this.component.id+"/_PropertyMode"]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Ess_FixActivePower"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"modalComponent","icon","title"],[3,"name","value","converter"]],template:function(n,i){n&1&&f(0,ZO,4,10,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();function eN(t,o){if(t&1&&d(0,"canvas",3),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)}}var ql=class t extends Ii{static{this.DEFAULT_PERIOD=new Ad.HistoryPeriod(new Date,new Date)}constructor(o,e,n){super("prediction-chart",o,e),this.service=o,this.translate=e,this.route=n}ngOnChanges(){this.updateChart()}ngOnInit(){this.service.startSpinner(this.spinnerId)}ngOnDestroy(){this.unsubscribeChartRefresh()}getChartHeight(){return window.innerHeight/4}updateChart(){this.autoSubscribeChartRefresh(),this.service.startSpinner(this.spinnerId),this.loading=!0,this.colors=[],this.queryHistoricTimeseriesData(t.DEFAULT_PERIOD.from,t.DEFAULT_PERIOD.to,{unit:Tr.Type.MINUTES,value:5}).then(o=>ae(this,null,function*(){let e=o.result,n=[],i=new Date().getHours(),a=new Date().getMinutes(),m=Math.trunc((i*60+a)/5),u=m-12;if(u=u<0?0:u,"_sum/EssSoc"in e.data){let C=e.data["_sum/EssSoc"].map(ge=>ge==null||ge>100||ge<0?null:ge),v=null;for(let ge=m;ge>=0;ge--)if(C[ge]!=null){v=C[ge];break}let T=new Date(0);T.setUTCSeconds(this.targetEpochSeconds);let A=this.chargeStartEpochSeconds!=null,b=new Date(0),F=0;if(A){b.setUTCSeconds(this.chargeStartEpochSeconds);let ge=b.getHours(),Ue=b.getMinutes();F=Math.trunc((ge*60+Ue)/5)}let k=0,Q=0,ve=Array(288).fill(null);if(v!=null&&T!=null){let ge=T.getHours(),Ue=T.getMinutes();Q=Math.trunc((ge*60+Ue)/5);let Ot=100-v,$t=0;if(A?$t=Q-F:$t=Q-m,$t>0){k=Ot/$t;let nt=v-k;for(let Gt=m;Gt<=Q;Gt++){if(A&&Gt<F){ve[Gt]=+(nt+k).toFixed(2);continue}nt=nt+k,ve[Gt]=+nt.toFixed(2)}}}let Re=Q+12;Re<e.data["_sum/EssSoc"].length-1&&(C.splice(Re+1,C.length),ve.splice(Re+1,ve.length),e.timestamps.splice(Re+1,e.timestamps.length)),u>0&&(C.splice(0,u),ve.splice(0,u),e.timestamps.splice(0,u));let se=[];for(let ge of e.timestamps)se.push(new Date(ge));this.labels=se,n.push({label:this.translate.instant("GENERAL.SOC"),data:C,hidden:!1,yAxisID:B.RIGHT},{label:this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.EXPECTED_SOC"),data:ve,hidden:!1,yAxisID:B.RIGHT}),this.colors.push({backgroundColor:"rgba(189, 195, 199,0.05)",borderColor:"rgba(189, 195, 199,1)"},{backgroundColor:"rgba(0,223,0,0)",borderColor:"rgba(0,223,0,1)"})}this.datasets=n,this.loading=!1,this.service.stopSpinner(this.spinnerId),this.unit=Z.PERCENTAGE,this.formatNumber="1.0-0",this.chartAxis=B.RIGHT,this.position="right",yield this.setOptions(this.options),this.applyControllerSpecificOptions()})).catch(o=>{console.error(o),this.initializeChart()})}setLabel(){this.options=M.deepCopy(Ns)}getChannelAddresses(){return new Promise(o=>{let e=[new y("_sum","EssSoc")];this.component!=null&&this.component.id&&e.push(new y(this.component.id,"DelayChargeMaximumChargeLimit")),o(e)})}applyControllerSpecificOptions(){this.options.scales[B.LEFT]={position:"left",display:!1},this.datasets=this.datasets.map(o=>(o.yAxisID=B.RIGHT,o)),this.options.scales.x.ticks.callback=function(o,e,n){let i=new Date(o);return i.getMinutes()===0?i.getHours()+":00":""}}static{this.\u0275fac=function(e){return new(e||t)(x(j),x(te),x(De))}}static{this.\u0275cmp=I({type:t,selectors:[["predictionChart"]],inputs:{component:"component",targetEpochSeconds:"targetEpochSeconds",chargeStartEpochSeconds:"chargeStartEpochSeconds",refresh:"refresh",edge:"edge"},standalone:!1,features:[S,En],decls:4,vars:5,consts:[[3,"response"],["id","chart-area",1,"semi-transparent-background"],[3,"name"],["baseChart","","type","line",3,"datasets","labels","options"]],template:function(e,n){e&1&&(d(0,"oe-history-data-error",0),s(1,"div",1),d(2,"ngx-spinner",2),f(3,eN,1,3,"canvas",3),l()),e&2&&(c("response",n.errorResponse),r(),re("height",n.getChartHeight(),"px"),r(),c("name",n.spinnerId),r(),_(n.loading?-1:3))},dependencies:[ye,me,Ee],encapsulation:2})}};var nN=()=>({color:"success",name:"options-outline"}),iN=(t,o)=>({name:t,value:"MANUAL",icon:o}),oN=()=>({color:"primary",name:"sunny"}),rN=(t,o)=>({name:t,value:"AUTOMATIC",icon:o}),aN=()=>({color:"danger",name:"power"}),sN=(t,o)=>({name:t,value:"OFF",icon:o}),VC=(t,o,e)=>[t,o,e],HC=t=>({text:t}),lN=t=>({text:t,lineStyle:"color: #666666"}),cN=(t,o)=>[t,o],mN=t=>({name:t,value:"LOW"}),pN=t=>({name:t,value:"MEDIUM"}),dN=t=>({name:t,value:"HIGH"}),uN=()=>({name:"arrow-up-outline"}),fN=()=>({name:"arrow-down-outline"}),_N=(t,o)=>({maxChargingPowerW:t,endTime:o}),hN=t=>[t];function CN(t,o){if(t&1&&d(0,"oe-modal-line",7),t&2){let e=p(3);c("name",e.chargeLimit.name)("converter",e.Utils.CONVERT_TO_WATT)("value",e.chargeLimit.value)}}function gN(t,o){if(t&1&&(d(0,"oe-modal-line",8),g(1,"translate")),t&2){let e=p(3);c("name",E(1,3,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.END_TIME_LONG"))("converter",e.CONVERT_MINUTE_TO_TIME_OF_DAY)("value",e.targetMinute)}}function EN(t,o){if(t&1&&(d(0,"oe-modal-line",8),g(1,"translate")),t&2){let e=p(3);c("name",E(1,3,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STORAGE_CAPACITY"))("converter",e.Utils.CONVERT_TO_WATTHOURS)("value",e.channelCapacity)}}function vN(t,o){if(t&1&&(d(0,"oe-modal-line",9),g(1,"translate")),t&2){let e=p(5);c("name",E(1,3,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MAXIMUM_GRID_FEED_IN"))("converter",e.CONVERT_TO_WATT)("channelAddress","_meta/_PropertyMaximumGridFeedInLimit")}}function yN(t,o){if(t&1&&f(0,vN,2,5,"oe-modal-line",9),t&2){let e=p(4);_(e.formGroup.value.sellToGridLimitEnabled?0:-1)}}function TN(t,o){if(t&1&&(d(0,"oe-modal-line",9),g(1,"translate")),t&2){let e=p(5);c("name",E(1,3,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MAXIMUM_GRID_FEED_IN"))("converter",e.Utils.CONVERT_TO_WATT)("channelAddress",e.component.id+"/_PropertyMaximumSellToGridPower")}}function IN(t,o){if(t&1&&f(0,TN,2,5,"oe-modal-line",9),t&2){let e=p(4);_(e.formGroup.value.sellToGridLimitEnabled?0:-1)}}function xN(t,o){if(t&1&&f(0,yN,1,1)(1,IN,1,1),t&2){let e=p(3);_(e.hasMaximumGridFeedInLimitInMeta?0:1)}}function SN(t,o){if(t&1&&(d(0,"oe-modal-line",6),g(1,"translate"),f(2,CN,1,3,"oe-modal-line",7),f(3,gN,2,5,"oe-modal-line",8),f(4,EN,2,5,"oe-modal-line",8),f(5,xN,2,1),d(6,"oe-modal-horizontal-line")),t&2){let e=p(2);c("name",E(1,6,"GENERAL.STATE"))("value",e.state),r(2),_(e.chargeLimit?2:-1),r(),_(e.targetMinute&&e.delayChargeState!==e.DelayChargeState.NO_REMAINING_TIME?3:-1),r(),_(e.isAtLeastAdmin?4:-1),r(),_(e.formGroup.value.sellToGridLimitEnabled?5:-1)}}function AN(t,o){t&1&&d(0,"ion-datetime",16,0)}function wN(t,o){if(t&1&&(s(0,"ion-item",14)(1,"ion-label"),h(2),g(3,"date"),l(),s(4,"ion-popover",15),G(5,AN,2,0,"ng-template"),l()()),t&2){let e=p(3);r(2),R(" ",e.formGroup.controls.manualTargetTime.value.match("/^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/")?q(3,1,e.formGroup.controls.manualTargetTime.value,"HH:mm"):e.formGroup.controls.manualTargetTime.value," ")}}function bN(t,o){if(t&1&&(Y(0,4),d(1,"oe-modal-horizontal-line")(2,"oe-modal-line",10),g(3,"translate"),s(4,"ion-item",11)(5,"table",12)(6,"tr")(7,"td")(8,"ion-text",13),h(9," EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.END_TIME "),l(),h(10,": "),l(),s(11,"td"),f(12,wN,6,4,"ion-item",14),l()()()(),z()),t&2){let e=p(2);c("formGroup",e.formGroup),r(2),c("name",E(3,3,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.END_TIME_DESCRIPTION")),r(10),_(e.formGroup?12:-1)}}function DN(t,o){if(t&1&&(d(0,"oe-modal-info-line",5),g(1,"unitvalue"),g(2,"translate")),t&2){let e=p(3);c("info",be(12,hN,be(10,HC,q(2,4,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.END_TIME_DETAILED_DESCRIPTION",at(7,_N,q(1,1,e.delayChargeMaximumChargeLimit,"W"),e.chargingEndTime)))))}}function RN(t,o){t&1&&(d(0,"oe-modal-info-line",5),g(1,"translate")),t&2&&c("info",E(1,1,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.END_TIME_DESCRIPTION"))}function ON(t,o){if(t&1&&(d(0,"oe-modal-horizontal-line"),f(1,DN,3,14,"oe-modal-info-line",5)(2,RN,2,3,"oe-modal-info-line",5),d(3,"oe-modal-horizontal-line"),Y(4),d(5,"oe-modal-info-line",5),g(6,"translate"),g(7,"translate"),d(8,"predictionChart",17)(9,"oe-modal-horizontal-line"),z(),d(10,"oe-modal-line",2),g(11,"translate"),d(12,"oe-modal-buttons",18),g(13,"translate"),g(14,"translate"),g(15,"translate"),d(16,"oe-modal-horizontal-line"),Y(17,19),d(18,"oe-modal-info-line",5),g(19,"translate"),d(20,"oe-modal-info-line",20),g(21,"translate"),d(22,"oe-modal-info-line",20),g(23,"translate"),z()),t&2){let e=p(2);r(),_(e.targetMinute!==null&&e.delayChargeMaximumChargeLimit!==null?1:2),r(4),c("info",at(38,cN,be(34,HC,E(6,16,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.EXPECTED_SOC")),be(36,lN,E(7,18,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.EXPECTED_SOC_WITHOUT_SELL_TO_GRID_LIMIT")))),r(3),c("refresh",e.refreshChart)("component",e.component)("edge",e.edge)("targetEpochSeconds",e.targetEpochSeconds)("chargeStartEpochSeconds",e.chargeStartEpochSeconds),r(2),c("name",E(11,20,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.RISK_PROPENSITY")),r(2),c("formGroup",e.formGroup)("component",e.component)("buttons",_i(47,VC,be(41,mN,E(13,22,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.LOW")),be(43,pN,E(14,24,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MEDIUM")),be(45,dN,E(15,26,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.HIGH")))),r(6),c("info",E(19,28,"Edge.Index.Widgets.GridOptimizedCharge.RiskDescription."+e.formGroup.value.delayChargeRiskLevel+".functionDescription")),r(2),c("info",E(21,30,"Edge.Index.Widgets.GridOptimizedCharge.RiskDescription."+e.formGroup.value.delayChargeRiskLevel+".storageDescription"))("icon",H(51,uN)),r(2),c("info",E(23,32,"Edge.Index.Widgets.GridOptimizedCharge.RiskDescription."+e.formGroup.value.delayChargeRiskLevel+".pvCurtail"))("icon",H(52,fN))}}function NN(t,o){t&1&&(d(0,"oe-modal-info-line",5),g(1,"translate")),t&2&&c("info",E(1,1,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.GRID_OPTIMIZED_CHARGE_DISABLED"))}function MN(t,o){if(t&1&&(s(0,"oe-modal",1),f(1,SN,7,8),d(2,"oe-modal-line",2),g(3,"translate"),d(4,"oe-modal-buttons",3),g(5,"translate"),g(6,"translate"),g(7,"translate"),f(8,bN,13,5,"ng-container",4),f(9,ON,24,53),f(10,NN,2,3,"oe-modal-info-line",5),l()),t&2){let e=p();c("title",e.component.alias)("component",e.component)("formGroup",e.formGroup),r(),_(e.formGroup.value.mode!=="OFF"?1:-1),r(),c("name",E(3,11,"GENERAL.MODE")),r(2),c("formGroup",e.formGroup)("component",e.component)("buttons",_i(31,VC,at(20,iN,E(5,13,"GENERAL.MANUALLY"),H(19,nN)),at(24,rN,E(6,15,"GENERAL.AUTOMATIC"),H(23,oN)),at(28,sN,E(7,17,"GENERAL.OFF"),H(27,aN)))),r(4),_(e.formGroup.value.mode==="MANUAL"?8:-1),r(),_(e.formGroup.value.mode==="AUTOMATIC"?9:-1),r(),_(e.formGroup.value.mode==="OFF"?10:-1)}}var BC=(()=>{class t extends Wt{constructor(){super(...arguments),this.isAtLeastAdmin=!1,this.hasMaximumGridFeedInLimitInMeta=!1,this.CONVERT_MINUTE_TO_TIME_OF_DAY=this.Converter.CONVERT_MINUTE_TO_TIME_OF_DAY(this.translate,Ze.geti18nLocale()),this.DelayChargeState=Gm,this.state="",this.delayChargeState=null,this.maximumSellToGridPower=null,this.targetMinute=null,this.delayChargeMaximumChargeLimit=null,this.targetEpochSeconds=null,this.chargeStartEpochSeconds=null,this.chargingEndTime=null}getChannelAddresses(){this.refreshChart=!1;let e=[];return this.edge.roleIsAtLeast(Rt.ADMIN)&&(this.isAtLeastAdmin=!0,"ess.id"in this.component.properties&&e.push(new y(this.component.properties["ess.id"],"Capacity"))),this.hasMaximumGridFeedInLimitInMeta=Hr(this.edge),e.push(new y(this.component.id,"SellToGridLimitState"),new y(this.component.id,"DelayChargeState"),new y(this.component.id,"SellToGridLimitMinimumChargeLimit"),new y(this.component.id,"_PropertySellToGridLimitEnabled"),new y(this.component.id,"TargetEpochSeconds"),new y(this.component.id,"TargetMinute"),new y(this.component.id,"DelayChargeMaximumChargeLimit"),new y(this.component.id,"PredictedChargeStartEpochSeconds")),Hr(this.edge)?e.push(new y("_meta","_PropertyMaximumGridFeedInLimit")):e.push(new y(this.component.id,"_PropertyMaximumSellToGridPower")),e}onCurrentData(e){if(this.chargingEndTime=this.targetMinute!==null?this.CONVERT_MINUTE_TO_TIME_OF_DAY(this.targetMinute):null,e.allComponents[this.component.id+"/SellToGridLimitState"]==Pm.ACTIVE_LIMIT_FIXED||e.allComponents[this.component.id+"/SellToGridLimitState"]==Pm.ACTIVE_LIMIT_CONSTRAINT&&e.allComponents[this.component.id+"/DelayChargeState"]!=Gm.ACTIVE_LIMIT&&e.allComponents[this.component.id+"/SellToGridLimitMinimumChargeLimit"]>0)this.chargeLimit={name:this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MINIMUM_CHARGE"),value:e.allComponents[this.component.id+"/SellToGridLimitMinimumChargeLimit"]},this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.GRID_FEED_IN_LIMITATION_IS_AVOIDED");else{switch(e.allComponents[this.component.id+"/DelayChargeState"]){case-1:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.NOT_DEFINED");break;case 0:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.CHARGE_LIMIT_ACTIVE");break;case 1:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.PASSED_END_TIME");break;case 2:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.STORAGE_ALREADY_FULL");break;case 3:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.END_TIME_NOT_CALCULATED");break;case 4:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.NO_LIMIT_POSSIBLE");break;case 5:case 7:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.NO_LIMIT_ACTIVE");break;case 8:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.CHARGING_DELAYED");break}e.allComponents[this.component.id+"/DelayChargeMaximumChargeLimit"]!=null&&(this.chargeLimit={name:this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MAXIMUM_CHARGE"),value:e.allComponents[this.component.id+"/DelayChargeMaximumChargeLimit"]})}this.delayChargeState=e.allComponents[this.component.id+"/DelayChargeState"],this.edge.roleIsAtLeast(Rt.ADMIN)&&"ess.id"in this.component.properties&&(this.channelCapacity=e.allComponents[this.component.properties["ess.id"]+"/Capacity"]),this.hasMaximumGridFeedInLimitInMeta?this.maximumSellToGridPower=e.allComponents["_meta/_PropertyMaximumGridFeedInLimit"]:this.maximumSellToGridPower=e.allComponents[this.component.id+"/_PropertyMaximumSellToGridPower"],this.targetMinute=e.allComponents[this.component.id+"/TargetMinute"],this.delayChargeMaximumChargeLimit=e.allComponents[this.component.id+"/DelayChargeMaximumChargeLimit"],this.targetEpochSeconds=e.allComponents[this.component.id+"/TargetEpochSeconds"],this.chargeStartEpochSeconds=e.allComponents[this.component.id+"/PredictedChargeStartEpochSeconds"]}getFormGroup(){return this.formBuilder.group({mode:new K(this.component.properties.mode),sellToGridLimitEnabled:new K(this.component.properties.sellToGridLimitEnabled),maximumSellToGridPower:new K(this.component.properties.maximumSellToGridPower,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required])),delayChargeRiskLevel:new K(this.component.properties.delayChargeRiskLevel),manualTargetTime:new K(this.component.properties.manualTargetTime)})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["popoverDatetime",""],["helpKey","CONTROLLER_ESS_GRID_OPTIMIZED_CHARGE",3,"title","component","formGroup"],[3,"name"],["controlName","mode",3,"formGroup","component","buttons"],[3,"formGroup"],[3,"info"],[3,"name","value"],[3,"name","converter","value"],["leftColumnWidth","70",3,"name","converter","value"],["leftColumnWidth","70",3,"name","converter","channelAddress"],["leftColumnWidth","100",3,"name"],["lines","none"],[1,"ion-text-center",2,"width","100%","padding-right","15%","padding-left","15%"],["translate",""],["button","true","id","open-date-input"],["trigger","open-date-input","show-backdrop","false","slot","end"],["presentation","time","displayFormat","HH:mm","formControlName","manualTargetTime"],["padding-bottom","","padding-top","",3,"refresh","component","edge","targetEpochSeconds","chargeStartEpochSeconds"],["controlName","delayChargeRiskLevel",3,"formGroup","component","buttons"],[2,"font-size","smaller"],["lineStyle","font-size: small",3,"info","icon"]],template:function(n,i){n&1&&f(0,MN,11,35,"oe-modal",1),n&2&&_(i.isInitialized&&i.formGroup?0:-1)},dependencies:[Nn,Mn,Vt,sn,Sn,Ie,Ke,zi,J,ne,He,Yi,$e,ot,en,Ne,ql,$o,Ut,V],encapsulation:2,changeDetection:0})}}return t})(),Gm=(function(t){return t[t.UNDEFINED=-1]="UNDEFINED",t[t.ACTIVE_LIMIT=0]="ACTIVE_LIMIT",t[t.NO_REMAINING_TIME=1]="NO_REMAINING_TIME",t[t.NO_REMAINING_CAPACITY=2]="NO_REMAINING_CAPACITY",t[t.TARGET_MINUTE_NOT_CALCULATED=3]="TARGET_MINUTE_NOT_CALCULATED",t[t.NO_FEASIBLE_SOLUTION=4]="NO_FEASIBLE_SOLUTION",t[t.NO_CHARGE_LIMIT=5]="NO_CHARGE_LIMIT",t[t.DISABLED=6]="DISABLED",t[t.NOT_STARTED=7]="NOT_STARTED",t[t.AVOID_LOW_CHARGING=8]="AVOID_LOW_CHARGING",t})(Gm||{}),Pm=(function(t){return t[t.UNDEFINED=-1]="UNDEFINED",t[t.ACTIVE_LIMIT_FIXED=0]="ACTIVE_LIMIT_FIXED",t[t.NO_LIMIT=1]="NO_LIMIT",t[t.NO_FEASIBLE_SOLUTION=2]="NO_FEASIBLE_SOLUTION",t[t.ACTIVE_LIMIT_CONSTRAINT=3]="ACTIVE_LIMIT_CONSTRAINT",t[t.DISABLED=4]="DISABLED",t[t.NOT_STARTED=5]="NOT_STARTED",t})(Pm||{});var FN=()=>({name:"oe-grid-storage",color:"dark"});function GN(t,o){if(t&1&&(d(0,"oe-flat-widget-line",3),g(1,"translate")),t&2){let e=p(4);c("name",E(1,3,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MINIMUM_CHARGE"))("converter",e.CONVERT_WATT_TO_KILOWATT)("value",e.sellToGridLimitMinimumChargeLimit)}}function PN(t,o){if(t&1&&(d(0,"oe-flat-widget-line",2),g(1,"translate"),g(2,"translate"),f(3,GN,2,5,"oe-flat-widget-line",3)),t&2){let e=p(3);c("name",E(1,3,"GENERAL.STATE"))("value",E(2,5,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.GRID_FEED_IN_LIMITATION_IS_AVOIDED")),r(3),_(e.sellToGridLimitMinimumChargeLimit>0?3:-1)}}function LN(t,o){if(t&1&&(d(0,"oe-flat-widget-line",3),g(1,"translate")),t&2){let e=p(4);c("name",E(1,3,"EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.MAXIMUM_CHARGE"))("converter",e.CONVERT_WATT_TO_KILOWATT)("value",e.delayChargeMaximumChargeLimit)}}function kN(t,o){if(t&1&&(d(0,"oe-flat-widget-line",2),g(1,"translate"),f(2,LN,2,5,"oe-flat-widget-line",3)),t&2){let e=p(3);c("name",E(1,3,"GENERAL.STATE"))("value",e.state),r(2),_(e.delayChargeMaximumChargeLimit!==null?2:-1)}}function VN(t,o){if(t&1&&f(0,PN,4,7)(1,kN,3,5),t&2){let e=p(2);_(e.isSellToGridLimitAvoided?0:1)}}function HN(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),f(3,VN,2,1),l()),t&2){let e=p();c("title",e.component.alias)("modalComponent",e.modalComponent)("icon",H(9,FN)),r(),c("name",E(2,7,"GENERAL.MODE"))("value",e.mode)("converter",e.CONVERT_MODE_TO_MANUAL_OFF_AUTOMATIC),r(2),_(e.mode!=="OFF"?3:-1)}}var WC=(()=>{class t extends ce{constructor(){super(...arguments),this.component=null,this.mode="-",this.state="-",this.isSellToGridLimitAvoided=!1,this.sellToGridLimitMinimumChargeLimit=!1,this.delayChargeMaximumChargeLimit=null,this.CONVERT_MODE_TO_MANUAL_OFF_AUTOMATIC=M.CONVERT_MODE_TO_MANUAL_OFF_AUTOMATIC(this.translate),this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:BC,componentProps:{component:this.component}}}getChannelAddresses(){return[new y(this.componentId,"DelayChargeState"),new y(this.componentId,"SellToGridLimitState"),new y(this.componentId,"DelayChargeMaximumChargeLimit"),new y(this.componentId,"SellToGridLimitMinimumChargeLimit"),new y(this.componentId,"_PropertyMode")]}onCurrentData(e){switch(this.mode=e.allComponents[this.component.id+"/_PropertyMode"],(e.allComponents[this.component.id+"/SellToGridLimitState"]==0||e.allComponents[this.component.id+"/SellToGridLimitState"]==3&&e.allComponents[this.component.id+"/DelayChargeState"]!=0&&e.allComponents[this.component.id+"/SellToGridLimitMinimumChargeLimit"]>0)&&(this.isSellToGridLimitAvoided=!0),this.sellToGridLimitMinimumChargeLimit=e.allComponents[this.component.id+"/SellToGridLimitMinimumChargeLimit"],e.allComponents[this.component.id+"/DelayChargeState"]){case-1:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.NOT_DEFINED");break;case 0:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.CHARGE_LIMIT_ACTIVE");break;case 1:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.PASSED_END_TIME");break;case 2:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.STORAGE_ALREADY_FULL");break;case 3:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.END_TIME_NOT_CALCULATED");break;case 4:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.NO_LIMIT_POSSIBLE");break;case 5:case 7:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.STATE.NO_LIMIT_ACTIVE");break;case 8:this.state=this.translate.instant("EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.CHARGING_DELAYED");break}this.delayChargeMaximumChargeLimit=e.allComponents[this.component.id+"/DelayChargeMaximumChargeLimit"]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Ess_GridOptimizedCharge"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title","modalComponent","icon"],[3,"name","value","converter"],["leftColumnWidth","20",3,"name","value"],[3,"name","converter","value"]],template:function(n,i){n&1&&f(0,HN,4,10,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var hr;(function(t){let o;(function(n){n.CHARGE_CONSUMPTION="CHARGE_CONSUMPTION",n.DELAY_DISCHARGE="DELAY_DISCHARGE"})(o=t.ControlMode||(t.ControlMode={}));function e(n,i,a,m,u,C,v,T){let A=[],b=[],F=[],k=Array(n).fill(null),Q=Array(n).fill(null),ve=Array(n).fill(null);for(let se=0;se<n;se++){let ge=on.formatPrice(i[se]),Ue=a[se];if(F.push(new Date(m[se])),Ue!==null)switch(Ue){case on.State.DelayDischarge:ve[se]=ge;break;case on.State.Balancing:Q[se]=ge;break;case on.State.ChargeGrid:k[se]=ge;break}}return A.push({type:"bar",label:v.instant("EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.BALANCING"),data:Q,order:1}),b.push({backgroundColor:"rgba(51,102,0,0.8)",borderColor:"rgba(51,102,0,1)"}),(!k.every(se=>se===null)||T==t.ControlMode.CHARGE_CONSUMPTION)&&(A.push({type:"bar",label:v.instant("EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.CHARGE_GRID"),data:k,order:1}),b.push({backgroundColor:"rgba(0, 204, 204,0.5)",borderColor:"rgba(0, 204, 204,0.7)"})),A.push({type:"bar",label:v.instant("EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.STATE.DELAY_DISCHARGE"),data:ve,order:1}),b.push({backgroundColor:"rgba(0,0,0,0.8)",borderColor:"rgba(0,0,0,0.9)"}),A.push({type:"line",label:v.instant("GENERAL.SOC"),data:C,hidden:!1,yAxisID:B.RIGHT,borderDash:[10,10],order:0}),b.push({backgroundColor:"rgba(189, 195, 199,0.2)",borderColor:"rgba(189, 195, 199,1)"}),A.push({type:"line",label:v.instant("GENERAL.GRID_BUY_ADVANCED"),data:u.map(se=>M.divideSafely(se,1e3)),hidden:!0,yAxisID:B.RIGHT_2,order:2}),b.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.BLUE_GREY,U.Colors.LEGEND_LABEL_BG_OPACITY),borderColor:Pt.rgbStringToRgba(U.Colors.BLUE_GREY,1)}),{colors:b,datasets:A,labels:F}}t.getScheduleChartData=e})(hr||(hr={}));var Kl=(()=>{class t extends un{static{this.METHOD="getSchedule"}constructor(){super(t.METHOD,{})}}return t})();function WN(t,o){if(t&1&&d(0,"canvas",3),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)}}var UC=(()=>{class t extends Ii{constructor(e,n,i,a){super("schedule-chart",e,n),this.service=e,this.translate=n,this.route=i,this.websocket=a}getChartHeight(){return on.getChartHeight(this.service.isSmartphoneResolution)}ngOnChanges(){return ae(this,null,function*(){this.edge.getConfig(this.websocket).pipe(vt(e=>!!e),pn(1)).subscribe(e=>{let n=e?.getComponent("_meta"),i=e?.getPropertyFromComponent(n,"currency");this.currencyLabel=Di.getCurrencyLabelByCurrency(i),this.currencyUnit=Di.getChartCurrencyUnitLabel(i)}),this.updateChart()})}ngOnInit(){this.service.startSpinner(this.spinnerId)}ngOnDestroy(){this.unsubscribeChartRefresh()}updateChart(){this.autoSubscribeChartRefresh(),this.service.startSpinner(this.spinnerId),this.loading=!0,this.edge.sendRequest(this.websocket,new Ci({componentId:this.component.id,payload:new Kl})).then(e=>{let i=e.result.schedule,{priceArray:a,stateArray:m,timestampArray:u,gridBuyArray:C,socArray:v}={priceArray:i.map(A=>A.price),stateArray:i.map(A=>A.state),timestampArray:i.map(A=>A.timestamp),gridBuyArray:i.map(A=>Je.ValueConverter.NEGATIVE_AS_ZERO(A.grid)),socArray:i.map(A=>A.soc)},T=hr.getScheduleChartData(i.length,a,m,u,C,v,this.translate,this.component.properties.controlMode);this.colors=T.colors,this.labels=T.labels,this.datasets=T.datasets,this.loading=!1,this.setLabel(),this.stopSpinner()}).catch(e=>{console.error(e),this.initializeChart()}).finally(()=>ae(this,null,function*(){this.unit=Z.CURRENCY,yield this.setOptions(this.options),this.applyControllerSpecificOptions()}))}setLabel(){this.options=this.createDefaultChartOptions()}getChannelAddresses(){return new Promise(()=>{})}applyControllerSpecificOptions(){let e={position:"right",unit:Z.PERCENTAGE,yAxisId:B.RIGHT,displayGrid:!0};this.options=de.getYAxisOptions(this.options,e,this.translate,"line",this.datasets,!0);let n={position:"right",unit:Z.POWER,yAxisId:B.RIGHT_2};this.options=de.getYAxisOptions(this.options,n,this.translate,"line",this.datasets,!0),this.options.scales.x.time.unit=On(this.service,this.service.historyPeriod.value.from,this.service.historyPeriod.value.to).timeFormat,this.options.scales.x.ticks={source:"auto",autoSkip:!1},this.options.scales.x.ticks.color=getComputedStyle(document.documentElement).getPropertyValue("--ion-color-chart-xAxis-ticks"),this.options.scales.x.ticks.maxTicksLimit=30,this.options.scales.x.offset=!1,this.options.scales.x.ticks.callback=function(a){let m=new Date(a);return m.getMinutes()===0?m.getHours()+":00":""},this.options.plugins.tooltip.mode="index",this.options.plugins.tooltip.callbacks.labelColor=a=>{if(a)return{borderColor:Pt.changeOpacityFromRGBA(a.dataset.borderColor,1),backgroundColor:a.dataset.backgroundColor}},this.options.plugins.tooltip.callbacks.label=a=>{let m=a.dataset.label,u=a.dataset.data[a.dataIndex];return on.getLabel(u,m,this.translate,this.currencyLabel)},this.datasets=this.datasets.map(a=>{let m=a.type==="line"?.2:.5;return a.backgroundColor&&a.borderColor&&(a.backgroundColor=Pt.changeOpacityFromRGBA(a.backgroundColor.toString(),m),a.borderColor=Pt.changeOpacityFromRGBA(a.borderColor.toString(),1)),a}),this.datasets=this.datasets.map(a=>(a.label==this.translate.instant("GENERAL.GRID_BUY_ADVANCED")?a.yAxisID=B.RIGHT_2:a.label==this.translate.instant("GENERAL.SOC")&&(a.yAxisID=B.RIGHT),a));let i={position:"left",unit:this.unit,yAxisId:B.LEFT,customTitle:this.currencyUnit,scale:{dynamicScale:!0}};[e,n].forEach(a=>{this.options=de.getYAxisOptions(this.options,a,this.translate,"line",this.datasets,!0)}),this.options.scales[B.LEFT]=ke(ke({},this.options.scales[B.LEFT]),U.DEFAULT_Y_SCALE_OPTIONS(i,this.translate,"bar",this.datasets.filter(a=>a.yAxisID===B.LEFT),!0)),this.options.scales[B.RIGHT].grid.display=!1,this.options.scales[B.RIGHT_2].suggestedMin=0,this.options.scales[B.RIGHT_2].suggestedMax=1,this.options.scales[B.RIGHT_2].grid.display=!1,this.options.animation=!1}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(te),x(De),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["statePriceChart"]],inputs:{refresh:"refresh",edge:"edge",component:"component"},standalone:!1,features:[S,En],decls:4,vars:5,consts:[[3,"response"],["id","chart-area",1,"semi-transparent-background"],[3,"name"],["baseChart","","type","line",3,"datasets","labels","options"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),s(1,"div",1),d(2,"ngx-spinner",2),f(3,WN,1,3,"canvas",3),l()),n&2&&(c("response",i.errorResponse),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:3))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();function zN(t,o){if(t&1&&d(0,"canvas",3),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)}}var zC=(()=>{class t extends Ii{constructor(e,n,i,a){super("powerSoc-chart",e,n),this.service=e,this.translate=n,this.route=i,this.websocket=a}ngOnChanges(){this.updateChart()}ngOnInit(){this.service.startSpinner(this.spinnerId)}ngOnDestroy(){this.unsubscribeChartRefresh()}getChartHeight(){return on.getChartHeight(this.service.isSmartphoneResolution)}setLabel(){this.options=this.createDefaultChartOptions();let e=this.translate;this.options.plugins={tooltip:{callbacks:{label:function(n){let i=n.dataset.label,a=n.dataset.data[n.dataIndex];return on.getLabel(a,i,e)}}}}}getChannelAddresses(){return new Promise(()=>{})}updateChart(){this.autoSubscribeChartRefresh(),this.service.startSpinner(this.spinnerId),this.loading=!0,this.edge.sendRequest(this.websocket,new Ci({componentId:this.component.id,payload:new Kl})).then(e=>{let i=e.result.schedule,a=[],{gridBuyArray:m,gridSellArray:u,productionArray:C,consumptionArray:v,essDischargeArray:T,essChargeArray:A,socArray:b,labels:F}={gridBuyArray:i.map(k=>Je.ValueConverter.NEGATIVE_AS_ZERO(k.grid),1e3),gridSellArray:i.map(k=>Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE(k.grid),1e3),productionArray:i.map(k=>k.production,1e3),consumptionArray:i.map(k=>k.consumption,1e3),essDischargeArray:i.map(k=>Je.ValueConverter.NEGATIVE_AS_ZERO(k.ess),1e3),essChargeArray:i.map(k=>Je.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE(k.ess),1e3),socArray:i.map(k=>k.soc),labels:i.map(k=>new Date(k.timestamp))};a.push({type:"line",label:this.translate.instant("GENERAL.GRID_BUY"),data:m.map(k=>M.divideSafely(k,1e3)),hidden:!0,order:1}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.BLUE_GREY,.2),borderColor:U.Colors.BLUE_GREY}),a.push({type:"line",label:this.translate.instant("GENERAL.GRID_SELL"),data:u.map(k=>M.divideSafely(k,1e3)),hidden:!0,order:1}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.PURPLE,.2),borderColor:U.Colors.PURPLE}),a.push({type:"line",label:this.translate.instant("GENERAL.PRODUCTION"),data:C.map(k=>M.divideSafely(k,1e3)),hidden:!1,order:1}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.BLUE,.2),borderColor:U.Colors.BLUE}),a.push({type:"line",label:this.translate.instant("GENERAL.CONSUMPTION"),data:v.map(k=>M.divideSafely(k,1e3)),hidden:!1,order:1}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.YELLOW,.2),borderColor:U.Colors.YELLOW}),a.push({type:"line",label:this.translate.instant("GENERAL.CHARGE"),data:A.map(k=>M.divideSafely(k,1e3)),hidden:!0,order:1,unit:Z.POWER}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.GREEN,.2),borderColor:U.Colors.GREEN}),a.push({type:"line",label:this.translate.instant("GENERAL.DISCHARGE"),data:T.map(k=>M.divideSafely(k,1e3)),hidden:!0,order:1,unit:Z.POWER}),this.colors.push({backgroundColor:Pt.rgbStringToRgba(U.Colors.RED,.2),borderColor:U.Colors.RED}),a.push({type:"line",label:this.translate.instant("GENERAL.SOC"),data:b,hidden:!1,yAxisID:B.RIGHT,borderDash:[10,10],order:1,unit:Z.PERCENTAGE}),this.colors.push({backgroundColor:"rgba(189, 195, 199,0.2)",borderColor:"rgba(189, 195, 199,1)"}),this.datasets=a,this.loading=!1,this.labels=F,this.setLabel(),this.stopSpinner()}).catch(e=>{console.error(e),this.initializeChart()}).finally(()=>ae(this,null,function*(){yield this.setOptions(this.options),this.applyControllerSpecificOptions()}))}applyControllerSpecificOptions(){let e={position:"right",unit:Z.PERCENTAGE,yAxisId:B.RIGHT},n={position:"left",unit:Z.POWER,yAxisId:B.LEFT};this.options=de.getYAxisOptions(this.options,e,this.translate,"line",U.EMPTY_DATASETS,!0),this.options=de.getYAxisOptions(this.options,n,this.translate,"line",U.EMPTY_DATASETS,!0),this.datasets=this.datasets.map(i=>(i.label===this.translate.instant("GENERAL.SOC")&&(i.yAxisID=B.RIGHT),i)),this.options.scales.x.ticks={source:"auto",autoSkip:!1},this.options.scales.x.ticks.color=getComputedStyle(document.documentElement).getPropertyValue("--ion-color-chart-xAxis-ticks"),this.options.scales.x.ticks.callback=function(i,a,m){let u=new Date(i);return u.getMinutes()===0?u.getHours()+":00":""},this.options.scales[B.RIGHT].grid.display=!1,this.options.scales[B.LEFT].suggestedMin=0,this.options.scales[B.LEFT].suggestedMax=1}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(te),x(De),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["powerSocChart"]],inputs:{refresh:"refresh",edge:"edge",component:"component"},standalone:!1,features:[S,En],decls:4,vars:5,consts:[[3,"response"],["id","chart-area",1,"semi-transparent-background"],[3,"name"],["baseChart","","type","line",3,"datasets","labels","options"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),s(1,"div",1),d(2,"ngx-spinner",2),f(3,zN,1,3,"canvas",3),l()),n&2&&(c("response",i.errorResponse),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:3))},dependencies:[ye,me,Ee],encapsulation:2})}}return t})();var YN=()=>({color:"primary",name:"sunny"}),$N=(t,o)=>({name:t,value:"AUTOMATIC",icon:o}),XN=()=>({color:"danger",name:"power"}),qN=(t,o)=>({name:t,value:"OFF",icon:o}),KN=(t,o)=>[t,o],QN=()=>({type:"TOGGLE"});function ZN(t,o){if(t&1&&(d(0,"oe-modal-horizontal-line")(1,"oe-modal-info-line",8),g(2,"translate"),d(3,"powerSocChart",9)),t&2){let e=p(4);r(),c("info",E(2,4,"EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.POWER_SOC_CHART_TITLE")),r(2),c("refresh",e.refreshChart)("component",e.component)("edge",e.edge)}}function JN(t,o){if(t&1&&(d(0,"oe-modal-horizontal-line")(1,"oe-modal-info-line",8),g(2,"translate"),d(3,"statePriceChart",9)(4,"oe-modal-info-line",10),g(5,"translate"),f(6,ZN,4,6)),t&2){let e=p(3);r(),c("info",E(2,6,"EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.CHART_TITLE")),r(2),c("refresh",e.refreshChart)("component",e.component)("edge",e.edge),r(),c("info",E(5,8,"EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.CHART_WARNING_NOTE")),r(2),_(e.edge.roleIsAtLeast("admin")?6:-1)}}function eM(t,o){t&1&&d(0,"oe-modal-horizontal-line")(1,"ion-card-content")}function tM(t,o){t&1&&(d(0,"span",7),g(1,"translate")),t&2&&c("innerHtml",E(1,1,"EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.CONTROL_MODE_DESCRIPTION.CHARGE_CONSUMPTION"),Vn)}function nM(t,o){if(t&1&&(f(0,JN,7,10),f(1,eM,2,0),d(2,"oe-modal-horizontal-line")(3,"oe-modal-line",5),g(4,"translate"),Y(5,6),f(6,tM,2,3,"span",7),z()),t&2){let e=p(2);_(e.formGroup.value.mode==="AUTOMATIC"?0:-1),r(),_(e.formGroup.value.mode==="OFF"?1:-1),r(2),c("name",E(4,6,"EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.CHARGE_FROM_GRID_ACTIVATE"))("formGroup",e.formGroup)("control",H(8,QN)),r(3),_(e.formGroup.value.chargeConsumptionIsActive?6:-1)}}function iM(t,o){if(t&1&&(s(0,"oe-modal",0),d(1,"oe-modal-line",1),g(2,"translate"),d(3,"oe-modal-line",2),g(4,"translate"),d(5,"oe-modal-horizontal-line")(6,"oe-modal-line",3),g(7,"translate"),d(8,"oe-modal-buttons",4),g(9,"translate"),g(10,"translate"),f(11,nM,7,9),l()),t&2){let e=p();c("title",e.component.alias)("component",e.component)("formGroup",e.formGroup),r(),c("name",E(2,13,"GENERAL.STATUS"))("converter",e.CONVERT_TIME_OF_USE_TARIFF_STATE)("channelAddress",e.component.id+"/StateMachine"),r(2),c("name",E(4,15,"EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.PRICE"))("value",e.priceWithCurrency),r(3),c("name",E(7,17,"GENERAL.MODE")),r(2),c("formGroup",e.formGroup)("component",e.component)("buttons",at(31,KN,at(24,$N,E(9,19,"GENERAL.AUTOMATIC"),H(23,YN)),at(28,qN,E(10,21,"GENERAL.OFF"),H(27,XN)))),r(3),_(e.component.factoryId==="Controller.Ess.Time-Of-Use-Tariff"?11:-1)}}var jC=(()=>{class t extends Wt{constructor(){super(...arguments),this.CONVERT_TIME_OF_USE_TARIFF_STATE=this.Utils.CONVERT_TIME_OF_USE_TARIFF_STATE(this.translate)}getFormGroup(){return this.formBuilder.group({mode:new K(this.component.properties.mode),controlMode:new K(this.component.properties.controlMode),chargeConsumptionIsActive:new K(this.component.properties.controlMode===hr.ControlMode.CHARGE_CONSUMPTION)})}getChannelAddresses(){return[new y(this.component.id,"QuarterlyPrices")]}onIsInitialized(){this.subscription.add(this.formGroup?.get("chargeConsumptionIsActive").valueChanges.subscribe(e=>{let n=e?hr.ControlMode.CHARGE_CONSUMPTION:hr.ControlMode.DELAY_DISCHARGE;this.formGroup.controls.controlMode.setValue(n),this.formGroup.controls.controlMode.markAsDirty()}))}onCurrentData(e){let n=e.allComponents[this.component.id+"/QuarterlyPrices"],i=this.config?.getComponent("_meta"),a=this.config?.getPropertyFromComponent(i,"currency"),m=Di.getCurrencyLabelByCurrency(a);this.priceWithCurrency=this.Utils.CONVERT_PRICE_TO_CENT_PER_KWH(2,m)(n)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["helpKey","CONTROLLER_ESS_TIME_OF_USE_TARIFF",3,"title","component","formGroup"],[3,"name","converter","channelAddress"],[3,"name","value"],[3,"name"],["controlName","mode",3,"formGroup","component","buttons"],["controlName","chargeConsumptionIsActive","leftColumnWidth","100",3,"name","formGroup","control"],[2,"font-size","smaller"],[3,"innerHtml"],[3,"info"],[1,"ion-padding",3,"refresh","component","edge"],[2,"font-size","small",3,"info"]],template:function(n,i){n&1&&f(0,iM,12,34,"oe-modal",0),n&2&&_(i.isInitialized&&i.formGroup?0:-1)},dependencies:[Nn,Mn,Vt,sn,Sn,Ke,We,ot,UC,zC,V],encapsulation:2})}}return t})();var oM=()=>({name:"cloud-outline",color:"normal"});function rM(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),d(3,"oe-flat-widget-line",2),g(4,"translate"),d(5,"oe-flat-widget-line",3),g(6,"translate"),l()),t&2){let e=p();c("title",e.component.alias)("icon",H(17,oM))("modalComponent",e.modalComponent),r(),c("name",E(2,11,"GENERAL.MODE"))("channelAddress",e.component.id+"/_PropertyMode")("converter",e.CONVERT_MODE_TO_MANUAL_OFF_AUTOMATIC),r(2),c("name",E(4,13,"EDGE.INDEX.WIDGETS.TIME_OF_USE_TARIFF.PRICE"))("value",e.priceWithCurrency),r(2),c("name",E(6,15,"GENERAL.STATUS"))("converter",e.CONVERT_TIME_OF_USE_TARIFF_STATE)("channelAddress",e.component.id+"/StateMachine")}}var YC=(()=>{class t extends ce{constructor(){super(...arguments),this.CONVERT_MODE_TO_MANUAL_OFF_AUTOMATIC=M.CONVERT_MODE_TO_MANUAL_OFF_AUTOMATIC(this.translate),this.CONVERT_TIME_OF_USE_TARIFF_STATE=M.CONVERT_TIME_OF_USE_TARIFF_STATE(this.translate),this.priceWithCurrency="-",this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:jC,componentProps:{component:this.component}}}getChannelAddresses(){return[new y(this.component.id,"QuarterlyPrices")]}onCurrentData(e){let n=e.allComponents[this.component.id+"/QuarterlyPrices"],i=this.config?.getComponent("_meta"),a=this.config?.getPropertyFromComponent(i,"currency"),m=Di.getCurrencyLabelByCurrency(a);this.priceWithCurrency=M.CONVERT_PRICE_TO_CENT_PER_KWH(2,m)(n)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Ess_TimeOfUseTariff"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon","modalComponent"],[3,"name","channelAddress","converter"],[3,"name","value"],["leftColumnWidth","20",3,"name","converter","channelAddress"]],template:function(n,i){n&1&&f(0,rM,7,18,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var $C=(()=>{class t{static{this.SELECTOR="administration"}constructor(e,n,i,a,m){this.route=e,this.modalCtrl=n,this.service=i,this.websocket=a,this.translate=m,this.isCheckedZoe=null}ngOnInit(){this.evcsComponent.properties.minHwCurrent==6e3?this.isCheckedZoe=!1:this.evcsComponent.properties.minHwCurrent==1e4&&(this.isCheckedZoe=!0)}updateZoeMode(e){let n=this.evcsComponent.properties.minHwCurrent,i=this.evcsComponent.properties.minHwCurrent;e.detail.checked==!0?n=1e4:n=6e3,this.edge!=null&&i!=n&&this.edge.updateComponentConfig(this.websocket,this.evcsComponent.id,[{name:"minHwCurrent",value:n}]).then(()=>{this.evcsComponent.properties.minHwCurrent=n,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(a=>{this.evcsComponent.properties.minHwCurrent=i,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+a,"danger"),console.warn(a)})}static{this.\u0275fac=function(n){return new(n||t)(x(De),x(he),x(j),x(Ce),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["administration"]],inputs:{evcsComponent:"evcsComponent",edge:"edge"},standalone:!1,decls:22,vars:4,consts:[["color","primary",1,"ion-justify-content-center"],["translate",""],["slot","end"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],["lines","none"],["mode","md",3,"ionChange","checked"],[1,"ion-padding-top"],[1,"ion-justify-content-center","ion-align-items-center"],["size","2",1,"ion-text-center"],["padding-right","","color","primary","size","large","name","alert-outline"],["size","10"],[1,"ion-text-wrap"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),h(3," EDGE.INDEX.WIDGETS.EVCS.ADMINISTRATION.CAR_ADMINISTRATION "),l(),s(4,"ion-buttons",2)(5,"ion-button",3),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",4),l()()()(),s(7,"ion-content")(8,"ion-card-content")(9,"ion-item",5)(10,"ion-label"),h(11),g(12,"translate"),l(),s(13,"ion-toggle",6),O("ionChange",function(m){return i.updateZoeMode(m)}),l()()(),s(14,"ion-grid",7)(15,"ion-row",8)(16,"ion-col",9),d(17,"ion-icon",10),l(),s(18,"ion-col",11)(19,"ion-note",12)(20,"small",1),h(21,"EDGE.INDEX.WIDGETS.EVCS.ADMINISTRATION.CUSTOM_CAR_INFO"),l()()()()()()),n&2&&(r(11),R(" ",E(12,2,"EDGE.INDEX.WIDGETS.EVCS.ADMINISTRATION.RENAULT_ZOE")," "),r(2),c("checked",i.isCheckedZoe))},dependencies:[Ge,Xe,We,Ae,je,Me,xt,ie,J,ne,qo,Se,St,wi,ct,ft,Ne,V],encapsulation:2})}}return t})();function sM(t,o){t&1&&(s(0,"ion-card-content"),d(1,"oe-modal-info-line",0),g(2,"translate"),d(3,"oe-modal-horizontal-line"),l(),s(4,"ion-card-content"),d(5,"oe-modal-info-line",0),g(6,"translate"),l()),t&2&&(r(),c("info",E(2,2,"EDGE.INDEX.WIDGETS.EVCS.OPTIMIZED_CHARGE_MODE.SHORT_NAME")),r(4),c("info",E(6,4,"EDGE.INDEX.WIDGETS.EVCS.OPTIMIZED_CHARGE_MODE.INFO")))}function lM(t,o){t&1&&(s(0,"ion-card-content"),d(1,"oe-modal-info-line",0),g(2,"translate"),d(3,"oe-modal-horizontal-line"),l(),s(4,"ion-card-content"),d(5,"oe-modal-info-line",0),g(6,"translate"),d(7,"oe-modal-info-line",0),g(8,"translate"),l()),t&2&&(r(),c("info",E(2,3,"GENERAL.MANUALLY")),r(4),c("info",E(6,5,"EDGE.INDEX.WIDGETS.EVCS.FORCE_CHARGE_MODE.INFO")),r(2),c("info",E(8,7,"EDGE.INDEX.WIDGETS.EVCS.FORCE_CHARGE_MODE.MAX_CHARGING_DETAILS")))}var XC=(()=>{class t extends Wt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:2,vars:1,consts:[[2,"text-align","center",3,"info"]],template:function(n,i){if(n&1&&f(0,sM,7,6)(1,lM,9,9),n&2){let a;_((a=i.chargeMode)==="EXCESS_POWER"?0:a==="FORCE_CHARGE"?1:-1)}},dependencies:[Mn,sn,We,V],encapsulation:2})}}return t})();var cM=t=>({text:t,lineStyle:"color: #FFA500"}),mM=t=>({text:t}),qC=(t,o)=>[t,o],pM=()=>({color:"success",name:"options-outline"}),dM=(t,o)=>({name:t,value:"FORCE_CHARGE",icon:o}),uM=()=>({color:"primary",name:"sunny-outline"}),fM=(t,o)=>({name:t,value:"EXCESS_POWER",icon:o}),_M=()=>({color:"danger",name:"power-outline"}),hM=(t,o)=>({name:t,value:"OFF",icon:o}),CM=(t,o,e)=>[t,o,e],KC=()=>({type:"TOGGLE"}),gM=(t,o,e)=>({tickMin:t,tickMax:o,unit:"W",step:100,pinFormatter:e}),QC=t=>({type:"RANGE",properties:t}),EM=()=>({color:"success",name:"oe-evcs"}),vM=(t,o)=>({name:t,value:"CAR",icon:o}),yM=()=>({color:"success",name:"oe-storage"}),TM=(t,o)=>({name:t,value:"STORAGE",icon:o}),IM=t=>({tickMin:1,tickMax:100,unit:"kWh ",step:1,pinFormatter:t});function xM(t,o){if(t&1){let e=W();s(0,"ion-button",4),O("click",function(){P(e);let i=p(2);return L(i.presentModal())})("keydown.enter",function(){P(e);let i=p(2);return L(i.presentModal())}),d(1,"ion-icon",5),l()}}function SM(t,o){if(t&1&&(d(0,"oe-modal-line",6),g(1,"translate")),t&2){let e=p(4);c("name",E(1,2,"EDGE.INDEX.WIDGETS.EVCS.CHARGE_TARGET"))("value",e.maxChargePower)}}function AM(t,o){if(t&1&&(d(0,"oe-modal-line",6),g(1,"translate")),t&2){let e=p(4);c("name",E(1,2,"EDGE.INDEX.WIDGETS.EVCS.CHARGE_TARGET"))("value",e.chargePowerLimit)}}function wM(t,o){if(t&1&&f(0,SM,2,4,"oe-modal-line",6)(1,AM,2,4,"oe-modal-line",6),t&2){let e=p(3);_(e.chargePowerLimit>=e.maxChargePower?0:1)}}function bM(t,o){if(t&1&&(d(0,"oe-modal-line",7),g(1,"translate")),t&2){let e=p(3);c("name",E(1,3,"EDGE.INDEX.WIDGETS.EVCS.CHARGING_POWER"))("value",e.chargePower.value)("converter",e.Utils.CONVERT_TO_WATT)}}function DM(t,o){if(t&1&&(d(0,"oe-modal-line",6),g(1,"translate")),t&2){let e=p(3);c("name",E(1,2,"EDGE.INDEX.WIDGETS.EVCS.CHARGING_POWER"))("value",e.emptyValue)}}function RM(t,o){if(t&1&&(d(0,"oe-modal-line",6),g(1,"translate")),t&2){let e=p(3);c("name",E(1,2,"EDGE.INDEX.WIDGETS.EVCS.ENERGY_SINCE_BEGINNING"))("value",e.energySession)}}function OM(t,o){t&1&&(s(0,"ion-row")(1,"ion-col",12),d(2,"ion-icon",13),l(),s(3,"ion-col",14),d(4,"oe-modal-info-line",3),g(5,"translate"),g(6,"translate"),l()()),t&2&&(r(4),c("info",at(9,qC,be(5,cM,E(5,1,"EDGE.INDEX.WIDGETS.EVCS.HYSTERESIS")),be(7,mM,E(6,3,"EDGE.INDEX.WIDGETS.EVCS.HYSTERESIS_INFO")))))}function NM(t,o){if(t&1){let e=W();s(0,"td",10)(1,"ion-icon",15),O("click",function(){P(e);let i=p(4);return i.isPrioritization=!1,L(i.presentPopover())}),l()()}}function MM(t,o){if(t&1&&(d(0,"oe-modal-buttons",11),g(1,"translate"),g(2,"translate"),g(3,"translate")),t&2){let e=p(4);c("formGroup",e.formGroup)("component",e.component)("buttons",_i(21,CM,at(10,dM,E(1,3,"GENERAL.MANUALLY"),H(9,pM)),at(14,fM,E(2,5,"GENERAL.AUTOMATIC"),H(13,uM)),at(18,hM,E(3,7,"GENERAL.OFF"),H(17,_M))))}}function FM(t,o){if(t&1&&(f(0,OM,7,12,"ion-row"),d(1,"oe-modal-horizontal-line"),s(2,"table",8)(3,"tr")(4,"td",9),h(5," GENERAL.MODE "),l(),f(6,NM,2,0,"td",10),l()(),f(7,MM,4,25,"oe-modal-buttons",11)),t&2){let e=p(3);_(e.awaitingHysteresis?0:-1),r(6),_(e.formGroup.value.chargeMode!=="OFF"?6:-1),r(),_(e.formGroup.controls.chargeMode.value?7:-1)}}function GM(t,o){if(t&1){let e=W();s(0,"table",8)(1,"tr")(2,"ion-range",17),O("ionChange",function(i){P(e);let a=p(5);return L(a.updateForceMinPower(i,a.controller,a.numberOfPhases))}),s(3,"ion-label",18),h(4),g(5,"unitvalue"),l(),s(6,"ion-label",19),h(7),g(8,"unitvalue"),l()()()()}if(t&2){let e=p(5);r(2),c("min",ki(e.formatNumber(e.minChargePower)))("max",ki(e.formatNumber(e.maxChargePower)))("value",ki(e.controller.properties.forceChargeMinPower*e.numberOfPhases))("pinFormatter",e.WATT_PIN_FORMATTER),r(2),R(" ",q(5,9,e.formatNumber(e.minChargePower),"W")," "),r(3),R(" ",q(8,12,e.formatNumber(e.maxChargePower),"W")," ")}}function PM(t,o){if(t&1&&(Y(0),d(1,"oe-modal-line",16),g(2,"translate"),f(3,GM,9,15,"table",8),z(),d(4,"oe-modal-horizontal-line")),t&2){let e=p(4);r(),c("name",E(2,5,"EDGE.INDEX.WIDGETS.EVCS.FORCE_CHARGE_MODE.MAX_CHARGING"))("value",e.formatNumber(e.formGroup.value.forceChargeMinPower*e.numberOfPhases))("component",e.component)("converter",e.Utils.CONVERT_TO_WATT),r(2),_(e.minChargePower&&e.maxChargePower&&e.numberOfPhases&&e.formGroup.value.forceChargeMinPower?3:-1)}}function LM(t,o){if(t&1&&(d(0,"oe-modal-line",22),g(1,"translate"),d(2,"oe-modal-line",23)),t&2){let e=p(5);c("name",E(1,7,"EDGE.INDEX.WIDGETS.EVCS.OPTIMIZED_CHARGE_MODE.MIN_CHARGE_POWER"))("formGroup",e.formGroup)("component",e.controller)("value",e.formGroup.value.defaultChargeMinPower)("converter",e.Utils.CONVERT_TO_WATT),r(2),c("formGroup",e.formGroup)("control",be(13,QC,_i(9,gM,e.minChargePower,e.maxChargePower,e.WATT_PIN_FORMATTER)))}}function kM(t,o){if(t&1&&(d(0,"oe-modal-buttons",21),g(1,"translate"),g(2,"translate")),t&2){let e=p(5);c("formGroup",e.formGroup)("component",e.component)("buttons",at(15,qC,at(8,vM,E(1,3,"EDGE.INDEX.WIDGETS.EVCS.OPTIMIZED_CHARGE_MODE.CHARGING_PRIORITY.CAR"),H(7,EM)),at(12,TM,E(2,5,"EDGE.INDEX.WIDGETS.EVCS.OPTIMIZED_CHARGE_MODE.CHARGING_PRIORITY.STORAGE"),H(11,yM))))}}function VM(t,o){if(t&1&&(d(0,"oe-modal-line",20),g(1,"translate"),f(2,LM,3,15),d(3,"oe-modal-line",2),g(4,"translate"),f(5,kM,3,18,"oe-modal-buttons",21),d(6,"oe-modal-horizontal-line")),t&2){let e=p(4);c("name",E(1,6,"EDGE.INDEX.WIDGETS.EVCS.OPTIMIZED_CHARGE_MODE.MIN_CHARGING"))("formGroup",e.formGroup)("control",H(10,KC)),r(2),_(e.formGroup.controls.minGuarantee.value===!0?2:-1),r(),c("name",E(4,8,"EDGE.INDEX.WIDGETS.EVCS.PRIORITIZATION")),r(2),_(e.formGroup.controls.priority.value?5:-1)}}function HM(t,o){if(t&1&&(d(0,"oe-modal-line",22),g(1,"translate"),d(2,"oe-modal-line",25)),t&2){let e=p(5);c("name",E(1,7,"EDGE.INDEX.WIDGETS.EVCS.ENERGY_LIMIT"))("formGroup",e.formGroup)("component",e.controller)("value",e.formGroup.value.energySessionLimit)("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS),r(2),c("formGroup",e.formGroup)("control",be(11,QC,be(9,IM,e.KILO_WATT_HOURS_PIN_FORMATTER)))}}function BM(t,o){if(t&1&&(d(0,"oe-modal-line",24),g(1,"translate"),f(2,HM,3,13)),t&2){let e=p(4);c("name",E(1,5,"EDGE.INDEX.WIDGETS.EVCS.MAX_ENERGY_RESTRICTION"))("formGroup",e.formGroup)("component",e.controller)("control",H(7,KC)),r(2),_(e.formGroup.controls.energyLimit.value===!0?2:-1)}}function WM(t,o){if(t&1&&(f(0,PM,5,7),f(1,VM,7,11),f(2,BM,3,8)),t&2){let e=p(3);_(e.formGroup.value.chargeMode==="FORCE_CHARGE"?0:-1),r(),_(e.formGroup.value.chargeMode==="EXCESS_POWER"?1:-1),r(),_(e.controller&&e.formGroup.value.chargeMode!=="OFF"?2:-1)}}function UM(t,o){t&1&&(d(0,"oe-modal-info-line",3),g(1,"translate")),t&2&&c("info",E(1,1,"EDGE.INDEX.WIDGETS.EVCS.UNCONTROLLABLE"))}function zM(t,o){if(t&1&&(d(0,"oe-modal-line",6),g(1,"translate"),f(2,wM,2,1),f(3,bM,2,5,"oe-modal-line",7)(4,DM,2,4,"oe-modal-line",6),f(5,RM,2,4,"oe-modal-line",6),f(6,FM,8,3),d(7,"oe-modal-horizontal-line"),f(8,WM,3,3),f(9,UM,2,3,"oe-modal-info-line",3)),t&2){let e=p(2);c("name",E(1,8,"EDGE.INDEX.WIDGETS.EVCS.STATUS"))("value",e.status),r(2),_(e.isReadWrite?2:-1),r(),_((e.chargePower==null?null:e.chargePower.value)>0?3:4),r(2),_((e.chargePower==null?null:e.chargePower.value)>0||e.state===2||e.state===7?5:-1),r(),_(e.isReadWrite?6:-1),r(2),_(e.controller?8:-1),r(),_(!e.controller&&e.isReadWrite?9:-1)}}function jM(t,o){t&1&&(d(0,"oe-modal-info-line",3),g(1,"translate")),t&2&&c("info",E(1,1,"EDGE.INDEX.WIDGETS.EVCS.NO_CONNECTION.DESCRIPTION"))}function YM(t,o){if(t&1&&(s(0,"oe-modal",0),f(1,xM,2,0,"ion-button",1),d(2,"ngx-spinner",2),f(3,zM,10,10),f(4,jM,2,3,"oe-modal-info-line",3),l()),t&2){let e=p();c("title",e.component.alias)("component",e.controller)("formGroup",e.formGroup)("useDefaultPrefix",e.useDefaultPrefix),r(),_(e.isReadWrite?1:-1),r(),c("name","spinner"),r(),_(e.isConnectionSuccessful?3:-1),r(),_(e.isConnectionSuccessful?-1:4)}}var ZC=(()=>{class t extends Wt{constructor(e,n,i,a,m,u,C,v,T){super(e,n,i,a,C,v,T),this.websocket=e,this.route=n,this.service=i,this.modalController=a,this.detailViewController=m,this.popoverctrl=u,this.translate=C,this.formBuilder=v,this.ref=T,this.CONVERT_MANUAL_ON_OFF_AUTOMATIC=M.CONVERT_MODE_TO_MANUAL_OFF_AUTOMATIC(this.translate),this.CONVERT_MANUAL_ON_OFF=M.CONVERT_MANUAL_ON_OFF(this.translate),this.isConnectionSuccessful=!1,this.emptyValue="-",this.state="",this.numberOfPhases=3,this.chargeMode=null,this.isEnergySinceBeginningAllowed=!1,this.isChargingEnabled=!1,this.isReadWrite=!0,this.useDefaultPrefix=!1,this.KILO_WATT_HOURS_PIN_FORMATTER=A=>this.Converter.TO_KILO_WATT_HOURS(A),this.WATT_PIN_FORMATTER=A=>this.Converter.POWER_IN_WATT(A),T.detach(),setInterval(()=>{this.ref.detectChanges()},0)}presentPopover(){return ae(this,null,function*(){return yield(yield this.popoverctrl.create({component:XC,componentProps:{chargeMode:this.formGroup.controls.chargeMode.value}})).present()})}presentModal(){return ae(this,null,function*(){let e=yield this.detailViewController.create({component:$C,componentProps:{evcsComponent:this.evcsComponent,edge:this.edge}});return e.onDidDismiss().then(()=>{this.updateRenaultZoeConfig()}),yield e.present()})}getChannelAddresses(){return this.chargePoint=vi.from(this.component,this.edge.getCurrentConfig(),this.edge),this.controller=this.config.getComponentsByFactory("Controller.Evcs").find(e=>"evcs.id"in e.properties&&e.properties["evcs.id"]==this.component.id),this.evcsComponent=this.config.getComponent(this.component.id),[this.chargePoint.powerChannel,new y(this.component.id,"Phases"),new y(this.component.id,"Plug"),new y(this.component.id,"Status"),new y(this.component.id,"State"),new y(this.component.id,"EnergySession"),new y(this.component.id,"MinimumHardwarePower"),new y(this.component.id,"MaximumHardwarePower"),new y(this.component.id,"SetChargePowerLimit"),new y(this.component.id,"_PropertyReadOnly"),new y(this.controller?.id,"_PropertyChargeMode"),new y(this.controller?.id,"_PropertyEnabledCharging"),new y(this.controller?.id,"_PropertyDefaultChargeMinPower"),new y(this.controller?.id,"AwaitingHysteresis")]}onCurrentData(e){this.isConnectionSuccessful=e.allComponents[this.component.id+"/State"]!==3,this.awaitingHysteresis=e.allComponents[this.controller?.id+"/AwaitingHysteresis"],this.isReadWrite=this.component.hasPropertyValue("readOnly",!0)===!1,this.formGroup?.pristine&&(this.status=this.getState(this.controller?e.allComponents[this.controller.id+"/_PropertyEnabledCharging"]===1:null,e.allComponents[this.component.id+"/Status"],e.allComponents[this.component.id+"/Plug"]),this.chargePower=M.convertChargeDischargePower(this.translate,e.allComponents[this.chargePoint.powerChannel.toString()]),this.chargePowerLimit=M.CONVERT_TO_WATT(this.formatNumber(e.allComponents[this.component.id+"/SetChargePowerLimit"])),this.state=e.allComponents[this.component.id+"/Status"],this.energySession=M.CONVERT_TO_WATTHOURS(e.allComponents[this.component.id+"/EnergySession"]),this.minChargePower=this.formatNumber(e.allComponents[this.component.id+"/MinimumHardwarePower"]),this.maxChargePower=this.formatNumber(e.allComponents[this.component.id+"/MaximumHardwarePower"]),this.numberOfPhases=e.allComponents[this.component.id+"/Phases"]?e.allComponents[this.component.id+"/Phases"]:3,this.defaultChargeMinPower=e.allComponents[this.controller?.id+"/_PropertyDefaultChargeMinPower"])}onIsInitialized(){this.chargePoint=vi.from(this.component,this.edge.getCurrentConfig(),this.edge),this.subscription.add(this.formGroup?.controls.energyLimit?.valueChanges.subscribe(e=>{e?this.formGroup.controls.energySessionLimit?.value===0&&(this.formGroup.controls.energySessionLimit.setValue(2e4),this.formGroup.controls.energySessionLimit.markAsDirty()):(this.formGroup.controls.energySessionLimit.setValue(0),this.formGroup.controls.energySessionLimit.markAsDirty())})),this.subscription.add(this.formGroup?.get("chargeMode").valueChanges.subscribe(e=>{e==="OFF"?(this.formGroup.get("enabledCharging").setValue(!1),this.formGroup.get("chargeMode").markAsPristine()):this.formGroup.get("enabledCharging").setValue(!0),this.formGroup.get("enabledCharging").markAsDirty()})),this.subscription.add(this.formGroup?.get("minGuarantee").valueChanges.subscribe(e=>{e?this.formGroup.controls.defaultChargeMinPower.setValue(1400*this.numberOfPhases):this.formGroup.controls.defaultChargeMinPower.setValue(0),this.formGroup.controls.defaultChargeMinPower.markAsDirty()})),this.subscription.add(this.formGroup?.get("energySessionLimitKwh").valueChanges.subscribe(e=>{this.formGroup.controls.energySessionLimit.setValue(e*1e3),this.formGroup.controls.energySessionLimit.markAsDirty(),this.formGroup.controls.energySessionLimitKwh.markAsPristine()}))}getFormGroup(){return this.formBuilder.group({chargeMode:new K(this.controller?.properties.enabledCharging==!1?"OFF":this.controller?.properties.chargeMode),energyLimit:new K(this.controller?.properties.energySessionLimit>0),minGuarantee:new K(this.controller?.properties.defaultChargeMinPower>0),defaultChargeMinPower:new K(this.controller?.properties.defaultChargeMinPower),forceChargeMinPower:new K(this.controller?.properties.forceChargeMinPower),priority:new K(this.controller?.properties.priority),energySessionLimit:new K(this.controller?.properties.energySessionLimit),energySessionLimitKwh:new K(Math.round(this.controller?.properties.energySessionLimit/1e3)),enabledCharging:new K(this.isChargingEnabled)})}pinFormatter(e){return Fo.FORMAT_WATT(e)}updateForceMinPower(e,n,i){let a=e.detail.value/i;this.formGroup.controls.forceChargeMinPower.markAsDirty(),this.formGroup.controls.forceChargeMinPower.setValue(a)}updateRenaultZoeConfig(){if(this.controller&&this.evcsComponent.properties.minHwCurrent==1e4){let e=this.controller.properties.forceChargeMinPower,n=2300;if(e<n&&this.edge!=null){let i=n;this.edge.updateComponentConfig(this.websocket,this.controller.id,[{name:"forceChargeMinPower",value:i}]).then(()=>{this.controller.properties.forceChargeMinPower=i}).catch(a=>{this.controller.properties.forceChargeMinPower=e,console.warn(a)})}}}formatNumber(e){return Math.ceil(e/100)*100}getState(e,n,i){if(e===!1)return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGING_STATION_DEACTIVATED");if(i==null){if(n==null)return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.NOT_CHARGING")}else if(i!=JC.PLUGGED_ON_EVCS_AND_ON_EV_AND_LOCKED&&this.chargePower?.value>450)return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CABLE_NOT_CONNECTED");switch(n){case bo.STARTING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.STARTING");case bo.UNDEFINED:case bo.ERROR:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.ERROR");case bo.READY_FOR_CHARGING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.READY_FOR_CHARGING");case bo.NOT_READY_FOR_CHARGING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.NOT_READY_FOR_CHARGING");case bo.AUTHORIZATION_REJECTED:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.NOT_CHARGING");case bo.CHARGING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGING");case bo.ENERGY_LIMIT_REACHED:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGE_LIMIT_REACHED");case bo.CHARGING_FINISHED:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CAR_FULL")}}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(De),x(j),x(he),x(he),x(md),x(te),x(Ft),x(ln))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["helpKey","EVCS",3,"title","component","formGroup","useDefaultPrefix"],["button","","tabindex","0"],[3,"name"],[3,"info"],["button","","tabindex","0",3,"click","keydown.enter"],["name","car"],[3,"name","value"],[3,"name","value","converter"],[1,"full_width"],["translate",""],[1,"align_right"],["controlName","chargeMode",3,"formGroup","component","buttons"],["size","1",2,"display","flex","align-items","center","justify-content","center"],["name","information-outline","size","large"],["size","11"],["name","information-circle-outline",1,"ion-no-padding",2,"cursor","pointer",3,"click"],[3,"name","value","component","converter"],["color","dark","pin","true","step","100","debounce","500",2,"padding-top","8px",3,"ionChange","min","max","pinFormatter","value"],["slot","start"],["slot","end"],["controlName","minGuarantee","leftColumnWidth","100",3,"name","formGroup","control"],["controlName","priority",3,"formGroup","component","buttons"],[3,"name","formGroup","component","value","converter"],["controlName","defaultChargeMinPower",3,"formGroup","control"],["controlName","energyLimit","leftColumnWidth","100",1,"align_right",3,"name","formGroup","component","control"],["controlName","energySessionLimitKwh",3,"formGroup","control"]],template:function(n,i){n&1&&f(0,YM,5,8,"oe-modal",0),n&2&&_(i.isInitialized&&i.formGroup?0:-1)},dependencies:[Nn,Mn,Vt,sn,Sn,me,Ke,Ge,Ae,ie,ne,Ai,Se,tn,ot,Ne,Ut,V],encapsulation:2})}}return t})(),bo=(function(t){return t[t.UNDEFINED=-1]="UNDEFINED",t[t.STARTING=0]="STARTING",t[t.NOT_READY_FOR_CHARGING=1]="NOT_READY_FOR_CHARGING",t[t.READY_FOR_CHARGING=2]="READY_FOR_CHARGING",t[t.CHARGING=3]="CHARGING",t[t.ERROR=4]="ERROR",t[t.AUTHORIZATION_REJECTED=5]="AUTHORIZATION_REJECTED",t[t.ENERGY_LIMIT_REACHED=6]="ENERGY_LIMIT_REACHED",t[t.CHARGING_FINISHED=7]="CHARGING_FINISHED",t})(bo||{}),JC=(function(t){return t[t.UNDEFINED=-1]="UNDEFINED",t[t.UNPLUGGED=0]="UNPLUGGED",t[t.PLUGGED_ON_EVCS=1]="PLUGGED_ON_EVCS",t[t.PLUGGED_ON_EVCS_AND_LOCKED=3]="PLUGGED_ON_EVCS_AND_LOCKED",t[t.PLUGGED_ON_EVCS_AND_ON_EV=5]="PLUGGED_ON_EVCS_AND_ON_EV",t[t.PLUGGED_ON_EVCS_AND_ON_EV_AND_LOCKED=7]="PLUGGED_ON_EVCS_AND_ON_EV_AND_LOCKED",t})(JC||{});var $M=()=>({name:"oe-evcs",color:"normal"});function XM(t,o){if(t&1&&(d(0,"oe-flat-widget-line",3),g(1,"translate")),t&2){let e=p(3);c("name",E(1,3,"EDGE.INDEX.WIDGETS.EVCS.ENERGY_SINCE_BEGINNING"))("channelAddress",e.componentId+"/EnergySession")("converter",e.CONVERT_TO_KILO_WATTHOURS)}}function qM(t,o){if(t&1&&(d(0,"oe-flat-widget-line",4),g(1,"translate")),t&2){let e=p(3);c("name",E(1,2,"GENERAL.MODE"))("value",e.mode)}}function KM(t,o){if(t&1&&(d(0,"oe-flat-widget-line",4),g(1,"translate"),g(2,"translate"),d(3,"oe-flat-widget-line",7),g(4,"translate")),t&2){let e=p(5);c("name",E(1,5,"EDGE.INDEX.WIDGETS.EVCS.OPTIMIZED_CHARGE_MODE.MIN_CHARGING"))("value",E(2,7,"GENERAL.ACTIVE")),r(3),c("name",E(4,9,"EDGE.INDEX.WIDGETS.EVCS.OPTIMIZED_CHARGE_MODE.MIN_CHARGE_POWER"))("converter",e.CONVERT_WATT_TO_KILOWATT)("value",e.defaultChargeMinPower)}}function QM(t,o){if(t&1&&(f(0,KM,5,11),d(1,"oe-flat-widget-line",6),g(2,"translate"),g(3,"translate")),t&2){let e=p(4);_(e.defaultChargeMinPower>0?0:-1),r(),c("name",E(2,3,"EDGE.INDEX.WIDGETS.EVCS.PRIORITIZATION"))("value",E(3,5,e.prioritization))}}function ZM(t,o){if(t&1&&(d(0,"oe-flat-widget-line",5),g(1,"translate")),t&2){let e=p(4);c("name",E(1,3,"EDGE.INDEX.WIDGETS.EVCS.FORCE_CHARGE_MODE.MAX_CHARGING"))("converter",e.CONVERT_WATT_TO_KILOWATT)("value",e.maxChargingValue)}}function JM(t,o){if(t&1&&(d(0,"oe-flat-widget-line",5),g(1,"translate")),t&2){let e=p(4);c("name",E(1,3,"EDGE.INDEX.WIDGETS.EVCS.ENERGY_LIMIT"))("converter",e.CONVERT_TO_KILO_WATTHOURS)("value",e.energySessionLimit)}}function e3(t,o){if(t&1&&(f(0,QM,4,7),f(1,ZM,2,5,"oe-flat-widget-line",5),f(2,JM,2,5,"oe-flat-widget-line",5)),t&2){let e=p(3);_(e.chargeMode==="EXCESS_POWER"?0:-1),r(),_(e.chargeMode==="FORCE_CHARGE"?1:-1),r(),_(e.energySessionLimit!==0?2:-1)}}function t3(t,o){if(t&1&&(d(0,"oe-flat-widget-line",2),g(1,"translate"),f(2,XM,2,5,"oe-flat-widget-line",3),f(3,qM,2,4,"oe-flat-widget-line",4),f(4,e3,3,3)),t&2){let e=p(2);c("name",E(1,5,"EDGE.INDEX.WIDGETS.EVCS.STATUS"))("value",e.status),r(2),_(e.isEnergySinceBeginningAllowed?2:-1),r(),_(e.isChargingEnabled&&e.isReadWrite?3:-1),r(),_(e.isChargingEnabled?4:-1)}}function n3(t,o){t&1&&(d(0,"oe-flat-widget-line",1),g(1,"translate")),t&2&&c("name",E(1,1,"EDGE.INDEX.WIDGETS.EVCS.NO_CONNECTION.DESCRIPTION"))}function i3(t,o){if(t&1&&(s(0,"oe-flat-widget",0),f(1,t3,5,7)(2,n3,2,3,"oe-flat-widget-line",1),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("title",e.evcsComponent.alias)("icon",H(4,$M)),r(),_(e.isConnectionSuccessful?1:2)}}var eg=(()=>{class t extends ce{constructor(){super(...arguments),this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.CONVERT_MANUAL_ON_OFF=M.CONVERT_MANUAL_ON_OFF(this.translate),this.evcsComponent=null,this.isConnectionSuccessful=!1,this.isEnergySinceBeginningAllowed=!1,this.isChargingEnabled=!1,this.state="",this.chargeMode=null,this.CONVERT_TO_WATT=M.CONVERT_TO_WATT,this.CONVERT_TO_KILO_WATTHOURS=M.CONVERT_TO_KILO_WATTHOURS,this.CONVERT_MANUAL_ON_OFF_AUTOMATIC=M.CONVERT_MODE_TO_MANUAL_OFF_AUTOMATIC(this.translate),this.propertyMode=null,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:ZC,componentProps:{component:this.component}}}getChannelAddresses(){this.chargePoint=vi.from(this.component,this.edge.getCurrentConfig(),this.edge);let e=[this.chargePoint.powerChannel,new y(this.component.id,"Phases"),new y(this.component.id,"Plug"),new y(this.component.id,"Status"),new y(this.component.id,"State"),new y(this.component.id,"EnergySession"),new y(this.component.id,"MinimumHardwarePower"),new y(this.component.id,"MaximumHardwarePower"),new y(this.component.id,"SetChargePowerLimit")],n=this.config.getComponentsByFactory("Controller.Evcs");for(let i of n){let a=i.properties;"evcs.id"in a&&a["evcs.id"]===this.componentId&&(this.controller=i,e.push(new y(i.id,"_PropertyEnabledCharging")))}return e}onCurrentData(e){this.evcsComponent=this.config.getComponent(this.component.id),this.isConnectionSuccessful=e.allComponents[this.component.id+"/State"]!=3,this.isReadWrite=this.component.hasPropertyValue("readOnly",!0)===!1,this.status=this.getState(this.controller?e.allComponents[this.controller.id+"/_PropertyEnabledCharging"]===1:null,e.allComponents[this.component.id+"/Status"],e.allComponents[this.component.id+"/Plug"]),(e.allComponents[this.chargePoint.powerChannel.toString()]>0||e.allComponents[this.component.id+"/Status"]==2||e.allComponents[this.component.id+"/Status"]==7)&&(this.isEnergySinceBeginningAllowed=!0),this.isChargingEnabled&&(this.chargeMode=="FORCE_CHARGE"?this.mode=this.translate.instant("GENERAL.MANUALLY"):this.chargeMode=="EXCESS_POWER"&&(this.mode=this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.OPTIMIZED_CHARGE_MODE.SHORT_NAME"))),this.controller&&(this.chargeMode=this.controller.properties.chargeMode,this.isChargingEnabled=e.allComponents[this.controller.id+"/_PropertyEnabledCharging"]===1,this.defaultChargeMinPower=this.controller.properties.defaultChargeMinPower,this.prioritization=this.controller.properties.priority in ng?"Edge.Index.Widgets.EVCS.OptimizedChargeMode.ChargingPriority."+this.controller.properties.priority.toLowerCase():"",this.phases?this.maxChargingValue=M.multiplySafely(this.controller.properties.forceChargeMinPower,this.phases):this.maxChargingValue=M.multiplySafely(this.controller.properties.forceChargeMinPower,3),this.energySessionLimit=this.controller.properties.energySessionLimit),this.phases=e.allComponents[this.componentId+"/Phases"],this.chargeDischargePower=M.convertChargeDischargePower(this.translate,e.allComponents[this.chargePoint.powerChannel.toString()]),this.chargeTarget=M.CONVERT_TO_WATT(this.formatNumber(e.allComponents[this.component.id+"/SetChargePowerLimit"])),this.energySession=M.CONVERT_TO_WATT(e.allComponents[this.component.id+"/EnergySession"]),this.minChargePower=this.formatNumber(e.allComponents[this.component.id+"/MinimumHardwarePower"]),this.maxChargePower=this.formatNumber(e.allComponents[this.component.id+"/MaximumHardwarePower"]),this.state=e.allComponents[this.component.id+"/Status"]}getState(e,n,i){if(e===!1)return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGING_STATION_DEACTIVATED");if(i==null){if(n==null)return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.NOT_CHARGING")}else if(i!=tg.PLUGGED_ON_EVCS_AND_ON_EV_AND_LOCKED)return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CABLE_NOT_CONNECTED");switch(n){case Do.STARTING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.STARTING");case Do.UNDEFINED:case Do.ERROR:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.ERROR");case Do.READY_FOR_CHARGING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.READY_FOR_CHARGING");case Do.NOT_READY_FOR_CHARGING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.NOT_READY_FOR_CHARGING");case Do.AUTHORIZATION_REJECTED:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.NOT_CHARGING");case Do.CHARGING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGING");case Do.ENERGY_LIMIT_REACHED:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGE_LIMIT_REACHED");case Do.CHARGING_FINISHED:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CAR_FULL")}}formatNumber(e){return Math.ceil(e/100)*100}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Evcs"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[2,"cursor","pointer",3,"modalComponent","title","icon"],["leftColumnWidth","100",3,"name"],["leftColumnWidth","20",3,"name","value"],[3,"name","channelAddress","converter"],[3,"name","value"],[3,"name","converter","value"],["leftColumnWidth","50",3,"name","value"],["leftColumnWidth","50",3,"name","converter","value"]],template:function(n,i){n&1&&f(0,i3,3,5,"oe-flat-widget",0),n&2&&_(i.isInitialized&&i.evcsComponent?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})(),Do=(function(t){return t[t.UNDEFINED=-1]="UNDEFINED",t[t.STARTING=0]="STARTING",t[t.NOT_READY_FOR_CHARGING=1]="NOT_READY_FOR_CHARGING",t[t.READY_FOR_CHARGING=2]="READY_FOR_CHARGING",t[t.CHARGING=3]="CHARGING",t[t.ERROR=4]="ERROR",t[t.AUTHORIZATION_REJECTED=5]="AUTHORIZATION_REJECTED",t[t.ENERGY_LIMIT_REACHED=6]="ENERGY_LIMIT_REACHED",t[t.CHARGING_FINISHED=7]="CHARGING_FINISHED",t})(Do||{}),tg=(function(t){return t[t.UNDEFINED=-1]="UNDEFINED",t[t.UNPLUGGED=0]="UNPLUGGED",t[t.PLUGGED_ON_EVCS=1]="PLUGGED_ON_EVCS",t[t.PLUGGED_ON_EVCS_AND_LOCKED=3]="PLUGGED_ON_EVCS_AND_LOCKED",t[t.PLUGGED_ON_EVCS_AND_ON_EV=5]="PLUGGED_ON_EVCS_AND_ON_EV",t[t.PLUGGED_ON_EVCS_AND_ON_EV_AND_LOCKED=7]="PLUGGED_ON_EVCS_AND_ON_EV_AND_LOCKED",t})(tg||{}),ng=(function(t){return t[t.CAR=0]="CAR",t[t.STORAGE=1]="STORAGE",t})(ng||{});function r3(t,o){t&1&&(s(0,"table",3)(1,"tr")(2,"td",4),d(3,"ion-icon",5),l(),s(4,"td",6),d(5,"oe-modal-line",7),g(6,"translate"),l()()()),t&2&&(r(5),c("name",E(6,1,"EDGE.INDEX.WIDGETS.HEAT.CHANGES_MY_PV_INFO")))}function a3(t,o){if(t&1&&(s(0,"oe-modal",0),d(1,"oe-modal-line",1),g(2,"translate"),g(3,"translate"),d(4,"oe-modal-line",2),g(5,"translate"),d(6,"oe-modal-line",2),g(7,"translate"),f(8,r3,7,3,"table",3),l()),t&2){let e=p();c("title",e.component.alias)("component",e.controller),r(),c("name",E(2,12,"GENERAL.STATUS"))("value",E(3,14,e.status))("converter",e.CONVERT_POWER_2_HEAT_STATE),r(3),c("name",E(5,16,"EDGE.INDEX.WIDGETS.HEAT.HEATING_OUTPUT"))("channelAddress",e.component.id+"/ActivePower")("converter",e.Utils.CONVERT_TO_WATT),r(2),c("name",E(7,18,"EDGE.INDEX.WIDGETS.HEAT.TEMPERATURE"))("channelAddress",e.component.id+"/Temperature")("converter",e.Utils.CONVERT_DEZIDEGREE_CELSIUS_TO_DEGREE_CELSIUS),r(2),_(e.isMyPV?8:-1)}}var Lm=(()=>{class t extends Wt{constructor(){super(...arguments),this.CONVERT_POWER_2_HEAT_STATE=Be.CONVERT_POWER_2_HEAT_STATE(this.translate),this.Mode=Gs,this.WorkMode=ca,this.statusNumber=0,this.status=null,this.isMyPV=!1}onIsInitialized(){this==null||this.component==null||(this.isMyPV=this.component.factoryId==="Heat.MyPv.AcThor9s")}getChannelAddresses(){return this==null||this.component==null?[]:[new y(this.component.id,"ActivePower"),new y(this.component.id,"Temperature"),new y(this.component.id,"Status")]}onCurrentData(e){if(this!=null&&this.component!=null)switch(this.statusNumber=e.allComponents[this.component.id+"/Status"]??Cr.error,this.statusNumber){case Cr.standby:case Cr.excess:case Cr.ControlNotAllowed:this.status=Ur.heating;break;case Cr.temperatureReached:this.status=Ur.temperatureReached;break;case Cr.noControlSignal:e.allComponents[this.component.id+"/ActivePower"]>0?this.status=Ur.heating:this.status=Ur.noHeating;break;case Cr.error:this.status=Ur.noHeating;break;default:this.status=Ur.noHeating;break}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"title","component"],[3,"name","value","converter"],[3,"name","channelAddress","converter"],[1,"full_width",2,"margin-top","5%"],["translate","",2,"width","10%"],["size","large","color","normal","name","information-outline",2,"margin-right","5%"],[2,"width","90%"],["leftColumnWidth","100",2,"font-style","italic",3,"name"]],template:function(n,i){n&1&&f(0,a3,9,20,"oe-modal",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[Vt,Sn,ie,Ne,V],encapsulation:2})}}return t})(),Cr=(function(t){return t[t.standby=0]="standby",t[t.excess=1]="excess",t[t.ControlNotAllowed=2]="ControlNotAllowed",t[t.temperatureReached=3]="temperatureReached",t[t.noControlSignal=4]="noControlSignal",t[t.error=5]="error",t})(Cr||{}),Ur=(function(t){return t[t.heating=0]="heating",t[t.temperatureReached=1]="temperatureReached",t[t.noHeating=2]="noHeating",t})(Ur||{});var s3=()=>({color:"normal",name:"flame"});function l3(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),g(3,"translate"),d(4,"oe-flat-widget-line",2),g(5,"translate"),d(6,"oe-flat-widget-line",2),g(7,"translate"),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("title",e.component.alias)("icon",H(20,s3)),r(),c("name",E(2,12,"GENERAL.STATUS"))("value",E(3,14,e.status))("converter",e.CONVERT_POWER_2_HEAT_STATE),r(3),c("name",E(5,16,"EDGE.INDEX.WIDGETS.HEAT.HEATING_OUTPUT"))("channelAddress",e.component.id+"/ActivePower")("converter",e.CONVERT_WATT_TO_KILOWATT),r(2),c("name",E(7,18,"EDGE.INDEX.WIDGETS.HEAT.TEMPERATURE"))("channelAddress",e.component.id+"/Temperature")("converter",e.Utils.CONVERT_DEZIDEGREE_CELSIUS_TO_DEGREE_CELSIUS)}}var ig=(()=>{class t extends ce{constructor(){super(...arguments),this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.CONVERT_POWER_2_HEAT_STATE=Be.CONVERT_POWER_2_HEAT_STATE(this.translate),this.statusNumber=null,this.status=null,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:Lm,componentProps:{component:this.component}}}presentModal(){return ae(this,null,function*(){return this.isInitialized?yield(yield this.modalController.create({component:Lm,componentProps:{component:this.component}})).present():void 0})}getChannelAddresses(){return this==null?[]:this.component==null?[]:[new y(this.component.id,"Status"),new y(this.component.id,"ControlNotAllowed"),new y(this.component.id,"ActivePower"),new y(this.component.id,"Temperature")]}onCurrentData(e){if(this.component!=null&&this.component!=null)switch(this.statusNumber=e.allComponents[this.component.id+"/Status"]??gr.error,this.statusNumber){case gr.standby:case gr.excess:case gr.ControlNotAllowed:this.status=zr.heating;break;case gr.temperatureReached:this.status=zr.temperatureReached;break;case gr.noControlSignal:e.allComponents[this.component.id+"/ActivePower"]>0?this.status=zr.heating:this.status=zr.noHeating;break;case gr.error:this.status=zr.noHeating;break;default:this.status=zr.noHeating;break}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Heat"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"modalComponent","title","icon"],[3,"name","value","converter"],[3,"name","channelAddress","converter"]],template:function(n,i){n&1&&f(0,l3,8,21,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})(),gr=(function(t){return t[t.standby=0]="standby",t[t.excess=1]="excess",t[t.ControlNotAllowed=2]="ControlNotAllowed",t[t.temperatureReached=3]="temperatureReached",t[t.noControlSignal=4]="noControlSignal",t[t.error=5]="error",t})(gr||{}),zr=(function(t){return t[t.heating=0]="heating",t[t.temperatureReached=1]="temperatureReached",t[t.noHeating=2]="noHeating",t})(zr||{});var ls=(function(t){return t[t.UNDEFINED=-1]="UNDEFINED",t[t.INACTIVE=0]="INACTIVE",t[t.ACTIVE=1]="ACTIVE",t[t.ACTIVE_FORCED=2]="ACTIVE_FORCED",t[t.ACTIVE_FORCED_LIMIT=3]="ACTIVE_FORCED_LIMIT",t[t.DONE=4]="DONE",t[t.UNREACHABLE=5]="UNREACHABLE",t[t.CALIBRATION=6]="CALIBRATION",t})(ls||{}),cs=(function(t){return t[t.LEVEL_0=0]="LEVEL_0",t[t.LEVEL_1=1]="LEVEL_1",t[t.LEVEL_2=2]="LEVEL_2",t[t.LEVEL_3=3]="LEVEL_3",t})(cs||{}),Sa=(function(t){return t[t.KILO_WATT_HOURS=1]="KILO_WATT_HOURS",t[t.HOUR=2]="HOUR",t})(Sa||{});function Ql(t,o){return o<100&&t!==ls.DONE?ls.INACTIVE:t}function Zl(t){return Be.CONVERT_HEATING_ELEMENT_RUNSTATE(t)}var m3=()=>({color:"success",name:"play-outline"}),p3=(t,o)=>({name:t,value:"MANUAL_ON",icon:o}),d3=()=>({color:"primary",name:"sunny"}),u3=(t,o)=>({name:t,value:"AUTOMATIC",icon:o}),f3=()=>({color:"danger",name:"power"}),_3=(t,o)=>({name:t,value:"MANUAL_OFF",icon:o}),og=(t,o,e)=>[t,o,e],h3=()=>({value:"LEVEL_1",name:"Level 1"}),C3=()=>({value:"LEVEL_2",name:"Level 2"}),g3=()=>({value:"LEVEL_3",name:"Level 3"}),E3=t=>({type:"SELECT",options:t}),v3=t=>({tickMin:1,tickMax:10,unit:"H",pinFormatter:t,snaps:!0}),rg=t=>({type:"RANGE",properties:t}),y3=(t,o)=>({tickMin:1,tickMax:t,unit:"kWh ",pinFormatter:o,snaps:!0});function T3(t,o){if(t&1&&(d(0,"oe-modal-line",3),g(1,"translate")),t&2){let e=p(2);c("name",E(1,2,"EDGE.INDEX.WIDGETS.HEATINGELEMENT.ACTIVE_LEVEL"))("value","Level "+e.level)}}function I3(t,o){if(t&1&&(d(0,"oe-modal-line",6),g(1,"translate"),d(2,"oe-modal-line",6),g(3,"translate")),t&2){let e=p(2);c("name",E(1,6,"EDGE.INDEX.WIDGETS.HEATINGELEMENT.HEATING_POWER"))("channelAddress",e.consumptionMeter.id+"/ActivePower")("converter",e.Utils.CONVERT_WATT_TO_KILOWATT),r(2),c("name",E(3,8,"EDGE.INDEX.WIDGETS.HEATINGELEMENT.ENERGY_SINCE_BEGINNING"))("channelAddress",e.component.id+"/SessionEnergy")("converter",e.Utils.CONVERT_TO_KILO_WATTHOURS)}}function x3(t,o){if(t&1){let e=W();d(0,"oe-modal-horizontal-line"),s(1,"table",7)(2,"tr")(3,"td",8),h(4," EDGE.INDEX.WIDGETS.HEATINGELEMENT.GUARANTEE_MINIMUM_HEATING "),l(),s(5,"td",9)(6,"ion-toggle",10),O("ionChange",function(i){P(e);let a=p(2);return L(a.switchWorkMode(i,"TIME"))}),l()()()()}if(t&2){let e=p(2);r(6),c("checked",e.formGroup.controls.workMode.value===e.WorkMode.TIME)}}function S3(t,o){if(t&1&&d(0,"oe-modal-horizontal-line")(1,"oe-modal-line",11),t&2){let e=p(2);r(),c("control",be(9,E3,_i(5,og,H(2,h3),H(3,C3),H(4,g3))))("formGroup",e.formGroup)}}function A3(t,o){t&1&&d(0,"ion-datetime",18,0)}function w3(t,o){if(t&1&&(s(0,"ion-item",15)(1,"ion-label"),h(2),l(),s(3,"ion-popover",17),G(4,A3,2,0,"ng-template"),l()()),t&2){let e=p(3);r(2),R(" ",e.formGroup.controls.endTime.value," ")}}function b3(t,o){if(t&1&&(d(0,"oe-modal-horizontal-line"),s(1,"table",12)(2,"tr")(3,"td",13)(4,"ion-text",14),h(5," EDGE.INDEX.WIDGETS.GRID_OPTIMIZED_CHARGE.END_TIME "),l(),h(6,": "),l(),s(7,"td"),f(8,w3,5,1,"ion-item",15),l()()(),d(9,"oe-modal-horizontal-line")(10,"oe-modal-line",3),g(11,"translate"),d(12,"oe-modal-line",16)),t&2){let e=p(2);r(8),_(e.formGroup?8:-1),r(2),c("name",E(11,5,"EDGE.INDEX.WIDGETS.HEATINGELEMENT.MINIMUM_RUN_TIME"))("value",e.formGroup.controls.minTime.value+" h"),r(2),c("control",be(9,rg,be(7,v3,e.pinFormatterTime)))("formGroup",e.formGroup)}}function D3(t,o){if(t&1){let e=W();d(0,"oe-modal-horizontal-line"),s(1,"table",7)(2,"tr")(3,"td",8),h(4," EDGE.INDEX.WIDGETS.HEATINGELEMENT.GUARANTEE_HEATING "),l(),s(5,"td",9)(6,"ion-toggle",10),O("ionChange",function(i){P(e);let a=p(2);return L(a.switchWorkMode(i,"ENERGY"))}),l()()()()}if(t&2){let e=p(2);r(6),c("checked",e.formGroup.controls.workMode.value===e.WorkMode.ENERGY)}}function R3(t,o){t&1&&d(0,"ion-datetime",21,0)}function O3(t,o){if(t&1&&(s(0,"ion-item",15)(1,"ion-label"),h(2),l(),s(3,"ion-popover",17),G(4,R3,2,0,"ng-template"),l()()),t&2){let e=p(3);r(2),R(" ",e.formGroup.controls.endTimeWithMeter.value," ")}}function N3(t,o){t&1&&(s(0,"div",20)(1,"ion-text",22),h(2," EDGE.INDEX.WIDGETS.HEATINGELEMENT.MESSAGE_UNREACHABLE "),l()())}function M3(t,o){if(t&1&&(d(0,"oe-modal-horizontal-line")(1,"oe-modal-line",3),g(2,"translate"),d(3,"oe-modal-line",19)(4,"oe-modal-horizontal-line"),s(5,"table",12)(6,"tr")(7,"td",13)(8,"ion-text",14),h(9," EDGE.INDEX.WIDGETS.HEATINGELEMENT.ENDTIME "),l(),h(10,": "),l(),s(11,"td"),f(12,O3,5,1,"ion-item",15),l()()(),f(13,N3,3,0,"div",20)),t&2){let e=p(2);r(),c("name",E(2,6,"EDGE.INDEX.WIDGETS.HEATINGELEMENT.MINIMAL_ENERGY_LIMIT"))("value",e.formGroup.controls.minEnergyLimitInKwh.value+" kWh"),r(2),c("control",be(11,rg,at(8,y3,e.maxPower,e.pinFormatterEnergy)))("formGroup",e.formGroup),r(9),_(e.formGroup?12:-1),r(),_(e.isUnreachable?13:-1)}}function F3(t,o){if(t&1&&(s(0,"oe-modal",1),d(1,"oe-modal-line",2),g(2,"translate"),f(3,T3,2,4,"oe-modal-line",3),f(4,I3,4,10),d(5,"oe-modal-horizontal-line")(6,"oe-modal-line",4),g(7,"translate"),d(8,"oe-modal-buttons",5),g(9,"translate"),g(10,"translate"),g(11,"translate"),f(12,x3,7,1),f(13,S3,2,11),f(14,b3,13,11),f(15,D3,7,1),f(16,M3,14,13),l()),t&2){let e=p();c("title",e.component.alias)("component",e.component)("formGroup",e.formGroup),r(),c("name",E(2,17,"GENERAL.STATE"))("value",e.runState)("converter",e.CONVERT_HEATING_ELEMENT_RUNSTATE),r(2),_(e.level!==e.Level.LEVEL_0?3:-1),r(),_(e.consumptionMeter?4:-1),r(2),c("name",E(7,19,"GENERAL.MODE")),r(2),c("formGroup",e.formGroup)("component",e.component)("buttons",_i(39,og,at(28,p3,E(9,21,"GENERAL.ON"),H(27,m3)),at(32,u3,E(10,23,"GENERAL.AUTOMATIC"),H(31,d3)),at(36,_3,E(11,25,"GENERAL.OFF"),H(35,f3)))),r(4),_(e.formGroup.controls.mode.value===e.Mode.AUTOMATIC?12:-1),r(),_(e.formGroup.controls.mode.value===e.Mode.MANUAL_ON||e.formGroup.controls.mode.value===e.Mode.AUTOMATIC&&e.formGroup.controls.workMode.value===e.WorkMode.TIME?13:-1),r(),_(e.formGroup.controls.workMode.value===e.WorkMode.TIME&&e.formGroup.controls.mode.value===e.Mode.AUTOMATIC?14:-1),r(),_(e.formGroup.controls.mode.value===e.Mode.AUTOMATIC&&e.consumptionMeter&&e.consumptionMeter.isEnabled?15:-1),r(),_(e.formGroup.controls.mode.value===e.Mode.AUTOMATIC&&e.formGroup.controls.workMode.value===e.WorkMode.ENERGY&&e.consumptionMeter&&e.consumptionMeter.isEnabled?16:-1)}}var ag=(()=>{class t extends Wt{constructor(){super(...arguments),this.CONVERT_HEATING_ELEMENT_RUNSTATE=Zl(this.translate),this.consumptionMeter=null,this.outputChannelArray=[],this.maxPower=15,this.isUnreachable=!1,this.Mode=Gs,this.WorkMode=ca,this.Level=cs,this.pinFormatterEnergy=e=>this.pinFormatter(e,Sa.KILO_WATT_HOURS),this.pinFormatterTime=e=>this.pinFormatter(e,Sa.HOUR)}static{this.PROPERTY_MODE="_PropertyMode"}static{this.PREDICTED_PV_PRODUCTION_HOUR=5}static{this.POWER_OVERSHOOT_FACTOR=1.1}switchWorkMode(e,n){e.detail.checked?this.formGroup.controls.workMode.setValue(n):this.formGroup.controls.workMode.setValue("NONE"),this.formGroup.controls.workMode.markAsDirty()}onIsInitialized(){this.subscription.add(this.formGroup.get("minEnergyLimitInKwh").valueChanges.subscribe(e=>{this.formGroup.controls.minEnergylimit.setValue(e*1e3),this.formGroup.controls.minEnergylimit.markAsDirty()}))}getRequiredPower(e){let n=new Date,i=this.formGroup?.controls.endTimeWithMeter?.value;if(i){let[a,m]=i.split(":").map(Number),u=new Date(n.getFullYear(),n.getMonth(),n.getDate(),a,m),C=this.formGroup?.controls.minEnergylimit?.value,v=C-e,T=new Date(n);return u.getTime()<n.getTime()&&(u.setDate(u.getDate()+1),T.setDate(n.getDate()+1),T.setHours(0,0,0,0),v=C),v/((u.getTime()-T.getTime())/1e3/3600)}return null}pinFormatter(e,n){switch(n){case Sa.KILO_WATT_HOURS:return Fo.FORMAT_KILO_WATT_HOURS(e);case Sa.HOUR:return Fo.FORMAT_HOUR(e);default:return e.toString()}}getChannelAddresses(){Lt.assertIsDefined(this.component,"Heating element can't be found"),this.outputChannelArray.push(y.fromString(this.component.properties.outputChannelPhaseL1),y.fromString(this.component.properties.outputChannelPhaseL2),y.fromString(this.component.properties.outputChannelPhaseL3));let e=[new y(this.component.id,"ForceStartAtSecondsOfDay"),...this.outputChannelArray,new y(this.component.id,"Level"),new y(this.component.id,"Status"),new y(this.component.id,t.PROPERTY_MODE),new y(this.component.id,"_PropertyWorkMode")];return"meter.id"in this.component.properties&&e.push(new y(this.component.properties["meter.id"],"ActivePower"),new y(this.component.id,"Phase1AvgPower"),new y(this.component.id,"Phase2AvgPower"),new y(this.component.id,"Phase3AvgPower"),new y(this.component.id,"SessionEnergy")),e}onCurrentData(e){if(Lt.assertIsDefined(this.component,"Heating element can't be found"),this.mode=e.allComponents[this.component.id+"/"+t.PROPERTY_MODE],this.consumptionMeter=this.config.getComponent(this.component.properties["meter.id"]),this.runState=e.allComponents[this.component.id+"/Status"],this.level=e.allComponents[this.component.id+"/Level"],!this.consumptionMeter)return;let n=e.allComponents[this.consumptionMeter.id+"/ActivePower"],i=e.allComponents[this.component.id+"/Phase1AvgPower"],a=e.allComponents[this.component.id+"/Phase2AvgPower"],m=e.allComponents[this.component.id+"/Phase3AvgPower"],u=M.addSafely(i,a,m);u!==null&&u/1e3*t.PREDICTED_PV_PRODUCTION_HOUR>this.maxPower&&(this.maxPower=Math.round(u/1e3)*t.PREDICTED_PV_PRODUCTION_HOUR);let C=e.allComponents[this.component.id+"/SessionEnergy"];this.requiredPower=this.getRequiredPower(C),this.isUnreachable=this.requiredPower!==null?this.requiredPower>u*t.POWER_OVERSHOOT_FACTOR:!1,this.runState=Ql(this.runState,n)}getFormGroup(){let e=this.formBuilder.group({minTime:new K(this.component.properties.minTime),minKwh:new K(this.component.properties.minKwh),endTime:new K(this.component.properties.endTime),workMode:new K(this.component.properties.workMode),endTimeWithMeter:new K(this.component.properties.endTimeWithMeter),minEnergylimit:new K(this.component.properties.minEnergylimit),minEnergyLimitInKwh:new K(Math.round(this.component.properties.minEnergylimit/1e3)),defaultLevel:new K(this.component.properties.defaultLevel),mode:new K(this.mode)});return this.component.properties["meter.id"]!==null&&e.addControl("meterId",new K(this.component.properties["meter.id"])),e}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["heatingelement-modal"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["popoverDatetime",""],["helpKey","CONTROLLER_IO_HEATING_ELEMENT",3,"title","component","formGroup"],[3,"name","value","converter"],[3,"name","value"],[3,"name"],["controlName","mode",3,"formGroup","component","buttons"],[3,"name","channelAddress","converter"],[1,"full_width"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"],[3,"ionChange","checked"],["name","Level","controlName","defaultLevel",3,"control","formGroup"],[2,"width","100%"],[1,"text-align:","left"],["translate",""],["button","true","id","open-date-input",2,"text-align","center"],["controlName","minTime",3,"control","formGroup"],["trigger","open-date-input","show-backdrop","false","slot","end"],["presentation","time","displayFormat","HH:mm","formControlName","endTime"],["controlName","minEnergyLimitInKwh",3,"control","formGroup"],[2,"text-align","center","margin-top","5px"],["presentation","time","displayFormat","HH:mm","formControlName","endTimeWithMeter"],["color","danger","translate",""]],template:function(n,i){n&1&&f(0,F3,17,43,"oe-modal",1),n&2&&_(i.isInitialized?0:-1)},dependencies:[Nn,Vt,sn,Sn,Ie,Ke,zi,J,ne,He,wi,Yi,ft,$e,ot,en,Ne,V],encapsulation:2})}}return t})();var G3=()=>({color:"normal",name:"flame"});function P3(t,o){if(t&1&&(d(0,"oe-flat-widget-line",1),g(1,"translate")),t&2){let e=p(2);c("name",E(1,2,"EDGE.INDEX.WIDGETS.HEATINGELEMENT.ACTIVE_LEVEL"))("value","Level\xA0"+e.level)}}function L3(t,o){if(t&1&&(d(0,"oe-flat-widget-line",3),g(1,"translate")),t&2){let e=p(2);c("name",E(1,3,"EDGE.INDEX.WIDGETS.HEATINGELEMENT.HEATING_POWER"))("channelAddress",e.consumptionMeter.id+"/ActivePower")("converter",e.Utils.CONVERT_WATT_TO_KILOWATT)}}function k3(t,o){t&1&&(d(0,"oe-flat-widget-horizontal-line"),s(1,"ion-text",4),h(2," EDGE.INDEX.WIDGETS.HEATINGELEMENT.CALIBRATION_DESCRIPTION "),l())}function V3(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),g(3,"translate"),d(4,"oe-flat-widget-line",2),g(5,"translate"),g(6,"translate"),Y(7),f(8,P3,2,4,"oe-flat-widget-line",1),f(9,L3,2,5,"oe-flat-widget-line",3),z(),f(10,k3,3,0),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("title",e.component.alias)("icon",H(19,G3)),r(),c("name",E(2,11,"GENERAL.MODE"))("value",E(3,13,e.mode)),r(3),c("name",E(5,15,"GENERAL.STATE"))("value",E(6,17,e.runState))("converter",e.CONVERT_HEATING_ELEMENT_RUNSTATE),r(4),_(e.consumptionMeter===null&&e.level!==e.Level.LEVEL_0?8:-1),r(),_(e.consumptionMeter?9:-1),r(),_(e.activePower&&e.activePower!==0&&e.runState===e.State.CALIBRATION?10:-1)}}var sg=(()=>{class t extends ce{constructor(){super(...arguments),this.CONVERT_HEATING_ELEMENT_RUNSTATE=Zl(this.translate),this.WorkMode=ca,this.Level=cs,this.State=ls,this.CONVERT_SECONDS_TO_DATE_FORMAT=M.CONVERT_SECONDS_TO_DATE_FORMAT,this.outputChannelArray=[],this.consumptionMeter=null,this.modalComponent=null}static{this.PROPERTY_MODE="_PropertyMode"}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:ag,componentProps:{component:this.component}}}getChannelAddresses(){return this.outputChannelArray.push(y.fromString(this.component.properties.outputChannelPhaseL1),y.fromString(this.component.properties.outputChannelPhaseL2),y.fromString(this.component.properties.outputChannelPhaseL3)),[new y(this.component.id,"ForceStartAtSecondsOfDay"),...this.outputChannelArray,new y(this.component.id,"Level"),new y(this.component.id,"Status"),new y(this.component.id,t.PROPERTY_MODE),new y(this.component.id,"_PropertyWorkMode")]}onCurrentData(e){switch(this.workMode=e.allComponents[this.component.id+"/_PropertyWorkMode"],this.consumptionMeter=this.config.getComponent(this.component.properties["meter.id"])??null,e.allComponents[this.component.id+"/"+t.PROPERTY_MODE]){case"MANUAL_ON":{this.mode="GENERAL.ON";break}case"MANUAL_OFF":{this.mode="GENERAL.OFF";break}case"AUTOMATIC":{this.mode="GENERAL.AUTOMATIC";break}}if(this.level=e.allComponents[this.component.id+"/Level"],this.edge.isVersionAtLeast("2022.8")&&(this.runState=e.allComponents[this.component.id+"/Status"],this.consumptionMeter)){let n=e.allComponents[this.consumptionMeter.id+"/ActivePower"];this.runState=Ql(this.runState,n)}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Io_HeatingElement"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"modalComponent","title","icon"],[3,"name","value"],[3,"name","value","converter"],[3,"name","channelAddress","converter"],["translate",""]],template:function(n,i){n&1&&f(0,V3,11,20,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,Ri,we,He,Ne,V],encapsulation:2})}}return t})();var lg=(()=>{class t extends eo{constructor(){super(...arguments),this.component=null,this.edge=null,this.isOnChannel=null}static generateView(e,n,i){Lt.assertIsDefined(n),Lt.assertIsDefined(i);let a=[{type:"info-line",name:e.instant("GENERAL.MODE")},{type:"buttons-from-form-control-line",name:e.instant("GENERAL.MODE"),controlName:"isOn",buttons:[{name:e.instant("GENERAL.ON"),value:1,icon:{color:"success",name:"play-outline",size:"medium"}},{name:e.instant("GENERAL.OFF"),value:0,icon:{color:"danger",name:"power-outline",size:"medium"}}]}];return{title:bi.METER_ALIAS_OR_ID(n),lines:a,component:n,edge:i}}getChannelAddresses(){return ae(this,null,function*(){let e=this.component?.id??null;return e?(this.isOnChannel=new y(e,"_PropertyIsOn"),Promise.resolve([this.isOnChannel])):Promise.resolve([])})}onCurrentData(e){if(this.form.dirty||!this.isOnChannel||e.allComponents[this.isOnChannel.toString()]==null)return;let n=e.allComponents[this.isOnChannel.toString()];this.form.controls.isOn.setValue(n)}generateView(e,n){return t.generateView(this.translate,this.component,this.edge)}getFormGroup(){return new hi({isOn:new K(null)})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],inputs:{component:"component",edge:"edge"},standalone:!1,features:[vn([{provide:kt,useClass:ci}]),S],decls:1,vars:2,consts:[[2,"display","block","height","inherit",3,"form","fields"]],template:function(n,i){n&1&&d(0,"formly-form",0),n&2&&c("form",i.form)("fields",i.fields)},dependencies:[si],encapsulation:2})}}return t})();var B3=()=>({name:"power-outline",size:"large",color:"normal"});function W3(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("title",e.component.alias)("icon",H(7,B3)),r(),c("name",E(2,5,"GENERAL.CURRENT_STATUS"))("value",e.state)}}var cg=(()=>{class t extends ce{constructor(){super(...arguments),this.state="-",this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:lg,componentProps:{component:this.component,edge:this.edge}}}getChannelAddresses(){return this.outputChannel=this.component.properties.outputChannelAddress,[y.fromString(this.outputChannel)]}onCurrentData(e){let n=e.allComponents[this.outputChannel];n!=null&&(n==1?this.state=this.translate.instant("GENERAL.ON"):n==0&&(this.state=this.translate.instant("GENERAL.OFF")))}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Io_FixDigitalOutput"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"modalComponent","title","icon"],[3,"name","value"]],template:function(n,i){n&1&&f(0,W3,3,8,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();var mg=(()=>{class t{constructor(e,n){this.service=e,this.translate=n,this.edge=null,this.timeSinceOffline=null,this.isAtLeastInstaller=!1,this.environment=pt,this.Producttype=Wd}static formatMilliSecondsToValidRange(e,n){let m={singular:"GENERAL.TIME.MINUTE",plural:"GENERAL.TIME.MINUTES"},u=Ir.getMinutesFromMilliSeconds(e)??0;return e>1728e5?(u=Ir.getDaysFromMilliSeconds(e)??0,m={singular:"GENERAL.TIME.DAY",plural:"GENERAL.TIME.DAYS"}):e>72e5&&(u=Ir.getHoursFromMilliSeconds(e)??0,m={singular:"GENERAL.TIME.HOUR",plural:"GENERAL.TIME.HOURS"}),Ir.getDurationText(u,n,m.singular,m.plural)}static getTimeSinceEdgeIsOffline(e,n){let i=dn.stringToDate(e);if(!i)return null;let a=i.getTime(),m=M.subtractSafely(new Date().getTime(),a);return m===null?null:t.formatMilliSecondsToValidRange(m,n)}ngOnInit(){this.service.getCurrentEdge().then(e=>{this.edge=e,this.isAtLeastInstaller=this.edge.roleIsAtLeast(Rt.INSTALLER),this.timeSinceOffline=t.getTimeSinceEdgeIsOffline(e.lastmessage?.toString(),this.translate)})}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["oe-offline"]],standalone:!1,decls:5,vars:1,consts:[["lines","full","color","light"],["slot","start","size","large","color","danger","name","cloud-offline-outline"]],template:function(n,i){n&1&&(s(0,"ion-card")(1,"ion-item",0),d(2,"ion-icon",1),s(3,"ion-label"),h(4),l()()()),n&2&&(r(4),R("",i.environment.edgeShortName," ist offline"))},dependencies:[Ht,ie,J,ne],styles:["ion-item[_ngcontent-%COMP%] > ion-label[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{font-weight:bolder}"]})}}return t})();var j3=["consumptionsection",""];function Y3(t,o){if(t&1&&(gt(),d(0,"path",2)),t&2){let e=p();ze("d",e.valuePath)}}function $3(t,o){if(t&1&&(gt(),s(0,"g")(1,"defs")(2,"linearGradient"),d(3,"stop",3)(4,"stop",4),l()(),d(5,"polygon")(6,"polygon",5),l()),t&2){let e=p();r(2),ze("id",e.sectionId)("x1",e.energyFlow.gradient.x1)("y1",e.energyFlow.gradient.y1)("x2",e.energyFlow.gradient.x2)("y2",e.energyFlow.gradient.y2),r(3),ze("points",e.energyFlow.points)("fill",e.fillRef),r(),c("@Consumption",e.stateName),ze("points",e.energyFlow.animationPoints)}}function X3(t,o){if(t&1&&(gt(),Y(0),h(1),z()),t&2){let e=p(2);r(),N(e.valueText)}}function q3(t,o){}function K3(t,o){if(t&1&&G(0,q3,0,0,"ng-template",7),t&2){p();let e=it(5);c("ngTemplateOutlet",e)}}function Q3(t,o){t&1&&h(0,"-")}function Z3(t,o){if(t&1&&(gt(),s(0,"g")(1,"text",6),f(2,X3,2,1,":svg:ng-container")(3,K3,1,1,":svg:ng-template",7),G(4,Q3,1,0,"ng-template",null,0,yt),l(),d(6,"use",8),l()),t&2){let e=p();ze("transform",Jn("translate(",e.squarePosition.x,",",e.squarePosition.y,")")),r(),ze("x",e.square.valueText.x)("y",e.square.valueText.y)("text-anchor",e.square.valueText.anchor),r(),_(e.valueText?2:3),r(4),ze("x",e.square.image.x)("y",e.square.image.y)("width",e.square.image.length)("height",e.square.image.length)("href",e.square.image.image+"#root")}}var Jl=(()=>{class t extends wo{constructor(e,n,i){super("GENERAL.CONSUMPTION","right","#FDC507",n,i,"Consumption"),this.showAnimation=!1,this.animationTrigger=!1,this.startAnimation=null,this.unitpipe=e}get stateName(){return this.showAnimation?"show":"hide"}ngOnInit(){this.adjustFillRefbyBrowser()}toggleAnimation(){this.startAnimation=setInterval(()=>{this.showAnimation=!this.showAnimation},this.animationSpeed),this.animationTrigger=!0}ngOnDestroy(){clearInterval(this.startAnimation)}getStartAngle(){return 46}getEndAngle(){return 134}getRatioType(){return"Only Positive [0,1]"}_updateCurrentData(e){let n;e.consumption.activePower>49?(this.animationTrigger||this.toggleAnimation(),n=M.divideSafely(e.consumption.activePower,e.system.totalPower)):n=0,super.updateSectionData(e.consumption.activePower,e.consumption.powerRatio,n)}getSquarePosition(e,n){let i=n-5-e.length,a=e.length/2*-1;return new So(i,a)}getImagePath(){return"icon/consumption.svg"}getValueText(e){return e==null||Number.isNaN(e)?"":this.unitpipe.transform(e,"kW")}initEnergyFlow(e){return new Ao(e,{x1:"0%",y1:"50%",x2:"100%",y2:"50%"})}setElementHeight(){this.square.valueText.y=this.square.valueText.y-this.square.valueText.y*.3,this.square.image.y=this.square.image.y-this.square.image.y*.3}getSvgEnergyFlow(e,n){let i=Math.abs(e),a=n,m={topLeft:{x:i,y:i*-1},middleLeft:{x:0,y:0},bottomLeft:{x:i,y:i},topRight:{x:a,y:i*-1},bottomRight:{x:a,y:i},middleRight:{x:a-i,y:0}};return e>0&&(m.topRight.x=m.topRight.x-i,m.middleRight.x=m.middleRight.x+i,m.bottomRight.x=m.bottomRight.x-i,m.middleLeft.x=m.topLeft.x+i),m}getSvgAnimationEnergyFlow(e,n){let i=Math.abs(e),a=n,m=a*-1-i,u={topLeft:{x:i,y:i*-1},middleLeft:{x:0,y:0},bottomLeft:{x:i,y:i},topRight:{x:a,y:i*-1},bottomRight:{x:a,y:i},middleRight:{x:a-i,y:0}};return e>0?(u.topRight.x=u.topLeft.x+m*.2,u.middleRight.x=u.middleLeft.x+m*.2+2*i,u.bottomRight.x=u.bottomLeft.x+m*.2,u.middleLeft.x=u.middleRight.x-m*.2):u=null,u}static{this.\u0275fac=function(n){return new(n||t)(x(Ut),x(te),x(j))}}static{this.\u0275cmp=I({type:t,selectors:[["","consumptionsection",""]],standalone:!1,features:[S],attrs:j3,decls:4,vars:4,consts:[["no_text",""],["fill","var(--ion-color-light)","stroke","var(--ion-color-medium-soft)"],["fill","var(--ion-color-warning)","stroke","var(--ion-color-warning)"],["offset","0%","stop-color","var(--ion-item-background)"],["offset","100%","stop-color","var(--ion-color-warning)"],[2,"fill","var(--ion-item-background)"],["font-family","sans-serif","font-size","square.valueText.fontsize","fill","var(--ion-text-color)"],[3,"ngTemplateOutlet"],[2,"color","var(--ion-color-warning)"]],template:function(n,i){n&1&&(gt(),d(0,"path",1),f(1,Y3,1,1,":svg:path",2),f(2,$3,7,9,":svg:g"),f(3,Z3,7,12,":svg:g")),n&2&&(ze("d",i.outlinePath),r(),_(i.isEnabled?1:-1),r(),_(i.isEnabled&&i.energyFlow?2:-1),r(),_(i.isEnabled&&i.squarePosition&&i.square?3:-1))},encapsulation:2,data:{animation:[go("Consumption",[ti("show",Rn({opacity:.1,transform:"translateX(0%)"})),ti("hide",Rn({opacity:.6,transform:"translateX(17%)"})),ni("show => hide",ei("650ms ease-out")),ni("hide => show",ei("0ms ease-in"))])]}})}}return t})();var eF=["productionsection",""];function tF(t,o){if(t&1&&(gt(),d(0,"path",2)),t&2){let e=p();ze("d",e.valuePath)}}function nF(t,o){if(t&1&&(gt(),s(0,"g")(1,"defs")(2,"linearGradient"),d(3,"stop",3)(4,"stop",4),l()(),d(5,"polygon")(6,"polygon",5),l()),t&2){let e=p();r(2),ze("id",e.sectionId)("x1",e.energyFlow.gradient.x1)("y1",e.energyFlow.gradient.y1)("x2",e.energyFlow.gradient.x2)("y2",e.energyFlow.gradient.y2),r(3),ze("points",e.energyFlow.points)("fill",e.fillRef),r(),c("@Production",e.stateName),ze("points",e.energyFlow.animationPoints)}}function iF(t,o){if(t&1&&(gt(),Y(0),h(1),z()),t&2){let e=p(2);r(),N(e.valueText)}}function oF(t,o){}function rF(t,o){if(t&1&&G(0,oF,0,0,"ng-template",7),t&2){p();let e=it(5);c("ngTemplateOutlet",e)}}function aF(t,o){t&1&&h(0,"-")}function sF(t,o){if(t&1&&(gt(),s(0,"g")(1,"text",6),f(2,iF,2,1,":svg:ng-container")(3,rF,1,1,":svg:ng-template",7),G(4,aF,1,0,"ng-template",null,0,yt),l(),d(6,"use",8),l()),t&2){let e=p();ze("transform",Jn("translate(",e.squarePosition.x,",",e.squarePosition.y,")")),r(),ze("x",e.square.valueText.x)("y",e.square.valueText.y)("text-anchor",e.square.valueText.anchor),r(),_(e.valueText?2:3),r(4),ze("x",e.square.image.x)("y",e.square.image.y)("width",e.square.image.length)("height",e.square.image.length)("href",e.square.image.image+"#root")}}var ec=(()=>{class t extends wo{constructor(e,n,i){super("GENERAL.PRODUCTION","up","var(--ion-color-primary)",e,n,"Common_Production"),this.startAnimation=null,this.showAnimation=!1,this.animationTrigger=!1,this.unitpipe=i}get stateName(){return this.showAnimation?"show":"hide"}ngOnInit(){this.adjustFillRefbyBrowser()}ngOnDestroy(){clearInterval(this.startAnimation)}toggleAnimation(){this.startAnimation=setInterval(()=>{this.showAnimation=!this.showAnimation},this.animationSpeed),this.animationTrigger=!0}getStartAngle(){return 316}getEndAngle(){return 404}getRatioType(){return"Only Positive [0,1]"}_updateCurrentData(e){let n;e.production.activePower>49?(this.animationTrigger||this.toggleAnimation(),n=M.divideSafely(e.production.activePower,e.system.totalPower)):n=0,super.updateSectionData(e.production.activePower,e.production.powerRatio,n)}getSquarePosition(e,n){let i=e.length/2*-1,a=(n-10)*-1;return new So(i,a)}getImagePath(){return"icon/production.svg"}getValueText(e){return e==null||Number.isNaN(e)?"":this.unitpipe.transform(e,"kW")}initEnergyFlow(e){return new Ao(e,{x1:"50%",y1:"100%",x2:"50%",y2:"0%"})}setElementHeight(){this.square.valueText.y=this.square.valueText.y-this.square.valueText.y*.4,this.square.image.y=this.square.image.y-this.square.image.y*.45}getSvgEnergyFlow(e,n){let i=Math.abs(e),a=n,m={topLeft:{x:i*-1,y:a*-1},bottomLeft:{x:i*-1,y:i*-1},topRight:{x:i,y:a*-1},bottomRight:{x:i,y:i*-1},middleBottom:{x:0,y:0},middleTop:{x:0,y:a*-1+i}};return e<0&&(m.topLeft.y=m.topLeft.y+i,m.middleTop.y=m.middleTop.y-i,m.topRight.y=m.topRight.y+i),m}getSvgAnimationEnergyFlow(e,n){let i=Math.abs(e),a=n,m=a*-1+i,u={topLeft:{x:i*-1,y:a*-1},bottomLeft:{x:i*-1,y:i*-1},topRight:{x:i,y:a*-1},bottomRight:{x:i,y:i*-1},middleBottom:{x:0,y:0},middleTop:{x:0,y:a*-1+i}};return e>0?(u.bottomRight.y=u.topRight.y+m*.2,u.bottomLeft.y=u.topLeft.y+m*.2,u.middleBottom.y=u.middleTop.y+m*.2):u=null,u}static{this.\u0275fac=function(n){return new(n||t)(x(te),x(j),x(Ut))}}static{this.\u0275cmp=I({type:t,selectors:[["","productionsection",""]],standalone:!1,features:[S],attrs:eF,decls:4,vars:4,consts:[["no_text",""],["fill","var(--ion-color-light)","stroke","var(--ion-color-medium-soft)"],["fill","var(--ion-color-production)","stroke","var(--ion-color-production)"],["offset","0%","stop-color","var(--ion-item-background)"],["offset","100%","stop-color","var(--ion-color-production)"],[2,"fill","var(--ion-item-background)"],["font-family","sans-serif","font-size","square.valueText.fontsize","fill","var(--ion-text-color)"],[3,"ngTemplateOutlet"],[2,"color","var(--ion-color-production)"]],template:function(n,i){n&1&&(gt(),d(0,"path",1),f(1,tF,1,1,":svg:path",2),f(2,nF,7,9,":svg:g"),f(3,sF,7,12,":svg:g")),n&2&&(ze("d",i.outlinePath),r(),_(i.isEnabled?1:-1),r(),_(i.isEnabled&&i.energyFlow?2:-1),r(),_(i.isEnabled&&i.squarePosition&&i.square?3:-1))},encapsulation:2,data:{animation:[go("Production",[ti("show",Rn({opacity:.4,transform:"translateY(0)"})),ti("hide",Rn({opacity:.1,transform:"translateY(17%)"})),ni("show => hide",ei("650ms ease-out")),ni("hide => show",ei("0ms ease-in"))])]}})}}return t})();var cF=["storagesection",""];function mF(t,o){if(t&1&&(gt(),d(0,"path",2)),t&2){let e=p();ze("d",e.valuePath)}}function pF(t,o){if(t&1&&(gt(),Y(0),d(1,"polygon",5),z()),t&2){let e=p(2);r(),c("@Charge",e.stateNameCharge),ze("points",e.energyFlow.animationPoints)}}function dF(t,o){if(t&1&&(gt(),Y(0),d(1,"polygon",5),z()),t&2){let e=p(2);r(),c("@Discharge",e.stateNameDischarge),ze("points",e.energyFlow.animationPoints)}}function uF(t,o){if(t&1&&(gt(),s(0,"g")(1,"defs")(2,"linearGradient"),d(3,"stop",3)(4,"stop",4),l()(),d(5,"polygon"),f(6,pF,2,2,":svg:ng-container"),f(7,dF,2,2,":svg:ng-container"),l()),t&2){let e=p();r(2),ze("id",e.sectionId)("x1",e.energyFlow.gradient.x1)("y1",e.energyFlow.gradient.y1)("x2",e.energyFlow.gradient.x2)("y2",e.energyFlow.gradient.y2),r(3),ze("points",e.energyFlow.points)("fill",e.fillRef),r(),_(e.chargeAnimationTrigger?6:-1),r(),_(e.dischargeAnimationTrigger?7:-1)}}function fF(t,o){if(t&1&&(gt(),Y(0),h(1),z()),t&2){let e=p(2);r(),N(e.valueText)}}function _F(t,o){}function hF(t,o){if(t&1&&G(0,_F,0,0,"ng-template",7),t&2){p();let e=it(5);c("ngTemplateOutlet",e)}}function CF(t,o){t&1&&h(0,"-")}function gF(t,o){if(t&1&&(gt(),s(0,"g")(1,"text",6),f(2,fF,2,1,":svg:ng-container")(3,hF,1,1,":svg:ng-template",7),G(4,CF,1,0,"ng-template",null,0,yt),l(),d(6,"use",8),l()),t&2){let e=p();ze("transform",Jn("translate(",e.squarePosition.x,",",e.squarePosition.y,")")),r(),ze("x",e.square.valueText.x)("y",e.square.valueText.y)("text-anchor",e.square.valueText.anchor),r(),_(e.valueText?2:3),r(4),Qr(e.svgStyle),ze("x",e.square.image.x)("y",e.square.image.y)("width",e.square.image.length)("height",e.square.image.length)("href",e.square.image.image+"#root")}}var tc=(()=>{class t extends wo{constructor(e,n,i){super("EDGE.INDEX.ENERGYMONITOR.STORAGE","down","#009846",e,n,"Storage"),this.service=n,this.chargeAnimationTrigger=!1,this.dischargeAnimationTrigger=!1,this.startAnimation=null,this.showChargeAnimation=!1,this.showDischargeAnimation=!1,this.unitpipe=i}get stateNameCharge(){return this.showChargeAnimation?"show":"hide"}get stateNameDischarge(){return this.showDischargeAnimation?"show":"hide"}ngOnInit(){this.adjustFillRefbyBrowser()}ngOnDestroy(){clearInterval(this.startAnimation)}toggleCharge(){this.startAnimation=setInterval(()=>{this.showChargeAnimation=!this.showChargeAnimation},this.animationSpeed),this.chargeAnimationTrigger=!0,this.dischargeAnimationTrigger=!1}toggleDischarge(){setInterval(()=>{this.showDischargeAnimation=!this.showDischargeAnimation},this.animationSpeed),this.chargeAnimationTrigger=!1,this.dischargeAnimationTrigger=!0}_updateCurrentData(e){this.service.getCurrentEdge().then(n=>ae(this,null,function*(){n.currentData.subscribe(i=>{let a=n.isVersionAtLeast("2024.2.2")?i.channel["_sum/EssMaxDischargePower"]:i.channel["_sum/EssMaxApparentPower"],m=n.isVersionAtLeast("2024.2.2")?i.channel["_sum/EssMinDischargePower"]:i.channel["_sum/EssMaxApparentPower"];if(e.storage.powerRatio=Gd.getEssPowerRatio(a,m,e.storage.effectivePower),e.storage.effectiveChargePower!=null){let u;e.storage.effectiveChargePower>49?(this.chargeAnimationTrigger||this.toggleCharge(),u=M.divideSafely(e.storage.effectiveChargePower,e.system.totalPower)):u=0,this.name=this.translate.instant("EDGE.INDEX.ENERGYMONITOR.STORAGE_CHARGE"),_s(t.prototype,this,"updateSectionData").call(this,e.storage.effectiveChargePower,e.storage.powerRatio,u)}else if(e.storage.effectiveDischargePower!=null){let u;e.storage.effectiveDischargePower>49?(this.dischargeAnimationTrigger||this.toggleDischarge(),u=M.multiplySafely(M.divideSafely(e.storage.effectiveDischargePower,e.system.totalPower),-1)):u=0,this.name=this.translate.instant("EDGE.INDEX.ENERGYMONITOR.STORAGE_DISCHARGE"),_s(t.prototype,this,"updateSectionData").call(this,e.storage.effectiveDischargePower,e.storage.powerRatio,u)}else this.name=this.translate.instant("EDGE.INDEX.ENERGYMONITOR.STORAGE"),_s(t.prototype,this,"updateSectionData").call(this,null,null,null);this.socValue=e.storage.soc,this.square&&(this.square.image.image="assets/img/"+this.getImagePath(),this.svgStyle="storage-"+M.getStorageSocSegment(this.socValue))})}))}getStartAngle(){return 136}getEndAngle(){return 224}getRatioType(){return"Negative and Positive [-1,1]"}getSquarePosition(e,n){let i=e.length/2*-1,a=n-5-e.length;return new So(i,a)}getImagePath(){return"icon/storage.svg"}getValueText(e){return e==null||Number.isNaN(e)?"":this.unitpipe.transform(e,"kW")}initEnergyFlow(e){return new Ao(e,{x1:"50%",y1:"0%",x2:"50%",y2:"100%"})}setElementHeight(){}getSvgEnergyFlow(e,n){let i=Math.abs(e),a=n,m={topLeft:{x:i*-1,y:i},bottomLeft:{x:i*-1,y:a},topRight:{x:i,y:i},bottomRight:{x:i,y:a},middleBottom:{x:0,y:a-i},middleTop:{x:0,y:0}};return e>0&&(m.bottomLeft.y=m.bottomLeft.y-i,m.middleBottom.y=m.middleBottom.y+i,m.bottomRight.y=m.bottomRight.y-i,m.middleTop.y=m.topLeft.y+i),m}getSvgAnimationEnergyFlow(e,n){let i=Math.abs(e),a=n,m=a-i,u={topLeft:{x:i*-1,y:i},bottomLeft:{x:i*-1,y:a},topRight:{x:i,y:i},bottomRight:{x:i,y:a},middleBottom:{x:0,y:a-i},middleTop:{x:0,y:0}};return e<0?(u.middleTop.y=u.middleBottom.y+m*.2,u.topRight.y=u.bottomRight.y+m*.2,u.topLeft.y=u.bottomLeft.y+m*.2):e>0?(u.bottomLeft.y=u.topLeft.y-m*.2,u.middleBottom.y=u.middleTop.y-m*.2+2*i,u.bottomRight.y=u.topRight.y-m*.2,u.middleTop.y=u.middleBottom.y+m*.2):u=null,u}static{this.\u0275fac=function(n){return new(n||t)(x(te),x(j),x(Ut))}}static{this.\u0275cmp=I({type:t,selectors:[["","storagesection",""]],standalone:!1,features:[S],attrs:cF,decls:4,vars:4,consts:[["no_text",""],["fill","var(--ion-color-light)","stroke","var(--ion-color-medium-soft)"],["fill","var(--ion-color-success)","stroke","var(--ion-color-success)"],["offset","0%","stop-color","var(--ion-item-background)"],["offset","100%","stop-color","var(--ion-color-success)"],[2,"fill","var(--ion-item-background)"],["font-family","sans-serif","font-size","square.valueText.fontsize","fill","var(--ion-text-color)"],[3,"ngTemplateOutlet"],[2,"color","var(--ion-color-success)"]],template:function(n,i){n&1&&(gt(),d(0,"path",1),f(1,mF,1,1,":svg:path",2),f(2,uF,8,9,":svg:g"),f(3,gF,7,14,":svg:g")),n&2&&(ze("d",i.outlinePath),r(),_(i.isEnabled?1:-1),r(),_(i.isEnabled&&i.energyFlow?2:-1),r(),_(i.isEnabled&&i.squarePosition&&i.square?3:-1))},encapsulation:2,data:{animation:[go("Discharge",[ti("show",Rn({opacity:.4,transform:"translateY(0)"})),ti("hide",Rn({opacity:.1,transform:"translateY(-17%)"})),ni("show => hide",ei("650ms ease-out")),ni("hide => show",ei("0ms ease-in"))]),go("Charge",[ti("show",Rn({opacity:.1,transform:"translateY(0)"})),ti("hide",Rn({opacity:.4,transform:"translateY(17%)"})),ni("show => hide",ei("650ms ease-out")),ni("hide => show",ei("0ms ease-out"))])]}})}}return t})();var vF=["energymonitorChart"],pg=(()=>{class t{constructor(e){this.service=e,this.spinnerId="energymonitor",this.ngUnsubscribe=new qt}set currentData(e){this.service.stopSpinner(this.spinnerId),this.updateCurrentData(e)}ngOnInit(){this.service.startSpinner(this.spinnerId),setTimeout(()=>this.updateOnWindowResize(),500),dp(window,"resize",null,null).pipe(An(this.ngUnsubscribe),fp(200),_p(100)).subscribe(n=>{this.updateOnWindowResize()})}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}updateCurrentData(e){let n=e.summary;[this.consumptionSection,this.gridSection,this.productionSection,this.storageSection].filter(i=>i!=null).forEach(i=>{i.updateCurrentData(n)})}updateOnWindowResize(){let e=300;this.chartDiv.nativeElement.offsetParent&&(e=this.chartDiv.nativeElement.offsetParent.offsetWidth-30),e>window.innerHeight&&(e=window.innerHeight),this.height=this.width=e,this.translation=`translate(${this.width/2}, ${this.height/2})`;let n=Math.min(this.width,this.height)/2,i=n-n*.1378;[this.consumptionSection,this.gridSection,this.productionSection,this.storageSection].filter(a=>a!=null).forEach(a=>{a.updateOnWindowResize(n,i,this.height,this.width)})}deg2rad(e){return e*(Math.PI/180)}static{this.\u0275fac=function(n){return new(n||t)(x(j))}}static{this.\u0275cmp=I({type:t,selectors:[["energymonitor-chart"]],viewQuery:function(n,i){if(n&1&&(wn(Jl,7),wn(Yt,7),wn(ec,7),wn(tc,7),wn(vF,7)),n&2){let a;bn(a=Dn())&&(i.consumptionSection=a.first),bn(a=Dn())&&(i.gridSection=a.first),bn(a=Dn())&&(i.productionSection=a.first),bn(a=Dn())&&(i.storageSection=a.first),bn(a=Dn())&&(i.chartDiv=a.first)}},inputs:{currentData:"currentData"},standalone:!1,decls:9,vars:8,consts:[["energymonitorChart",""],[2,"text-align","center"],["bdColor","rgba(0, 0, 0, 0.8)","size","medium","color","#fff","type","ball-clip-rotate-multiple","name","live-energymonitor",3,"fullScreen"],["overflow","visible"],["consumptionsection",""],["gridsection",""],["productionsection",""],["storagesection",""]],template:function(n,i){n&1&&(s(0,"div",1,0),d(2,"ngx-spinner",2),gt(),s(3,"svg",3)(4,"g"),d(5,"g",4)(6,"g",5)(7,"g",6)(8,"g",7),l()()()),n&2&&(r(2),c("fullScreen",!1),r(),re("width",Ui("",i.width,"px"))("height",Ui("",i.height,"px")),r(),ze("transform",i.translation))},dependencies:[me,Jl,Yt,ec,tc],encapsulation:2})}}return t})();function TF(t,o){if(t&1&&(s(0,"ion-item",0),d(1,"energymonitor-chart",1),l()),t&2){let e=p();r(),c("currentData",e)}}function IF(t,o){if(t&1&&(s(0,"ion-card")(1,"ion-item",2),d(2,"ion-icon",3),s(3,"ion-label"),h(4),g(5,"translate"),l()(),s(6,"ion-card-content"),d(7,"energymonitor-chart",4),l()()),t&2){let e=p();r(4),R(" ",E(5,2,"EDGE.INDEX.ENERGYMONITOR.TITLE")," "),r(3),c("currentData",e)}}function xF(t,o){if(t&1&&f(0,TF,2,1,"ion-item",0)(1,IF,8,4,"ion-card"),t&2){let e=p();_(e.navigationService.position()==="bottom"?0:1)}}var dg=(()=>{class t{static{this.SELECTOR="energymonitor"}constructor(e,n,i,a,m){this.service=e,this.websocket=n,this.route=i,this.dataService=a,this.navigationService=m,this.edge=null}ngOnInit(){this.service.getCurrentEdge().then(e=>{this.edge=e;let n=this.edge.isVersionAtLeast("2024.2.2")?[new y("_sum","EssMinDischargePower"),new y("_sum","EssMaxDischargePower")]:[new y("_sum","EssMaxApparentPower")];this.dataService.getValues([new y("_sum","EssSoc"),new y("_sum","EssActivePower"),...n,new y("_sum","GridActivePower"),new y("_sum","GridMinActivePower"),new y("_sum","GridMaxActivePower"),new y("_sum","GridMode"),new y("_sum","ProductionActivePower"),new y("_sum","ProductionDcActualPower"),new y("_sum","ProductionAcActivePower"),new y("_sum","ProductionMaxActivePower"),new y("_sum","ConsumptionActivePower"),new y("_sum","ConsumptionMaxActivePower")],e)})}ngOnDestroy(){this.edge!=null&&this.edge.unsubscribeChannels(this.websocket,t.SELECTOR)}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(Ce),x(De),x(kt),x(fn))}}static{this.\u0275cmp=I({type:t,selectors:[["energymonitor"]],standalone:!1,decls:2,vars:3,consts:[["lines","none"],[1,"ion-margin-bottom",3,"currentData"],["lines","full",2,"--background","var(--ion-background-color-card-header)"],["size","large","slot","start","name","laptop-outline","color","normal"],[3,"currentData"]],template:function(n,i){if(n&1&&(f(0,xF,2,1),g(1,"async")),n&2){let a;_((a=E(1,1,i.edge==null?null:i.edge.currentData))?0:-1,a)}},dependencies:[Ht,We,ie,J,ne,pg,lt,V],encapsulation:2})}}return t})();var ms;(function(t){t.METHOD="dailyWeatherForecast";class o extends un{constructor(i){super(t.METHOD,i),this.params=i}}t.Request=o;class e extends Ms{constructor(i,a){super(i),this.id=i,this.result=a,this.forecast=a.dailyWeatherForecast.map(m=>Li(ke({},m),{date:new Date(m.date)}))}}t.Response=e})(ms||(ms={}));var ps;(function(t){t.METHOD="hourlyWeatherForecast";class o extends un{constructor(i){super(t.METHOD,i),this.params=i}}t.Request=o;class e extends Ms{constructor(i,a){super(i),this.id=i,this.result=a,this.forecast=a.hourlyWeatherForecast.map(m=>Li(ke({},m),{datetime:new Date(m.datetime)}))}}t.Response=e})(ps||(ps={}));var ug=(()=>{class t{transform(e,n){let i=Ze.getCurrentLanguage();return Is(e,i.i18nLocaleKey,n)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=ui({name:"numberFormat",type:t,pure:!0})}}return t})();var fg=(()=>{class t{transform(e){return oo.formatHour(e,Ze.getCurrentLanguage())}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=ui({name:"hourFormat",type:t,pure:!0})}}return t})();var _g=(()=>{class t{transform(e){return dn.formatWeekday(e,Ze.getCurrentLanguage())}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=ui({name:"weekdayFormat",type:t,pure:!0})}}return t})();var hg=(()=>{class t{transform(e){return dn.formatDayMonth(e,Ze.getCurrentLanguage())}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=ui({name:"dayMonthFormat",type:t,pure:!0})}}return t})();var Dt=(function(t){return t.ClearDay="oe-clear-day",t.ClearNight="oe-clear-night",t.PartlyCloudyDay="oe-partly-cloudy-day",t.PartlyCloudyNight="oe-partly-cloudy-night",t.Thunderstorm="oe-thunderstorm",t.WeatherCloudy="oe-weather-cloudy",t.WeatherFoggy="oe-weather-foggy",t.WeatherMix="oe-weather-mix",t.WeatherRainy="oe-weather-rainy",t.WeatherSnowy="oe-weather-snowy",t.Unknown="oe-help",t})(Dt||{});function Cg(){Bd({"oe-clear-day":"assets/img/icon/clear_day.svg","oe-clear-night":"assets/img/icon/clear_night.svg","oe-partly-cloudy-day":"assets/img/icon/partly_cloudy_day.svg","oe-partly-cloudy-night":"assets/img/icon/partly_cloudy_night.svg","oe-thunderstorm":"assets/img/icon/thunderstorm.svg","oe-weather-cloudy":"assets/img/icon/weather_cloudy.svg","oe-weather-foggy":"assets/img/icon/weather_foggy.svg","oe-weather-mix":"assets/img/icon/weather_mix.svg","oe-weather-rainy":"assets/img/icon/weather_rainy.svg","oe-weather-snowy":"assets/img/icon/weather_snowy.svg","oe-sunshine-duration":"assets/img/icon/sunshine_duration.svg","oe-help":"assets/img/icon/help.svg"})}var gg=new Map([[0,{icon:Dt.ClearDay,description:"WEATHER_CODE_0"}],[1,{icon:Dt.PartlyCloudyDay,description:"WEATHER_CODE_1"}],[2,{icon:Dt.PartlyCloudyDay,description:"WEATHER_CODE_2"}],[3,{icon:Dt.WeatherCloudy,description:"WEATHER_CODE_3"}],[45,{icon:Dt.WeatherFoggy,description:"WEATHER_CODE_45"}],[48,{icon:Dt.WeatherFoggy,description:"WEATHER_CODE_48"}],[51,{icon:Dt.WeatherRainy,description:"WEATHER_CODE_51"}],[53,{icon:Dt.WeatherRainy,description:"WEATHER_CODE_53"}],[55,{icon:Dt.WeatherRainy,description:"WEATHER_CODE_55"}],[56,{icon:Dt.WeatherMix,description:"WEATHER_CODE_56"}],[57,{icon:Dt.WeatherMix,description:"WEATHER_CODE_57"}],[61,{icon:Dt.WeatherRainy,description:"WEATHER_CODE_61"}],[63,{icon:Dt.WeatherRainy,description:"WEATHER_CODE_63"}],[65,{icon:Dt.WeatherRainy,description:"WEATHER_CODE_65"}],[66,{icon:Dt.WeatherMix,description:"WEATHER_CODE_66"}],[67,{icon:Dt.WeatherMix,description:"WEATHER_CODE_67"}],[71,{icon:Dt.WeatherSnowy,description:"WEATHER_CODE_71"}],[73,{icon:Dt.WeatherSnowy,description:"WEATHER_CODE_73"}],[75,{icon:Dt.WeatherSnowy,description:"WEATHER_CODE_75"}],[77,{icon:Dt.WeatherSnowy,description:"WEATHER_CODE_77"}],[80,{icon:Dt.WeatherRainy,description:"WEATHER_CODE_80"}],[81,{icon:Dt.WeatherRainy,description:"WEATHER_CODE_81"}],[82,{icon:Dt.WeatherRainy,description:"WEATHER_CODE_82"}],[85,{icon:Dt.WeatherSnowy,description:"WEATHER_CODE_85"}],[86,{icon:Dt.WeatherSnowy,description:"WEATHER_CODE_86"}],[95,{icon:Dt.Thunderstorm,description:"WEATHER_CODE_95"}],[96,{icon:Dt.Thunderstorm,description:"WEATHER_CODE_96"}],[99,{icon:Dt.Thunderstorm,description:"WEATHER_CODE_99"}]]),RF=new Map([[0,{icon:Dt.ClearNight,description:"WEATHER_CODE_0_NIGHT"}],[1,{icon:Dt.PartlyCloudyNight,description:"WEATHER_CODE_1_NIGHT"}],[2,{icon:Dt.PartlyCloudyNight,description:"WEATHER_CODE_2_NIGHT"}]]),Eg={icon:Dt.Unknown,description:"WEATHER_CODE_UNKNOWN"};function nc(t,o){return o===!0?gg.get(t)??Eg:RF.get(t)??gg.get(t)??Eg}var vg=(()=>{class t{transform(e,n){return nc(e,n).icon}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=ui({name:"weatherCodeIcon",type:t,pure:!0})}}return t})();var yg=(()=>{class t{transform(e,n){return nc(e,n).description}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=ui({name:"weatherCodeDescription",type:t,pure:!0})}}return t})();var MF=t=>({location:t}),Tg=t=>({temp:t}),Ig=t=>({duration:t});function FF(t,o){if(t&1&&(s(0,"ion-col",17)(1,"ion-text",21),h(2),g(3,"hourFormat"),l(),d(4,"ion-icon",11),g(5,"weatherCodeIcon"),s(6,"ion-text",22),h(7),g(8,"number"),l()()),t&2){let e=o.$implicit;r(2),R(" ",E(3,3,e.datetime)," "),r(2),c("name",q(5,5,e.weatherCode,e.isDay)),r(3),R(" ",q(8,8,e.temperature,"1.0-0"),"\xB0 ")}}function GF(t,o){if(t&1&&(s(0,"ion-row",20)(1,"ion-col",23),h(2),g(3,"weekdayFormat"),l(),s(4,"ion-col",24),h(5),g(6,"dayMonthFormat"),l(),s(7,"ion-col",25),d(8,"ion-icon",11),g(9,"weatherCodeIcon"),l(),s(10,"ion-col",26)(11,"ion-row")(12,"ion-col",27),h(13),g(14,"number"),l(),s(15,"ion-col",28),h(16),g(17,"number"),l()()(),s(18,"ion-col",29),d(19,"ion-icon",14)(20,"ion-text",30),g(21,"numberFormat"),l()()),t&2){let e=o.$implicit;r(2),R(" ",E(3,7,e.date)," "),r(3),R(" ",E(6,9,e.date)," "),r(3),c("name",q(9,11,e.weatherCode,!0)),r(5),R(" ",q(14,14,e.minTemperature,"1.0-0"),"\xB0 "),r(3),R(" ",q(17,17,e.maxTemperature,"1.0-0"),"\xB0 "),r(4),c("translate","SUNSHINE_DURATION_HOURS")("translateParams",be(23,Ig,q(21,20,e.sunshineDuration/3600,"1.1-1")))}}function PF(t,o){if(t&1&&(s(0,"ion-card")(1,"ion-item",0),d(2,"ion-icon",1),g(3,"weatherCodeIcon"),s(4,"ion-label"),h(5),g(6,"translate"),l()(),s(7,"ion-card-content",2)(8,"ion-grid",2)(9,"ion-card",3)(10,"ion-card-content")(11,"ion-row")(12,"ion-col",4)(13,"ion-row",5)(14,"ion-text",6),h(15),g(16,"number"),l()(),s(17,"ion-row"),d(18,"ion-text",7),g(19,"number"),d(20,"ion-text",8),g(21,"number"),l()(),s(22,"ion-col",9)(23,"ion-row",10),d(24,"ion-icon",11),g(25,"weatherCodeIcon"),l(),s(26,"ion-row",10)(27,"ion-text",12),h(28),g(29,"weatherCodeDescription"),l()(),s(30,"ion-row",13),d(31,"ion-icon",14)(32,"ion-text",8),g(33,"numberFormat"),l()()(),d(34,"div",15),s(35,"ion-row",16),fe(36,FF,9,11,"ion-col",17,xe),g(38,"slice"),l()()(),s(39,"ion-card",18)(40,"ion-card-content",19),fe(41,GF,22,25,"ion-row",20,xe),l()()()()()),t&2){let e=p();r(2),c("name",q(3,11,e.currentHourlyForecast.weatherCode,e.currentHourlyForecast.isDay)),r(3),R(" ",q(6,14,"TITLE_WITH_LOCATION",be(39,MF,e.placeName))," "),r(10),R(" ",q(16,17,e.currentHourlyForecast.temperature,"1.0-0"),"\xB0 "),r(3),c("translate","MIN_TEMPERATURE")("translateParams",be(41,Tg,q(19,20,e.currentDailyForecast.minTemperature,"1.0-0"))),r(2),c("translate","MAX_TEMPERATURE")("translateParams",be(43,Tg,q(21,23,e.currentDailyForecast.maxTemperature,"1.0-0"))),r(4),c("name",q(25,26,e.currentHourlyForecast.weatherCode,e.currentHourlyForecast.isDay)),r(4),R(" ",q(29,29,e.currentHourlyForecast.weatherCode,e.currentHourlyForecast.isDay)," "),r(4),c("translate","SUNSHINE_DURATION_HOURS")("translateParams",be(45,Ig,q(33,32,e.currentDailyForecast.sunshineDuration/3600,"1.1-1"))),r(4),_e(Ap(38,35,e.upcomingHourlyForecasts,0,e.isSmartphone?5:6)),r(5),_e(e.upcomingDailyForecasts)}}var xg=(()=>{class t extends ce{constructor(){super(...arguments),this.placeName=null,this.isSmartphone=!1,this.currentHourlyForecast=null,this.upcomingHourlyForecasts=[],this.currentDailyForecast=null,this.upcomingDailyForecasts=[],this.resolutionService=Ro(j)}static{this.SELECTOR="weather"}static{this.FETCH_INTERVAL_MS=900*1e3}ngOnDestroy(){this.weatherForecastSubscription?.unsubscribe(),super.ngOnDestroy()}afterIsInitialized(){let e=this.edge.getConfig(this.websocket).value.getComponentsByFactory("Core.Meta")[0];this.placeName=e.getPropertyFromComponent("placeName")??"",this.isSmartphone=this.resolutionService.isSmartphoneResolution,this.weatherForecastSubscription=up(t.FETCH_INTERVAL_MS).pipe(hp(0)).subscribe(()=>{this.fetchHourlyWeatherForecast(),this.fetchDailyWeatherForecast()})}fetchHourlyWeatherForecast(){this.edge.sendRequest(this.websocket,new Ci({componentId:this.componentId,payload:new ps.Request({forecastHours:6})})).then(e=>{let n=new ps.Response(e.id,e.result),i=new Date;this.currentHourlyForecast=n.forecast.find(a=>a0(a.datetime,i))??null,this.upcomingHourlyForecasts=n.forecast.filter(a=>Ec(sa(a.datetime),sa(i)))}).catch(e=>{console.warn("Error fetching weather forecast",e)})}fetchDailyWeatherForecast(){this.edge.sendRequest(this.websocket,new Ci({componentId:this.componentId,payload:new ms.Request({})})).then(e=>{let n=new ms.Response(e.id,e.result),i=new Date;this.currentDailyForecast=n.forecast.find(a=>Rs(a.date,i))??null,this.upcomingDailyForecasts=n.forecast.filter(a=>Ec(gc(a.date),gc(i)))}).catch(e=>{console.warn("Error fetching weather forecast",e)})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["weather"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["lines","full",2,"--background","var(--ion-background-color-card-header)"],["slot","start","size","large","color","normal",3,"name"],[1,"ion-no-padding"],[2,"--background","var(--ion-background-color-card-header)","box-shadow","none"],["size","6",1,"ion-display-flex","ion-flex-column","ion-justify-content-between"],[2,"flex-grow","1"],[2,"font-size","3.2rem","line-height","1"],[2,"margin-right","0.25rem",3,"translate","translateParams"],[3,"translate","translateParams"],["size","6"],[1,"ion-justify-content-end"],[1,"weather-icon",3,"name"],["translate",""],[1,"ion-align-items-center","ion-justify-content-end",2,"gap","0.2rem"],["name","oe-sunshine-duration","color","primary",1,"sunshine-duration-icon"],[1,"thin-divider"],[1,"ion-justify-content-between"],["size","auto",1,"ion-display-flex","ion-flex-column","ion-align-items-center","ion-text-center"],[2,"--background","var(--ion-background-color)","box-shadow","none"],[2,"padding-top","0","padding-bottom","0"],[1,"ion-align-items-center",2,"margin-top","0px"],["color","normal",2,"font-size","0.7rem","margin-bottom","0.15rem"],[1,"ion-text-bold",2,"padding-left","0.15rem"],["size","2","size-sm","1",1,"ion-text-start","ion-text-bold"],["size-sm","3",1,"ion-hide-sm-down","ion-text-center"],["size","2","size-sm","2",1,"ion-text-center"],["size","4","size-sm","3"],["size","6",1,"ion-text-end",2,"color","var(--ion-color-normal)"],["size","6",1,"ion-text-start","ion-text-bold",2,"padding-left","0.3rem"],["size","4","size-sm","3",1,"ion-display-flex","ion-justify-content-end","ion-align-items-center","ion-text-end",2,"gap","0.15rem"],[2,"width","5ch",3,"translate","translateParams"]],template:function(n,i){n&1&&f(0,PF,43,47,"ion-card"),n&2&&_(i.currentHourlyForecast&&i.currentDailyForecast?0:-1)},dependencies:[Ht,We,Ae,Me,ie,J,ne,Se,He,Ne,Rp,Dp,V,ug,fg,_g,hg,vg,yg],styles:[".weather-icon[_ngcontent-%COMP%]{font-size:1.8rem;vertical-align:middle}.sunshine-duration-icon[_ngcontent-%COMP%]{font-size:1.05rem;vertical-align:middle}.thin-divider[_ngcontent-%COMP%]{height:1px;background-color:var(--ion-background-color);margin:.5rem 0}"]})}}return t})();var kF=["*"];function VF(t,o){if(t&1){let e=W();s(0,"ion-refresher",0),O("ionRefresh",function(i){P(e);let a=p();return L(a.refresh(i))}),d(1,"ion-refresher-content",1),l(),s(2,"ion-item",2)(3,"ion-row",3)(4,"ion-col",4),d(5,"ion-icon",5),s(6,"ion-text",6),h(7," LIVE.PULL_TO_REFRESH "),l(),d(8,"ion-icon",7),l()()()}}var ic=(()=>{class t{constructor(e,n,i){this.el=e,this.renderer=n,this.platFormService=i,this.show=!1,this.refresh=m=>{},wt(()=>{i.isActiveAgain()&&Ei.handleRefresh()});let a=this.el.nativeElement;this.renderer.addClass(a,"ion-page")}static{this.\u0275fac=function(n){return new(n||t)(x(fo),x(gs),x(Ei))}}static{this.\u0275cmp=I({type:t,selectors:[["oe-refresh-view"]],inputs:{show:"show",refresh:"refresh"},ngContentSelectors:kF,decls:3,vars:1,consts:[["mode","ios","slot","fixed",3,"ionRefresh"],["refreshingSpinner","crescent"],["lines","none","color","medium-tint",1,"ion-item-min-content-height",2,"background-color","var(--ion-color-background-pull-to-refresh) !important","cursor","pointer"],[1,"ion-justify-content-center","ion-full-width","ion-align-items-center","ion-no-padding"],[1,"ion-text-align-center","ion-col-with-left-and-right-icon"],["name","arrow-down-circle-outline","size","medium",2,"color","var(--ion-color-pull-to-refresh)"],["translate","",1,"ion-font-size-smaller","ion-font-style-oblique",2,"color","var(--ion-color-pull-to-refresh)"],["name","arrow-down-circle-outline"]],template:function(n,i){n&1&&(vs(),f(0,VF,9,0),s(1,"ion-content"),ys(2),l()),n&2&&_(i.show?0:-1)},dependencies:[tu,Ae,je,ie,J,ia,oa,Se,He,Ne,Te,lo,gi,st],styles:[".ion-col-with-left-and-right-icon[_ngcontent-%COMP%]{display:flex;justify-content:center}.ion-col-with-left-and-right-icon[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{padding-left:1%;padding-right:1%;align-self:center}"]})}}return t})();function BF(t,o){if(t&1&&(h(0),g(1,"unitvalue")),t&2){let e=o;R(" ",q(1,1,e>=0?e:0,"W")," ")}}function WF(t,o){if(t&1&&(h(0),g(1,"unitvalue")),t&2){let e=o;R(" ",q(1,1,e>=0?e:0,"W")," ")}}function UF(t,o){if(t&1&&(h(0),g(1,"unitvalue")),t&2){let e=o;R(" ",q(1,1,e>=0?e:0,"W")," ")}}function zF(t,o){if(t&1&&(h(0),g(1,"unitvalue")),t&2){let e=o;R(" ",q(1,1,e>=0?e:0,"W")," ")}}function jF(t,o){if(t&1&&(s(0,"table",13)(1,"tr")(2,"td",14),h(3," GENERAL.MEASURED_VALUE "),l(),s(4,"td",15),f(5,BF,2,4),l()()(),s(6,"table",13)(7,"tr"),d(8,"td",16),s(9,"td",17),h(10," GENERAL.MEASURED_VALUE"),s(11,"span"),h(12,"\xA0L1"),l()(),s(13,"td",15),g(14,"async"),f(15,WF,2,4),l()(),s(16,"tr"),d(17,"td",16),s(18,"td",17),h(19," GENERAL.MEASURED_VALUE"),s(20,"span"),h(21,"\xA0L2"),l()(),s(22,"td",15),g(23,"async"),f(24,UF,2,4),l()(),s(25,"tr"),d(26,"td",16),s(27,"td",17),h(28," GENERAL.MEASURED_VALUE"),s(29,"span"),h(30,"\xA0L3"),l()(),s(31,"td",15),g(32,"async"),f(33,zF,2,4),l()()()),t&2){let e,n,i,a,m,u,C,v=o,T=p(),A=p(2);r(5),_((e=T[v+"/ActivePower"]||!0)?5:-1,e),r(8),fi("bold",((n=E(14,10,A.mostStressedPhase))==null?null:n.name)==="L1"),r(2),_((i=T[v+"/ActivePowerL1"]||!0)?15:-1,i),r(7),fi("bold",((a=E(23,12,A.mostStressedPhase))==null?null:a.name)==="L2"),r(2),_((m=T[v+"/ActivePowerL2"]||!0)?24:-1,m),r(7),fi("bold",((u=E(32,14,A.mostStressedPhase))==null?null:u.name)==="L3"),r(2),_((C=T[v+"/ActivePowerL3"]||!0)?33:-1,C)}}function YF(t,o){if(t&1&&(s(0,"ion-card-content",5),f(1,jF,34,16),l()),t&2){let e,n=p(2);r(),_((e=n.component.properties["meter.id"])?1:-1,e)}}function $F(t,o){if(t&1&&(s(0,"ion-card-content")(1,"form",18)(2,"table",13)(3,"tr")(4,"td",14),h(5," EDGE.INDEX.WIDGETS.PEAKSHAVING.PEAKSHAVING_POWER "),l(),s(6,"td",15)(7,"ion-item",19),d(8,"ion-input",20),l()()()(),s(9,"table",13)(10,"tr")(11,"td",14),h(12," EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE_POWER "),l(),s(13,"td",15)(14,"ion-item",19),d(15,"ion-input",21),l()()()()()()),t&2){let e=p(2);r(),c("formGroup",e.formGroup)}}function XF(t,o){if(t&1&&(f(0,YF,2,1,"ion-card-content",5),g(1,"async"),f(2,$F,16,1,"ion-card-content"),s(3,"ion-grid",6)(4,"ion-row",7)(5,"ion-col",8),d(6,"ion-icon",9),l(),s(7,"ion-col",10)(8,"ion-note",11)(9,"small",12),h(10,"EDGE.INDEX.WIDGETS.PEAKSHAVING.ASYMMETRIC_INFO"),l()()()()()),t&2){let e,n=p();_((e=E(1,2,n.edge.currentData).channel)?0:-1,e),r(2),_(n.edge.roleIsAtLeast("owner")?2:-1)}}function qF(t,o){if(t&1){let e=W();s(0,"ion-fab",4)(1,"ion-fab-button",2),O("click",function(){P(e);let i=p();return L(i.applyChanges())}),d(2,"ion-icon",22),l()()}}function KF(t,o){t&1&&(s(0,"ion-grid"),d(1,"ion-progress-bar",23),l())}var Sg=(()=>{class t{constructor(e,n,i,a,m){this.service=e,this.translate=n,this.modalCtrl=i,this.formBuilder=a,this.websocket=m,this.loading=!1}ngOnInit(){this.formGroup=this.formBuilder.group({peakShavingPower:new K(this.component.properties.peakShavingPower,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required])),rechargePower:new K(this.component.properties.rechargePower,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required]))})}applyChanges(){if(this.edge!=null)if(this.edge.roleIsAtLeast("owner"))if(this.formGroup.controls.peakShavingPower.valid&&this.formGroup.controls.rechargePower.valid)if(this.formGroup.controls.peakShavingPower.value>=this.formGroup.controls.rechargePower.value){let e=[];Object.keys(this.formGroup.controls).forEach((n,i)=>{this.formGroup.controls[n].dirty&&e.push({name:Object.keys(this.formGroup.controls)[i],value:this.formGroup.controls[n].value})}),this.loading=!0,this.edge.updateComponentConfig(this.websocket,this.component.id,e).then(()=>{this.component.properties.peakShavingPower=this.formGroup.value.peakShavingPower,this.component.properties.rechargePower=this.formGroup.value.rechargePower,this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(n=>{this.formGroup.controls.peakShavingPower.setValue(this.component.properties.peakShavingPower),this.formGroup.controls.rechargePower.setValue(this.component.properties.rechargePower),this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+n.error.message,"danger"),console.warn(n)}),this.formGroup.markAsPristine()}else this.service.toast(this.translate.instant("EDGE.INDEX.WIDGETS.PEAKSHAVING.RELATION_ERROR"),"danger");else this.service.toast(this.translate.instant("GENERAL.INPUT_NOT_VALID"),"danger");else this.service.toast(this.translate.instant("GENERAL.INSUFFICIENT_RIGHTS"),"danger")}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(te),x(he),x(Ft),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["asymmetricpeakshaving-modal"]],inputs:{component:"component",edge:"edge",mostStressedPhase:"mostStressedPhase"},standalone:!1,decls:11,vars:4,consts:[[1,"ion-justify-content-center",2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["slot","end"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],["vertical","bottom","horizontal","end","slot","fixed",1,"ion-padding-bottom"],[1,"underline"],[1,"ion-padding-top"],[1,"ion-justify-content-center","ion-align-items-center"],["size","2",1,"ion-text-center"],["padding-right","","color","primary","size","large","name","alert-outline"],["size","10"],[1,"ion-text-wrap"],["translate",""],[1,"full_width"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"],[2,"width","2%"],["translate","",2,"width","63%"],[3,"formGroup"],["lines","inset",1,"noPadding"],["formControlName","peakShavingPower","type","number","label","\xA0W",1,"regularFont",2,"text-align","end"],["formControlName","rechargePower","type","number","label","\xA0W",1,"regularFont",2,"text-align","end"],["size","large","name","checkmark-circle-outline"],["type","indeterminate"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),h(3),l(),s(4,"ion-buttons",1)(5,"ion-button",2),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",3),l()()()(),s(7,"ion-content"),f(8,XF,11,4),f(9,qF,3,0,"ion-fab",4),f(10,KF,2,0,"ion-grid"),l()),n&2&&(r(3),N(i.component.alias),r(5),_(i.loading?-1:8),r(),_(i.formGroup.dirty?9:-1),r(),_(i.loading===!0?10:-1))},dependencies:[cn,Ie,Ke,Ge,Xe,We,Ae,je,Wn,Un,Me,xt,ie,nn,J,qo,oi,Se,St,ct,tn,ot,en,Ne,lt,Ut],encapsulation:2})}}return t})();var QF=()=>({name:"trending-down-outline",color:"normal"});function ZF(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),g(3,"async"),g(4,"async"),d(5,"oe-flat-widget-line",1),g(6,"translate"),d(7,"oe-flat-widget-line",1),g(8,"translate"),l()),t&2){let e,n,i=p();c("modalComponent",i.modalComponent)("title",i.component.alias)("icon",H(22,QF)),r(),c("name",E(2,12,"EDGE.INDEX.WIDGETS.PEAKSHAVING.MOST_STRESSED_PHASE")+"\xA0"+((e=E(3,14,i.mostStressedPhase))==null?null:e.name))("converter",i.CONVERT_WATT_TO_KILOWATT)("value",(n=E(4,16,i.mostStressedPhase))==null?null:n.value),r(4),c("name",E(6,18,"EDGE.INDEX.WIDGETS.PEAKSHAVING.PEAKSHAVING_POWER"))("converter",i.CONVERT_WATT_TO_KILOWATT)("value",i.peakShavingPower),r(2),c("name",E(8,20,"EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE_POWER"))("converter",i.CONVERT_WATT_TO_KILOWATT)("value",i.rechargePower)}}var Ag=(()=>{class t extends ce{constructor(){super(...arguments),this.mostStressedPhase=new $r(null),this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:Sg,componentProps:{component:this.component,edge:this.edge,mostStressedPhase:this.mostStressedPhase}}}getChannelAddresses(){return this.meterId=this.component.properties["meter.id"],[new y(this.meterId,"ActivePower"),new y(this.meterId,"ActivePowerL1"),new y(this.meterId,"ActivePowerL2"),new y(this.meterId,"ActivePowerL3")]}onCurrentData(e){let n=[e.allComponents[this.meterId+"/ActivePowerL1"],e.allComponents[this.meterId+"/ActivePowerL2"],e.allComponents[this.meterId+"/ActivePowerL3"]],i=["L1","L2","L3"];this.mostStressedPhase.next({name:i[n.indexOf(Math.max(...n))],value:Math.max(...n,0)}),this.peakShavingPower=this.component.properties.peakShavingPower,this.rechargePower=this.component.properties.rechargePower}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Asymmetric_PeakShaving"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"modalComponent","title","icon"],[3,"name","converter","value"]],template:function(n,i){n&1&&f(0,ZF,9,23,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,lt,V],encapsulation:2})}}return t})();function eG(t,o){if(t&1&&(Y(0),s(1,"oe-flat-widget",1),g(2,"translate"),d(3,"oe-flat-widget-line",2),g(4,"translate"),l(),z()),t&2){let e=o.ngVar,n=p(2);r(),c("icon",n.icon)("title",E(2,4,e)),r(2),c("name",E(4,6,e))("value",n.state)}}function tG(t,o){if(t&1&&G(0,eG,5,8,"ng-container",0),t&2){let e=p();c("ngVar",e.component.id===e.component.alias?e.outputChannel.channelId:e.component.alias)}}var wg=(()=>{class t extends ce{constructor(){super(...arguments),this.icon={name:"",size:"large",color:"normal"},this.state="?"}getChannelAddresses(){return this.outputChannel=y.fromString(this.component.properties.outputChannelAddress),[this.outputChannel]}onCurrentData(e){let n=e.allComponents[this.outputChannel.toString()];n!=null?n==1?(this.icon.name="radio-button-on-outline",this.state=this.translate.instant("GENERAL.ON")):n==0&&(this.icon.name="radio-button-off-outline",this.state=this.translate.instant("GENERAL.OFF")):this.icon.name="help-outline"}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Channelthreshold"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[4,"ngVar"],[3,"icon","title"],[3,"name","value"]],template:function(n,i){n&1&&f(0,tG,1,1,"ng-container"),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,xa,V],encapsulation:2})}}return t})();function iG(t,o){if(t&1){let e=W();s(0,"ion-segment",12),O("ionChange",function(i){P(e);let a=p(2);return L(a.updateMode(i))}),s(1,"ion-segment-button",13)(2,"ion-label"),h(3),g(4,"translate"),l(),d(5,"ion-icon",14),l(),s(6,"ion-segment-button",15)(7,"ion-label"),h(8),g(9,"translate"),l(),d(10,"ion-icon",16),l(),s(11,"ion-segment-button",17)(12,"ion-label"),h(13),g(14,"translate"),l(),d(15,"ion-icon",18),l()()}if(t&2){let e=p(2);c("value",ki(e.component.properties.mode)),r(3),R(" ",E(4,8,"GENERAL.ON")," "),r(2),c("color",e.component.properties.mode==="MANUAL_ON"?"success":"normal"),r(3),R(" ",E(9,10,"GENERAL.AUTOMATIC")," "),r(2),c("color",e.component.properties.mode==="AUTOMATIC"?"primary":"normal"),r(3),R(" ",E(14,12,"GENERAL.OFF")," "),r(2),c("color",e.component.properties.mode==="MANUAL_OFF"?"danger":"normal")}}function oG(t,o){if(t&1){let e=W();s(0,"ion-card-content",5)(1,"table",6)(2,"tr")(3,"td",9),h(4," GENERAL.SOC "),l(),s(5,"td",10),h(6),g(7,"unitvalue"),l()(),d(8,"div",19),s(9,"tr")(10,"td",9),h(11," EDGE.INDEX.WIDGETS.CHP.HIGH_THRESHOLD "),l(),s(12,"td",10),h(13),g(14,"unitvalue"),l()(),s(15,"tr")(16,"td",9),h(17," EDGE.INDEX.WIDGETS.CHP.LOW_THRESHOLD "),l(),s(18,"td",10),h(19),g(20,"unitvalue"),l()()(),s(21,"table",6)(22,"tr")(23,"ion-range",20),O("ionChange",function(){P(e);let i=p(2);return L(i.updateThresholds())}),Zt("ngModelChange",function(i){P(e);let a=p(2);return Qt(a.thresholds,i)||(a.thresholds=i),L(i)}),s(24,"ion-label",21),h(25),g(26,"unitvalue"),l(),s(27,"ion-label",1),h(28),g(29,"unitvalue"),l()()()()()}if(t&2){let e=p(),n=p();r(6),R(" ",q(7,6,e.channel[n.inputChannel],"%")," "),r(7),R(" ",q(14,9,n.component.properties.highThreshold,"%")," "),r(6),R(" ",q(20,12,n.component.properties.lowThreshold,"%")," "),r(4),Kt("ngModel",n.thresholds),r(2),R(" ",q(26,15,0,"%")," "),r(3),R(" ",q(29,18,100,"%")," ")}}function rG(t,o){t&1&&(s(0,"span",7),h(1,"GENERAL.ACTIVE"),l())}function aG(t,o){t&1&&(s(0,"span",7),h(1,"GENERAL.INACTIVE"),l())}function sG(t,o){t&1&&d(0,"ion-icon",11)}function lG(t,o){if(t&1&&(s(0,"ion-card-content",5)(1,"table",6)(2,"tr")(3,"td",7),h(4," GENERAL.MODE "),l()()(),f(5,iG,16,14,"ion-segment",8),l(),f(6,oG,30,21,"ion-card-content",5),s(7,"ion-card-content")(8,"table",6)(9,"tr")(10,"td",9),h(11,"GENERAL.STATE"),l(),s(12,"td",10),f(13,rG,2,0,"span",7)(14,aG,2,0,"span",7)(15,sG,1,0,"ion-icon",11),l()()()()),t&2){let e,n=p();r(5),_(n.component?5:-1),r(),_(n.component.properties.mode==="AUTOMATIC"&&n.edge.roleIsAtLeast("owner")?6:-1),r(7),_((e=o.channel[n.outputChannel])===1?13:e===0?14:15)}}var km=(()=>{class t{static{this.SELECTOR="chpsoc-modal"}constructor(e,n,i,a,m){this.service=e,this.websocket=n,this.router=i,this.translate=a,this.modalCtrl=m,this.thresholds={lower:null,upper:null}}ngOnInit(){this.thresholds.lower=this.component.properties.lowThreshold,this.thresholds.upper=this.component.properties.highThreshold}updateMode(e){let n=this.component.properties.mode,i;switch(e.detail.value){case"MANUAL_ON":i="MANUAL_ON";break;case"MANUAL_OFF":i="MANUAL_OFF";break;case"AUTOMATIC":i="AUTOMATIC";break}this.edge!=null&&this.edge.updateComponentConfig(this.websocket,this.component.id,[{name:"mode",value:i}]).then(()=>{this.component.properties.mode=i,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(a=>{this.component.properties.mode=n,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+a.error.message,"danger"),console.warn(a)})}updateThresholds(){let e=this.component.properties.lowThreshold,n=this.component.properties.highThreshold,i=this.thresholds.lower,a=this.thresholds.upper;this.edge!=null&&(e!=i||n!=a)&&this.edge.updateComponentConfig(this.websocket,this.component.id,[{name:"lowThreshold",value:i},{name:"highThreshold",value:a}]).then(()=>{this.component.properties.lowThreshold=i,this.component.properties.highThreshold=a,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(m=>{this.component.properties.lowThreshold=e,this.component.properties.highThreshold=n,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+m.error.message,"danger"),console.warn(m)})}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(Ce),x(It),x(te),x(he))}}static{this.\u0275cmp=I({type:t,selectors:[["chpsoc-modal"]],inputs:{edge:"edge",component:"component",outputChannel:"outputChannel",inputChannel:"inputChannel"},standalone:!1,decls:11,vars:4,consts:[[2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["slot","end"],["key","CONTROLLER_CHP_SOC"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],[1,"underline"],[1,"full_width"],["translate",""],["scrollable","false",3,"value"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"],["name","help-outline"],["scrollable","false",3,"ionChange","value"],["value","MANUAL_ON"],["name","play-outline",2,"width","40px",3,"color"],["value","AUTOMATIC"],["name","sunny-outline",2,"width","40px",3,"color"],["value","MANUAL_OFF"],["name","power-outline",2,"width","40px",3,"color"],[2,"padding-top","5px"],["dual-knobs","","pin","","color","dark","min","0","max","100","debounce","500",3,"ionChange","ngModelChange","ngModel"],["slot","start"]],template:function(n,i){if(n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),h(3),l(),s(4,"ion-buttons",1),d(5,"oe-help-button",2),s(6,"ion-button",3),O("click",function(){return i.modalCtrl.dismiss()}),d(7,"ion-icon",4),l()()()(),s(8,"ion-content"),f(9,lG,16,3),g(10,"async"),l()),n&2){let a;r(3),N(i.component.alias),r(6),_((a=E(10,2,i.edge.currentData))?9:-1,a)}},dependencies:[Ie,Tn,Ge,Xe,We,je,xt,ie,ne,Ai,ri,ai,St,ct,tn,$e,Ne,Oi,lt,Ut,V],encapsulation:2})}}return t})();var cG=()=>({name:"flame-outline",color:"normal"});function mG(t,o){if(t&1&&(d(0,"oe-flat-widget-line",1),g(1,"translate")),t&2){let e=p(2);c("name",E(1,2,"GENERAL.STATE"))("value",e.state)}}function pG(t,o){if(t&1&&(d(0,"oe-flat-widget-line",2),g(1,"translate")),t&2){let e=p(2);c("icon",e.icon)("name",E(1,2,"GENERAL.STATE"))}}function dG(t,o){if(t&1&&(gt(),s(0,"text",5),h(1),l()),t&2){let e=p(3);ze("x",Ui("",e.lowThresholdValue,"%")),r(),R(" ",e.lowThresholdValue+" %"," ")}}function uG(t,o){if(t&1&&(gt(),s(0,"text",6),h(1),l()),t&2){let e=p(3);ze("x",Ui("",e.highThresholdValue,"%")),r(),R(" ",e.highThresholdValue+" %"," ")}}function fG(t,o){t&1&&(gt(),d(0,"rect",8)),t&2&&Da("x: calc("+o+"% + 2px); fill: #0000ff80;")}function _G(t,o){if(t&1&&(s(0,"oe-flat-widget-percentagebar"),gt(),s(1,"svg"),d(2,"use",3)(3,"rect",4),f(4,dG,2,3,":svg:text",5),f(5,uG,2,3,":svg:text",6),f(6,fG,1,2,":svg:rect",7),l()()),t&2){let e,n=p(2);r(3),Da("x: calc("+n.lowThresholdValue+"% + 2px); width: calc("+n.thresholdDelta+"% - 4px);"),r(),_(n.thresholdDelta>15?4:-1),r(),_(n.thresholdDelta>15?5:-1),r(),_((e=n.inputChannelValue)?6:-1,e)}}function hG(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),f(3,mG,2,4,"oe-flat-widget-line",1)(4,pG,2,4,"oe-flat-widget-line",2),f(5,_G,7,5,"oe-flat-widget-percentagebar"),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("title",e.component.alias)("icon",H(9,cG)),r(),c("name",E(2,7,"GENERAL.MODE"))("value",e.mode),r(2),_(e.icon.name===""?3:4),r(2),_(e.modeChannelValue==="AUTOMATIC"?5:-1)}}var bg=(()=>{class t extends ce{constructor(){super(...arguments),this.inputChannel=null,this.outputChannel=null,this.propertyModeChannel=null,this.icon={name:"",size:"large",color:"primary"},this.modalComponent=null}static{this.PROPERTY_MODE="_PropertyMode"}get thresholdDelta(){let e=this.highThresholdValue-this.lowThresholdValue;return e<0?0:e}presentModal(){return ae(this,null,function*(){return yield(yield this.modalController.create({component:km,componentProps:{component:this.component,edge:this.edge,outputChannel:this.outputChannel,inputChannel:this.inputChannel}})).present()})}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:km,componentProps:{component:this.component,edge:this.edge,outputChannel:this.outputChannel,inputChannel:this.inputChannel}}}getChannelAddresses(){return this.outputChannel=y.fromString(this.component.properties.outputChannelAddress),this.inputChannel=y.fromString(this.component.properties.inputChannelAddress),this.propertyModeChannel=new y(this.component.id,t.PROPERTY_MODE),[this.outputChannel,this.inputChannel,this.propertyModeChannel,new y(this.component.id,"_PropertyHighThreshold"),new y(this.component.id,"_PropertyLowThreshold")]}onCurrentData(e){switch(this.modeChannelValue=e.allComponents[this.propertyModeChannel.toString()],this.modeChannelValue){case"ON":this.mode=this.translate.instant("GENERAL.ON");break;case"OFF":this.mode=this.translate.instant("GENERAL.OFF");break;case"AUTOMATIC":this.mode=this.translate.instant("GENERAL.AUTOMATIC")}switch(e.allComponents[this.outputChannel.toString()]){case 0:this.state=this.translate.instant("GENERAL.INACTIVE"),this.icon.name=="help-outline";break;case 1:this.state=this.translate.instant("GENERAL.ACTIVE");break}this.inputChannelValue=e.allComponents[this.inputChannel.toString()],this.highThresholdValue=e.allComponents[this.component.id+"/_PropertyHighThreshold"],this.lowThresholdValue=e.allComponents[this.component.id+"/_PropertyLowThreshold"]}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_ChpSocComponent"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["tabindex","0","button","",3,"modalComponent","title","icon"],[3,"name","value"],[3,"icon","name"],["href","#container"],["y","2","rx","6","ry","6","height","18","ngClass","primary-color"],["id","first","dx","3px","y","50%","dominant-baseline","middle","text-anchor","start","ngClass","secondary-color",2,"font-weight","500"],["id","second","dx","-3px","y","50%","dominant-baseline","middle","text-anchor","end","ngClass","secondary-color",2,"font-weight","500"],["y","2","rx","0","ry","0","width","1%","height","18",3,"style"],["y","2","rx","0","ry","0","width","1%","height","18"]],template:function(n,i){n&1&&f(0,hG,6,10,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[Si,pe,we,Qi,V],encapsulation:2})}}return t})();var ds;(function(t){function o(e,n){return e==null||e?.toString()==null||n==null?null:n[e.toString()]}t.getChannel=o})(ds||(ds={}));function gG(t,o){t&1&&(s(0,"span",9),h(1,"GENERAL.ON"),l())}function EG(t,o){t&1&&(s(0,"span",9),h(1,"GENERAL.OFF"),l())}function vG(t,o){t&1&&d(0,"ion-icon",10)}function yG(t,o){if(t&1&&(s(0,"ion-card-content",5)(1,"table",6)(2,"tr")(3,"td",26),h(4," EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.DEPENDEND_ON "),l(),s(5,"td",27)(6,"span",9),h(7,"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.OTHER"),l(),h(8),l()()()()),t&2){let e=p(6);r(8),R(" (",e.component.properties.inputChannelAddress,") ")}}function TG(t,o){if(t&1){let e=W();s(0,"ion-card-content",19)(1,"ion-row")(2,"ion-col",28)(3,"ion-item",29)(4,"ion-select",30),g(5,"translate"),O("ionChange",function(i){P(e);let a=p(6);return L(a.updateInputMode(i))}),s(6,"ion-select-option",31),h(7,"GENERAL.SOC"),l(),s(8,"ion-select-option",32),h(9,"GENERAL.PRODUCTION"),l(),s(10,"ion-select-option",33),h(11,"GENERAL.GRID_SELL"),l(),s(12,"ion-select-option",34),h(13,"GENERAL.GRID_BUY"),l()()()()()()}if(t&2){let e=p(6);r(4),c("value",e.inputMode.value)("label",E(5,2,"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.DEPENDEND_ON"))}}function IG(t,o){t&1&&(s(0,"table",6)(1,"tr")(2,"td",36)(3,"ion-text",37),h(4," EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.MORE_THAN_MAX_POWER "),l()()()())}function xG(t,o){if(t&1&&(s(0,"ion-card-content",20)(1,"table",6)(2,"tr")(3,"td",7),h(4," EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCHED_LOAD_POWER "),l(),s(5,"td",8)(6,"ion-item",22),d(7,"ion-input",35),l()()()(),f(8,IG,5,0,"table",6),l()),t&2){let e=p(6);r(8),_(e.formGroup.controls.switchedLoadPower.dirty&&e.formGroup.controls.inputMode.value==="GRIDSELL"?8:-1)}}function SG(t,o){if(t&1&&(s(0,"td",8),h(1),g(2,"unitvalue"),l()),t&2){let e=p(3);r(),R(" ",q(2,1,e.storage.soc,"%")," ")}}function AG(t,o){if(t&1&&(s(0,"td",8),h(1),g(2,"unitvalue"),l()),t&2){let e=p(3);r(),R(" ",q(2,1,e.grid.sellActivePower,"W")," ")}}function wG(t,o){if(t&1&&(s(0,"td",8),h(1),g(2,"unitvalue"),l()),t&2){let e=p(3);r(),R(" ",q(2,1,e.grid.buyActivePower,"W")," ")}}function bG(t,o){if(t&1&&(s(0,"td",8),h(1),g(2,"unitvalue"),l()),t&2){let e=p(3);r(),R(" ",q(2,1,e.production.activePower,"W")," ")}}function DG(t,o){if(t&1&&(s(0,"div"),h(1),l()),t&2){let e=p(7);r(),R(" \xA0",e.inputChannelUnit," ")}}function RG(t,o){if(t&1&&(s(0,"td",8),h(1),f(2,DG,2,1,"div"),l()),t&2){let e=p(4),n=p(2);r(),R(" ",e.channel[n.component.properties.inputChannelAddress]," "),r(),_(n.inputChannelUnit?2:-1)}}function OG(t,o){if(t&1&&(s(0,"table",6)(1,"tr")(2,"td",7),h(3," EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.THRESHOLD"),l(),s(4,"td",8),h(5),g(6,"unitvalue"),l()()(),s(7,"table",6)(8,"tr")(9,"ion-range",38)(10,"ion-label",39),h(11),g(12,"unitvalue"),l(),s(13,"ion-label",1),h(14),g(15,"unitvalue"),l()()()()),t&2){let e=p(6);r(5),R(" ",q(6,4,e.threshold.value,"%")," "),r(4),c("value",e.threshold.value),r(2),R(" ",q(12,7,0,"%")," "),r(3),R(" ",q(15,10,100,"%")," ")}}function NG(t,o){if(t&1&&(s(0,"table",6)(1,"tr")(2,"td",7),h(3," EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.THRESHOLD "),l(),s(4,"td",8)(5,"ion-item",22),d(6,"ion-input",40),l()()()()),t&2){let e=p(6);r(6),c("label",e.inputMode.value!=="OTHER"?"\xA0W":e.inputMode.value==="OTHER"&&e.inputChannelUnit?"\xA0{{ inputChannelUnit }}":"")}}function MG(t,o){if(t&1&&(s(0,"span",9),h(1,"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_ABOVE"),l(),h(2),g(3,"unitvalue")),t&2){let e=p(7);r(2),R(" ",q(3,1,e.threshold.value,"%")," ")}}function FG(t,o){if(t&1&&(s(0,"span",9),h(1,"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_ABOVE"),l(),h(2),g(3,"unitvalue")),t&2){let e=p(7);r(2),R(" ",q(3,1,e.threshold.value,"W")," ")}}function GG(t,o){if(t&1&&(s(0,"span",9),h(1,"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_BELOW"),l(),h(2),g(3,"unitvalue")),t&2){let e=p(7);r(2),R(" ",q(3,1,e.threshold.value,"%")," ")}}function PG(t,o){if(t&1&&(s(0,"span",9),h(1,"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_BELOW"),l(),h(2),g(3,"unitvalue")),t&2){let e=p(7);r(2),R(" ",q(3,1,e.threshold.value,"W")," ")}}function LG(t,o){if(t&1&&(s(0,"ion-segment",21)(1,"ion-segment-button",41)(2,"ion-label"),f(3,MG,4,4)(4,FG,4,4),l(),d(5,"ion-icon",42),l(),s(6,"ion-segment-button",41)(7,"ion-label"),f(8,GG,4,4)(9,PG,4,4),l(),d(10,"ion-icon",43),l()()),t&2){let e=p(6);c("value",e.formGroup.controls.invert.value),r(),c("value",!1),r(2),_((e.inputMode==null?null:e.inputMode.value)==="SOC"?3:4),r(3),c("value",!0),r(2),_((e.inputMode==null?null:e.inputMode.value)==="SOC"?8:9)}}function kG(t,o){if(t&1&&(s(0,"ion-segment",21)(1,"ion-segment-button",41)(2,"ion-label")(3,"span",9),h(4,"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_ABOVE"),l(),h(5),g(6,"unitvalue"),l(),d(7,"ion-icon",42),l(),s(8,"ion-segment-button",41)(9,"ion-label")(10,"span",9),h(11,"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_BELOW"),l(),h(12),g(13,"unitvalue"),l(),d(14,"ion-icon",43),l()()),t&2){let e=p(6);c("value",e.invert.value),r(),c("value",!0),r(4),R(" ",q(6,5,e.threshold.value,"W")," "),r(3),c("value",!1),r(4),R(" ",q(13,8,e.threshold.value,"W")," ")}}function VG(t,o){if(t&1){let e=W();s(0,"ion-fab",25)(1,"ion-fab-button",3),O("click",function(){P(e);let i=p(6);return L(i.applyChanges())}),d(2,"ion-icon",44),l()()}}function HG(t,o){if(t&1&&(s(0,"form",18),f(1,yG,9,1,"ion-card-content",5),f(2,TG,14,4,"ion-card-content",19),f(3,xG,9,1,"ion-card-content",20),s(4,"ion-card-content",5)(5,"table",6)(6,"tr")(7,"td",7),h(8," EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.CURRENT_VALUE"),l(),f(9,SG,3,4,"td",8)(10,AG,3,4,"td",8)(11,wG,3,4,"td",8)(12,bG,3,4,"td",8)(13,RG,3,2,"td",8),l()(),f(14,OG,16,13),f(15,NG,7,1,"table",6),l(),s(16,"ion-card-content",5)(17,"table",6)(18,"tr")(19,"td",7),h(20," EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.BEHAVIOUR "),l()()(),f(21,LG,11,5,"ion-segment",21),f(22,kG,15,11,"ion-segment",21),l(),s(23,"ion-card-content")(24,"table",6)(25,"tr")(26,"td",7),h(27," EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.MIN_SWITCHING_TIME "),l(),s(28,"td",8)(29,"ion-item",22),d(30,"ion-input",23),s(31,"ion-label",24),h(32,"\xA0s"),l()()()()()()(),f(33,VG,3,0,"ion-fab",25)),t&2){let e,n=p(5);c("formGroup",n.formGroup),r(),_((n.inputMode==null?null:n.inputMode.value)==="OTHER"?1:-1),r(),_(n.inputMode.value!=="OTHER"?2:-1),r(),_(n.inputMode.value!=="SOC"&&n.inputMode.value!=="PRODUCTION"?3:-1),r(6),_((e=n.inputMode.value)==="SOC"?9:e==="GRIDSELL"?10:e==="GRIDBUY"?11:e==="PRODUCTION"?12:e==="OTHER"?13:-1),r(5),_(n.inputMode.value==="SOC"?14:-1),r(),_((n.inputMode==null?null:n.inputMode.value)!=="SOC"?15:-1),r(6),_(n.inputMode!==null&&n.inputMode.value!=="GRIDSELL"?21:-1),r(),_((n.formGroup==null||n.formGroup.controls.invert==null?null:n.formGroup.controls.invert.value)!==null&&n.inputMode&&n.inputMode.value==="GRIDSELL"?22:-1),r(11),_(n.formGroup.dirty?33:-1)}}function BG(t,o){if(t&1){let e=W();s(0,"ion-card-content",5)(1,"table",6)(2,"tr")(3,"td",7),h(4," GENERAL.STATE "),l(),s(5,"td",8),f(6,gG,2,0,"span",9)(7,EG,2,0,"span",9)(8,vG,1,0,"ion-icon",10),l()()()(),s(9,"ion-card-content",5)(10,"table",6)(11,"tr")(12,"td",7),h(13," GENERAL.MODE "),l()()(),s(14,"ion-segment",11),O("ionChange",function(i){P(e);let a=p(4);return L(a.updateMode(i))}),s(15,"ion-segment-button",12)(16,"ion-label"),h(17),g(18,"translate"),l(),d(19,"ion-icon",13),l(),s(20,"ion-segment-button",14)(21,"ion-label"),h(22),g(23,"translate"),l(),d(24,"ion-icon",15),l(),s(25,"ion-segment-button",16)(26,"ion-label"),h(27),g(28,"translate"),l(),d(29,"ion-icon",17),l()()(),f(30,HG,34,10)}if(t&2){let e,n=p(2),i=p(2);r(6),_((e=n.channel[i.outputChannel])===1?6:e===0?7:8),r(8),c("value",ki(i.component.properties.mode)),r(3),R(" ",E(18,10,"GENERAL.ON")," "),r(2),c("color",i.component.properties.mode==="ON"?"success":"normal"),r(3),R(" ",E(23,12,"GENERAL.AUTOMATIC")," "),r(2),c("color",i.component.properties.mode==="AUTOMATIC"?"primary":"normal"),r(3),R(" ",E(28,14,"GENERAL.OFF")," "),r(2),c("color",i.component.properties.mode==="OFF"?"danger":"normal"),r(),_(i.component.properties.mode==="AUTOMATIC"&&!i.loading?30:-1)}}function WG(t,o){t&1&&(s(0,"ion-grid"),d(1,"ion-progress-bar",45),l())}function UG(t,o){if(t&1&&(s(0,"ion-content"),f(1,BG,31,16),f(2,WG,2,0,"ion-grid"),l()),t&2){let e=p(3);r(),_(e.loading?-1:1),r(),_(e.loading?2:-1)}}function zG(t,o){if(t&1&&f(0,UG,3,2,"ion-content"),t&2){let e;_((e=o.summary)?0:-1,e)}}function jG(t,o){if(t&1&&(f(0,zG,1,1),g(1,"async")),t&2){let e;_((e=E(1,1,o.currentData))?0:-1,e)}}var Vm=(()=>{class t{constructor(e,n,i,a,m,u){this.service=e,this.modalCtrl=n,this.translate=i,this.websocket=a,this.formBuilder=m,this.dataService=u,this.outputChannel=null,this.inputChannelUnit=null,this.loading=!1,this.minimumSwitchingTime=null,this.threshold=null,this.switchedLoadPower=null,this.inputMode=null,this.invert=null,wt(()=>{let v=u.currentValue().allComponents[new y(this.component.id,"_PropertyInvert").toString()]==1;Vi.findFormControlSafely(this.formGroup,"invert").dirty||this.formGroup.controls.invert.setValue(v)})}ngOnInit(){this.formGroup=this.formBuilder.group({minimumSwitchingTime:new K(this.component.properties.minimumSwitchingTime,le.compose([le.min(5),le.pattern("^[1-9][0-9]*$"),le.required])),switchedLoadPower:new K(this.component.properties.switchedLoadPower,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required])),threshold:new K(this.getInputMode()=="GRIDSELL"?this.component.properties.threshold*-1:this.component.properties.threshold,le.compose([le.min(1),le.pattern("^[1-9][0-9]*$"),le.required])),inputMode:new K(this.getInputMode()),invert:new K(null,le.requiredTrue)}),this.minimumSwitchingTime=this.formGroup.controls.minimumSwitchingTime,this.threshold=this.formGroup.controls.threshold,this.switchedLoadPower=this.formGroup.controls.switchedLoadPower,this.inputMode=this.formGroup.controls.inputMode,this.invert=this.component.properties.invert,this.dataService.getValues([new y(this.component.id,"_PropertyInvert")],this.edge,"")}updateInputMode(e){let n=this.component.properties.threshold;switch(e.detail.value){case"SOC":this.inputMode.setValue("SOC"),this.switchedLoadPower.setValue(0),this.switchedLoadPower.markAsDirty(),Math.abs(this.component.properties.threshold)<0||Math.abs(this.component.properties.threshold)>100?(n=50,this.threshold.setValue(n),this.threshold.markAsDirty()):this.component.properties.threshold<0&&(this.threshold.setValue(n),this.threshold.markAsDirty());break;case"GRIDSELL":this.inputMode.setValue("GRIDSELL"),this.threshold.markAsDirty(),this.switchedLoadPower.markAsDirty();break;case"GRIDBUY":this.inputMode.setValue("GRIDBUY"),this.switchedLoadPower.markAsDirty(),this.component.properties.threshold<0&&(n=this.formGroup.value.threshold,this.threshold.setValue(n),this.threshold.markAsDirty());break;case"PRODUCTION":this.inputMode.setValue("PRODUCTION"),this.switchedLoadPower.setValue(0),this.switchedLoadPower.markAsDirty(),this.component.properties.threshold<0&&(n=this.threshold.value,this.threshold.setValue(n),this.threshold.markAsDirty());break}}updateMode(e){let n=this.component.properties.mode,i;switch(e.detail.value){case"ON":i="ON";break;case"OFF":i="OFF";break;case"AUTOMATIC":i="AUTOMATIC";break}this.edge!=null&&this.edge.updateComponentConfig(this.websocket,this.component.id,[{name:"mode",value:i}]).then(()=>{this.component.properties.mode=i,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(a=>{this.component.properties.mode=n,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+a.error.message,"danger"),console.warn(a)})}applyChanges(){if(this.edge!=null)if(this.edge.roleIsAtLeast("owner"))if(this.minimumSwitchingTime.valid&&this.threshold.valid&&this.switchedLoadPower.valid)if(this.threshold.value>this.switchedLoadPower.value){let e=[];Object.keys(this.formGroup.controls).forEach((n,i)=>{this.formGroup.controls[n].dirty&&(Object.keys(this.formGroup.controls)[i]=="inputMode"?e.push({name:"inputChannelAddress",value:this.convertToChannelAddress(this.formGroup.controls[n].value)}):this.inputMode.value=="GRIDSELL"&&Object.keys(this.formGroup.controls)[i]=="threshold"?(this.formGroup.controls[n].setValue(this.formGroup.controls[n].value*-1),e.push({name:Object.keys(this.formGroup.controls)[i],value:this.formGroup.controls[n].value})):e.push({name:Object.keys(this.formGroup.controls)[i],value:this.formGroup.controls[n].value}))}),this.loading=!0,this.edge.updateComponentConfig(this.websocket,this.component.id,e).then(()=>{this.component.properties.minimumSwitchingTime=this.minimumSwitchingTime.value,this.component.properties.threshold=this.inputMode.value=="GRIDSELL"?this.threshold.value*-1:this.threshold.value,this.component.properties.switchedLoadPower=this.switchedLoadPower.value,this.component.properties.inputChannelAddress=this.convertToChannelAddress(this.inputMode.value)!=this.component.properties.inputChannelAddress?this.convertToChannelAddress(this.inputMode.value):this.component.properties.inputChannelAddress,this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(n=>{this.loading=!1,this.minimumSwitchingTime.setValue(this.component.properties.minimumSwitchingTime),this.threshold.setValue(this.component.properties.threshold),this.switchedLoadPower.setValue(this.component.properties.switchedLoadPower),this.inputMode.setValue(this.convertToInputMode(this.component.properties.inputChannelAddress,this.component.properties.threshold)),this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+n.error.message,"danger"),console.warn(n)}),this.inputMode.value=="GRIDSELL"&&(this.inputMode.dirty||this.threshold.dirty)&&this.threshold.setValue(this.threshold.value*-1),this.formGroup.markAsPristine()}else this.service.toast(this.translate.instant("EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.RELATION_ERROR"),"danger");else this.service.toast(this.translate.instant("GENERAL.INPUT_NOT_VALID"),"danger");else this.service.toast(this.translate.instant("GENERAL.INSUFFICIENT_RIGHTS"),"danger")}getInputMode(){if(this.component.properties.inputChannelAddress=="_sum/GridActivePower"&&this.component.properties.threshold<0)return"GRIDSELL";if(this.component.properties.inputChannelAddress=="_sum/GridActivePower"&&this.component.properties.threshold>0)return"GRIDBUY";if(this.component.properties.inputChannelAddress=="_sum/ProductionActivePower")return"PRODUCTION";if(this.component.properties.inputChannelAddress=="_sum/EssSoc")return"SOC";if(this.component.properties.inputChannelAddress!=null)return"OTHER"}convertToChannelAddress(e){switch(e){case"SOC":return"_sum/EssSoc";case"GRIDBUY":return"_sum/GridActivePower";case"GRIDSELL":return"_sum/GridActivePower";case"PRODUCTION":return"_sum/ProductionActivePower";default:return null}}convertToInputMode(e,n){switch(e){case"_sum/EssSoc":return"SOC";case"_sum/ProductionActivePower":return"PRODUCTION";case"_sum/GridActivePower":if(n>0)return"GRIDBUY";if(n<0)return"GRIDSELL"}}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(he),x(te),x(Ce),x(Ft),x(kt))}}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-io-channelsinglethreshold-modal"]],inputs:{edge:"edge",config:"config",component:"component",outputChannel:"outputChannel",inputChannel:"inputChannel",inputChannelUnit:"inputChannelUnit"},standalone:!1,features:[vn([{provide:kt,useClass:ci}])],decls:9,vars:2,consts:[["mode","md",1,"ion-justify-content-center",2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["slot","end"],["key","CONTROLLER_IO_CHANNEL_SINGLE_THRESHOLD"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],[1,"underline"],[1,"full_width"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"],["translate",""],["name","help-outline"],["scrollable","false",3,"ionChange","value"],["value","ON"],["name","play-outline",2,"width","40px",3,"color"],["value","AUTOMATIC"],["name","sunny-outline",2,"width","40px",3,"color"],["value","OFF"],["name","power-outline",2,"width","40px",3,"color"],[3,"formGroup"],[1,"ion-no-padding"],[1,"underline",2,"padding-top","0"],["formControlName","invert","scrollable","false",3,"value"],["lines","inset",1,"noPadding"],["type","number","formControlName","minimumSwitchingTime","inputmode","decimal",1,"regularFont",2,"text-align","end"],[1,"regularFont"],["vertical","bottom","horizontal","center","slot","fixed",1,"ion-padding-bottom"],["translate","",2,"width","50%"],[1,"align_right",2,"width","50%"],["size","12",1,"ion-no-padding"],["lines","none",1,"noPadding"],["formControlName","inputMode",3,"ionChange","value","label"],["value","SOC","translate",""],["value","PRODUCTION","translate",""],["value","GRIDSELL","translate",""],["value","GRIDBUY","translate",""],["type","number","formControlName","switchedLoadPower","label","\xA0W",1,"regularFont",2,"text-align","end"],[2,"width","100%"],["color","danger","translate",""],["formControlName","threshold","pin","","color","dark","min","1","max","100",3,"value"],["slot","start"],["type","number","formControlName","threshold",1,"regularFont",2,"text-align","end",3,"label"],[3,"value"],["name","arrow-up-outline",2,"width","40px"],["name","arrow-down-outline",2,"width","40px"],["size","large","name","checkmark-circle-outline"],["type","indeterminate"]],template:function(n,i){if(n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),h(3),l(),s(4,"ion-buttons",1),d(5,"oe-help-button",2),s(6,"ion-button",3),O("click",function(){return i.modalCtrl.dismiss()}),d(7,"ion-icon",4),l()()()(),f(8,jG,2,3)),n&2){let a;r(3),N(i.component.alias),r(5),_((a=i.service.currentEdge())?8:-1,a)}},dependencies:[cn,Ie,Ke,Ge,Xe,We,Ae,je,Wn,Un,Me,xt,ie,nn,J,ne,oi,Ai,Se,ri,ai,jn,Yn,He,St,ct,tn,$e,ot,en,Ne,Oi,lt,Ut,V],encapsulation:2})}}return t})();var YG=t=>({name:t,color:"normal"});function $G(t,o){if(t&1&&(d(0,"oe-flat-widget-line",4),g(1,"translate")),t&2){let e=p(3);c("name",E(1,3,"GENERAL.CURRENT_VALUE"))("value",e.currentValue)("filter",e.Filter.NOT_NULL_OR_UNDEFINED)}}function XG(t,o){if(t&1&&d(0,"oe-flat-widget-line",5),t&2){let e=p(3);c("converter",e.switchConverter)("name",e.switchState)("value",e.switchValue)}}function qG(t,o){if(t&1&&(d(0,"oe-flat-widget-line",3),g(1,"translate"),f(2,$G,2,5,"oe-flat-widget-line",4),f(3,XG,1,3,"oe-flat-widget-line",5)),t&2){let e=p(2);c("name",E(1,5,"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.DEPENDEND_ON"))("value",e.dependentOnLabel)("filter",e.Filter.NOT_NULL_OR_UNDEFINED),r(2),_(e.isOtherInputAddress?2:-1),r(),_(e.outputChannelValue!==null?3:-1)}}function KG(t,o){if(t&1){let e=W();s(0,"oe-flat-widget",1),O("click",function(){P(e);let i=p();return L(i.presentModal())}),d(1,"oe-flat-widget-line",2),g(2,"translate"),d(3,"oe-flat-widget-line",2),g(4,"translate"),f(5,qG,4,7),l()}if(t&2){let e=p();c("title",e.component.alias)("icon",be(11,YG,e.icon.name)),r(),c("name",E(2,7,"GENERAL.STATE"))("value",e.state),r(2),c("name",E(4,9,"GENERAL.MODE"))("value",e.mode),r(2),_(e.modeValue==="AUTOMATIC"?5:-1)}}var Dg=(()=>{class t extends ce{constructor(){super(...arguments),this.Filter=Vs,this.inputChannel=fc(null),this.invert=fc(null),this.icon={name:"",color:"",size:"large"},this.dependentOnLabel=null,this.currentValue=null,this.unitOfInputChannel=null,this.outputChannelValue=null,this.switchConverter=M.CONVERT_WATT_TO_KILOWATT,this.modalComponent=null}static createCurrentValueLabel(e,n){return e==null||n==null?null:Fo.formatSafelyWithSuffix(e,"1.0-0",n)}static createSwitchStateLabel(e,n,i,a){let m=i!==null&&i>0,u=QG.find(C=>C.invert===e&&C.outputChannelValue===n&&C.propertyThresholdPositive===m)?.label??null;return u==null?null:a.instant(u)}presentModal(){return ae(this,null,function*(){return yield(yield this.modalController.create({component:Vm,componentProps:{component:this.component,config:this.config,edge:this.edge,outputChannel:this.outputChannel,inputChannel:this.inputChannel,inputChannelUnit:this.unitOfInputChannel}})).present()})}getModalComponent(){return{component:Vm,componentProps:{component:this.component,config:this.config,edge:this.edge,outputChannel:this.outputChannel,inputChannel:this.inputChannel,inputChannelUnit:this.unitOfInputChannel}}}afterIsInitialized(){return ae(this,null,function*(){this.modalComponent=this.getModalComponent(),this.inputChannel.set(y.fromStringSafely(this.component.getPropertyFromComponent("inputChannelAddress"))),this.invert.set(this.component.getPropertyFromComponent("invert"))})}getChannelAddresses(){let e=this.component.properties.outputChannelAddress;return typeof e=="string"?this.outputChannel=y.fromString(e):this.outputChannel=y.fromString(e[0]),[this.outputChannel,this.inputChannel(),y.fromString(this.component.id+"/_PropertyInvert"),y.fromString(this.component.id+"/_PropertyMode"),y.fromString(this.component.id+"/_PropertyThreshold")]}onCurrentData(e){return ae(this,null,function*(){this.unitOfInputChannel==null&&this.dependentOnLabel==null&&this.onInputChannelValueChange(e);let n=y.fromString(this.component.getPropertyFromComponent("inputChannelAddress")),i=this.getPropertyInvert(e)==1;(this.inputChannel().toString()!==n.toString()||this.invert()!=i)&&(this.inputChannel.set(n),this.invert.set(i),this.onInputChannelValueChange(e));let a=ds.getChannel(this.inputChannel(),e.allComponents);switch(this.currentValue=t.createCurrentValueLabel(a,this.unitOfInputChannel),this.outputChannelValue=e.allComponents[this.outputChannel.toString()],this.outputChannelValue){case 0:this.icon.name="radio-button-off-outline",this.state=this.translate.instant("GENERAL.OFF");break;case 1:this.icon.name="aperture-outline",this.state=this.translate.instant("GENERAL.ON");break}switch(this.modeValue=e.allComponents[this.component.id+"/_PropertyMode"],this.modeValue){case"ON":this.mode=this.translate.instant("GENERAL.ON");break;case"OFF":this.mode=this.translate.instant("GENERAL.OFF");break;case"AUTOMATIC":this.mode=this.translate.instant("GENERAL.AUTOMATIC")}this.isOtherInputAddress=Sd.isNotIn(this.inputChannel.toString(),[null,"_sum/EssSoc","_sum/GridActivePower","_sum/ProductionActivePower"])})}onInputChannelValueChange(e){return ae(this,null,function*(){let n=yield this.edge.getChannel(this.websocket,y.fromString(this.component.properties.inputChannelAddress));this.unitOfInputChannel=n?.unit??null;let i=this.inputChannel();this.dependentOnLabel=this.createDependenOnLabel(i,e),this.setSwitchValues(i,e)})}setSwitchValues(e,n){let i=this.getPropertyThreshold(n);switch(this.switchValue=i.toString(),e.toString()){case"_sum/EssSoc":this.switchConverter=M.CONVERT_TO_PERCENT;break;case"_sum/ProductionActivePower":this.switchConverter=M.CONVERT_TO_WATT;break;case"_sum/GridActivePower":i<0?this.outputChannelValue==0?this.switchValue=(i*-1).toString():this.outputChannelValue==1&&(this.switchValue=(i*-1-this.component.properties.switchedLoadPower).toString()):i>0&&(this.outputChannelValue===1&&(this.switchValue=(i-this.component.properties.switchedLoadPower).toString()),this.switchConverter=M.CONVERT_TO_WATT);break;default:i<0?this.switchValue=M.multiplySafely(this.component.properties.threshold,-1)+this.unitOfInputChannel!==""?this.unitOfInputChannel:"":i>0&&(this.switchValue+=this.unitOfInputChannel!==""?this.unitOfInputChannel:""),this.switchConverter=M.CONVERT_TO_WATT;break}let a=ds.getChannel(this.outputChannel,n?.allComponents??null);this.switchState=t.createSwitchStateLabel(this.invert(),a,i,this.translate)}createDependenOnLabel(e,n){switch(e.toString()){case"_sum/EssSoc":return this.translate.instant("GENERAL.SOC");case"_sum/GridActivePower":return this.getPropertyThreshold(n)<0?this.translate.instant("GENERAL.GRID_SELL"):this.translate.instant("GENERAL.GRID_BUY");case"_sum/ProductionActivePower":return this.translate.instant("GENERAL.PRODUCTION");default:return this.translate.instant("EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.OTHER")+" ("+e+")"}}getPropertyThreshold(e){let n=this.component.id+"/_PropertyThreshold";return e&&n in e.allComponents?e.allComponents[n]:this.component.getPropertyFromComponent("threshold")}getPropertyInvert(e){let n=this.component.id+"/_PropertyInvert";return e&&n in e.allComponents?e.allComponents[n]:this.component.getPropertyFromComponent("invert")}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["oe-controller-io-channelsinglethreshold"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"title","icon"],["button","",3,"click","title","icon"],[3,"name","value"],["leftColumnWidth","20",3,"name","value","filter"],[3,"name","value","filter"],[3,"converter","name","value"]],template:function(n,i){n&1&&f(0,KG,6,13,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})(),Wo=(function(t){return t[t.OFF=0]="OFF",t[t.ON=1]="ON",t})(Wo||{}),QG=[{propertyThresholdPositive:!0,invert:!0,outputChannelValue:Wo.OFF,label:"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_BELOW"},{propertyThresholdPositive:!0,invert:!0,outputChannelValue:Wo.ON,label:"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_BELOW"},{propertyThresholdPositive:!0,invert:!1,outputChannelValue:Wo.OFF,label:"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_ABOVE"},{propertyThresholdPositive:!0,invert:!1,outputChannelValue:Wo.ON,label:"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_ABOVE"},{propertyThresholdPositive:!1,invert:!0,outputChannelValue:Wo.OFF,label:"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_ABOVE"},{propertyThresholdPositive:!1,invert:!0,outputChannelValue:Wo.ON,label:"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_ABOVE"},{propertyThresholdPositive:!1,invert:!1,outputChannelValue:Wo.OFF,label:"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_BELOW"},{propertyThresholdPositive:!1,invert:!1,outputChannelValue:Wo.ON,label:"EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.SWITCH_ON_BELOW"}];function JG(t,o){t&1&&(Y(0),h(1," EDGE.INDEX.WIDGETS.HEAT_PUMP.UNDEFINED "),z())}function eP(t,o){t&1&&(Y(0),h(1," EDGE.INDEX.WIDGETS.HEAT_PUMP.LOCK "),z())}function tP(t,o){t&1&&(Y(0),h(1," EDGE.INDEX.WIDGETS.HEAT_PUMP.NORMAL_OPERATION "),z())}function nP(t,o){t&1&&(Y(0),h(1," EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_REC "),z())}function iP(t,o){t&1&&(Y(0),h(1," EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_COM "),z())}function oP(t,o){t&1&&(s(0,"td",23),G(1,JG,2,0,"ng-container",24)(2,eP,2,0,"ng-container",24)(3,tP,2,0,"ng-container",24)(4,nP,2,0,"ng-container",24)(5,iP,2,0,"ng-container",24),l()),t&2&&(r(),c("ngSwitchCase",-1),r(),c("ngSwitchCase",0),r(),c("ngSwitchCase",1),r(),c("ngSwitchCase",2),r(),c("ngSwitchCase",3))}function rP(t,o){t&1&&(s(0,"td",25),d(1,"ion-icon",26),l())}function aP(t,o){t&1&&(s(0,"td",23),h(1," GENERAL.MANUALLY "),l())}function sP(t,o){t&1&&(s(0,"td",23),h(1," GENERAL.AUTOMATIC "),l())}function lP(t,o){if(t&1&&(s(0,"table",8)(1,"tr",18)(2,"td",19),h(3,"GENERAL.STATE"),l(),G(4,oP,6,5,"td",20)(5,rP,2,0,"td",21),l(),s(6,"tr")(7,"td",19),h(8,"GENERAL.MODE"),l(),G(9,aP,2,0,"td",22)(10,sP,2,0,"td",22),l()()),t&2){let e=o.ngIf,n=p(2);r(),c("ngSwitch",e[n.component.id+"/Status"]),r(3),c("ngIf",e[n.component.id+"/State"]!==3),r(),c("ngIf",e[n.component.id+"/State"]===3),r(4),c("ngIf",n.component.properties.mode==="MANUAL"),r(),c("ngIf",n.component.properties.mode==="AUTOMATIC")}}function cP(t,o){if(t&1){let e=W();s(0,"ion-card-content")(1,"ion-list")(2,"ion-item",27),O("click",function(){P(e);let i=p(3);return L(i.updateManualMode("FORCE_ON"))}),s(3,"ion-label",28),h(4),g(5,"translate"),l(),s(6,"ion-toggle",29),O("keydown.enter",function(){P(e);let i=p(3);return L(i.updateManualMode("FORCE_ON"))}),l()(),s(7,"ion-item",27),O("click",function(){P(e);let i=p(3);return L(i.updateManualMode("RECOMMENDATION"))}),s(8,"ion-label",28),h(9),g(10,"translate"),l(),s(11,"ion-toggle",30),O("keydown.enter",function(){P(e);let i=p(3);return L(i.updateManualMode("RECOMMENDATION"))}),l()(),s(12,"ion-item",27),O("click",function(){P(e);let i=p(3);return L(i.updateManualMode("REGULAR"))}),s(13,"ion-label",28),h(14),g(15,"translate"),l(),s(16,"ion-toggle",30),O("keydown.enter",function(){P(e);let i=p(3);return L(i.updateManualMode("REGULAR"))}),l()(),s(17,"ion-item",27),O("click",function(){P(e);let i=p(3);return L(i.updateManualMode("LOCK"))}),s(18,"ion-label",28),h(19),g(20,"translate"),l(),s(21,"ion-toggle",30),O("keydown.enter",function(){P(e);let i=p(3);return L(i.updateManualMode("LOCK"))}),l()()()()}if(t&2){let e=p(3);r(4),N(E(5,8,"EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_COM")),r(2),c("checked",e.formGroup.value.manualState==="FORCE_ON"),r(3),N(E(10,10,"EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_REC")),r(2),c("checked",e.formGroup.value.manualState==="RECOMMENDATION"),r(3),N(E(15,12,"EDGE.INDEX.WIDGETS.HEAT_PUMP.NORMAL_OPERATION")),r(2),c("checked",e.formGroup.value.manualState==="REGULAR"),r(3),N(E(20,14,"EDGE.INDEX.WIDGETS.HEAT_PUMP.LOCK")),r(2),c("checked",e.formGroup.value.manualState==="LOCK")}}function mP(t,o){if(t&1&&(Y(0),G(1,cP,22,16,"ion-card-content",5),z()),t&2){let e=p(2);r(),c("ngIf",e.formGroup.value.workMode!=="NONE")}}function pP(t,o){t&1&&(s(0,"table",8)(1,"tr")(2,"td",41)(3,"ion-text",42),h(4," EDGE.INDEX.WIDGETS.HEAT_PUMP.MORE_THAN_MAX_POWER "),l()()()())}function dP(t,o){t&1&&(s(0,"table",8)(1,"tr")(2,"td",41)(3,"ion-text",42),h(4," EDGE.INDEX.WIDGETS.HEAT_PUMP.MORE_THAN_MAX_POWER "),l()()()())}function uP(t,o){if(t&1){let e=W();Y(0),s(1,"ion-card-content",6)(2,"ion-item",27),O("click",function(){P(e);let i=p(2);return L(i.updateAutomaticEnableMode(i.formGroup.controls.automaticRecommendationCtrlEnabled.value!==!0,"automaticRecommendationCtrlEnabled"))}),s(3,"ion-label",28),h(4),g(5,"translate"),l(),d(6,"ion-toggle",31),l(),s(7,"table",8)(8,"tr")(9,"td",19),h(10," EDGE.INDEX.WIDGETS.HEAT_PUMP.GRID_SELL "),l(),s(11,"td",25)(12,"ion-item",32),d(13,"ion-input",33),l()()()(),G(14,pP,5,0,"table",7),l(),s(15,"ion-card-content",6)(16,"ion-item",27),O("click",function(){P(e);let i=p(2);return L(i.updateAutomaticEnableMode(i.formGroup.controls.automaticForceOnCtrlEnabled.value!==!0,"automaticForceOnCtrlEnabled"))}),s(17,"ion-label",28),h(18),g(19,"translate"),l(),d(20,"ion-toggle",31),l(),Y(21),s(22,"table",8)(23,"tr")(24,"td",19),h(25," EDGE.INDEX.WIDGETS.HEAT_PUMP.GRID_SELL "),l(),s(26,"td",25)(27,"ion-item",32),d(28,"ion-input",34),l()()()(),G(29,dP,5,0,"table",7),s(30,"table",8)(31,"tr")(32,"td",19),h(33," EDGE.INDEX.WIDGETS.HEAT_PUMP.ABOVE_SOC"),l(),s(34,"td",35),h(35),g(36,"unitvalue"),l()()(),s(37,"table",8)(38,"tr")(39,"ion-range",36)(40,"ion-label",37),h(41),g(42,"unitvalue"),l(),s(43,"ion-label",1),h(44),g(45,"unitvalue"),l()()()(),z(),l(),s(46,"ion-card-content",6)(47,"ion-item",27),O("click",function(){P(e);let i=p(2);return L(i.updateAutomaticEnableMode(i.formGroup.controls.automaticLockCtrlEnabled.value!==!0,"automaticLockCtrlEnabled"))}),s(48,"ion-label",28),h(49),g(50,"translate"),l(),d(51,"ion-toggle",31),l(),Y(52),s(53,"table",8)(54,"tr")(55,"td",19),h(56," EDGE.INDEX.WIDGETS.HEAT_PUMP.GRID_BUY "),l(),s(57,"td",25)(58,"ion-item",32),d(59,"ion-input",38),l()()()(),s(60,"table",8)(61,"tr")(62,"td",19),h(63," EDGE.INDEX.WIDGETS.HEAT_PUMP.BELOW_SOC"),l(),s(64,"td",35),h(65),g(66,"unitvalue"),l()()(),s(67,"table",8)(68,"tr")(69,"ion-range",39)(70,"ion-label",37),h(71),g(72,"unitvalue"),l(),s(73,"ion-label",1),h(74),g(75,"unitvalue"),l()()()(),z(),l(),s(76,"ion-card-content",6)(77,"table",8)(78,"tr")(79,"td",19),h(80," EDGE.INDEX.WIDGETS.SINGLETHRESHOLD.MIN_SWITCHING_TIME "),l(),s(81,"td",25)(82,"ion-item",32),d(83,"ion-input",40),l()()()()(),z()}if(t&2){let e=p(2);r(4),N(E(5,14,"EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_REC")),r(2),c("checked",e.formGroup.controls.automaticRecommendationCtrlEnabled.value===!0),r(8),c("ngIf",e.formGroup.controls.automaticRecommendationSurplusPower.dirty),r(4),R("",E(19,16,"EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_COM")," "),r(2),c("checked",e.formGroup.controls.automaticForceOnCtrlEnabled.value===!0),r(9),c("ngIf",e.formGroup.controls.automaticForceOnSurplusPower.dirty),r(6),R(" ",q(36,18,e.formGroup.controls.automaticForceOnSoc.value,"%")," "),r(6),R(" ",q(42,21,0,"%")," "),r(3),R(" ",q(45,24,100,"%")," "),r(5),N(E(50,27,"EDGE.INDEX.WIDGETS.HEAT_PUMP.LOCK")),r(2),c("checked",e.formGroup.controls.automaticLockCtrlEnabled.value),r(14),R(" ",q(66,29,e.formGroup.controls.automaticLockSoc.value,"%")," "),r(6),R(" ",q(72,32,0,"%")," "),r(3),R(" ",q(75,35,100,"%")," ")}}function fP(t,o){if(t&1){let e=W();s(0,"ion-fab",43)(1,"ion-fab-button",3),O("click",function(){P(e);let i=p(2);return L(i.applyChanges())}),d(2,"ion-icon",44),l()()}}function _P(t,o){t&1&&(s(0,"ion-grid"),d(1,"ion-progress-bar",45),l())}function hP(t,o){if(t&1){let e=W();Y(0),s(1,"ion-card-content",6),G(2,lP,11,5,"table",7),g(3,"async"),l(),s(4,"ion-card-content",6)(5,"table",8)(6,"tr")(7,"td",9),h(8," GENERAL.MODE "),l()()(),s(9,"ion-segment",10),O("ionChange",function(i){P(e);let a=p();return L(a.updateControllerMode(i))}),s(10,"ion-segment-button",11)(11,"ion-label"),h(12),g(13,"translate"),l(),d(14,"ion-icon",12),l(),s(15,"ion-segment-button",13)(16,"ion-label",14),h(17),g(18,"translate"),l(),d(19,"ion-icon",15),l()()(),s(20,"form",16),G(21,mP,2,1,"ng-container",5)(22,uP,84,38,"ng-container",5),l(),G(23,fP,3,0,"ion-fab",17)(24,_P,2,0,"ion-grid",5),z()}if(t&2){let e=p();r(2),c("ngIf",E(3,11,e.edge.currentData).channel),r(7),c("value",e.component.properties.mode),r(3),R(" ",E(13,13,"GENERAL.MANUALLY")," "),r(2),c("color",e.component.properties.mode==="MANUAL"?"success":"normal"),r(3),R(" ",E(18,15,"GENERAL.AUTOMATIC")," "),r(2),c("color",e.component.properties.mode==="AUTOMATIC"?"primary":"normal"),r(),c("formGroup",e.formGroup),r(),c("ngIf",e.component.properties.mode==="MANUAL"),r(),c("ngIf",e.component.properties.mode==="AUTOMATIC"),r(),c("ngIf",e.formGroup.dirty),r(),c("ngIf",e.loading===!0)}}var Rg=(()=>{class t{constructor(e,n,i,a,m){this.websocket=e,this.translate=n,this.formBuilder=i,this.modalCtrl=a,this.service=m,this.edge=null,this.component=null,this.formGroup=null,this.loading=!1}ngOnInit(){this.formGroup=this.formBuilder.group({manualState:new K(this.component.properties.manualState),automaticForceOnCtrlEnabled:new K(this.component.properties.automaticForceOnCtrlEnabled),automaticForceOnSoc:new K(this.component.properties.automaticForceOnSoc),automaticForceOnSurplusPower:new K(this.component.properties.automaticForceOnSurplusPower),automaticLockCtrlEnabled:new K(this.component.properties.automaticLockCtrlEnabled),automaticLockGridBuyPower:new K(this.component.properties.automaticLockGridBuyPower),automaticLockSoc:new K(this.component.properties.automaticLockSoc),automaticRecommendationCtrlEnabled:new K(this.component.properties.automaticRecommendationCtrlEnabled),automaticRecommendationSurplusPower:new K(this.component.properties.automaticRecommendationSurplusPower),minimumSwitchingTime:new K(this.component.properties.minimumSwitchingTime)})}updateControllerMode(e){let n=this.component.properties.mode,i=e.detail.value;this.edge!=null&&this.edge.updateComponentConfig(this.websocket,this.component.id,[{name:"mode",value:i}]).then(()=>{this.component.properties.mode=i,this.formGroup.markAsPristine(),this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(a=>{this.component.properties.mode=n,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+a.error.message,"danger"),console.warn(a)})}updateAutomaticEnableMode(e,n){this.formGroup.controls[n].setValue(e),this.formGroup.controls[n].markAsDirty()}updateManualMode(e){this.formGroup.controls.manualState.setValue(e),this.formGroup.controls.manualState.markAsDirty()}applyChanges(){if(this.edge!=null)if(this.edge.roleIsAtLeast("owner"))if(this.formGroup.controls.automaticRecommendationSurplusPower.value<this.formGroup.controls.automaticForceOnSurplusPower.value){let e=[];Object.keys(this.formGroup.controls).forEach((n,i)=>{this.formGroup.controls[n].dirty&&e.push({name:Object.keys(this.formGroup.controls)[i],value:this.formGroup.controls[n].value})}),this.loading=!0,this.edge.updateComponentConfig(this.websocket,this.component.id,e).then(()=>{this.component.properties.manualState=this.formGroup.value.manualState,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success"),this.loading=!1}).catch(n=>{this.formGroup.controls.minTime.setValue(this.component.properties.manualState),this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+n,"danger"),this.loading=!1,console.warn(n)}),this.formGroup.markAsPristine()}else this.service.toast(this.translate.instant("EDGE.INDEX.WIDGETS.HEAT_PUMP.RELATION_ERROR"),"danger");else this.service.toast(this.translate.instant("GENERAL.INSUFFICIENT_RIGHTS"),"danger")}static{this.\u0275fac=function(n){return new(n||t)(x(Ce),x(te),x(Ft),x(he),x(j))}}static{this.\u0275cmp=I({type:t,selectors:[["heatpump-modal"]],inputs:{edge:"edge",component:"component"},standalone:!1,decls:10,vars:2,consts:[[1,"ion-justify-content-center",2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["slot","end"],["key","CONTROLLER_IO_HEAT_PUMP_SG_READY"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],[4,"ngIf"],[1,"underline"],["class","full_width",4,"ngIf"],[1,"full_width"],["translate",""],["scrollable","false",3,"ionChange","value"],["value","MANUAL"],["name","options-outline",2,"width","40px",3,"color"],["value","AUTOMATIC"],[2,"color","var(--ion-color-text)"],["name","sunny-outline",2,"width","40px",3,"color"],[3,"formGroup"],["class","ion-padding-bottom","vertical","bottom","horizontal","center","slot","fixed",4,"ngIf"],[3,"ngSwitch"],["translate","",2,"width","65%"],["style","width:35%","class","align_right","translate","",4,"ngIf"],["style","width:35%","class","align_right",4,"ngIf"],["style","width: 35%","class","align_right","translate","",4,"ngIf"],["translate","",1,"align_right",2,"width","35%"],[4,"ngSwitchCase"],[1,"align_right",2,"width","35%"],["name","help-outline"],["lines","none",1,"ion-no-padding",2,"cursor","pointer",3,"click"],[1,"regularFont"],["button","","tabindex","0","mode","md","slot","end",2,"pointer-events","none",3,"keydown.enter","checked"],["mode","md","slot","end",2,"pointer-events","none",3,"keydown.enter","checked"],["mode","md",3,"checked"],["lines","inset",1,"ion-no-padding"],["id","automaticRecommendationSurplusPower","formControlName","automaticRecommendationSurplusPower","type","number","label","\xA0W",1,"regularFont",2,"text-align","end"],["type","number","formControlName","automaticForceOnSurplusPower","label","\xA0W",1,"regularFont",2,"text-align","end"],[1,"align_right","ion-padding-end",2,"width","35%"],["formControlName","automaticForceOnSoc","pin","","color","dark","min","1","max","100"],["slot","start"],["type","number","formControlName","automaticLockGridBuyPower","label","\xA0W",1,"regularFont",2,"text-align","end"],["formControlName","automaticLockSoc","pin","","color","dark","min","1","max","100"],["formControlName","minimumSwitchingTime","type","number","label","\xA0s",1,"regularFont",2,"text-align","end"],[2,"width","100%"],["color","danger","translate",""],["vertical","bottom","horizontal","center","slot","fixed",1,"ion-padding-bottom"],["size","large","name","checkmark-circle-outline"],["type","indeterminate"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),h(3),l(),s(4,"ion-buttons",1),d(5,"oe-help-button",2),s(6,"ion-button",3),O("click",function(){return i.modalCtrl.dismiss()}),d(7,"ion-icon",4),l()()()(),s(8,"ion-content"),G(9,hP,25,17,"ng-container",5),l()),n&2&&(r(3),N(i.component.alias),r(6),c("ngIf",!i.loading))},dependencies:[yn,ho,Co,cn,Ie,Ke,Ge,Xe,We,je,Wn,Un,Me,xt,ie,nn,J,ne,zn,oi,Ai,ri,ai,He,St,wi,ct,ft,tn,$e,ot,en,Ne,Oi,lt,Ut,V],encapsulation:2})}}return t})();var CP=()=>({color:"normal",name:"flame",size:"medium"});function gP(t,o){if(t&1&&(d(0,"oe-flat-widget-line",1),g(1,"translate")),t&2){let e=p(2);c("name",E(1,2,"GENERAL.STATE"))("value",e.statusValue)}}function EP(t,o){if(t&1&&(s(0,"oe-flat-widget",0),f(1,gP,2,4,"oe-flat-widget-line",1),d(2,"oe-flat-widget-line",1),g(3,"translate"),g(4,"translate"),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("icon",H(10,CP))("title",e.component.alias),r(),_(e.isConnectionSuccessful?1:-1),r(),c("name",E(3,6,"GENERAL.MODE"))("value",E(4,8,e.mode))}}var Og=(()=>{class t extends ce{constructor(){super(...arguments),this.component=null,this.status=new $r(null),this.modalComponent=null}static{this.PROPERTY_MODE="_PropertyMode"}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:Rg,componentProps:{edge:this.edge,component:this.component,status:this.status}}}getChannelAddresses(){return[new y(this.component.id,"Status"),new y(this.component.id,"State"),new y(this.component.id,t.PROPERTY_MODE)]}onCurrentData(e){switch(this.isConnectionSuccessful=e.allComponents[this.componentId+"/State"]!=3,e.allComponents[this.componentId+"/Status"]){case-1:this.statusValue=this.translate.instant("EDGE.INDEX.WIDGETS.HEAT_PUMP.UNDEFINED");break;case 0:this.statusValue=this.translate.instant("EDGE.INDEX.WIDGETS.HEAT_PUMP.LOCK");break;case 1:this.statusValue=this.translate.instant("EDGE.INDEX.WIDGETS.HEAT_PUMP.NORMAL_OPERATION");break;case 2:this.statusValue=this.translate.instant("EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_REC");break;case 3:this.statusValue=this.translate.instant("EDGE.INDEX.WIDGETS.HEAT_PUMP.SWITCH_ON_COM");break}switch(e.allComponents[this.component.id+"/"+t.PROPERTY_MODE]){case"AUTOMATIC":{this.mode=this.translate.instant("GENERAL.AUTOMATIC");break}case"MANUAL":{this.mode=this.translate.instant("GENERAL.MANUALLY");break}}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Io_Heatpump"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",3,"modalComponent","icon","title"],[3,"name","value"]],template:function(n,i){n&1&&f(0,EP,5,11,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();function yP(t,o){if(t&1&&(h(0),g(1,"unitvalue")),t&2){let e=o;R(" ",q(1,1,e>=0?e:0,"W")," ")}}function TP(t,o){if(t&1&&(s(0,"table",6)(1,"tr")(2,"td",7),h(3," GENERAL.MEASURED_VALUE "),l(),s(4,"td",8),f(5,yP,2,4),l()()()),t&2){let e,n=p();r(5),_((e=n[o+"/ActivePower"]||!0)?5:-1,e)}}function IP(t,o){if(t&1&&(s(0,"ion-card-content",5),f(1,TP,6,1,"table",6),l()),t&2){let e,n=p(2);r(),_((e=n.component.properties["meter.id"])?1:-1,e)}}function xP(t,o){if(t&1&&(s(0,"ion-card-content")(1,"form",9)(2,"table",6)(3,"tr")(4,"td",7),h(5," EDGE.INDEX.WIDGETS.PEAKSHAVING.PEAKSHAVING_POWER "),l(),s(6,"td",8)(7,"ion-item",10),d(8,"ion-input",11),l()()()(),s(9,"table",6)(10,"tr")(11,"td",7),h(12," EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE_POWER "),l(),s(13,"td",8)(14,"ion-item",10),d(15,"ion-input",12),l()()()()()()),t&2){let e=p(2);r(),c("formGroup",e.formGroup)}}function SP(t,o){if(t&1&&(f(0,IP,2,1,"ion-card-content",5),g(1,"async"),f(2,xP,16,1,"ion-card-content")),t&2){let e,n=p();_((e=E(1,2,n.edge.currentData).channel)?0:-1,e),r(2),_(n.edge.roleIsAtLeast("owner")?2:-1)}}function AP(t,o){if(t&1){let e=W();s(0,"ion-fab",4)(1,"ion-fab-button",2),O("click",function(){P(e);let i=p();return L(i.applyChanges())}),d(2,"ion-icon",13),l()()}}function wP(t,o){t&1&&(s(0,"ion-grid"),d(1,"ion-progress-bar",14),l())}var Ng=(()=>{class t{constructor(e,n,i,a,m){this.formBuilder=e,this.modalCtrl=n,this.service=i,this.translate=a,this.websocket=m,this.loading=!1}ngOnInit(){this.formGroup=this.formBuilder.group({peakShavingPower:new K(this.component.properties.peakShavingPower,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required])),rechargePower:new K(this.component.properties.rechargePower,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required]))})}applyChanges(){if(this.edge!=null)if(this.edge.roleIsAtLeast("owner")){let e=this.formGroup.controls.peakShavingPower,n=this.formGroup.controls.rechargePower;if(e.valid&&n.valid)if(e.value>=n.value){let i=[];Object.keys(this.formGroup.controls).forEach((a,m)=>{this.formGroup.controls[a].dirty&&i.push({name:Object.keys(this.formGroup.controls)[m],value:this.formGroup.controls[a].value})}),this.loading=!0,this.edge.updateComponentConfig(this.websocket,this.component.id,i).then(()=>{this.component.properties.peakShavingPower=e.value,this.component.properties.rechargePower=n.value,this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(a=>{e.setValue(this.component.properties.peakShavingPower),n.setValue(this.component.properties.rechargePower),this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+a.error.message,"danger"),console.warn(a)}),this.formGroup.markAsPristine()}else this.service.toast(this.translate.instant("EDGE.INDEX.WIDGETS.PEAKSHAVING.RELATION_ERROR"),"danger");else this.service.toast(this.translate.instant("GENERAL.INPUT_NOT_VALID"),"danger")}else this.service.toast(this.translate.instant("GENERAL.INSUFFICIENT_RIGHTS"),"danger")}static{this.\u0275fac=function(n){return new(n||t)(x(Ft),x(he),x(j),x(te),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["symmetricpeakshaving-modal"]],inputs:{component:"component",edge:"edge"},standalone:!1,decls:11,vars:4,consts:[[1,"ion-justify-content-center",2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["slot","end"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],["vertical","bottom","horizontal","end","slot","fixed",1,"ion-padding-bottom"],[1,"underline"],[1,"full_width"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"],[3,"formGroup"],["lines","inset",1,"noPadding"],["type","number","formControlName","peakShavingPower","label","\xA0W",1,"regularFont",2,"text-align","end"],["type","number","formControlName","rechargePower","label","\xA0W",1,"regularFont",2,"text-align","end"],["size","large","name","checkmark-circle-outline"],["type","indeterminate"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),h(3),l(),s(4,"ion-buttons",1)(5,"ion-button",2),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",3),l()()()(),s(7,"ion-content"),f(8,SP,3,4),f(9,AP,3,0,"ion-fab",4),f(10,wP,2,0,"ion-grid"),l()),n&2&&(r(3),N(i.component.alias),r(5),_(i.loading?-1:8),r(),_(i.formGroup.dirty?9:-1),r(),_(i.loading===!0?10:-1))},dependencies:[cn,Ie,Ke,Ge,Xe,We,je,Wn,Un,Me,xt,ie,nn,J,oi,St,ct,tn,ot,en,Ne,lt,Ut],encapsulation:2})}}return t})();var bP=()=>({name:"trending-down-outline",color:"normal"});function DP(t,o){if(t&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),d(3,"oe-flat-widget-line",1),g(4,"translate"),d(5,"oe-flat-widget-line",1),g(6,"translate"),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("title",e.component.alias)("icon",H(18,bP)),r(),c("name",E(2,12,"GENERAL.MEASURED_VALUE"))("converter",e.CONVERT_WATT_TO_KILOWATT)("value",e.activePower),r(2),c("name",E(4,14,"EDGE.INDEX.WIDGETS.PEAKSHAVING.PEAKSHAVING_POWER"))("converter",e.CONVERT_WATT_TO_KILOWATT)("value",e.peakShavingPower),r(2),c("name",E(6,16,"EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE_POWER"))("converter",e.CONVERT_WATT_TO_KILOWATT)("value",e.rechargePower)}}var Mg=(()=>{class t extends ce{constructor(){super(...arguments),this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:Ng,componentProps:{component:this.component,edge:this.edge}}}getChannelAddresses(){return[new y(this.component.properties["meter.id"],"ActivePower"),new y(this.componentId,"_PropertyPeakShavingPower"),new y(this.componentId,"_PropertyRechargePower")]}onCurrentData(e){this.activePower=e.allComponents[this.component.properties["meter.id"]+"/ActivePower"]>=0?e.allComponents[this.component.properties["meter.id"]+"/ActivePower"]:0,this.peakShavingPower=this.component.properties.peakShavingPower,this.rechargePower=this.component.properties.rechargePower}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Symmetric_PeakShaving"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"modalComponent","title","icon"],[3,"name","converter","value"]],template:function(n,i){n&1&&f(0,DP,7,19,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();function OP(t,o){if(t&1&&(h(0),g(1,"unitvalue")),t&2){let e=o;R(" ",q(1,1,e>=0?e:0,"W")," ")}}function NP(t,o){if(t&1&&(s(0,"table",14)(1,"tr")(2,"td",15),h(3," GENERAL.MEASURED_VALUE "),l(),s(4,"td",16),f(5,OP,2,4),l()()()),t&2){let e,n=p();r(5),_((e=n[o+"/ActivePower"]||!0)?5:-1,e)}}function MP(t,o){if(t&1&&(s(0,"ion-card-content",13),f(1,NP,6,1,"table",14),l()),t&2){let e,n=p(2);r(),_((e=n.component.properties["meter.id"])?1:-1,e)}}function FP(t,o){if(t&1&&(s(0,"form",4)(1,"ion-card-content")(2,"ion-row")(3,"ion-col")(4,"ion-label"),h(5),g(6,"translate"),l(),d(7,"ion-checkbox",6),l(),s(8,"ion-col")(9,"ion-label"),h(10),g(11,"translate"),l(),d(12,"ion-checkbox",7),l(),s(13,"ion-col")(14,"ion-label"),h(15),g(16,"translate"),l(),d(17,"ion-checkbox",8),l(),s(18,"ion-col")(19,"ion-label"),h(20),g(21,"translate"),l(),d(22,"ion-checkbox",9),l(),s(23,"ion-col")(24,"ion-label"),h(25),g(26,"translate"),l(),d(27,"ion-checkbox",10),l(),s(28,"ion-col")(29,"ion-label"),h(30),g(31,"translate"),l(),d(32,"ion-checkbox",11),l(),s(33,"ion-col")(34,"ion-label"),h(35),g(36,"translate"),l(),d(37,"ion-checkbox",12),l()()(),f(38,MP,2,1,"ion-card-content",13),g(39,"async"),s(40,"ion-card-content",13)(41,"table",14)(42,"tr")(43,"td",15),h(44," EDGE.INDEX.WIDGETS.PEAKSHAVING.PEAKSHAVING_POWER "),l(),s(45,"td",16)(46,"ion-item",17),d(47,"ion-input",18),l()()()(),s(48,"table",14)(49,"tr")(50,"td",15),h(51," EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE_POWER "),l(),s(52,"td",16)(53,"ion-item",17),d(54,"ion-input",19),l()()()(),s(55,"table",14)(56,"tr")(57,"td",15),h(58," EDGE.INDEX.WIDGETS.PEAKSHAVING.HYSTERESIS_SO_C "),l(),s(59,"td",16)(60,"ion-item",17),d(61,"ion-input",20),l()()()()(),s(62,"ion-card-content",13)(63,"table",14)(64,"tr")(65,"td",15),h(66," EDGE.INDEX.WIDGETS.PEAKSHAVING.START_DATE "),l(),s(67,"td",16)(68,"ion-item",17),d(69,"ion-input",21),l()()(),s(70,"tr")(71,"td",15),h(72," EDGE.INDEX.WIDGETS.PEAKSHAVING.END_DATE "),l(),s(73,"td",16)(74,"ion-item",17),d(75,"ion-input",22),l()()()()(),s(76,"ion-card-content",13)(77,"table",14)(78,"tr")(79,"td",15),h(80," EDGE.INDEX.WIDGETS.PEAKSHAVING.START_TIME"),l(),s(81,"td",16)(82,"ion-item",17),d(83,"ion-input",23),l()()(),s(84,"tr")(85,"td",15),h(86," EDGE.INDEX.WIDGETS.PEAKSHAVING.END_TIME"),l(),s(87,"td",16)(88,"ion-item",17),d(89,"ion-input",24),l()()()()(),s(90,"ion-card-content",13)(91,"table",14)(92,"tr")(93,"td",15),h(94," EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE "),l(),s(95,"td",16)(96,"ion-item",17),d(97,"ion-input",25),l()()(),s(98,"tr")(99,"td",15),h(100," EDGE.INDEX.WIDGETS.PEAKSHAVING.START_TIME_CHARGE "),l(),s(101,"td",16)(102,"ion-item",17),d(103,"ion-input",26),l()()()()()()),t&2){let e,n=p();c("formGroup",n.formGroup),r(5),N(E(6,9,"EDGE.HISTORY.MON")),r(5),N(E(11,11,"EDGE.HISTORY.TUE")),r(5),N(E(16,13,"EDGE.HISTORY.WED")),r(5),N(E(21,15,"EDGE.HISTORY.THU")),r(5),N(E(26,17,"EDGE.HISTORY.FRI")),r(5),N(E(31,19,"EDGE.HISTORY.SAT")),r(5),N(E(36,21,"EDGE.HISTORY.SUN")),r(3),_((e=E(39,23,n.edge.currentData).channel)?38:-1,e)}}function GP(t,o){if(t&1){let e=W();s(0,"ion-fab",5)(1,"ion-fab-button",2),O("click",function(){P(e);let i=p();return L(i.applyChanges())}),d(2,"ion-icon",27),l()()}}function PP(t,o){t&1&&(s(0,"ion-grid"),d(1,"ion-progress-bar",28),l())}var Fg=(()=>{class t{static{this.SELECTOR="timeslotpeakshaving-modal"}constructor(e,n,i,a,m){this.formBuilder=e,this.modalCtrl=n,this.service=i,this.translate=a,this.websocket=m,this.component=null,this.edge=null,this.loading=!1}ngOnInit(){this.formGroup=this.formBuilder.group({peakShavingPower:new K(this.component.properties.peakShavingPower,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required])),rechargePower:new K(this.component.properties.rechargePower,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required])),hysteresisSoc:new K(this.component.properties.hysteresisSoc,le.compose([le.pattern("^(100|[1-9]?[0-9])$"),le.required])),slowChargePower:new K(this.component.properties.slowChargePower*-1),slowChargeStartTime:new K(this.component.properties.slowChargeStartTime,le.compose([le.pattern("^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"),le.required])),startDate:new K(this.component.properties.startDate,le.compose([le.pattern("^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)[0-9]{2}$"),le.required])),startTime:new K(this.component.properties.startTime,le.compose([le.pattern("^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"),le.required])),endDate:new K(this.component.properties.endDate),endTime:new K(this.component.properties.endTime,le.compose([le.pattern("^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"),le.required])),monday:new K(this.component.properties.monday),tuesday:new K(this.component.properties.tuesday),wednesday:new K(this.component.properties.wednesday),thursday:new K(this.component.properties.thursday),friday:new K(this.component.properties.friday),saturday:new K(this.component.properties.saturday),sunday:new K(this.component.properties.sunday)})}applyChanges(){if(this.edge!=null)if(this.edge.roleIsAtLeast("owner")){let e=this.formGroup.controls.peakShavingPower,n=this.formGroup.controls.rechargePower;if(e.valid&&n.valid)if(e.value>=n.value){let i=[];Object.keys(this.formGroup.controls).forEach((a,m)=>{this.formGroup.controls[a].dirty&&(Object.keys(this.formGroup.controls)[m]=="slowChargePower"?i.push({name:Object.keys(this.formGroup.controls)[m],value:this.formGroup.controls[a].value*-1}):i.push({name:Object.keys(this.formGroup.controls)[m],value:this.formGroup.controls[a].value}))}),this.loading=!0,this.edge.updateComponentConfig(this.websocket,this.component.id,i).then(()=>{this.component.properties.peakShavingPower=e.value,this.component.properties.rechargePower=n.value,this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(a=>{e.setValue(this.component.properties.peakShavingPower),n.setValue(this.component.properties.rechargePower),this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+a.error.message,"danger"),console.warn(a)}),this.formGroup.markAsPristine()}else this.service.toast(this.translate.instant("EDGE.INDEX.WIDGETS.PEAKSHAVING.RELATION_ERROR"),"danger");else this.service.toast(this.translate.instant("GENERAL.INPUT_NOT_VALID"),"danger")}else this.service.toast(this.translate.instant("GENERAL.INSUFFICIENT_RIGHTS"),"danger")}static{this.\u0275fac=function(n){return new(n||t)(x(Ft),x(he),x(j),x(te),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["timeslotpeakshaving-modal"]],inputs:{component:"component",edge:"edge"},standalone:!1,decls:11,vars:4,consts:[[1,"ion-justify-content-center",2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["slot","end"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],[3,"formGroup"],["vertical","bottom","horizontal","end","slot","fixed",1,"ion-padding-bottom"],["formControlName","monday"],["formControlName","tuesday"],["formControlName","wednesday"],["formControlName","thursday"],["formControlName","friday"],["formControlName","saturday"],["formControlName","sunday"],[1,"underline"],[1,"full_width"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"],["lines","inset",1,"noPadding"],["type","number","formControlName","peakShavingPower","label","\xA0W",1,"regularFont",2,"text-align","end"],["type","number","formControlName","rechargePower","label","\xA0W",1,"regularFont",2,"text-align","end"],["type","number","formControlName","hysteresisSoc","label","\xA0%",1,"regularFont",2,"text-align","end"],["type","text","formControlName","startDate",1,"regularFont",2,"text-align","end"],["type","text","formControlName","endDate",1,"regularFont",2,"text-align","end"],["type","text","formControlName","startTime",1,"regularFont",2,"text-align","end"],["type","text","formControlName","endTime",1,"regularFont",2,"text-align","end"],["type","number","formControlName","slowChargePower","label","\xA0W",1,"regularFont",2,"text-align","end"],["type","text","formControlName","slowChargeStartTime",1,"regularFont",2,"text-align","end"],["size","large","name","checkmark-circle-outline"],["type","indeterminate"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),h(3),l(),s(4,"ion-buttons",1)(5,"ion-button",2),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",3),l()()()(),s(7,"ion-content"),f(8,FP,104,25,"form",4),f(9,GP,3,0,"ion-fab",5),f(10,PP,2,0,"ion-grid"),l()),n&2&&(r(3),N(i.component.alias),r(5),_(i.loading?-1:8),r(),_(i.formGroup.dirty?9:-1),r(),_(i.loading===!0?10:-1))},dependencies:[cn,Ie,Ke,Ge,Xe,We,zt,Ae,je,Wn,Un,Me,xt,ie,nn,J,ne,oi,Se,St,ct,ft,tn,Bn,ot,en,Ne,lt,Ut,V],encapsulation:2})}}return t})();var LP=()=>({name:"trending-down-outline",color:"normal"}),Gg=(()=>{class t extends ce{constructor(){super(...arguments),this.CONVERT_WATT_TO_KILOWATT=M.CONVERT_WATT_TO_KILOWATT,this.modalComponent=null}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:Fg,componentProps:{component:this.component,edge:this.edge}}}getChannelAddresses(){return[new y(this.component.properties["meter.id"],"ActivePower"),new y(this.componentId,"_PropertyPeakShavingPower"),new y(this.componentId,"_PropertyRechargePower")]}onCurrentData(e){this.activePower=e.allComponents[this.component.properties["meter.id"]+"/ActivePower"]>=0?e.allComponents[this.component.properties["meter.id"]+"/ActivePower"]:0,this.peakShavingPower=this.component.properties.peakShavingPower,this.rechargePower=this.component.properties.rechargePower}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Controller_Symmetric_TimeSlot_PeakShaving"]],standalone:!1,features:[S],decls:7,vars:19,consts:[[3,"modalComponent","title","icon"],[3,"name","converter","value"]],template:function(n,i){n&1&&(s(0,"oe-flat-widget",0),d(1,"oe-flat-widget-line",1),g(2,"translate"),d(3,"oe-flat-widget-line",1),g(4,"translate"),d(5,"oe-flat-widget-line",1),g(6,"translate"),l()),n&2&&(c("modalComponent",i.modalComponent)("title",i.component.alias)("icon",H(18,LP)),r(),c("name",E(2,12,"GENERAL.MEASURED_VALUE"))("converter",i.CONVERT_WATT_TO_KILOWATT)("value",i.activePower),r(2),c("name",E(4,14,"EDGE.INDEX.WIDGETS.PEAKSHAVING.PEAKSHAVING_POWER"))("converter",i.CONVERT_WATT_TO_KILOWATT)("value",i.peakShavingPower),r(2),c("name",E(6,16,"EDGE.INDEX.WIDGETS.PEAKSHAVING.RECHARGE_POWER"))("converter",i.CONVERT_WATT_TO_KILOWATT)("value",i.rechargePower))},dependencies:[pe,we,V],encapsulation:2})}}return t})();function VP(t,o){if(t&1){let e=W();s(0,"ion-fab",12)(1,"ion-fab-button",2),O("click",function(){P(e);let i=p(2);return L(i.applyChanges())}),d(2,"ion-icon",13),l()()}}function HP(t,o){if(t&1&&(s(0,"form",4)(1,"ion-card-content",5)(2,"table",6)(3,"tr")(4,"td",7),h(5," EDGE.INDEX.WIDGETS.DELAYED_SELL_TO_GRID.SELL_TO_GRID_POWER_LIMIT "),l(),s(6,"td",8)(7,"ion-item",9),d(8,"ion-input",10),l()()()()(),s(9,"ion-card-content",5)(10,"table",6)(11,"tr")(12,"td",7),h(13," EDGE.INDEX.WIDGETS.DELAYED_SELL_TO_GRID.CONTINUOUS_SELL_TO_GRID_POWER "),l(),s(14,"td",8)(15,"ion-item",9),d(16,"ion-input",11),l()()()()(),f(17,VP,3,0,"ion-fab",12),l()),t&2){let e=p();c("formGroup",e.formGroup),r(17),_(e.formGroup.dirty?17:-1)}}function BP(t,o){t&1&&(s(0,"ion-grid"),d(1,"ion-progress-bar",14),l())}var Pg=(()=>{class t{static{this.SELECTOR="delayedselltogrid-modal"}constructor(e,n,i,a,m){this.formBuilder=e,this.modalCtrl=n,this.service=i,this.translate=a,this.websocket=m,this.loading=!1}ngOnInit(){this.formGroup=this.formBuilder.group({continuousSellToGridPower:new K(this.component.properties.continuousSellToGridPower,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required])),sellToGridPowerLimit:new K(this.component.properties.sellToGridPowerLimit,le.compose([le.pattern("^(?:[1-9][0-9]*|0)$"),le.required]))})}applyChanges(){if(this.edge!=null)if(this.edge.roleIsAtLeast("owner")){let e=this.formGroup.controls.continuousSellToGridPower,n=this.formGroup.controls.sellToGridPowerLimit;if(e.valid&&n.valid)if(n.value>e.value){let i=[];Object.keys(this.formGroup.controls).forEach((a,m)=>{this.formGroup.controls[a].dirty&&i.push({name:Object.keys(this.formGroup.controls)[m],value:this.formGroup.controls[a].value})}),this.loading=!0,this.edge.updateComponentConfig(this.websocket,this.component.id,i).then(()=>{this.component.properties.continuousSellToGridPower=e.value,this.component.properties.sellToGridPowerLimit=n.value,this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(a=>{e.setValue(this.component.properties.continuousSellToGridPower),n.setValue(this.component.properties.sellToGridPowerLimit),this.loading=!1,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+a.error.message,"danger"),console.warn(a)}),this.formGroup.markAsPristine()}else this.service.toast(this.translate.instant("EDGE.INDEX.WIDGETS.DELAYED_SELL_TO_GRID.RELATION_ERROR"),"danger");else this.service.toast(this.translate.instant("GENERAL.INPUT_NOT_VALID"),"danger")}else this.service.toast(this.translate.instant("GENERAL.INSUFFICIENT_RIGHTS"),"danger")}static{this.\u0275fac=function(n){return new(n||t)(x(Ft),x(he),x(j),x(te),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["delayedselltogrid-modal"]],inputs:{component:"component",edge:"edge"},standalone:!1,decls:10,vars:3,consts:[[1,"ion-justify-content-center",2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["slot","end"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],[3,"formGroup"],[1,"underline"],[1,"full_width"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"],["lines","inset",1,"noPadding"],["type","number","formControlName","sellToGridPowerLimit","label","\xA0W",1,"regularFont",2,"text-align","end"],["type","number","formControlName","continuousSellToGridPower","label","\xA0W",1,"regularFont",2,"text-align","end"],["vertical","bottom","horizontal","end","slot","fixed",1,"ion-padding-bottom"],["size","large","name","checkmark-circle-outline"],["type","indeterminate"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),h(3),l(),s(4,"ion-buttons",1)(5,"ion-button",2),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",3),l()()()(),s(7,"ion-content"),f(8,HP,18,2,"form",4),f(9,BP,2,0,"ion-grid"),l()),n&2&&(r(3),N(i.component.alias),r(5),_(i.loading?-1:8),r(),_(i.loading===!0?9:-1))},dependencies:[cn,Ie,Ke,Ge,Xe,We,je,Wn,Un,Me,xt,ie,nn,J,oi,St,ct,tn,ot,en,Ne],encapsulation:2})}}return t})();function WP(t,o){if(t&1&&(s(0,"ion-card-content",4),Y(1),s(2,"table",5)(3,"tr")(4,"td",6),h(5," EDGE.INDEX.WIDGETS.DELAYED_SELL_TO_GRID.SELL_TO_GRID_POWER_LIMIT "),l(),s(6,"td",7),h(7),g(8,"unitvalue"),l()(),s(9,"tr")(10,"td",6),h(11," EDGE.INDEX.WIDGETS.DELAYED_SELL_TO_GRID.CONTINUOUS_SELL_TO_GRID_POWER "),l(),s(12,"td",7),h(13),g(14,"unitvalue"),l()()(),z(),l()),t&2){let e=p(2);r(7),R(" ",q(8,2,e.component.properties.sellToGridPowerLimit,"kW")," "),r(6),R(" ",q(14,5,e.component.properties.continuousSellToGridPower,"kW")," ")}}function UP(t,o){if(t&1){let e=W();s(0,"ion-card",1),O("click",function(){P(e);let i=p();return L(i.presentModal())})("keydown.enter",function(){P(e);let i=p();return L(i.presentModal())}),s(1,"ion-item",2),d(2,"ion-icon",3),s(3,"ion-label"),h(4),l()(),f(5,WP,15,8,"ion-card-content",4),g(6,"async"),l()}if(t&2){let e,n=p();r(4),N(n.component.alias),r(),_((e=E(6,2,n.edge.currentData).channel)?5:-1,e)}}var Lg=(()=>{class t{static{this.SELECTOR="delayedselltogrid"}constructor(e,n,i,a,m){this.route=e,this.websocket=n,this.translate=i,this.modalCtrl=a,this.service=m,this.edge=null,this.component=null}ngOnInit(){this.service.getCurrentEdge().then(e=>{this.edge=e,this.service.getConfig().then(n=>{this.component=n.getComponent(this.componentId)})})}ngOnDestroy(){this.edge.unsubscribeChannels(this.websocket,t.SELECTOR)}presentModal(){return ae(this,null,function*(){return yield(yield this.modalCtrl.create({component:Pg,componentProps:{component:this.component,edge:this.edge}})).present()})}static{this.\u0275fac=function(n){return new(n||t)(x(De),x(Ce),x(te),x(he),x(j))}}static{this.\u0275cmp=I({type:t,selectors:[["delayedselltogrid"]],inputs:{componentId:"componentId"},standalone:!1,decls:1,vars:1,consts:[["button","","tabindex","0"],["button","","tabindex","0",3,"click","keydown.enter"],["lines","full","color","light"],["slot","start","size","large","color","normal","name","trending-down-outline"],[1,"underline"],[1,"full_width"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"]],template:function(n,i){n&1&&f(0,UP,7,4,"ion-card",0),n&2&&_(i.component?0:-1)},dependencies:[Ht,We,ie,J,ne,Ne,lt,Ut],encapsulation:2})}}return t})();function jP(t,o){t&1&&d(0,"ion-progress-bar",1)}function YP(t,o){if(t&1&&d(0,"canvas",2),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("colors",e.colors)}}var kg=(()=>{class t{static{this.SELECTOR="evcsChart"}constructor(e,n){this.translate=e,this.modalController=n,this.evcsConfigMap={},this.loading=!0}getMaxPower(){let n=this.currentData[this.componentId+"/MaximumHardwarePower"],i=this.currentData[this.componentId+"/ChargePower"];n=n==null?22:n/1e3,i=i==null?0:i/1e3;let a=i<22||n;return Math.round(a)}ngOnInit(){this.options=$P,this.options.scales.yAxes[0].ticks.max=this.getMaxPower(),this.labels=["Ladeleistung"],this.datasets=[{data:[],label:""}]}ngOnChanges(e){this.updateChart()}updateChart(){if(this.datasets==null){this.loading=!0;return}this.loading=!0;let e=0;for(let n in this.evcsMap){let a=this.edge.currentData.value.channel[n+"/ChargePower"]/1e3,m=this.evcsConfigMap[n].properties.alias;this.datasets[e]==null?this.datasets.push({label:m,data:[a??0]}):m==""?this.datasets[e].label=n:(this.datasets[e].label=m,this.datasets[e].data=[a??0]),e++}this.loading=!1}static{this.\u0275fac=function(n){return new(n||t)(x(te),x(he))}}static{this.\u0275cmp=I({type:t,selectors:[["evcsChart"]],inputs:{evcsMap:"evcsMap",edge:"edge",currentData:"currentData",evcsConfigMap:"evcsConfigMap",componentId:"componentId"},standalone:!1,features:[En],decls:3,vars:2,consts:[[2,"max-width","600px","max-height","500px","width","100%","height","250px","position","relative"],["type","indeterminate"],["baseChart","","chartType","bar",3,"datasets","labels","options","colors"]],template:function(n,i){n&1&&(s(0,"div",0),f(1,jP,1,0,"ion-progress-bar",1),f(2,YP,1,4,"canvas",2),l()),n&2&&(r(),_(i.loading?1:-1),r(),_(i.loading?-1:2))},dependencies:[ye,oi],encapsulation:2})}}return t})(),$P={maintainAspectRatio:!1,legend:{position:"bottom"},elements:{point:{radius:0,hitRadius:0,hoverRadius:0},line:{borderWidth:2,tension:.1}},hover:{mode:"point",intersect:!0},scales:{xAxes:[{stacked:!0}],yAxes:[{scaleLabel:{display:!0,labelString:""},ticks:{beginAtZero:!0,max:50},stacked:!0}]},tooltips:{mode:"index",intersect:!1,axis:"x",title:"Ladeleistung",callbacks:{label(t,o){let e=t.yLabel;return e=parseFloat(e.toFixed(2)),o.datasets[t.datasetIndex].label+": "+e.toLocaleString("de-DE")+" kW"}}},annotation:{annotations:[{type:"line",mode:"horizontal",yScaleID:"y-axis-0",value:33,borderColor:"green",borderWidth:4,label:{enabled:!0,content:"Test label"}}]}};function qP(t,o){t&1&&(s(0,"ion-label"),h(1),l()),t&2&&(r(),R(" ",o," "))}function KP(t,o){t&1&&(s(0,"ion-label"),h(1),g(2,"translate"),l()),t&2&&(r(),R(" ",E(2,1,"EDGE.INDEX.WIDGETS.EVCS.CHARGING_STATION_CLUSTER")," "))}function QP(t,o){t&1&&(s(0,"ion-label"),h(1),l()),t&2&&(r(),R(" ",o.properties.alias," "))}function ZP(t,o){if(t&1&&(s(0,"ion-label"),h(1),l()),t&2){let e=p().$implicit;r(),R(" ",e," ")}}function JP(t,o){if(t&1&&(s(0,"ion-item",19)(1,"ion-text"),h(2),l(),f(3,QP,2,1,"ion-label"),f(4,ZP,2,1,"ion-label"),d(5,"ion-reorder",1),l()),t&2){let e,n=o.$implicit,i=o.$index,a=p(3);ze("data-index",i),r(2),R("",i+1,".\xA0"),r(),_((e=a.evcsConfigMap[n])?3:-1,e),r(),_(a.evcsConfigMap[n]?-1:4)}}function eL(t,o){if(t&1){let e=W();s(0,"ion-slide")(1,"ion-label",6)(2,"ion-header")(3,"ion-toolbar",7)(4,"ion-title",8),h(5," EDGE.INDEX.WIDGETS.EVCS.OVERVIEW_CHARGING_STATIONS "),l(),d(6,"ion-icon",9),l()(),s(7,"ion-item",10)(8,"table",11)(9,"tr")(10,"td",12),h(11,"EDGE.INDEX.WIDGETS.EVCS.AMOUNT_OF_CHARGING_STATIONS "),l(),d(12,"td",13),s(13,"td",14),h(14),l()(),s(15,"tr")(16,"td",15)(17,"ion-label"),h(18),g(19,"translate"),l()(),d(20,"td",13),s(21,"td",14),h(22),l()()()(),s(23,"ion-item",16),d(24,"evcsChart",17),l(),s(25,"ion-label")(26,"ion-label"),h(27),g(28,"translate"),l(),h(29,": "),s(30,"ion-reorder-group",18),O("ionItemReorder",function(i){P(e);let a=p(2);return L(a.doReorder(i))}),fe(31,JP,6,4,"ion-item",19,xe),l()()()()}if(t&2){let e=p(),n=p();r(14),R(" ",n.evcsAmount," "),r(4),R(" ",E(19,9,"EDGE.INDEX.WIDGETS.EVCS.TOTAL_CHARGING_POWER")," "),r(4),R(" ",e[n.componentId+"/ChargePower"]," W "),r(2),c("evcsMap",n.evcsMap)("edge",n.edge)("currentData",e)("evcsConfigMap",n.evcsConfigMap)("componentId",n.componentId),r(3),N(E(28,11,"EDGE.INDEX.WIDGETS.EVCS.PRIORITIZATION")),r(4),_e(n.prioritizedEvcsList)}}function tL(t,o){if(t&1){let e=W();s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),f(3,qP,2,1,"ion-label"),f(4,KP,3,3,"ion-label"),l(),s(5,"ion-buttons",1),d(6,"oe-help-button",2),s(7,"ion-button",3),O("click",function(){P(e);let i=p();return L(i.cancel())}),d(8,"ion-icon",4),l()()()(),s(9,"ion-content")(10,"ion-slides",5),f(11,eL,33,13,"ion-slide"),l()()}if(t&2){let e,n=p();r(3),_((e=n.config.properties.alias)?3:-1,e),r(),_(n.config.properties.alias?-1:4),r(6),c("options",n.slideOpts),r(),_(n.evcsAmount>1?11:-1)}}var Hm=(()=>{class t{constructor(e,n,i,a,m,u){this.service=e,this.websocket=n,this.router=i,this.route=a,this.translate=m,this.modalCtrl=u,this.config=null,this.evcsMap={},this.swiperIndex=0,this.slideOpts={noSwiping:!0,noSwipingClass:"swiper-no-swiping",initialSlide:0,speed:1e3},this.evcsConfigMap={}}ngOnInit(){this.prioritizedEvcsList=this.config.properties["evcs.ids"],this.evcsAmount=this.prioritizedEvcsList.length,this.lastEvcs=this.prioritizedEvcsList[this.evcsAmount-1],this.firstEvcs=this.prioritizedEvcsList[0],this.service.getConfig().then(e=>{this.prioritizedEvcsList.forEach(n=>{this.evcsConfigMap[n]=e.getComponent(n)})})}doReorder(e){let n=this.prioritizedEvcsList;this.prioritizedEvcsList=e.detail.complete(this.prioritizedEvcsList);let i=this.prioritizedEvcsList;this.edge!=null&&this.edge.updateComponentConfig(this.websocket,this.config.id,[{name:"evcs.ids",value:i}]).then(a=>{this.config.properties.chargeMode=i,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(a=>{this.config.properties.chargeMode=n,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+a.error.message,"danger"),console.warn(a)})}cancel(){this.modalCtrl.dismiss()}updateChargeMode(e,n){let i=n.properties.chargeMode,a;switch(e.detail.value){case"FORCE_CHARGE":a="FORCE_CHARGE";break;case"EXCESS_POWER":a="EXCESS_POWER";break}this.edge!=null&&this.edge.updateComponentConfig(this.websocket,n.id,[{name:"chargeMode",value:a}]).then(m=>{n.properties.chargeMode=a,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(m=>{n.properties.chargeMode=i,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+m.error.message,"danger"),console.warn(m)})}priorityChanged(e,n){let i=n.properties.priority,a;switch(e.detail.value){case"CAR":a="CAR";break;case"STORAGE":a="STORAGE";break}this.edge!=null&&this.edge.updateComponentConfig(this.websocket,n.id,[{name:"priority",value:a}]).then(m=>{n.properties.priority=a,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(m=>{n.properties.priority=i,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+m.error.message,"danger"),console.warn(m)})}updateForceMinPower(e,n,i){let a=n.properties.forceChargeMinPower,m=e.detail.value;m/=i,this.edge!=null&&this.edge.updateComponentConfig(this.websocket,n.id,[{name:"forceChargeMinPower",value:m}]).then(u=>{n.properties.forceChargeMinPower=m,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(u=>{n.properties.forceChargeMinPower=a,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+u.error.message,"danger"),console.warn(u)})}updateDefaultMinPower(e,n){let i=n.properties.defaultChargeMinPower,a=e.detail.value;this.edge!=null&&this.edge.updateComponentConfig(this.websocket,n.id,[{name:"defaultChargeMinPower",value:a}]).then(m=>{n.properties.defaultChargeMinPower=a,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(m=>{n.properties.defaultChargeMinPower=i,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+m.error.message,"danger"),console.warn(m)})}currentLimitChanged(e,n){}allowMinimumChargePower(e,n,i){let a=i.properties.defaultChargeMinPower,m=0;(a==null||a==0)&&(m=n!=null?1400*n:4200),this.edge!=null&&this.edge.updateComponentConfig(this.websocket,i.id,[{name:"defaultChargeMinPower",value:m}]).then(u=>{i.properties.defaultChargeMinPower=m,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(u=>{i.properties.defaultChargeMinPower=a,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+u.error.message,"danger"),console.warn(u)})}enableOrDisableCharging(e,n){let i=n.properties.enabledCharging,a=!i;this.edge!=null&&this.edge.updateComponentConfig(this.websocket,n.id,[{name:"enabledCharging",value:a}]).then(m=>{n.properties.enabledCharging=a,this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(m=>{n.properties.enabledCharging=i,this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+m.error.message,"danger"),console.warn(m)})}getState(e,n,i,a){if(a!=null&&a.properties.enabledCharging!=null&&a.properties.enabledCharging==!1)return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGING_STATION_DEACTIVATED");if(e==null||e==0){if(this.chargeState=n,this.chargePlug=i,this.chargePlug==null){if(this.chargeState==null)return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.NOT_CHARGING")}else if(this.chargePlug!=Vg.PLUGGED_ON_EVCS_AND_ON_EV_AND_LOCKED)return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CABLE_NOT_CONNECTED");switch(this.chargeState){case Uo.STARTING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.STARTING");case Uo.UNDEFINED:case Uo.ERROR:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.ERROR");case Uo.READY_FOR_CHARGING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.READY_FOR_CHARGING");case Uo.NOT_READY_FOR_CHARGING:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.NOT_READY_FOR_CHARGING");case Uo.AUTHORIZATION_REJECTED:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.NOT_CHARGING");case Uo.ENERGY_LIMIT_REACHED:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGE_LIMIT_REACHED");case Uo.CHARGING_FINISHED:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CAR_FULL");default:return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGING")}}return this.translate.instant("EDGE.INDEX.WIDGETS.EVCS.CHARGING")}formatNumber(e){return Math.ceil(e/100)*100}getValueOrThree(e){return e==null||e==null?3:e}currentChargingPower(){return this.sumOfChannel("ChargePower")}sumOfChannel(e){return 0}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(Ce),x(It),x(De),x(te),x(he))}}static{this.\u0275cmp=I({type:t,selectors:[["Evcs_Api_Cluster-modal"]],viewQuery:function(n,i){if(n&1&&wn(ra,7),n&2){let a;bn(a=Dn())&&(i.reorderGroup=a.first)}},inputs:{edge:"edge",config:"config",componentId:"componentId",evcsMap:"evcsMap"},standalone:!1,decls:2,vars:3,consts:[[1,"ion-justify-content-center",2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["slot","end"],["key","EVCS_CLUSTER"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],[3,"options"],[2,"width","100%"],["ion-background","transparent"],["translate","",2,"text-align","center"],["size","large","slot","end","name","arrow-dropright-outline"],["padding-top","","lines","none",1,"normalFontSize"],[1,"full_width"],["translate","",2,"width","50%"],[2,"width","5%"],[1,"align_right",2,"width","45%"],[2,"width","50%"],["padding-bottom","","padding-top","","lines","none"],[2,"width","90%",3,"evcsMap","edge","currentData","evcsConfigMap","componentId"],["disabled","false",3,"ionItemReorder"],["lines","full"]],template:function(n,i){if(n&1&&(f(0,tL,12,4),g(1,"async")),n&2){let a;_((a=E(1,1,i.edge.currentData).channel)?0:-1,a)}},dependencies:[Ge,Xe,je,xt,ie,J,ne,ws,ra,He,St,ct,Ne,Oi,kg,lt,V],encapsulation:2})}}return t})(),Uo=(function(t){return t[t.UNDEFINED=-1]="UNDEFINED",t[t.STARTING=0]="STARTING",t[t.NOT_READY_FOR_CHARGING=1]="NOT_READY_FOR_CHARGING",t[t.READY_FOR_CHARGING=2]="READY_FOR_CHARGING",t[t.CHARGING=3]="CHARGING",t[t.ERROR=4]="ERROR",t[t.AUTHORIZATION_REJECTED=5]="AUTHORIZATION_REJECTED",t[t.ENERGY_LIMIT_REACHED=6]="ENERGY_LIMIT_REACHED",t[t.CHARGING_FINISHED=7]="CHARGING_FINISHED",t})(Uo||{}),Vg=(function(t){return t[t.UNDEFINED=-1]="UNDEFINED",t[t.UNPLUGGED=0]="UNPLUGGED",t[t.PLUGGED_ON_EVCS=1]="PLUGGED_ON_EVCS",t[t.PLUGGED_ON_EVCS_AND_LOCKED=3]="PLUGGED_ON_EVCS_AND_LOCKED",t[t.PLUGGED_ON_EVCS_AND_ON_EV=5]="PLUGGED_ON_EVCS_AND_ON_EV",t[t.PLUGGED_ON_EVCS_AND_ON_EV_AND_LOCKED=7]="PLUGGED_ON_EVCS_AND_ON_EV_AND_LOCKED",t})(Vg||{});var nL=()=>({name:"oe-evcs",color:"normal"});function iL(t,o){if(t&1&&(d(0,"oe-flat-widget-line",3),g(1,"translate")),t&2){let e=p(3);c("name",E(1,3,"EDGE.INDEX.WIDGETS.EVCS.TOTAL_CHARGING_POWER"))("converter",e.CONVERT_TO_WATT)("channelAddress",e.component.id+"/ChargePower")}}function oL(t,o){if(t&1&&(d(0,"oe-flat-widget-line",2),g(1,"translate"),f(2,iL,2,5,"oe-flat-widget-line",3)),t&2){let e=p(2);c("name",E(1,3,"EDGE.INDEX.WIDGETS.EVCS.AMOUNT_OF_CHARGING_STATIONS"))("value",e.evcssInCluster.length),r(2),_(e.isEvcsCluster?-1:2)}}function rL(t,o){t&1&&(d(0,"oe-flat-widget-line",1),g(1,"translate")),t&2&&c("name",E(1,1,"EDGE.INDEX.WIDGETS.EVCS.CLUSTER_CONFIG_ERROR"))}function aL(t,o){if(t&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),f(2,oL,3,5)(3,rL,2,3,"oe-flat-widget-line",1),l()),t&2){let e=p();c("modalComponent",e.modalComponent)("icon",H(6,nL))("title",E(1,4,e.alias)),r(2),_(e.isConnectionSuccessful?2:3)}}var Hg=(()=>{class t extends ce{constructor(){super(...arguments),this.channelAddresses=[],this.evcsIdsInCluster=[],this.evcssInCluster=[],this.evcsComponent=null,this.evcsMap={},this.CONVERT_TO_WATT=M.CONVERT_TO_WATT}get modalComponent(){return{component:Hm,componentProps:{config:this.component,edge:this.edge,componentId:this.componentId,evcsMap:this.evcsMap}}}presentModal(){return ae(this,null,function*(){return yield(yield this.modalController.create({component:Hm,componentProps:{config:this.component,edge:this.edge,componentId:this.componentId,evcsMap:this.evcsMap}})).present()})}getChannelAddresses(){this.evcsIdsInCluster=this.config.components[this.componentId].properties["evcs.ids"];let e="io.openems.edge.evcs.api.Evcs";for(let n of this.config.getComponentsImplementingNature(e))this.evcsIdsInCluster.includes(n.id)&&(this.evcssInCluster.push(n),this.fillChannelAddresses(n.id,this.channelAddresses));return this.channelAddresses.push(new y(this.componentId,"ChargePower"),new y(this.componentId,"Phases"),new y(this.componentId,"Plug"),new y(this.componentId,"Status"),new y(this.componentId,"State"),new y(this.componentId,"EnergySession"),new y(this.componentId,"MinimumHardwarePower"),new y(this.componentId,"MaximumHardwarePower")),this.channelAddresses}onCurrentData(e){this.evcsComponent=this.config.getComponent(this.componentId),this.alias=this.config.components[this.componentId].properties.alias??"EDGE.INDEX.WIDGETS.EVCS.CHARGING_STATION_CLUSTER",this.isConnectionSuccessful=e.allComponents[this.componentId+"/State"]!=3,this.evcssInCluster.forEach(i=>{this.evcsMap[i.id]=null}),this.config.getComponentsByFactory("Controller.Evcs").forEach(i=>{this.evcsIdsInCluster.includes(i.properties["evcs.id"])&&(this.evcsMap[i.properties["evcs.id"]]=i)})}fillChannelAddresses(e,n){n.push(new y(e,"ChargePower"),new y(e,"MaximumHardwarePower"),new y(e,"MinimumHardwarePower"),new y(e,"MaximumPower"),new y(e,"Phases"),new y(e,"Plug"),new y(e,"Status"),new y(e,"State"),new y(e,"EnergySession"),new y(e,"Alias"))}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Evcs_Api_Cluster"]],standalone:!1,features:[S],decls:1,vars:1,consts:[["button","",2,"cursor","pointer",3,"modalComponent","icon","title"],["leftColumnWidth","100",3,"name"],[3,"name","value"],[3,"name","converter","channelAddress"]],template:function(n,i){n&1&&f(0,aL,4,7,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,we,V],encapsulation:2})}}return t})();function lL(t,o){t&1&&d(0,"ion-icon",10)}function cL(t,o){t&1&&d(0,"ion-icon",11)}function mL(t,o){if(t&1&&(s(0,"tr")(1,"td",8),h(2),l(),s(3,"td",9),f(4,lL,1,0,"ion-icon",10)(5,cL,1,0,"ion-icon",11),l()()),t&2){let e=o.$implicit,n=p().$implicit,i=p();r(2),N(e.id),r(2),_(i[n.componentId+"/"+e.id]===0?4:5)}}function pL(t,o){if(t&1&&(s(0,"ion-card-content")(1,"table",5)(2,"tr",6)(3,"td",7),h(4),l()(),fe(5,mL,6,2,"tr",null,xe),l()()),t&2){let e=o.$implicit;r(4),N(e.componentAlias),r(),_e(e.channels)}}function dL(t,o){if(t&1&&fe(0,pL,7,1,"ion-card-content",null,xe),t&2){let e=p(2);_e(e.digitalInputChannelsPerComponent)}}function uL(t,o){if(t&1&&(f(0,dL,2,0),g(1,"async")),t&2){let e;_((e=E(1,1,o.currentData).channel)?0:-1,e)}}var Bg=(()=>{class t{static{this.SELECTOR="Io_Api_DigitalInput_ModalComponent"}constructor(e,n,i){this.service=e,this.modalCtrl=n,this.websocket=i}ngOnInit(){this.getDigitalInputChannels().then(e=>{this.digitalInputChannelsPerComponent=e;let n=this.digitalInputChannelsPerComponent.reduce((i,a)=>[...i,...a.channels.map(m=>new y(a.componentId,m.id))],[]);this.edge.subscribeChannels(this.websocket,t.SELECTOR,n)})}ngOnDestroy(){this.edge.unsubscribeChannels(this.websocket,t.SELECTOR)}getDigitalInputChannels(){return ae(this,null,function*(){return er.hasChannelsInEdgeConfig(this.edge)?this.ioComponents.map(n=>({componentId:n.id,componentAlias:n.alias,channels:Object.entries(n.channels).filter(([i,a])=>!(a.accessMode!=="RO"||a.type!=="BOOLEAN"||i==="_PropertyEnabled")).map(([i,a])=>ke({id:i},a))})):(yield this.edge.sendRequest(this.websocket,new Ci({componentId:"_componentManager",payload:new fL({componentIds:this.ioComponents.map(n=>n.id)})}))).result.channelsPerComponent.map(n=>ke({componentAlias:this.ioComponents.find(i=>i.id==n.componentId)?.alias??n.componentId},n))})}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(he),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["Io_Api_DigitalInputModal"]],inputs:{edge:"edge",ioComponents:"ioComponents"},standalone:!1,decls:9,vars:1,consts:[[1,"ion-justify-content-center",2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["translate",""],["slot","end"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],[1,"full_width"],[1,"underline"],[2,"width","100%"],[2,"width","65%"],[1,"align_right",2,"width","36%"],["name","radio-button-off"],["name","radio-button-on"]],template:function(n,i){if(n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),h(3,"GENERAL.DIGITAL_INPUTS"),l(),s(4,"ion-buttons",2)(5,"ion-button",3),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",4),l()()()(),s(7,"ion-content"),f(8,uL,2,3),l()),n&2){let a;r(8),_((a=i.service.currentEdge())?8:-1,a)}},dependencies:[Ge,Xe,We,je,xt,ie,St,ct,Ne,lt],encapsulation:2})}}return t})(),fL=(()=>{class t extends un{static{this.METHOD="getDigitalInputChannelsOfComponents"}constructor(e){super(t.METHOD,e),this.params=e}}return t})();var _L=()=>({name:"radio-button-off-outline",color:"dark"}),Wg=(()=>{class t extends ce{constructor(){super(...arguments),this.ioComponents=null,this.ioComponentCount=0,this.modalComponent=null}getModalComponent(){return{component:Bg,componentProps:{ioComponents:this.ioComponents,edge:this.edge}}}afterIsInitialized(){this.modalComponent=this.getModalComponent(),this.service.getConfig().then(e=>{this.ioComponents=e.getComponentsImplementingNature("io.openems.edge.io.api.DigitalInput").filter(n=>n.isEnabled),this.ioComponentCount=this.ioComponents.length})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["Io_Api_DigitalInput"]],standalone:!1,features:[S],decls:4,vars:10,consts:[[2,"cursor","pointer",3,"modalComponent","title","icon"],[3,"name","value"]],template:function(n,i){n&1&&(s(0,"oe-flat-widget",0),g(1,"translate"),d(2,"oe-flat-widget-line",1),g(3,"translate"),l()),n&2&&(c("modalComponent",i.modalComponent)("title",E(1,5,"GENERAL.DIGITAL_INPUTS"))("icon",H(9,_L)),r(2),c("name",E(3,7,"GENERAL.NUMBER_OF_COMPONENTS"))("value",i.ioComponentCount))},dependencies:[pe,we,V],encapsulation:2})}}return t})();var Bm=()=>["L1","L2","L3"],CL=()=>({type:"TOGGLE"}),Wm=(t,o,e)=>({targetSoc:t,targetTime:o,targetTimeBuffer:e}),Um=(t,o)=>({date:t,time:o}),zm=(t,o,e,n)=>({targetDate:t,targetTime:o,targetSoc:e,targetTimeBuffer:n}),jm=t=>({targetSoc:t});function gL(t,o){if(t&1&&(s(0,"tr"),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.DISCHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l()()),t&2){let e=p(2).ngVar,n=p(2).$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e,"W")," ")}}function EL(t,o){if(t&1&&(s(0,"tr"),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.CHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l()()),t&2){let e=p(2).ngVar,n=p(2).$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e*-1,"W")," ")}}function vL(t,o){if(t&1&&(Y(0),G(1,gL,11,5,"tr",13)(2,EL,11,5,"tr",13),z()),t&2){let e=p().ngVar;r(),c("ngIf",e>0),r(),c("ngIf",e<=0)}}function yL(t,o){if(t&1&&(Y(0),G(1,vL,3,2,"ng-container",13),z()),t&2){let e=o.ngVar;r(),c("ngIf",e!=null)}}function TL(t,o){if(t&1&&(Y(0),G(1,yL,2,1,"ng-container",23),z()),t&2){let e=p().$implicit,n=p(2).ngVar;r(),c("ngVar",n["effectiveActivePower"+e])}}function IL(t,o){if(t&1&&(s(0,"tr"),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.DISCHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l()()),t&2){let e=p(2).ngVar,n=p(2).$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e,"W")," ")}}function xL(t,o){if(t&1&&(s(0,"tr"),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.CHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l()()),t&2){let e=p(2).ngVar,n=p(2).$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e*-1,"W")," ")}}function SL(t,o){if(t&1&&(Y(0),G(1,IL,11,5,"tr",13)(2,xL,11,5,"tr",13),z()),t&2){let e=p().ngVar;r(),c("ngIf",e>0),r(),c("ngIf",e<=0)}}function AL(t,o){if(t&1&&(Y(0),G(1,SL,3,2,"ng-container",13),z()),t&2){let e=o.ngVar;r(),c("ngIf",e!=null)}}function wL(t,o){if(t&1&&G(0,AL,2,1,"ng-container",23),t&2){let e=p().$implicit,n=p(2).ngVar;c("ngVar",n["activePower"+e])}}function bL(t,o){if(t&1&&(Y(0),G(1,TL,2,1,"ng-container",22)(2,wL,1,1,"ng-template",null,1,yt),z()),t&2){let e=it(3),n=p(6);r(),c("ngIf",(n.chargerComponents==null?null:n.chargerComponents.length)!==0)("ngIfElse",e)}}function DL(t,o){t&1&&(s(0,"table",16),G(1,bL,4,2,"ng-container",14),l()),t&2&&(r(),c("ngForOf",H(1,Bm)))}function RL(t,o){t&1&&(Y(0),d(1,"ion-toggle",35),z()),t&2&&(r(),c("formControlName","isReserveSocEnabled"))}function OL(t,o){t&1&&(d(0,"oe-modal-line",40),g(1,"translate")),t&2&&c("innerHtml",E(1,1,"EDGE.INDEX.WIDGETS.STORAGE.GRID_CHARGE_WARNING"),Vn)}function NL(t,o){if(t&1&&(Y(0),d(1,"oe-modal-horizontal-line")(2,"oe-modal-line",38),g(3,"translate"),G(4,OL,2,3,"oe-modal-line",39),d(5,"oe-modal-horizontal-line"),z()),t&2){let e=p(8);r(2),c("name",E(3,4,"EDGE.INDEX.WIDGETS.STORAGE.GRID_CHARGE"))("formGroup",e.formGroup.controls._meta)("control",H(6,CL)),r(2),c("ngIf",e.hasRequiredEdgeVersion)}}function ML(t,o){if(t&1&&(Y(0),s(1,"ion-range",36)(2,"ion-label",37),h(3),g(4,"unitvalue"),l(),s(5,"ion-label",5),h(6),g(7,"unitvalue"),l()(),G(8,NL,6,7,"ng-container",13),z()),t&2){let e=p(7);r(3),R(" ",q(4,3,5,"%")," "),r(3),R(" ",q(7,6,100,"%")," "),r(2),c("ngIf",e.formGroup.controls._meta&&e.hasRequiredEdgeVersion)}}function FL(t,o){if(t&1&&(Y(0,26)(1),s(2,"table",27)(3,"tr")(4,"ion-item-divider",28)(5,"td",29),h(6," EDGE.INDEX.EMERGENCY_RESERVE.EMERGENCY_RESERVE "),l(),s(7,"td",30),h(8),g(9,"unitvalue"),l(),s(10,"td",30),G(11,RL,2,1,"ng-container",13),l()()()(),s(12,"table",27)(13,"tr")(14,"td",31),d(15,"ion-icon",32),l(),s(16,"td",33)(17,"ion-note",34)(18,"ion-text")(19,"small",4),h(20," EDGE.INDEX.EMERGENCY_RESERVE.INFO_FOR_EMERGENCY_RESERVE_SLIDER "),l()()()()()(),G(21,ML,9,9,"ng-container",13),z()()),t&2){let e=p(3).$implicit,n=p(3);c("formGroupName","emergencyReserveController"),r(8),R(" ",q(9,4,n.formGroup.value[e.id]==null||n.formGroup.value[e.id].emergencyReserveController==null?null:n.formGroup.value[e.id].emergencyReserveController.reserveSoc,"%")," "),r(3),c("ngIf",n.formGroup.controls[e.id].value.emergencyReserveController.hasOwnProperty("isReserveSocEnabled")),r(10),c("ngIf",(n.formGroup.value[e.id]==null||n.formGroup.value[e.id].emergencyReserveController==null?null:n.formGroup.value[e.id].emergencyReserveController.reserveSoc)&&(n.formGroup.value[e.id]==null||n.formGroup.value[e.id].emergencyReserveController==null?null:n.formGroup.value[e.id].emergencyReserveController.isReserveSocEnabled))}}function GL(t,o){if(t&1&&(s(0,"table",27)(1,"tr")(2,"td",31),d(3,"ion-icon",32),l(),s(4,"td",33)(5,"ion-note",34)(6,"ion-text")(7,"small",47),h(8," EDGE.INDEX.RETROFITTING.INFORMATION_FOR_INSTANT_START "),l()()()()()()),t&2){let e=p().ngIf;r(7),c("translateParams",_i(1,Wm,e.targetSoc,e.targetTime,e.targetTimeBuffer))}}function PL(t,o){if(t&1&&(s(0,"ion-label",53),h(1),g(2,"date"),g(3,"date"),g(4,"translate"),l()),t&2){let e=o.ngIf;r(),R(" ",q(4,7,"EDGE.INDEX.RETROFITTING.ON_DATE_AT_TIME",at(10,Um,q(2,1,e,"dd.MM.yyyy"),q(3,4,e,"HH:mm")))," ")}}function LL(t,o){t&1&&(d(0,"ion-icon",54),s(1,"ion-label",53),h(2),g(3,"translate"),l()),t&2&&(r(2),R(" ",E(3,1,"EDGE.INDEX.RETROFITTING.SELECT_A_DATE")," "))}function kL(t,o){if(t&1&&d(0,"ion-datetime",55),t&2){let e=p(12);c("showDefaultButtons",!0)("doneText",e.translate.instant("GENERAL.OK"))("cancelText",e.translate.instant("GENERAL.CANCEL"))("formControlName","targetTime")}}function VL(t,o){if(t&1&&(s(0,"table",16)(1,"tr",48)(2,"td",49)(3,"ion-item",50),G(4,PL,5,13,"ion-label",51)(5,LL,4,3,"ng-template",null,2,yt),s(7,"ion-popover",52),G(8,kL,1,4,"ng-template"),l()()()()()),t&2){let e=it(6),n=p().ngIf;r(4),c("ngIf",n.targetTime)("ngIfElse",e)}}function HL(t,o){if(t&1&&(s(0,"small",47),g(1,"date"),g(2,"date"),h(3," EDGE.INDEX.RETROFITTING.INFORMATION_FOR_PL_ANNED_EXPANSION "),l()),t&2){let e=p(9).$implicit,n=p(3);c("translateParams",Zr(7,zm,q(1,1,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.expectedStartOfPreparation,"dd.MM.yyyy"),q(2,4,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.expectedStartOfPreparation,"HH:mm"),n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetSoc,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetTimeBuffer))}}function BL(t,o){if(t&1&&(s(0,"small",47),h(1," EDGE.INDEX.RETROFITTING.INFORMATION_FOR_PL_ANNED_EXPANSION_INVALID_TARGET_DATE "),l()),t&2){let e=p(9).$implicit,n=p(3);c("translateParams",be(1,jm,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetSoc))}}function WL(t,o){if(t&1&&(s(0,"table",27)(1,"tr")(2,"td",31),d(3,"ion-icon",32),l(),s(4,"td",33)(5,"ion-note",34)(6,"ion-text"),G(7,HL,4,12,"small",56)(8,BL,2,3,"small",56),l()()()()()),t&2){let e=p(8).$implicit,n=p(3);r(7),c("ngIf",!n.isTargetTimeInValid.get(e.id)&&(n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetTimeBuffer)),r(),c("ngIf",n.isTargetTimeInValid.get(e.id))}}function UL(t,o){if(t&1&&(Y(0),s(1,"ion-segment",43)(2,"ion-segment-button",44)(3,"ion-label"),h(4),g(5,"translate"),l()(),s(6,"ion-segment-button",45)(7,"ion-label"),h(8),g(9,"translate"),l()()(),G(10,GL,9,5,"table",46)(11,VL,9,2,"table",20)(12,WL,9,2,"table",46),z()),t&2){let e=o.ngIf;r(),c("formControlName","targetTimeSpecified"),r(3),N(E(5,6,"EDGE.INDEX.RETROFITTING.INSTANT_START")),r(4),N(E(9,8,"EDGE.INDEX.RETROFITTING.PLANNED_EXPANSION")),r(2),c("ngIf",e.targetTimeSpecified==="false"&&e.targetTime&&e.targetSoc&&e.targetTimeBuffer),r(),c("ngIf",e.targetTimeSpecified==="true"),r(),c("ngIf",e.targetTimeSpecified==="true")}}function zL(t,o){if(t&1&&(Y(0),G(1,UL,13,10,"ng-container",13),z()),t&2){let e=p(6).$implicit,n=p(3);r(),c("ngIf",n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController)}}function jL(t,o){if(t&1&&(Y(0),G(1,zL,2,1,"ng-container",13),z()),t&2){let e=p(5).$implicit,n=p(3);r(),c("ngIf",(n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController)!==null)}}function YL(t,o){if(t&1&&(Y(0),G(1,jL,2,1,"ng-container",22),z()),t&2){let e=p(7),n=it(11);r(),c("ngIf",e.controllerIsRequiredEdgeVersion)("ngIfElse",n)}}function $L(t,o){if(t&1&&(Y(0,26),s(1,"table",27)(2,"tr")(3,"ion-item-divider",28)(4,"td",41),h(5," EDGE.INDEX.RETROFITTING.OPTIMAL "),l(),s(6,"td",30),d(7,"ion-toggle",42),l()()()(),G(8,YL,2,2,"ng-container",13),z()),t&2){let e=p(3).$implicit,n=p(3);c("formGroupName","prepareBatteryExtensionController"),r(8),c("ngIf",n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.isRunning)}}function XL(t,o){if(t&1&&(Y(0,26),G(1,FL,22,7,"ng-container",21)(2,$L,9,2,"ng-container",21),z()),t&2){let e=p(2).$implicit,n=p(3);c("formGroupName",e.id),r(),c("ngIf",n.formGroup.value[e.id]==null?null:n.formGroup.value[e.id].emergencyReserveController),r(),c("ngIf",(n.formGroup.value[e.id]==null||n.formGroup.value[e.id].prepareBatteryExtensionController==null?null:n.formGroup.value[e.id].prepareBatteryExtensionController.hasOwnProperty("isRunning"))&&n.isAtLeastInstaller)}}function qL(t,o){if(t&1&&(s(0,"ion-card-content")(1,"table",16),d(2,"div",17),s(3,"tr")(4,"td",18),h(5,"GENERAL.SOC"),l(),s(6,"td",19),h(7),g(8,"unitvalue"),l()(),s(9,"tr")(10,"td",18),h(11,"GENERAL.CHARGE"),l(),s(12,"td",19),h(13),g(14,"unitvalue"),l()(),s(15,"tr")(16,"td",18),h(17,"GENERAL.DISCHARGE"),l(),s(18,"td",19),h(19),g(20,"unitvalue"),l()()(),d(21,"div",17),G(22,DL,2,2,"table",20)(23,XL,3,3,"ng-container",21),l()),t&2){let e=o.ngVar,n=p().$implicit,i=p(3);fi("underline",!i.isLastElement(n,i.essComponents)),r(7),R(" ",q(8,7,e.soc,"%")," "),r(6),N(q(14,10,e.effectivePower<=0?e.effectivePower*-1:null,"W")),r(6),R(" ",q(20,13,e.effectivePower>0?e.effectivePower:null,"W")," "),r(3),c("ngIf",e.activePowerL1!==null&&e.activePowerL2!==null&&e.activePowerL3!==null),r(),c("ngIf",i.formGroup.controls[n.id])}}function KL(t,o){if(t&1&&(Y(0),G(1,qL,24,16,"ion-card-content",15),z()),t&2){let e=p().ngIf;r(),c("ngVar",e.summary.storage)}}function QL(t,o){if(t&1&&(Y(0),G(1,KL,2,1,"ng-container",14),z()),t&2){let e=p(2);r(),c("ngForOf",e.essComponents)}}function ZL(t,o){if(t&1&&(s(0,"tr"),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.DISCHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l()()),t&2){let e=p(2).ngVar,n=p(2).$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e,"W")," ")}}function JL(t,o){if(t&1&&(s(0,"tr"),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.CHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l()()),t&2){let e=p(2).ngVar,n=p(2).$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e*-1,"W")," ")}}function e4(t,o){if(t&1&&(Y(0),G(1,ZL,11,5,"tr",13)(2,JL,11,5,"tr",13),z()),t&2){let e=p().ngVar;r(),c("ngIf",e>0),r(),c("ngIf",e<=0)}}function t4(t,o){if(t&1&&(Y(0),G(1,e4,3,2,"ng-container",13),z()),t&2){let e=o.ngVar;r(),c("ngIf",e!=null)}}function n4(t,o){if(t&1&&(Y(0),G(1,t4,2,1,"ng-container",23),z()),t&2){let e=p().$implicit,n=p(2).ngIf;r(),c("ngVar",n["effectiveActivePower"+e])}}function i4(t,o){if(t&1&&(s(0,"tr"),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.DISCHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l()()),t&2){let e=p(2).ngVar,n=p(2).$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e,"W")," ")}}function o4(t,o){if(t&1&&(s(0,"tr"),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.CHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l()()),t&2){let e=p(2).ngVar,n=p(2).$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e*-1,"W")," ")}}function r4(t,o){if(t&1&&(Y(0),G(1,i4,11,5,"tr",13)(2,o4,11,5,"tr",13),z()),t&2){let e=p().ngVar;r(),c("ngIf",e>0),r(),c("ngIf",e<=0)}}function a4(t,o){if(t&1&&(Y(0),G(1,r4,3,2,"ng-container",13),z()),t&2){let e=o.ngVar;r(),c("ngIf",e!=null)}}function s4(t,o){if(t&1&&G(0,a4,2,1,"ng-container",23),t&2){let e=p().$implicit,n=p(2).ngIf;c("ngVar",n["activePower"+e])}}function l4(t,o){if(t&1&&(Y(0),G(1,n4,2,1,"ng-container",22)(2,s4,1,1,"ng-template",null,1,yt),z()),t&2){let e=it(3),n=p(6);r(),c("ngIf",(n.chargerComponents==null?null:n.chargerComponents.length)!==0)("ngIfElse",e)}}function c4(t,o){t&1&&(s(0,"ion-grid",61)(1,"ion-row",62)(2,"ion-col",63),d(3,"ion-icon",64),l(),s(4,"ion-col",65)(5,"ion-note",66)(6,"small",4),h(7,"EDGE.INDEX.WIDGETS.PHASES_INFO"),l()()()()())}function m4(t,o){if(t&1&&(Y(0),G(1,c4,8,0,"ion-grid",60),z()),t&2){let e=o.ngIf;r(),c("ngIf",e.activePowerL1!==null&&e.activePowerL2!==null&&e.activePowerL3!==null)}}function p4(t,o){if(t&1&&(Y(0),G(1,m4,2,1,"ng-container",13),z()),t&2){let e=o.ngIf;r(),c("ngIf",e.summary.storage)}}function d4(t,o){if(t&1&&(Y(0),G(1,p4,2,1,"ng-container",13),g(2,"async"),z()),t&2){let e=o.ngIf;r(),c("ngIf",E(2,1,e.currentData))}}function u4(t,o){if(t&1&&(Y(0),d(1,"div",17),s(2,"table",16),G(3,l4,4,2,"ng-container",14),l(),G(4,d4,3,3,"ng-container",13),z()),t&2){let e=p(5);r(3),c("ngForOf",H(2,Bm)),r(),c("ngIf",e.service.currentEdge())}}function f4(t,o){if(t&1&&(Y(0),s(1,"table",16)(2,"tr")(3,"td",59),h(4," GENERAL.TOTAL "),l()(),d(5,"div",17),s(6,"tr")(7,"td",18),h(8,"GENERAL.SOC"),l(),s(9,"td",19),h(10),g(11,"unitvalue"),l()(),s(12,"tr")(13,"td",18),h(14,"GENERAL.CHARGE"),l(),s(15,"td",19),h(16),g(17,"unitvalue"),l()(),s(18,"tr")(19,"td",18),h(20,"GENERAL.DISCHARGE"),l(),s(21,"td",19),h(22),g(23,"unitvalue"),l()()(),G(24,u4,5,3,"ng-container",13),z()),t&2){let e=o.ngIf;r(10),R(" ",q(11,4,e.soc,"%")," "),r(6),R(" ",q(17,7,e.effectiveChargePower,"W")," "),r(6),R(" ",q(23,10,e.effectiveDischargePower,"W")," "),r(2),c("ngIf",e.activePowerL1!==null&&e.activePowerL2!==null&&e.activePowerL3!==null)}}function _4(t,o){if(t&1&&(s(0,"ion-card-content",58),G(1,f4,25,13,"ng-container",13),l()),t&2){let e=o.ngIf;r(),c("ngIf",e.summary.storage)}}function h4(t,o){if(t&1&&(s(0,"table",16)(1,"tr")(2,"td",18),h(3,"GENERAL.CHARGE"),l(),s(4,"td",19),h(5),g(6,"unitvalue"),l(),d(7,"td"),l(),s(8,"tr")(9,"td",18),h(10,"GENERAL.DISCHARGE"),l(),s(11,"td",19),h(12),g(13,"unitvalue"),l(),d(14,"td"),l()()),t&2){let e=p().ngVar;r(5),R("",q(6,2,e<=0?e*-1:null,"W")," "),r(7),R("",q(13,5,e>0?e:null,"W")," ")}}function C4(t,o){if(t&1&&(Y(0),G(1,h4,15,8,"table",20),z()),t&2){let e=o.ngVar,n=p().ngIf;r(),c("ngIf",n.natureIds.includes("io.openems.edge.ess.api.SymmetricEss")&&e!==null&&e!==void 0)}}function g4(t,o){if(t&1&&(Y(0),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.DISCHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l(),z()),t&2){let e=p(2).ngVar,n=p().$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e,"W")," ")}}function E4(t,o){if(t&1&&(Y(0),d(1,"td",24),s(2,"td",25)(3,"span",4),h(4,"GENERAL.PHASE"),l(),h(5),s(6,"span",4),h(7,"GENERAL.CHARGE"),l()(),s(8,"td",19),h(9),g(10,"unitvalue"),l(),z()),t&2){let e=p(2).ngVar,n=p().$implicit;r(5),R(" ",n," "),r(4),R(" ",q(10,2,e*-1,"W")," ")}}function v4(t,o){if(t&1&&(s(0,"tr"),G(1,g4,11,5,"ng-container",13)(2,E4,11,5,"ng-container",13),l()),t&2){let e=p().ngVar;r(),c("ngIf",e>0),r(),c("ngIf",e<=0)}}function y4(t,o){if(t&1&&(Y(0),G(1,v4,3,2,"tr",13),z()),t&2){let e=o.ngVar;r(),c("ngIf",e!=null)}}function T4(t,o){if(t&1&&(Y(0),G(1,y4,2,1,"ng-container",23),z()),t&2){let e=o.$implicit,n=p(3).$implicit,i=p().ngIf;r(),c("ngVar",i[n.id+"/ActivePower"+e])}}function I4(t,o){t&1&&(s(0,"table",16),G(1,T4,2,1,"ng-container",14),l()),t&2&&(r(),c("ngForOf",H(1,Bm)))}function x4(t,o){t&1&&(Y(0),d(1,"ion-toggle",69),z()),t&2&&(r(),c("formControlName","isReserveSocEnabled"))}function S4(t,o){t&1&&(Y(0),s(1,"ion-range",36)(2,"ion-label",37),h(3),g(4,"unitvalue"),l(),s(5,"ion-label",5),h(6),g(7,"unitvalue"),l()(),z()),t&2&&(r(3),R(" ",q(4,2,5,"%")," "),r(3),R(" ",q(7,5,100,"%")," "))}function A4(t,o){if(t&1&&(Y(0),s(1,"table",27)(2,"tr")(3,"ion-item-divider",28)(4,"td",29),h(5," EDGE.INDEX.EMERGENCY_RESERVE.EMERGENCY_RESERVE "),l(),s(6,"td",30),h(7),g(8,"unitvalue"),l(),s(9,"td",30),G(10,x4,2,1,"ng-container",13),l()()()(),s(11,"table",27)(12,"tr")(13,"td",31),d(14,"ion-icon",32),l(),s(15,"td",33)(16,"ion-note",34)(17,"ion-text")(18,"small",68),h(19," EDGE.INDEX.EMERGENCY_RESERVE.INFO_FOR_EMERGENCY_RESERVE_SLIDER "),l()()()()()(),G(20,S4,8,8,"ng-container",13),z()),t&2){let e=p(3).$implicit,n=p(4);r(7),R(" ",q(8,3,n.formGroup.value[e.id]==null||n.formGroup.value[e.id].emergencyReserveController==null?null:n.formGroup.value[e.id].emergencyReserveController.reserveSoc,"%")," "),r(3),c("ngIf",n.formGroup.controls[e.id].value.emergencyReserveController.hasOwnProperty("isReserveSocEnabled")),r(10),c("ngIf",(n.formGroup.value[e.id]==null||n.formGroup.value[e.id].emergencyReserveController==null?null:n.formGroup.value[e.id].emergencyReserveController.reserveSoc)&&(n.formGroup.value[e.id]==null||n.formGroup.value[e.id].emergencyReserveController==null?null:n.formGroup.value[e.id].emergencyReserveController.isReserveSocEnabled))}}function w4(t,o){if(t&1&&(s(0,"table",27)(1,"tr")(2,"td",31),d(3,"ion-icon",32),l(),s(4,"td",33)(5,"ion-note",34)(6,"ion-text")(7,"small",47),h(8," EDGE.INDEX.RETROFITTING.INFORMATION_FOR_INSTANT_START "),l()()()()()()),t&2){let e=p().ngIf;r(7),c("translateParams",_i(1,Wm,e.targetSoc,e.targetTime,e.targetTimeBuffer))}}function b4(t,o){if(t&1&&(s(0,"ion-label",53),h(1),g(2,"date"),g(3,"date"),g(4,"translate"),l()),t&2){let e=o.ngIf;r(),R(" ",q(4,7,"EDGE.INDEX.RETROFITTING.ON_DATE_AT_TIME",at(10,Um,q(2,1,e,"dd.MM.yyyy"),q(3,4,e,"HH:mm")))," ")}}function D4(t,o){t&1&&(d(0,"ion-icon",54),s(1,"ion-label",53),h(2),g(3,"translate"),l()),t&2&&(r(2),R(" ",E(3,1,"EDGE.INDEX.RETROFITTING.SELECT_A_DATE")," "))}function R4(t,o){if(t&1&&d(0,"ion-datetime",55),t&2){let e=p(13);c("showDefaultButtons",!0)("doneText",e.translate.instant("GENERAL.OK"))("cancelText",e.translate.instant("GENERAL.CANCEL"))("formControlName","targetTime")}}function O4(t,o){if(t&1&&(s(0,"table",16)(1,"tr",48)(2,"td",49)(3,"ion-item",50),G(4,b4,5,13,"ion-label",51)(5,D4,4,3,"ng-template",null,2,yt),s(7,"ion-popover",52),G(8,R4,1,4,"ng-template"),l()()()()()),t&2){let e=it(6),n=p().ngIf;r(4),c("ngIf",n.targetTime)("ngIfElse",e)}}function N4(t,o){if(t&1&&(s(0,"small",47),g(1,"date"),g(2,"date"),h(3," EDGE.INDEX.RETROFITTING.INFORMATION_FOR_PL_ANNED_EXPANSION "),l()),t&2){let e=p(9).$implicit,n=p(4);c("translateParams",Zr(7,zm,q(1,1,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.expectedStartOfPreparation,"dd.MM.yyyy"),q(2,4,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.expectedStartOfPreparation,"HH:mm"),n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetSoc,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetTimeBuffer))}}function M4(t,o){if(t&1&&(s(0,"small",47),h(1," EDGE.INDEX.RETROFITTING.INFORMATION_FOR_PL_ANNED_EXPANSION_INVALID_TARGET_DATE "),l()),t&2){let e=p(9).$implicit,n=p(4);c("translateParams",be(1,jm,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetSoc))}}function F4(t,o){if(t&1&&(s(0,"table",27)(1,"tr")(2,"td",31),d(3,"ion-icon",32),l(),s(4,"td",33)(5,"ion-note",34)(6,"ion-text"),G(7,N4,4,12,"small",56)(8,M4,2,3,"small",56),l()()()()()),t&2){let e=p(8).$implicit,n=p(4);r(7),c("ngIf",!n.isTargetTimeInValid.get(e.id)&&(n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetTimeBuffer)),r(),c("ngIf",n.isTargetTimeInValid.get(e.id))}}function G4(t,o){if(t&1&&(Y(0),s(1,"ion-segment",43)(2,"ion-segment-button",44)(3,"ion-label",4),h(4,"EDGE.INDEX.RETROFITTING.INSTANT_START"),l()(),s(5,"ion-segment-button",45)(6,"ion-label",4),h(7,"EDGE.INDEX.RETROFITTING.PLANNED_EXPANSION"),l()()(),G(8,w4,9,5,"table",46)(9,O4,9,2,"table",20)(10,F4,9,2,"table",46),z()),t&2){let e=o.ngIf;r(),c("formControlName","targetTimeSpecified"),r(7),c("ngIf",e.targetTimeSpecified==="false"&&e.targetTime&&e.targetSoc&&e.targetTimeBuffer),r(),c("ngIf",e.targetTimeSpecified==="true"),r(),c("ngIf",e.targetTimeSpecified==="true")}}function P4(t,o){if(t&1&&(Y(0),G(1,G4,11,4,"ng-container",13),z()),t&2){let e=p(6).$implicit,n=p(4);r(),c("ngIf",n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController)}}function L4(t,o){if(t&1&&(Y(0),G(1,P4,2,1,"ng-container",13),z()),t&2){let e=p(5).$implicit,n=p(4);r(),c("ngIf",(n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController)!==null)}}function k4(t,o){if(t&1&&(Y(0),G(1,L4,2,1,"ng-container",22),z()),t&2){let e=p(8),n=it(11);r(),c("ngIf",e.controllerIsRequiredEdgeVersion)("ngIfElse",n)}}function V4(t,o){if(t&1&&(Y(0,26),s(1,"table",27)(2,"tr")(3,"ion-item-divider",28)(4,"td",41),h(5," EDGE.INDEX.RETROFITTING.OPTIMAL "),l(),s(6,"td",30),d(7,"ion-toggle",42),l()()()(),G(8,k4,2,2,"ng-container",13),z()),t&2){let e=p(3).$implicit,n=p(4);c("formGroupName","prepareBatteryExtensionController"),r(8),c("ngIf",n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.isRunning)}}function H4(t,o){if(t&1&&(Y(0,26)(1,26),G(2,A4,21,6,"ng-container",13),z(),G(3,V4,9,2,"ng-container",21),z()),t&2){let e=p(2).$implicit,n=p(4);c("formGroupName",e.id),r(),c("formGroupName","emergencyReserveController"),r(),c("ngIf",n.formGroup.value[e.id]==null?null:n.formGroup.value[e.id].emergencyReserveController),r(),c("ngIf",(n.formGroup.value[e.id]==null||n.formGroup.value[e.id].prepareBatteryExtensionController==null?null:n.formGroup.value[e.id].prepareBatteryExtensionController.hasOwnProperty("isRunning"))&&n.isAtLeastInstaller)}}function B4(t,o){if(t&1&&(Y(0),s(1,"ion-card-content")(2,"table",16)(3,"tr")(4,"td",67),h(5),l()(),d(6,"div",17),s(7,"tr")(8,"td",18),h(9,"GENERAL.SOC"),l(),s(10,"td",19),h(11),g(12,"unitvalue"),l()()(),G(13,C4,2,1,"ng-container",23)(14,I4,2,2,"table",20)(15,H4,4,4,"ng-container",21),l(),z()),t&2){let e=o.ngIf,n=p().$implicit,i=p().ngIf,a=p(3);r(),fi("underline",(a.chargerComponents==null?null:a.chargerComponents.length)>0||!a.isLastElement(n,a.essComponents)),r(4),R(" ",n.alias," "),r(6),R(" ",q(12,7,i[n.id+"/Soc"],"%")," "),r(2),c("ngVar",i[n.id+"/ActivePower"]),r(),c("ngIf",e.natureIds.includes("io.openems.edge.ess.api.AsymmetricEss")),r(),c("ngIf",a.formGroup.controls[n.id])}}function W4(t,o){if(t&1&&(Y(0),G(1,B4,16,10,"ng-container",13),z()),t&2){let e=o.$implicit,n=p(4);r(),c("ngIf",n.config.factories[e.factoryId])}}function U4(t,o){if(t&1&&(Y(0),G(1,W4,2,1,"ng-container",14),z()),t&2){let e=p(3);r(),c("ngForOf",e.essComponents)}}function z4(t,o){if(t&1&&(Y(0),G(1,_4,2,1,"ion-card-content",57),g(2,"async"),G(3,U4,2,1,"ng-container",13),g(4,"async"),z()),t&2){let e=p(2);r(),c("ngIf",E(2,2,e.edge.currentData)),r(2),c("ngIf",E(4,4,e.edge.currentData).channel)}}function j4(t,o){if(t&1&&(Y(0),s(1,"tr")(2,"td",67),h(3),l()(),s(4,"tr")(5,"td",70),h(6,"GENERAL.CHARGE"),l(),d(7,"td",71),s(8,"td",19),h(9),g(10,"unitvalue"),l()(),s(11,"tr")(12,"td",70),h(13,"GENERAL.DISCHARGE"),l(),d(14,"td",71),s(15,"td",19),h(16),g(17,"unitvalue"),l()(),z()),t&2){let e=p().ngVar,n=p(2).$implicit;r(3),N(n.alias),r(6),R(" ",q(10,3,e>0?e:null,"W")," "),r(7),R(" ",e<=0?e*-1:q(17,6,null,"W")," ")}}function Y4(t,o){if(t&1&&(Y(0),G(1,j4,18,9,"ng-container",13),z()),t&2){let e=o.ngVar;r(),c("ngIf",e!=null)}}function $4(t,o){if(t&1&&(s(0,"table",16),G(1,Y4,2,1,"ng-container",23),l()),t&2){let e=o.ngIf,n=p().$implicit;r(),c("ngVar",e[n.id+"/ActualPower"])}}function X4(t,o){t&1&&(Y(0),d(1,"ion-toggle",69),z()),t&2&&(r(),c("formControlName","isReserveSocEnabled"))}function q4(t,o){t&1&&(Y(0),s(1,"ion-range",36)(2,"ion-label",37),h(3),g(4,"unitvalue"),l(),s(5,"ion-label",5),h(6),g(7,"unitvalue"),l()(),z()),t&2&&(r(3),R(" ",q(4,2,5,"%")," "),r(3),R(" ",q(7,5,100,"%")," "))}function K4(t,o){if(t&1&&(Y(0),s(1,"table",27)(2,"tr")(3,"ion-item-divider",28)(4,"td",29),h(5," EDGE.INDEX.EMERGENCY_RESERVE.EMERGENCY_RESERVE "),l(),s(6,"td",30),h(7),g(8,"unitvalue"),l(),s(9,"td",30),G(10,X4,2,1,"ng-container",13),l()()()(),s(11,"table",27)(12,"tr")(13,"td",31),d(14,"ion-icon",32),l(),s(15,"td",33)(16,"ion-note",34)(17,"ion-text")(18,"small",68),h(19," EDGE.INDEX.EMERGENCY_RESERVE.INFO_FOR_EMERGENCY_RESERVE_SLIDER "),l()()()()()(),G(20,q4,8,8,"ng-container",13),z()),t&2){let e=p(2).$implicit,n=p(3);r(7),R(" ",q(8,3,n.formGroup.value[e.id]==null||n.formGroup.value[e.id].emergencyReserveController==null?null:n.formGroup.value[e.id].emergencyReserveController.reserveSoc,"%")," "),r(3),c("ngIf",n.formGroup.controls[e.id].value.emergencyReserveController.hasOwnProperty("isReserveSocEnabled")),r(10),c("ngIf",(n.formGroup.value[e.id]==null||n.formGroup.value[e.id].emergencyReserveController==null?null:n.formGroup.value[e.id].emergencyReserveController.reserveSoc)&&(n.formGroup.value[e.id]==null||n.formGroup.value[e.id].emergencyReserveController==null?null:n.formGroup.value[e.id].emergencyReserveController.isReserveSocEnabled))}}function Q4(t,o){if(t&1&&(s(0,"table",27)(1,"tr")(2,"td",31),d(3,"ion-icon",32),l(),s(4,"td",33)(5,"ion-note",34)(6,"ion-text")(7,"small",47),h(8," EDGE.INDEX.RETROFITTING.INFORMATION_FOR_INSTANT_START "),l()()()()()()),t&2){let e=p().ngIf;r(7),c("translateParams",_i(1,Wm,e.targetSoc,e.targetTime,e.targetTimeBuffer))}}function Z4(t,o){if(t&1&&(s(0,"ion-label",53),h(1),g(2,"date"),g(3,"date"),g(4,"translate"),l()),t&2){let e=o.ngIf;r(),R(" ",q(4,7,"EDGE.INDEX.RETROFITTING.ON_DATE_AT_TIME",at(10,Um,q(2,1,e,"dd.MM.yyyy"),q(3,4,e,"HH:mm")))," ")}}function J4(t,o){t&1&&(d(0,"ion-icon",54),s(1,"ion-label",53),h(2),g(3,"translate"),l()),t&2&&(r(2),R(" ",E(3,1,"EDGE.INDEX.RETROFITTING.SELECT_A_DATE")," "))}function ek(t,o){if(t&1&&d(0,"ion-datetime",55),t&2){let e=p(11);c("showDefaultButtons",!0)("doneText",e.translate.instant("GENERAL.OK"))("cancelText",e.translate.instant("GENERAL.CANCEL"))("formControlName","targetTime")}}function tk(t,o){if(t&1&&(s(0,"table",16)(1,"tr",48)(2,"td",49)(3,"ion-item",50),G(4,Z4,5,13,"ion-label",51)(5,J4,4,3,"ng-template",null,2,yt),s(7,"ion-popover",52),G(8,ek,1,4,"ng-template"),l()()()()()),t&2){let e=it(6),n=p().ngIf;r(4),c("ngIf",n.targetTime)("ngIfElse",e)}}function nk(t,o){if(t&1&&(s(0,"small",47),g(1,"date"),g(2,"date"),h(3," EDGE.INDEX.RETROFITTING.INFORMATION_FOR_PL_ANNED_EXPANSION "),l()),t&2){let e=p(8).$implicit,n=p(3);c("translateParams",Zr(7,zm,q(1,1,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.expectedStartOfPreparation,"dd.MM.yyyy"),q(2,4,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.expectedStartOfPreparation,"HH:mm"),n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetSoc,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetTimeBuffer))}}function ik(t,o){if(t&1&&(s(0,"small",47),h(1," EDGE.INDEX.RETROFITTING.INFORMATION_FOR_PL_ANNED_EXPANSION_INVALID_TARGET_DATE "),l()),t&2){let e=p(8).$implicit,n=p(3);c("translateParams",be(1,jm,n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetSoc))}}function ok(t,o){if(t&1&&(s(0,"table",27)(1,"tr")(2,"td",31),d(3,"ion-icon",32),l(),s(4,"td",33)(5,"ion-note",34)(6,"ion-text"),G(7,nk,4,12,"small",56)(8,ik,2,3,"small",56),l()()()()()),t&2){let e=p(7).$implicit,n=p(3);r(7),c("ngIf",!n.isTargetTimeInValid.get(e.id)&&(n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.targetTimeBuffer)),r(),c("ngIf",n.isTargetTimeInValid.get(e.id))}}function rk(t,o){if(t&1&&(Y(0),s(1,"ion-segment",43)(2,"ion-segment-button",44)(3,"ion-label",4),h(4,"EDGE.INDEX.RETROFITTING.INSTANT_START"),l()(),s(5,"ion-segment-button",45)(6,"ion-label",4),h(7,"EDGE.INDEX.RETROFITTING.PLANNED_EXPANSION"),l()()(),G(8,Q4,9,5,"table",46)(9,tk,9,2,"table",20)(10,ok,9,2,"table",46),z()),t&2){let e=o.ngIf;r(),c("formControlName","targetTimeSpecified"),r(7),c("ngIf",e.targetTimeSpecified==="false"&&e.targetTime&&e.targetSoc&&e.targetTimeBuffer),r(),c("ngIf",e.targetTimeSpecified==="true"),r(),c("ngIf",e.targetTimeSpecified==="true")}}function ak(t,o){if(t&1&&(Y(0),G(1,rk,11,4,"ng-container",13),z()),t&2){let e=p(5).$implicit,n=p(3);r(),c("ngIf",n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController)}}function sk(t,o){if(t&1&&(Y(0),G(1,ak,2,1,"ng-container",13),z()),t&2){let e=p(4).$implicit,n=p(3);r(),c("ngIf",(n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController)!==null)}}function lk(t,o){if(t&1&&(Y(0),G(1,sk,2,1,"ng-container",22),z()),t&2){let e=p(6),n=it(11);r(),c("ngIf",e.controllerIsRequiredEdgeVersion)("ngIfElse",n)}}function ck(t,o){if(t&1&&(Y(0,26),s(1,"table",27)(2,"tr")(3,"ion-item-divider",28)(4,"td",41),h(5," EDGE.INDEX.RETROFITTING.OPTIMAL "),l(),s(6,"td",30),d(7,"ion-toggle",42),l()()()(),G(8,lk,2,2,"ng-container",13),z()),t&2){let e=p(2).$implicit,n=p(3);c("formGroupName","prepareBatteryExtensionController"),r(8),c("ngIf",n.formGroup.controls[e.id]==null?null:n.formGroup.controls[e.id].value.prepareBatteryExtensionController.isRunning)}}function mk(t,o){if(t&1&&(Y(0,26)(1,26),G(2,K4,21,6,"ng-container",13),z(),G(3,ck,9,2,"ng-container",21),z()),t&2){let e=p().$implicit,n=p(3);c("formGroupName",e.id),r(),c("formGroupName","emergencyReserveController"),r(),c("ngIf",n.formGroup.value[e.id]==null?null:n.formGroup.value[e.id].emergencyReserveController),r(),c("ngIf",(n.formGroup.value[e.id]==null||n.formGroup.value[e.id].prepareBatteryExtensionController==null?null:n.formGroup.value[e.id].prepareBatteryExtensionController.hasOwnProperty("isRunning"))&&n.isAtLeastInstaller)}}function pk(t,o){if(t&1&&(Y(0),s(1,"ion-card-content"),G(2,$4,2,1,"table",20),g(3,"async"),G(4,mk,4,4,"ng-container",21),l(),z()),t&2){let e=o.$implicit,n=p(3);r(),fi("underline",!n.isLastElement(e,n.chargerComponents)),r(),c("ngIf",E(3,4,n.edge.currentData).channel),r(2),c("ngIf",n.formGroup.controls[e.id])}}function dk(t,o){if(t&1&&(Y(0),G(1,pk,5,6,"ng-container",14),z()),t&2){let e=p(2);r(),c("ngForOf",e.chargerComponents)}}function uk(t,o){if(t&1&&(s(0,"form",12),G(1,QL,2,1,"ng-container",13),g(2,"async"),G(3,z4,5,6,"ng-container",13)(4,dk,2,1,"ng-container",13),l()),t&2){let e=p();c("formGroup",e.formGroup),r(),c("ngIf",E(2,4,(e.essComponents==null?null:e.essComponents.length)===1&&e.edge.currentData)),r(2),c("ngIf",(e.essComponents==null?null:e.essComponents.length)>1),r(),c("ngIf",(e.chargerComponents==null?null:e.chargerComponents.length)!==0&&(e.essComponents==null?null:e.essComponents.length)!==1)}}function fk(t,o){if(t&1){let e=W();s(0,"table",27)(1,"tr")(2,"td")(3,"ion-text")(4,"span",4),h(5," EDGE.INDEX.RETROFITTING.UPDATE_TO_NEW_VERSION "),l(),h(6," \u2192 "),s(7,"a",72),g(8,"translate"),O("click",function(){P(e);let i=p();return L(i.modalCtrl.dismiss())}),l()()()()()}if(t&2){let e=p();r(7),c("routerLink",Ui("/device/",e.edge.id,"/settings/system"))("innerHtml",E(8,3,"EDGE.INDEX.SYSTEMUPDATE"),Vn)}}function _k(t,o){if(t&1){let e=W();s(0,"ion-fab",73)(1,"ion-fab-button",7),O("click",function(){P(e);let i=p();return L(i.applyChanges())}),d(2,"ion-icon",74),l()()}}var Ym=(()=>{class t{constructor(e,n,i,a,m){this.service=e,this.translate=n,this.modalCtrl=i,this.websocket=a,this.formBuilder=m,this.component=null,this.isLastElement=M.isLastElement,this.formGroup=new hi({}),this.isTargetTimeInValid=new Map,this.controllerIsRequiredEdgeVersion=!1,this.hasRequiredEdgeVersion=!1,this.essComponents=null,this.environment=pt}ngOnInit(){this.edge.getFirstValidConfig(this.websocket).then(e=>{this.config=e,this.essComponents=this.config.getComponentsImplementingNature("io.openems.edge.ess.api.SymmetricEss").filter(u=>u.isEnabled&&!this.config.getNatureIdsByFactoryId(u.factoryId).includes("io.openems.edge.ess.api.MetaEss")),this.chargerComponents=this.config.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger").filter(u=>u.isEnabled),this.controllerIsRequiredEdgeVersion=this.edge.isVersionAtLeast("2023.2.5"),this.isAtLeastInstaller=this.edge.roleIsAtLeast(Rt.INSTALLER);let n=this.config.getComponentsByFactory("Controller.Ess.EmergencyCapacityReserve"),i=this.config.getComponentsByFactory("Controller.Ess.PrepareBatteryExtension");this.hasRequiredEdgeVersion=this.edge.isVersionAtLeast("2024.12.3");let a=[...i,...n].filter(u=>u.isEnabled).reduce((u,C)=>{let v=C.properties["ess.id"];return u[v]==null&&(u[v]=[]),u[v].push(C),u},{}),m=[];m.push(...this.chargerComponents.map(u=>new y(u.id,"ActualPower"))),this.hasRequiredEdgeVersion&&m.push(new y("_meta","IsEssChargeFromGridAllowed"));for(let u in i){let C=i[u];m.push(new y(C.id,"_PropertyIsRunning"),new y(C.id,"_PropertyTargetTime"),new y(C.id,"_PropertyTargetTimeSpecified"),new y(C.id,"_PropertyTargetSoc"),new y(C.id,"_PropertyTargetTimeBuffer"),new y(C.id,"ExpectedStartEpochSeconds"))}this.edge.subscribeChannels(this.websocket,"storage",m),this.edge.currentData.subscribe(u=>{let C=new hi({});this.hasRequiredEdgeVersion&&C.addControl("_meta",this.formBuilder.group({isEssChargeFromGridAllowed:new K(u.channel["_meta/IsEssChargeFromGridAllowed"])}));for(let v of Object.keys(a)){let T=a[v],A=new hi({});for(let b of T)if(b.factoryId=="Controller.Ess.EmergencyCapacityReserve"){let F=u.channel[b.id+"/_PropertyReserveSoc"]??20,k=u.channel[b.id+"/_PropertyIsReserveSocEnabled"]==1;A.addControl("emergencyReserveController",this.formBuilder.group({controllerId:new K(b.id),isReserveSocEnabled:new K(k),reserveSoc:new K(F)}))}else if(b.factoryId=="Controller.Ess.PrepareBatteryExtension"){let F=u.channel[b.id+"/_PropertyIsRunning"]==1,k=(u.channel[b.id+"/_PropertyTargetTimeSpecified"]==1).toString(),Q=u.channel[b.id+"/_PropertyTargetTime"],ve=u.channel[b.id+"/_PropertyTargetSoc"],Re=u.channel[b.id+"/_PropertyTargetTimeBuffer"],se=u.channel[b.id+"/ExpectedStartEpochSeconds"],ge=new Date(0);ge.setUTCSeconds(se??0),(!Q||Q==0||isNaN(Date.parse(Q)))&&(Q=null),se==null||se==0?this.isTargetTimeInValid.set(v,!0):vc(new Date(Q),ge)||vc(new Date(Q),new Date)?this.isTargetTimeInValid.set(v,!0):this.isTargetTimeInValid.set(v,!1),A.addControl("prepareBatteryExtensionController",this.formBuilder.group({controllerId:new K(b.id),isRunning:new K(F),targetTime:new K(Q),targetTimeSpecified:new K(k),targetSoc:new K(ve),targetTimeBuffer:new K(Re),expectedStartOfPreparation:new K(ge)}))}C.addControl(v,A)}this.formGroup.dirty||(this.formGroup=C)})})}applyChanges(){return ae(this,null,function*(){if(this.edge==null)return;let e=new Map;if(this.hasRequiredEdgeVersion){let n=this.formGroup.get("_meta")?.controls??[];for(let i of Object.keys(n))n[i].dirty&&(e.get("_meta")?e.get("_meta").push(new Map().set(i,n[i].value)):e.set("_meta",[new Map().set(i,n[i].value)]))}for(let n in this.formGroup.controls){let i=this.formGroup.controls[n],a=i.get("emergencyReserveController")?.controls??{};for(let u of Object.keys(a))a[u].dirty&&(e.get(a.controllerId.value)?e.get(a.controllerId.value).push(new Map().set(u,a[u].value)):e.set(a.controllerId.value,[new Map().set(u,a[u].value)]));let m=i.get("prepareBatteryExtensionController")?.controls??{};for(let u of Object.keys(m))m[u].dirty&&(e.get(m.controllerId.value)?e.get(m.controllerId.value).push(new Map().set(u,m[u].value)):e.set(m.controllerId.value,[new Map().set(u,m[u].value)]))}for(let n of e.keys()){let i=e.get(n),a=[];i.forEach(m=>{let u=m.keys().next().value,C=m.values().next().value,v=C;u==="targetTime"&&(v=oo.formatToISOZonedDateTime(C)),a.push({name:u,value:v})});try{yield this.edge.updateComponentConfig(this.websocket,n,a),this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success"),this.formGroup.markAsPristine()}catch(m){this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+m,"danger")}}})}ngOnDestroy(){this.edge.unsubscribeChannels(this.websocket,"storage")}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(te),x(he),x(Ce),x(Ft))}}static{this.\u0275cmp=I({type:t,selectors:[["storage-modal"]],inputs:{edge:"edge",component:"component"},standalone:!1,decls:13,vars:2,consts:[["oldControllerVersion",""],["noCharger",""],["noValidTargetTime",""],[2,"--background","var(--ion-color-toolbar-primary)","color","var(--ion-title-color)"],["translate",""],["slot","end"],["key","COMMON_STORAGE"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],[2,"height","100%"],["style","margin-bottom: 15%;","class","align_items",3,"formGroup",4,"ngIf"],["class","ion-padding-bottom","vertical","bottom","horizontal","center","slot","fixed",4,"ngIf"],[1,"align_items",2,"margin-bottom","15%",3,"formGroup"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"underline",4,"ngVar"],[1,"full_width"],[2,"padding-top","5px"],["translate","",2,"width","65%"],[1,"align_right",2,"width","35%"],["class","full_width",4,"ngIf"],[3,"formGroupName",4,"ngIf"],[4,"ngIf","ngIfElse"],[4,"ngVar"],[2,"width","2%"],[2,"width","63%"],[3,"formGroupName"],[1,"full_width",2,"margin-top","2%"],["color","light"],["translate","",2,"width","70%"],[1,"align_right",2,"width","15%"],[2,"width","10%"],["name","information-outline","size","large"],[2,"width","90%"],[1,"ion-text-wrap","ion-align-items-center"],["tabindex","0","mode","md",3,"formControlName"],["formControlName","reserveSoc","pin","","color","primary","min","5","max","100"],["slot","start"],["controlName","isEssChargeFromGridAllowed","leftColumnWidth","100",3,"name","formGroup","control"],[3,"innerHtml",4,"ngIf"],[3,"innerHtml"],["translate","",2,"width","90%"],["mode","md","formControlName","isRunning"],[3,"formControlName"],["value","false"],["value","true"],["class","full_width","style","margin-top: 2%;",4,"ngIf"],["translate","","translate","",3,"translateParams"],[2,"display","block","width","75%","margin-left","12.5%","margin-top","2%"],[2,"width","20%","text-align","center"],["button","true","id","open-date-input"],["style","text-align: center",4,"ngIf","ngIfElse"],["trigger","open-date-input","show-backdrop","false","side","top",2,"--offset-y","0px !important","--height","50%"],[2,"text-align","center"],["name","warning-outline","color","warning"],["presentation","date-time",2,"overflow-y","auto",3,"showDefaultButtons","doneText","cancelText","formControlName"],["translate","","translate","",3,"translateParams",4,"ngIf"],["class","underline",4,"ngIf"],[1,"underline"],["translate","",2,"width","100%"],["class","ion-padding-top",4,"ngIf"],[1,"ion-padding-top"],[1,"ion-justify-content-center","ion-align-items-center"],["size","2",1,"ion-text-center"],["padding-right","","color","primary","size","large","name","alert-outline"],["size","10"],[1,"ion-text-wrap"],[2,"width","100%"],["translate","",2,"color","var(--ion-text-color)"],["mode","md",3,"formControlName"],["translate","",2,"width","20%"],[2,"width","30%"],[3,"click","routerLink","innerHtml"],["vertical","bottom","horizontal","center","slot","fixed",1,"ion-padding-bottom"],["size","large","name","checkmark-circle-outline"]],template:function(n,i){if(n&1){let a=W();s(0,"ion-header")(1,"ion-toolbar",3)(2,"ion-title",4),h(3,"GENERAL.STORAGE_SYSTEM"),l(),s(4,"ion-buttons",5),d(5,"oe-help-button",6),s(6,"ion-button",7),O("click",function(){return P(a),L(i.modalCtrl.dismiss())}),d(7,"ion-icon",8),l()()()(),s(8,"ion-content",9),G(9,uk,5,6,"form",10)(10,fk,9,5,"ng-template",null,0,yt)(12,_k,3,0,"ion-fab",11),l()}n&2&&(r(9),c("ngIf",i.formGroup),r(3),c("ngIf",i.formGroup==null?null:i.formGroup.dirty))},dependencies:[Hn,yn,Vt,sn,xa,cn,Ie,Ke,Ge,Xe,We,Ae,je,zi,Wn,Un,Me,xt,ie,J,ed,ne,qo,Ai,Se,ri,ai,He,St,wi,ct,Yi,ft,tn,$e,bs,ot,en,As,ii,Ne,Oi,lt,$o,Ut,V],encapsulation:2})}}return t})();var hk=()=>({name:"oe-storage",color:"success"});function Ck(t,o){if(t&1&&d(0,"oe-flat-widget-line",2),t&2){let e=p().$implicit;c("name",e.alias)}}function gk(t,o){if(t&1&&(gt(),s(0,"svg"),d(1,"rect",5),l()),t&2){let e=o;r(),Da("x: calc("+(e>98?98:e)+"% + 2px); fill: #0008;")}}function Ek(t,o){if(t&1&&f(0,gk,2,2,":svg:svg"),t&2){let e,n=p();_((e=n.currentReserveSoc)?0:-1,e)}}function vk(t,o){if(t&1&&(s(0,"oe-flat-widget-percentagebar",3),f(1,Ek,1,1),l()),t&2){let e=p().$implicit,n=p(2);c("channelAddress",e.id+"/Soc"),r(),_(n.isEmergencyReserveEnabled[e.id]?1:-1)}}function yk(t,o){if(t&1&&d(0,"oe-flat-widget-percentagebar",3),t&2){let e=p().$implicit;c("channelAddress",e.id+"/Soc")}}function Tk(t,o){if(t&1&&(d(0,"oe-flat-widget-line",6),g(1,"translate"),d(2,"oe-flat-widget-line",6),g(3,"translate")),t&2){let e=p().$implicit,n=p(2);c("name",E(1,6,"GENERAL.CHARGE"))("channelAddress",e.id+"/ActivePower")("converter",n.convertChargePower),r(2),c("name",E(3,8,"GENERAL.DISCHARGE"))("channelAddress",e.id+"/ActivePower")("converter",n.convertDischargePower)}}function Ik(t,o){if(t&1&&(d(0,"oe-flat-widget-line",6),g(1,"translate"),d(2,"oe-flat-widget-line",6),g(3,"translate")),t&2){let e=p().$implicit,n=p(2);c("name",E(1,6,"GENERAL.CHARGE"))("channelAddress",e.id+"/DcDischargePower")("converter",n.convertChargePower),r(2),c("name",E(3,8,"GENERAL.DISCHARGE"))("channelAddress",e.id+"/DcDischargePower")("converter",n.convertDischargePower)}}function xk(t,o){if(t&1&&d(0,"oe-flat-widget-horizontal-line")(1,"oe-flat-widget-line",7),t&2){let e=o;r(),re("color",e.color),c("name",e.text)}}function Sk(t,o){if(t&1&&(f(0,Ck,1,1,"oe-flat-widget-line",2),f(1,vk,2,2,"oe-flat-widget-percentagebar",3)(2,yk,1,1,"oe-flat-widget-percentagebar",3),f(3,Tk,4,10)(4,Ik,4,10),f(5,xk,2,3),d(6,"oe-flat-widget-horizontal-line",4)),t&2){let e,n,i=o.$implicit,a=o.$index,m=p(2);_(m.essComponents.length>1?0:-1),r(),_((e=m.emergencyReserveComponents[i.id])?1:2,e),r(2),_(m.isHybridEss[i.id]?4:3),r(2),_((n=m.possibleBatteryExtensionMessage.get(i.id))?5:-1,n),r(),c("components",m.essComponents)("index",a)}}function Ak(t,o){if(t&1&&(s(0,"oe-flat-widget",1),g(1,"translate"),fe(2,Sk,7,6,null,null,xe),l()),t&2){let e=p();Qr(e.storageIconStyle),c("icon",H(7,hk))("title",E(1,5,"GENERAL.STORAGE_SYSTEM"))("modalComponent",e.modalComponent),r(2),_e(e.essComponents)}}var Ug=(()=>{class t extends ce{constructor(){super(...arguments),this.essComponents=[],this.chargerComponents=[],this.storageIconStyle=null,this.isHybridEss=[],this.emergencyReserveComponents={},this.currentSoc=[],this.isEmergencyReserveEnabled=[],this.possibleBatteryExtensionMessage=new Map,this.modalComponent=null,this.convertChargePower=e=>this.convertPower(M.multiplySafely(e,-1),!0),this.convertDischargePower=e=>this.convertPower(e)}convertPower(e,n){let i=(Ze.getByKey(localStorage.LANGUAGE)??Ze.DEFAULT).i18nLocaleKey;if(e==null)return"-";let a=e/1e3;return a>0?Is(a,i,"1.0-1")+" kW":a==0&&n?"0 kW":"-"}presentModal(){return ae(this,null,function*(){return yield(yield this.modalController.create({component:Ym,componentProps:{edge:this.edge,component:this.component}})).present()})}afterIsInitialized(){this.modalComponent=this.getModalComponent()}getModalComponent(){return{component:Ym,componentProps:{edge:this.edge,component:this.component}}}getChannelAddresses(){let e=[new y("_sum","EssSoc"),new y("_sum","EssActivePowerL1"),new y("_sum","EssActivePowerL2"),new y("_sum","EssActivePowerL3")];this.prepareBatteryExtensionCtrl=this.config.getComponentsByFactory("Controller.Ess.PrepareBatteryExtension").filter(n=>n.isEnabled).reduce((n,i)=>Li(ke({},n),{[i.properties["ess.id"]]:i}),{});for(let n in this.prepareBatteryExtensionCtrl){let i=this.prepareBatteryExtensionCtrl[n];e.push(new y(i.id,"CtrlIsBlockingEss"),new y(i.id,"CtrlIsChargingEss"),new y(i.id,"CtrlIsDischargingEss"),new y(i.id,"_PropertyIsRunning"),new y(i.id,"_PropertyTargetTimeSpecified"),new y(i.id,"_PropertyTargetTime"))}this.emergencyReserveComponents=this.config.getComponentsByFactory("Controller.Ess.EmergencyCapacityReserve").filter(n=>n.isEnabled).reduce((n,i)=>Li(ke({},n),{[i.properties["ess.id"]]:i}),{});for(let n of Object.values(this.emergencyReserveComponents))e.push(new y(n.id,"_PropertyReserveSoc"),new y(n.id,"_PropertyIsReserveSocEnabled"));this.chargerComponents=this.config.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger").filter(n=>n.isEnabled);for(let n of this.chargerComponents)e.push(new y(n.id,"ActualPower"));this.essComponents=this.config.getComponentsImplementingNature("io.openems.edge.ess.api.SymmetricEss").filter(n=>n.isEnabled&&!this.config.getNatureIdsByFactoryId(n.factoryId).includes("io.openems.edge.ess.api.MetaEss"));for(let n of this.config.getComponentsImplementingNature("io.openems.edge.ess.api.SymmetricEss").filter(i=>i.isEnabled&&!this.config.getNatureIdsByFactoryId(i.factoryId).includes("io.openems.edge.ess.api.MetaEss")))this.isHybridEss[n.id]=this.config.getNatureIdsByFactoryId(n.factoryId).includes("io.openems.edge.ess.api.HybridEss"),e.push(new y(n.id,"Soc"),new y(n.id,"Capacity")),this.config.factories[n.factoryId].natureIds.includes("io.openems.edge.ess.api.AsymmetricEss")&&e.push(new y(n.id,"ActivePowerL1"),new y(n.id,"ActivePowerL2"),new y(n.id,"ActivePowerL3"));return e}onCurrentData(e){for(let i in this.prepareBatteryExtensionCtrl){let a=this.prepareBatteryExtensionCtrl[i];this.possibleBatteryExtensionMessage.set(i,this.getBatteryCapacityExtensionStatus(e.allComponents[a.id+"/_PropertyIsRunning"]==1,e.allComponents[a.id+"/CtrlIsBlockingEss"],e.allComponents[a.id+"/CtrlIsChargingEss"],e.allComponents[a.id+"/CtrlIsDischargingEss"],e.allComponents[a.id+"/_PropertyTargetTimeSpecified"],e.allComponents[a.id+"/_PropertyTargetTime"]))}let n=e.allComponents["_sum/EssSoc"];this.storageIconStyle="storage-"+M.getStorageSocSegment(n);for(let i in this.emergencyReserveComponents){let a=this.emergencyReserveComponents[i];a.currentReserveSoc=e.allComponents[a.id+"/_PropertyReserveSoc"],this.isEmergencyReserveEnabled[i]=e.allComponents[a.id+"/_PropertyIsReserveSocEnabled"]==1}}getBatteryCapacityExtensionStatus(e,n,i,a,m,u){if(!e)return null;if(m&&u){let C=dn.stringToDate(u.toString());return{color:"green",text:this.translate.instant("EDGE.INDEX.RETROFITTING.TARGET_TIME_SPECIFIED",{targetDate:dn.toLocaleDateString(C),targetTime:C.toLocaleTimeString()})}}return n!=null&&n==1?{color:"green",text:this.translate.instant("EDGE.INDEX.RETROFITTING.REACHED_TARGET_SOC")}:i!=null&&i==1||a!=null&&a==1?{color:"orange",text:this.translate.instant("EDGE.INDEX.RETROFITTING.PREPARING")}:null}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["storage"]],standalone:!1,features:[S],decls:1,vars:1,consts:[[3,"class","icon","title","modalComponent"],[3,"icon","title","modalComponent"],[3,"name"],[3,"channelAddress"],[3,"components","index"],["y","2","rx","0","ry","0","width","1%","height","18"],[3,"name","channelAddress","converter"],["leftColumnWidth","100",3,"name"]],template:function(n,i){n&1&&f(0,Ak,4,8,"oe-flat-widget",0),n&2&&_(i.isInitialized?0:-1)},dependencies:[pe,Ri,we,Qi,V],encapsulation:2})}}return t})();var bk=["modal"];function Dk(t,o){t&1&&d(0,"energymonitor"),t&2&&ze("tabindex",0)}function Rk(t,o){if(t&1&&(Y(0,11),G(1,Dk,1,1,"energymonitor",12),z()),t&2){let e=o.$implicit;c("ngSwitch",e),r(),c("ngSwitchCase","Energymonitor")}}function Ok(t,o){if(t&1&&d(0,"weather",14),t&2){let e=p().$implicit;c("componentId",e.componentId)}}function Nk(t,o){if(t&1&&(Y(0,11),G(1,Ok,1,1,"weather",13),z()),t&2){let e=o.$implicit;c("ngSwitch",e.name),r(),c("ngSwitchCase","Weather.OpenMeteo")}}function Mk(t,o){t&1&&(s(0,"ion-col",16),d(1,"Common_Autarchy"),l())}function Fk(t,o){t&1&&(s(0,"ion-col",16),d(1,"Common_Selfconsumption"),l())}function Gk(t,o){t&1&&(s(0,"ion-col",16),d(1,"storage"),l())}function Pk(t,o){t&1&&(s(0,"ion-col",16),d(1,"grid"),l())}function Lk(t,o){t&1&&(s(0,"ion-col",16),d(1,"Common_Production"),l())}function kk(t,o){t&1&&(s(0,"ion-col",16),d(1,"consumption"),l())}function Vk(t,o){if(t&1&&(Y(0,11),G(1,Mk,2,0,"ion-col",15)(2,Fk,2,0,"ion-col",15)(3,Gk,2,0,"ion-col",15)(4,Pk,2,0,"ion-col",15)(5,Lk,2,0,"ion-col",15)(6,kk,2,0,"ion-col",15),z()),t&2){let e=o.$implicit;c("ngSwitch",e),r(),c("ngSwitchCase","Common_Autarchy"),r(),c("ngSwitchCase","Common_Selfconsumption"),r(),c("ngSwitchCase","Storage"),r(),c("ngSwitchCase","Grid"),r(),c("ngSwitchCase","Common_Production"),r(),c("ngSwitchCase","Consumption")}}function Hk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Evcs",18),l()),t&2){let e=p(3).$implicit;r(),c("componentId",e.componentId)}}function Bk(t,o){t&1&&(Y(0),G(1,Hk,2,1,"ion-col",15),z()),t&2&&(r(),c("ngSwitchCase","io.openems.edge.evcs.api.Evcs"))}function Wk(t,o){if(t&1&&(Y(0),G(1,Bk,2,1,"ng-container",0),z()),t&2){let e=o.ngIf;r(),c("ngIf",e!=="Evcs.Cluster.PeakShaving"&&e!=="Evcs.Cluster.SelfConsumption")}}function Uk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Evcs_Api_Cluster",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function zk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Evcs_Api_Cluster",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function jk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Channelthreshold",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function Yk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Channelthreshold",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function $k(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Io_FixDigitalOutput",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function Xk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Api_ModbusTcp",18),l()),t&2){let e=p(2).$implicit;r(),c("componentId",e.componentId)}}function qk(t,o){t&1&&(Y(0),G(1,Xk,2,1,"ion-col",15),z()),t&2&&(r(),c("ngSwitchCase","Controller.Api.ModbusTcp.ReadWrite"))}function Kk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_ChpSocComponent",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function Qk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Io_HeatingElement",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function Zk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Heat",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function Jk(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Io_Heatpump",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function e5(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Symmetric_PeakShaving",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function t5(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Asymmetric_PeakShaving",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function n5(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Symmetric_TimeSlot_PeakShaving",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function i5(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"delayedselltogrid",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function o5(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"oe-controller-io-channelsinglethreshold",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function r5(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Ess_TimeOfUseTariff",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function a5(t,o){t&1&&(s(0,"ion-col",16),d(1,"Io_Api_DigitalInput"),l())}function s5(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_EnerixControl",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function l5(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Ess_FixActivePower",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function c5(t,o){if(t&1&&(s(0,"ion-col",16),d(1,"Controller_Ess_GridOptimizedCharge",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function m5(t,o){if(t&1&&(s(0,"ion-col",19),d(1,"weather",18),l()),t&2){let e=p().$implicit;r(),c("componentId",e.componentId)}}function p5(t,o){if(t&1&&(Y(0,11),G(1,Wk,2,1,"ng-container",0)(2,Uk,2,1,"ion-col",15)(3,zk,2,1,"ion-col",15)(4,jk,2,1,"ion-col",15)(5,Yk,2,1,"ion-col",15)(6,$k,2,1,"ion-col",15)(7,qk,2,1,"ng-container",0)(8,Kk,2,1,"ion-col",15)(9,Qk,2,1,"ion-col",15)(10,Zk,2,1,"ion-col",15)(11,Jk,2,1,"ion-col",15)(12,e5,2,1,"ion-col",15)(13,t5,2,1,"ion-col",15)(14,n5,2,1,"ion-col",15)(15,i5,2,1,"ion-col",15)(16,o5,2,1,"ion-col",15)(17,r5,2,1,"ion-col",15)(18,a5,2,0,"ion-col",15)(19,s5,2,1,"ion-col",15)(20,l5,2,1,"ion-col",15)(21,c5,2,1,"ion-col",15)(22,m5,2,1,"ion-col",17),z()),t&2){let e=o.$implicit,n=p(4);c("ngSwitch",e.name),r(),c("ngIf",n.config.components[e.componentId].factoryId),r(),c("ngSwitchCase","Evcs.Cluster.SelfConsumption"),r(),c("ngSwitchCase","Evcs.Cluster.PeakShaving"),r(),c("ngSwitchCase","Controller.ChannelThreshold"),r(),c("ngSwitchCase","io.openems.impl.controller.channelthreshold.ChannelThresholdController"),r(),c("ngSwitchCase","Controller.Io.FixDigitalOutput"),r(),c("ngIf",n.isModbusTcpWidgetAllowed),r(),c("ngSwitchCase","Controller.CHP.SoC"),r(),c("ngSwitchCase","Controller.IO.HeatingElement"),r(),c("ngSwitchCase","io.openems.edge.heat.api.ManagedHeatElement"),r(),c("ngSwitchCase","Controller.Io.HeatPump.SgReady"),r(),c("ngSwitchCase","Controller.Symmetric.PeakShaving"),r(),c("ngSwitchCase","Controller.Asymmetric.PeakShaving"),r(),c("ngSwitchCase","Controller.TimeslotPeakshaving"),r(),c("ngSwitchCase","Controller.Ess.DelayedSellToGrid"),r(),c("ngSwitchCase","Controller.IO.ChannelSingleThreshold"),r(),c("ngSwitchCase","Controller.Ess.Time-Of-Use-Tariff"),r(),c("ngSwitchCase","io.openems.edge.io.api.DigitalInput"),r(),c("ngSwitchCase","Controller.Clever-PV"),r(),c("ngSwitchCase","Controller.Ess.FixActivePower"),r(),c("ngSwitchCase","Controller.Ess.GridOptimizedCharge"),r(),c("ngSwitchCase","Weather.OpenMeteo")}}function d5(t,o){if(t&1&&(s(0,"ion-row",5)(1,"ion-col",6)(2,"ion-grid",7)(3,"ion-row")(4,"ion-col",8),G(5,Rk,2,2,"ng-container",9),l()(),s(6,"ion-row")(7,"ion-col",8),G(8,Nk,2,2,"ng-container",9),l()()()(),s(9,"ion-col",10)(10,"ion-grid",7)(11,"ion-row"),G(12,Vk,7,7,"ng-container",9)(13,p5,23,23,"ng-container",9),l()()()()),t&2){let e=p(3);r(),ze("size-md",8)("size-lg",e.navigationService.position()==="left"?4:3),r(4),c("ngForOf",e.widgets.classes),r(3),c("ngForOf",e.widgets.list),r(4),c("ngForOf",e.widgets.classes),r(),c("ngForOf",e.widgets.list)}}function u5(t,o){if(t&1&&(s(0,"ion-grid"),G(1,d5,14,6,"ion-row",4),l()),t&2){let e=p(2);r(),c("ngIf",e.widgets)}}function f5(t,o){t&1&&(s(0,"ion-grid"),d(1,"ion-progress-bar",20),l())}function _5(t,o){t&1&&(s(0,"ion-grid")(1,"ion-row",21)(2,"ion-col",22),d(3,"oe-offline"),l()()())}function h5(t,o){if(t&1){let e=W();s(0,"oe-navigation-view")(1,"oe-refresh-view",1)(2,"ion-refresher",2),O("ionRefresh",function(i){P(e);let a=p();return L(a.handleRefresh(i))}),d(3,"ion-refresher-content",3),l()(),G(4,u5,2,1,"ion-grid",0)(5,f5,2,0,"ion-grid",0)(6,_5,4,0,"ion-grid",0),l()}if(t&2){let e=p();r(),c("refresh",e.handleRefresh)("show",e.showRefreshDragDown),r(3),c("ngIf",e.edge&&e.edge.isOnline&&e.paddingBottom!==null),r(),c("ngIf",e.edge&&e.edge.isOnline&&!e.edge.subscribeChannelsSuccessful),r(),c("ngIf",e.edge&&!e.edge.isOnline)}}var zg=(()=>{class t{constructor(e,n,i,a,m,u,C){this.route=e,this.service=n,this.utils=i,this.websocket=a,this.dataService=m,this.router=u,this.navigationService=C,this.edge=null,this.config=null,this.widgets=null,this.isModbusTcpWidgetAllowed=!1,this.showRefreshDragDown=!1,this.showNewFooter=!1,this.paddingBottom=null,this.stopOnDestroy=new qt,this.handleRefresh=v=>this.dataService.refresh(v),wt(()=>{let v=this.service.currentEdge(),T=this.navigationService.position();this.paddingBottom=t.calculatePaddingBottom(T),this.edge=v,this.isModbusTcpWidgetAllowed=er.isModbusTcpApiWidgetAllowed(v),this.service.getConfig().then(A=>{this.config=A,this.widgets=A.widgets}),this.checkIfRefreshNeeded()})}static calculatePaddingBottom(e){return 100-Zd.getViewHeight(e)}ionViewWillEnter(){this.widgets?.list&&(this.showNewFooter=this.widgets?.list.filter(e=>e.name=="Evse.Controller.Single"||e.name=="Controller.IO.Heating.Room")?.length>0)}ionViewWillLeave(){this.ngOnDestroy()}ngOnDestroy(){clearInterval(this.interval),this.stopOnDestroy.next(),this.stopOnDestroy.complete()}checkIfRefreshNeeded(){this.interval=setInterval(()=>ae(this,null,function*(){if(this.edge?.isOnline===!1){this.showRefreshDragDown=!1;return}let e=this.dataService.lastUpdated();if(e==null){this.showRefreshDragDown=!0;return}this.showRefreshDragDown=oo.isDifferenceInSecondsGreaterThan(20,new Date,e)}),5e3)}static{this.\u0275fac=function(n){return new(n||t)(x(De),x(j),x(M),x(Ce),x(kt),x(It),x(fn))}}static{this.\u0275cmp=I({type:t,selectors:[["live"]],viewQuery:function(n,i){if(n&1&&wn(bk,5,fo),n&2){let a;bn(a=Dn())&&(i.modal=a.first)}},standalone:!1,decls:1,vars:1,consts:[[4,"ngIf"],["header","",3,"refresh","show"],["mode","ios","slot","fixed",3,"ionRefresh"],["refreshingSpinner","crescent"],["class","ion-justify-content-center ion-no-padding",4,"ngIf"],[1,"ion-justify-content-center","ion-no-padding"],["size","12",1,"ion-no-padding"],[1,"ion-no-padding"],["size","12"],[3,"ngSwitch",4,"ngFor","ngForOf"],["size","12","size-md","8","size-lg","6",1,"ion-no-padding"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","ion-hide-sm-down",3,"componentId",4,"ngSwitchCase"],[1,"ion-hide-sm-down",3,"componentId"],["size","12","size-lg","6","class","ion-no-padding",4,"ngSwitchCase"],["size","12","size-lg","6",1,"ion-no-padding"],["size","12","size-lg","6","class","ion-hide-sm-up ion-no-padding",4,"ngSwitchCase"],[3,"componentId"],["size","12","size-lg","6",1,"ion-hide-sm-up","ion-no-padding"],["type","indeterminate"],[1,"ion-justify-content-center"],["size-xl","8","size-lg","10","size-md","11","size-sm","12"]],template:function(n,i){n&1&&G(0,h5,7,5,"oe-navigation-view",0),n&2&&c("ngIf",i.edge)},dependencies:[Hn,yn,ho,Co,xC,AC,Xl,DC,OC,FC,PC,kC,WC,YC,eg,ig,sg,cg,mg,dg,xg,li,Ae,Me,oi,ia,oa,Se,ic,Ag,wg,bg,Dg,Og,Mg,Gg,Lg,Hg,Wg,Ug],encapsulation:2})}}return t})();var rc=(()=>{class t extends un{static{this.METHOD="getEdges"}constructor(e){super(t.METHOD,e),this.params=e}}return t})();var zo=(function(t){return t.GERMANY="de",t.AUSTRIA="at",t.SWITZERLAND="ch",t.SWEDEN="se",t.CZECH_REPUBLIK="cz",t.NETHERLANDS="nl",t.GREECE="gr",t.LITHUANIA="lt",t})(zo||{}),ac=t=>[{value:zo.GERMANY,label:t.instant("GENERAL.COUNTRY.GERMANY")},{value:zo.AUSTRIA,label:t.instant("GENERAL.COUNTRY.AUSTRIA")},{value:zo.SWITZERLAND,label:t.instant("GENERAL.COUNTRY.SWITZERLAND")},{value:zo.SWEDEN,label:t.instant("GENERAL.COUNTRY.SWEDEN")},{value:zo.NETHERLANDS,label:t.instant("GENERAL.COUNTRY.NETHERLANDS")},{value:zo.CZECH_REPUBLIK,label:t.instant("GENERAL.COUNTRY.CZECH")},{value:zo.GREECE,label:t.instant("GENERAL.COUNTRY.GREECE")},{value:zo.LITHUANIA,label:t.instant("GENERAL.COUNTRY.LITHUANIA")}];function C5(t,o){if(t&1&&(s(0,"form",1)(1,"ion-row",2)(2,"ion-col",3)(3,"ion-item",4),d(4,"ion-checkbox",5,0),l()(),s(6,"ion-col"),d(7,"ion-label",6),l()()()),t&2){let e=p();c("formGroup",e.form.formGroup),r(4),c("slot",(e.attributes==null?null:e.attributes.slot)??"start")("labelPlacement",(e.attributes==null?null:e.attributes.labelPlacement)??e.end)("formControlName",e.form.controlName),r(3),c("innerHTML",e.attributes.text,Vn)}}var sc=(()=>{class t{constructor(){this.attributes=null,this.form=null}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=I({type:t,selectors:[["oe-checkbox"]],inputs:{attributes:"attributes",form:"form"},decls:1,vars:1,consts:[["htmlRef",""],[3,"formGroup"],[1,"ion-align-items-center","ion-padding-top"],["size","auto"],["lines","none"],[1,"ion-white-space-pre-wrap",3,"slot","labelPlacement","formControlName"],[3,"innerHTML"]],template:function(n,i){n&1&&f(0,C5,8,5,"form",1),n&2&&_(i.form?0:-1)},dependencies:[Ve,zt,Ae,J,ne,Se,ft,Mo,cn,Ie,Ke,st,ot,en],encapsulation:2})}}return t})();var E5=t=>({formGroup:t,controlName:"acceptPrivacyPolicy"}),v5=t=>({link:t}),jg=t=>({labelPlacement:"end",text:t}),y5=t=>({formGroup:t,controlName:"acceptAgb"});function T5(t,o){if(t&1&&(Y(0),s(1,"ion-select-option",29),h(2),l(),z()),t&2){let e=o.$implicit;r(),c("value",e.value),r(),N(e.label)}}function I5(t,o){if(t&1&&(Y(0),s(1,"ion-item"),d(2,"ion-input",15),g(3,"translate"),g(4,"translate"),l(),s(5,"ion-item"),d(6,"ion-input",16),g(7,"translate"),g(8,"translate"),l(),s(9,"ion-item"),d(10,"ion-input",17),g(11,"translate"),g(12,"translate"),l(),s(13,"ion-item"),d(14,"ion-input",18),g(15,"translate"),g(16,"translate"),l(),s(17,"ion-item"),d(18,"ion-input",19),g(19,"translate"),g(20,"translate"),l(),s(21,"ion-item")(22,"ion-select",20),g(23,"translate"),G(24,T5,3,2,"ng-container",21),l()(),s(25,"ion-item"),d(26,"ion-input",22),g(27,"translate"),g(28,"translate"),l(),s(29,"ion-item"),d(30,"ion-input",23),g(31,"translate"),g(32,"translate"),l(),s(33,"ion-item"),d(34,"ion-input",24),g(35,"translate"),g(36,"translate"),l(),s(37,"ion-item"),d(38,"ion-input",25),g(39,"translate"),g(40,"translate"),l(),s(41,"ion-item"),d(42,"ion-input",26),g(43,"translate"),g(44,"translate"),l(),d(45,"oe-checkbox",27),g(46,"translate"),d(47,"oe-checkbox",27),g(48,"translate"),s(49,"ion-item"),d(50,"ion-text",28),g(51,"translate"),l(),z()),t&2){let e=p();r(2),c("placeholder",E(3,27,"REGISTER.FORM.FIRSTNAME"))("label",E(4,29,"REGISTER.FORM.FIRSTNAME")+" * "),r(4),c("placeholder",E(7,31,"REGISTER.FORM.LASTNAME"))("label",E(8,33,"REGISTER.FORM.LASTNAME")+" * "),r(4),c("placeholder",E(11,35,"REGISTER.FORM.STREET"))("label",E(12,37,"REGISTER.FORM.STREET")+" * "),r(4),c("placeholder",E(15,39,"REGISTER.FORM.ZIP"))("label",E(16,41,"REGISTER.FORM.ZIP")+" * "),r(4),c("placeholder",E(19,43,"REGISTER.FORM.CITY"))("label",E(20,45,"REGISTER.FORM.CITY")+" * "),r(4),c("label",E(23,47,"REGISTER.FORM.COUNTRY")+" * "),r(2),c("ngForOf",e.countries),r(2),c("placeholder",E(27,49,"REGISTER.FORM.PHONE"))("label",E(28,51,"REGISTER.FORM.PHONE")+" * "),r(4),c("placeholder",E(31,53,"REGISTER.FORM.EMAIL"))("label",E(32,55,"REGISTER.FORM.EMAIL")+" * "),r(4),c("placeholder",E(35,57,"REGISTER.FORM.CONFIRM_EMAIL"))("label",E(36,59,"REGISTER.FORM.CONFIRM_EMAIL")+" * "),r(4),c("placeholder",E(39,61,"REGISTER.FORM.PASSWORD"))("label",E(40,63,"REGISTER.FORM.PASSWORD")+" * "),r(4),c("placeholder",E(43,65,"REGISTER.FORM.CONFIRM_PASSWORD"))("label",E(44,67,"REGISTER.FORM.CONFIRM_PASSWORD")+" * "),r(3),c("form",be(76,E5,e.formGroup))("attributes",be(80,jg,q(46,69,"REGISTER.FORM.USER.ACCEPT_PRIVACY_POLICY",be(78,v5,e.docsLink)))),r(2),c("form",be(82,y5,e.formGroup))("attributes",be(84,jg,E(48,72,"REGISTER.FORM.ACCEPT_AGB"))),r(3),c("innerHTML",E(51,74,"REGISTER.FORM.SUBSCRIBE_NEWSLETTER"),Vn)}}function x5(t,o){if(t&1&&(Y(0),s(1,"ion-select-option",29),h(2),l(),z()),t&2){let e=o.$implicit;r(),c("value",e.value),r(),N(e.label)}}function S5(t,o){if(t&1&&(Y(0),s(1,"ion-item"),d(2,"ion-input",30),g(3,"translate"),g(4,"translate"),l(),s(5,"ion-item"),d(6,"ion-input",15),g(7,"translate"),g(8,"translate"),l(),s(9,"ion-item"),d(10,"ion-input",31),g(11,"translate"),g(12,"translate"),l(),s(13,"ion-item"),d(14,"ion-input",17),g(15,"translate"),g(16,"translate"),l(),s(17,"ion-item"),d(18,"ion-input",18),g(19,"translate"),g(20,"translate"),l(),s(21,"ion-item"),d(22,"ion-input",19),g(23,"translate"),g(24,"translate"),l(),s(25,"ion-item")(26,"ion-select",20),g(27,"translate"),G(28,x5,3,2,"ng-container",21),l()(),s(29,"ion-item"),d(30,"ion-input",22),g(31,"translate"),g(32,"translate"),l(),s(33,"ion-item"),d(34,"ion-input",23),g(35,"translate"),g(36,"translate"),l(),s(37,"ion-item"),d(38,"ion-input",24),g(39,"translate"),g(40,"translate"),l(),s(41,"ion-item"),d(42,"ion-input",25),g(43,"translate"),g(44,"translate"),l(),s(45,"ion-item"),d(46,"ion-input",26),g(47,"translate"),g(48,"translate"),l(),z()),t&2){let e=p();r(2),c("placeholder",E(3,24,"REGISTER.FORM.COMPANY_NAME"))("label",E(4,26,"REGISTER.FORM.COMPANY_NAME")+" * "),r(4),c("placeholder",E(7,28,"REGISTER.FORM.FIRSTNAME"))("label",E(8,30,"REGISTER.FORM.FIRSTNAME")+" * "),r(4),c("placeholder",E(11,32,"REGISTER.FORM.LASTNAME"))("label",E(12,34,"REGISTER.FORM.LASTNAME")+" * "),r(4),c("placeholder",E(15,36,"REGISTER.FORM.STREET"))("label",E(16,38,"REGISTER.FORM.STREET")+" * "),r(4),c("placeholder",E(19,40,"REGISTER.FORM.ZIP"))("label",E(20,42,"REGISTER.FORM.ZIP")+" * "),r(4),c("placeholder",E(23,44,"REGISTER.FORM.CITY"))("label",E(24,46,"REGISTER.FORM.CITY")+" * "),r(4),c("label",E(27,48,"REGISTER.FORM.COUNTRY")+" * "),r(2),c("ngForOf",e.countries),r(2),c("placeholder",E(31,50,"REGISTER.FORM.PHONE"))("label",E(32,52,"REGISTER.FORM.PHONE")+" * "),r(4),c("placeholder",E(35,54,"REGISTER.FORM.EMAIL"))("label",E(36,56,"REGISTER.FORM.EMAIL")+" * "),r(4),c("placeholder",E(39,58,"REGISTER.FORM.CONFIRM_EMAIL"))("label",E(40,60,"REGISTER.FORM.CONFIRM_EMAIL")+" * "),r(4),c("placeholder",E(43,62,"REGISTER.FORM.PASSWORD"))("label",E(44,64,"REGISTER.FORM.PASSWORD")+" * "),r(4),c("placeholder",E(47,66,"REGISTER.FORM.CONFIRM_PASSWORD"))("label",E(48,68,"REGISTER.FORM.CONFIRM_PASSWORD")+" * ")}}var Yg=(()=>{class t{constructor(e,n,i,a,m){this.formBuilder=e,this.modalCtrl=n,this.translate=i,this.service=a,this.websocket=m,this.activeSegment="installer",this.countries=ac(this.translate),this.docsLink=null}ngOnInit(){this.formGroup=this.getForm(this.activeSegment),this.docsLink=this.createEvcsDocsLink()}updateRegistrationForm(e){this.formGroup=this.getForm(e.detail.value)}onSubmit(){if(!this.formGroup.valid){this.service.toast(this.translate.instant("REGISTER.ERRORS.REQUIRED_FIELDS"),"danger");return}let e=this.formGroup.value.password,n=this.formGroup.value.confirmPassword;if(e!=n){this.service.toast(this.translate.instant("REGISTER.ERRORS.PASSWORD_NOT_EQUAL"),"danger");return}let i=this.formGroup.value.email,a=this.formGroup.value.confirmEmail;if(i!=a){this.service.toast(this.translate.instant("REGISTER.ERRORS.EMAIL_NOT_EQUAL"),"danger");return}let m=new Vd({user:{firstname:this.formGroup.value.firstname,lastname:this.formGroup.value.lastname,phone:this.formGroup.value.phone,email:this.formGroup.value.email,password:e,confirmPassword:n,address:{street:this.formGroup.value.street,zip:this.formGroup.value.zip,city:this.formGroup.value.city,country:this.formGroup.value.country},role:this.activeSegment},oem:pt.theme}),u=this.formGroup.value.companyName;u&&(m.params.user.company={name:u}),this.websocket.sendRequest(m).then(()=>{this.service.toast(this.translate.instant("REGISTER.SUCCESS"),"success"),this.modalCtrl.dismiss()}).catch(C=>{this.service.toast(C.error.message,"danger")})}getForm(e){return e==="installer"?this.formBuilder.group({companyName:new K("",le.required),firstname:new K("",le.required),lastname:new K("",le.required),street:new K("",le.required),zip:new K("",le.required),city:new K("",le.required),country:new K("",le.required),phone:new K("",le.required),email:new K("",[le.required,le.email]),confirmEmail:new K("",[le.required,le.email]),password:new K("",le.required),confirmPassword:new K("",le.required)}):this.formBuilder.group({firstname:new K("",le.required),lastname:new K("",le.required),street:new K("",le.required),zip:new K("",le.required),city:new K("",le.required),country:new K("",le.required),phone:new K("",le.required),email:new K("",[le.required,le.email]),confirmEmail:new K("",[le.required,le.email]),password:new K("",le.required),confirmPassword:new K("",le.required)})}createEvcsDocsLink(){let e=pt.links.DATA_PROTECTION;return e==null?null:e.replace("{language}",this.service.getDocsLang())}static{this.\u0275fac=function(n){return new(n||t)(x(Ft),x(he),x(te),x(j),x(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["registration-modal"]],standalone:!1,decls:28,vars:11,consts:[["color","primary",1,"ion-justify-content-center"],["translate",""],["slot","end"],[3,"click"],["name","close-outline",2,"color","var(--ion-title-color)"],[3,"ngModelChange","ionChange","ngModel"],["value","installer"],["value","owner"],[1,"ion-padding-top"],[3,"ngSubmit","formGroup","ngSwitch"],[4,"ngSwitchCase"],["type","submit",2,"visibility","hidden","position","absolute","position","-999px"],[1,"ion-padding-top","ion-padding-bottom"],["type","submit",1,"ion-float-right"],["slot","icon-only","name","log-in-outline"],["formControlName","firstname","type","input","label-placement","floating",3,"placeholder","label"],["labelPlacement","floating","formControlName","lastname","type","input","label-placement","floating",3,"placeholder","label"],["formControlName","street","type","input","label-placement","floating",3,"placeholder","label"],["formControlName","zip","type","input","label-placement","floating",3,"placeholder","label"],["formControlName","city","type","input","label-placement","floating",3,"placeholder","label"],["formControlName","country","label-placement","floating",3,"label"],[4,"ngFor","ngForOf"],["formControlName","phone","type","input","label-placement","floating",3,"placeholder","label"],["formControlName","email","type","input","label-placement","floating",3,"placeholder","label"],["formControlName","confirmEmail","type","input","label-placement","floating",3,"placeholder","label"],["formControlName","password","type","password","label-placement","floating",3,"placeholder","label"],["formControlName","confirmPassword","type","password","label-placement","floating",3,"placeholder","label"],[3,"form","attributes"],[3,"innerHTML"],[3,"value"],["formControlName","companyName","type","input","label-placement","floating",3,"placeholder","label"],["formControlName","lastname","type","input","label-placement","floating",3,"placeholder","label"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),h(3,"REGISTER.TITLE"),l(),s(4,"ion-buttons",2)(5,"ion-button",3),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",4),l()()()(),s(7,"ion-segment",5),Zt("ngModelChange",function(m){return Qt(i.activeSegment,m)||(i.activeSegment=m),m}),O("ionChange",function(m){return i.updateRegistrationForm(m)}),s(8,"ion-segment-button",6)(9,"ion-label"),h(10),g(11,"translate"),l()(),s(12,"ion-segment-button",7)(13,"ion-label"),h(14),g(15,"translate"),l()()(),s(16,"ion-content")(17,"ion-grid",8)(18,"form",9),O("ngSubmit",function(){return i.onSubmit()}),G(19,I5,52,86,"ng-container",10)(20,S5,49,70,"ng-container",10),d(21,"input",11),s(22,"ion-row",12)(23,"ion-col")(24,"ion-button",13)(25,"small",1),h(26,"REGISTER.BUTTON"),l(),d(27,"ion-icon",14),l()()()()()()),n&2&&(r(7),Kt("ngModel",i.activeSegment),r(3),N(E(11,7,"REGISTER.SEGMENT.INSTALLER")),r(4),N(E(15,9,"REGISTER.SEGMENT.USER")),r(4),c("formGroup",i.formGroup)("ngSwitch",i.activeSegment),r(),c("ngSwitchCase","owner"),r(),c("ngSwitchCase","installer"))},dependencies:[Hn,ho,Co,cn,Ie,Ke,Tn,Ge,Xe,Ae,je,Me,xt,ie,nn,J,ne,Se,ri,ai,jn,Yn,He,St,ct,$e,Bn,ot,en,Ne,sc,V],encapsulation:2})}}return t})();var $g=(()=>{class t{constructor(e){this.modalController=e}presentModal(){return ae(this,null,function*(){return yield(yield this.modalController.create({component:Yg})).present()})}static{this.\u0275fac=function(n){return new(n||t)(x(he))}}static{this.\u0275cmp=I({type:t,selectors:[["registration"]],standalone:!1,decls:3,vars:0,consts:[["type","button","size","small",1,"ion-float-left",2,"text-decoration","none",3,"click","keydown.enter"],["translate",""]],template:function(n,i){n&1&&(s(0,"a",0),O("click",function(){return i.presentModal()})("keydown.enter",function(){return i.presentModal()}),s(1,"small",1),h(2,"REGISTER.CREATE_USER"),l()())},dependencies:[Ne],encapsulation:2})}}return t})();function w5(t,o){t&1&&d(0,"ion-card")}function b5(t,o){if(t&1){let e=W();s(0,"ion-card-content")(1,"form",7),O("ngSubmit",function(){P(e);let i=it(10),a=p(2);return L(a.doLogin({password:i.value}))}),s(2,"div",8)(3,"ion-item")(4,"ion-text",9),h(5," LOGIN.PREAMBLE "),l()(),s(6,"ion-item")(7,"ion-label",10),h(8,"LOGIN.PASSWORD_LABEL"),l(),d(9,"ion-input",11,0),g(11,"translate"),l(),d(12,"input",12),s(13,"ion-button",13),d(14,"ion-icon",14),l()()()()}if(t&2){let e=p(2);r(9),c("placeholder",E(11,2,"LOGIN.PASSWORD_LABEL")),r(4),c("disabled",e.formIsDisabled)}}function D5(t,o){if(t&1){let e=W();s(0,"ion-card-content")(1,"form",7),O("ngSubmit",function(){P(e);let i=it(4),a=it(9),m=p(2);return L(m.doLogin({username:i.value,password:a.value}))}),s(2,"ion-item"),d(3,"ion-input",15,1),g(5,"translate"),g(6,"translate"),l(),s(7,"ion-item"),d(8,"ion-input",16,0),g(10,"translate"),g(11,"translate"),l(),d(12,"input",12),s(13,"ion-item",17)(14,"table",18)(15,"tr")(16,"th")(17,"tr")(18,"a",19)(19,"small",20),h(20,"LOGIN.PASSWORD_RESET"),l()()(),s(21,"tr"),d(22,"registration",21),l()(),s(23,"th")(24,"ion-button",22)(25,"small"),h(26,"Login"),l(),d(27,"ion-icon",23),l()()()()()()()}if(t&2){let e=p(2);r(3),c("placeholder","E-Mail / "+E(5,6,"LOGIN.PASSWORD_LABEL"))("label","E-Mail / "+E(6,8,"LOGIN.USER")),r(5),c("placeholder",E(10,10,"LOGIN.PASSWORD_LABEL"))("label",E(11,12,"LOGIN.PASSWORD_LABEL")),r(10),c("href",e.environment.links.FORGET_PASSWORD,No),r(6),c("disabled",e.formIsDisabled)}}function R5(t,o){if(t&1&&(s(0,"ion-card")(1,"ion-item",5),d(2,"ion-icon",6),s(3,"ion-label"),h(4),g(5,"translate"),l()(),f(6,b5,15,4,"ion-card-content"),f(7,D5,28,14,"ion-card-content"),l()),t&2){let e=p();r(4),N(E(5,3,"LOGIN.TITLE")),r(2),_(e.environment.backend==="OpenEMS Edge"?6:-1),r(),_(e.environment.backend==="OpenEMS Backend"?7:-1)}}var us=class t{static{this.DEFAULT_THEME=Os.LIGHT}constructor(o,e,n,i,a,m,u,C){this.service=o,this.websocket=e,this.utils=n,this.router=i,this.route=a,this.cdref=m,this.modalCtrl=u,this.userService=C,this.environment=pt,this.formIsDisabled=!1,this.popoverActive=null,this.showPassword=!1,this.operatingSystem=Ei.deviceInfo.os,this.isApp=Ls.getPlatform()!=="web",this.stopOnDestroy=new qt,this.page=0,wt(()=>{let v=this.userService.currentUser();this.currentThemeMode=C.getValidBrowserTheme(v?.getThemeFromSettings()??localStorage.getItem("THEME"))})}static getCurrentTheme(o){return o?.settings[Hd.THEME]??localStorage.getItem("THEME")??this.DEFAULT_THEME}static preprocessCredentials(o,e){return ke({password:o?.trim()},e&&{username:e?.trim().toLowerCase()})}ngAfterContentChecked(){this.cdref.detectChanges()}ngOnInit(){let o=setInterval(()=>{this.websocket.status==="online"&&!this.router.url.split("/").includes("live")&&(this.router.navigate(["/overview"]),clearInterval(o))},1e3)}ionViewWillEnter(){return ae(this,null,function*(){this.route.snapshot.routeConfig.path=="demo"?yield new Promise(o=>setTimeout(()=>{if(this.websocket.status=="waiting for credentials"){this.service.startSpinner("loginspinner");let e=this.route.snapshot.queryParamMap.get("lang")??null;e&&(localStorage.DEMO_LANGUAGE=e),o(this.doDemoLogin({username:"demo",password:"demo"}))}},2e3)):localStorage.removeItem("DEMO_LANGUAGE")})}doLogin(o){this.websocket.state.set(Ld.AUTHENTICATION_WITH_CREDENTIALS),o=t.preprocessCredentials(o.password,o.username),!this.formIsDisabled&&(this.formIsDisabled=!0,this.websocket.login(new xc(o)).finally(()=>{this.ionViewWillEnter(),this.formIsDisabled=!1}))}doDemoLogin(o){return this.websocket.login(new xc(o)).then(()=>{this.service.stopSpinner("loginspinner")}),new Promise((e,n)=>{let i=new rc({page:this.page});this.service.getEdges(i).then(a=>{setTimeout(()=>{this.router.navigate(["/device",a[0].id])},100),e(a)}).catch(a=>{n(a)})}).finally(()=>{this.service.stopSpinner("loginspinner")})}ngOnDestroy(){this.stopOnDestroy.next(),this.stopOnDestroy.complete()}showPopoverOrRedirectToStore(o){return ae(this,null,function*(){let e=Ei.getAppStoreLink();e?window.open(e,"_blank"):this.popoverActive=o})}static{this.\u0275fac=function(e){return new(e||t)(x(j),x(Ce),x(M),x(It),x(De),x(ln),x(he),x(qn))}}static{this.\u0275cmp=I({type:t,selectors:[["login"]],standalone:!1,decls:8,vars:2,consts:[["password",""],["username",""],[1,"ion-justify-content-center"],[3,"name"],["size","12","size-md","6","size-lg","4"],["color","primary","lines","full"],["slot","start","name","person-outline"],[3,"ngSubmit"],[1,"ion-padding"],["color","medium","translate","",1,"ion-text-wrap"],["position","floating","translate",""],["required","","type","password","value","user",3,"placeholder"],["type","submit",2,"visibility","hidden","position","absolute","position","-999px"],["type","submit",1,"ion-float-right",3,"disabled"],["slot","icon-only","name","log-in-outline"],["required","","type","input","label-placement","floating",3,"placeholder","label"],["required","","type","password","label-placement","floating",3,"placeholder","label"],["lines","none",1,"ion-margin-top"],[1,"full_width"],["type","button","size","small",1,"ion-float-left",2,"text-decoration","none",3,"href"],["translate",""],[2,"cursor","pointer"],["type","submit","size","medium",1,"ion-float-right",3,"disabled"],["slot","end","name","log-in-outline"]],template:function(e,n){if(e&1&&(d(0,"header"),s(1,"ion-content")(2,"ion-grid")(3,"ion-row",2),d(4,"ngx-spinner",3),s(5,"ion-col",4),f(6,w5,1,0,"ion-card")(7,R5,8,5,"ion-card"),l()()()()),e&2){let i;r(4),c("name","loginspinner"),r(2),_((i=n.websocket.status)==="authenticating"?6:i==="waiting for credentials"?7:-1)}},dependencies:[me,cn,Ke,Wp,gC,Ge,Ht,We,Ae,je,Me,ie,nn,J,ne,Se,He,Bn,Ne,$g,V],encapsulation:2})}};function O5(t,o){t&1&&d(0,"ion-icon",1)}function N5(t,o){t&1&&d(0,"ion-icon",2)}function M5(t,o){t&1&&d(0,"ion-icon",3)}function F5(t,o){t&1&&d(0,"ion-icon",4)}function G5(t,o){t&1&&d(0,"ion-icon",5)}function P5(t,o){t&1&&d(0,"ion-icon",6)}function L5(t,o){t&1&&d(0,"ion-icon",2)}function k5(t,o){if(t&1&&(Y(0,0),f(1,M5,1,0,"ion-icon",3)(2,F5,1,0,"ion-icon",4)(3,G5,1,0,"ion-icon",5)(4,P5,1,0,"ion-icon",6)(5,L5,1,0,"ion-icon",2),z()),t&2){let e,n=p(2);r(),_((e=n.sumState)===n.SUM_STATE.OK?1:e===n.SUM_STATE.INFO?2:e===n.SUM_STATE.WARNING?3:e===n.SUM_STATE.FAULT?4:5)}}function V5(t,o){if(t&1&&f(0,N5,1,0,"ion-icon",2)(1,k5,6,1,"ng-container",0),t&2){let e=p();_(e.isAtLeastInstaller?1:0)}}var $m=(function(t){return t.OK="OK",t.INFO="INFO",t.WARNING="WARNING",t.FAULT="FAULT",t})($m||{}),Xg=(()=>{class t{constructor(e){this.service=e,this.sumState=$m.OK,this.isEdgeOnline=!1,this.isAtLeastInstaller=!1,this.SUM_STATE=$m}ngOnInit(){let e=this.service.metadata?.value?.user??null;e&&(this.isAtLeastInstaller=Rt.isAtLeast(e.globalRole,Rt.INSTALLER))}static{this.\u0275fac=function(n){return new(n||t)(x(j))}}static{this.\u0275cmp=I({type:t,selectors:[["oe-sum-state"]],inputs:{sumState:"sumState",isEdgeOnline:"isEdgeOnline"},standalone:!1,decls:3,vars:1,consts:[[1,"sum-state-icon"],["name","cloud-offline-outline","color","danger"],["color","primary","name","play-outline"],["color","success","name","checkmark-circle-outline"],["color","success","name","information-circle-outline"],["color","warning","name","warning-outline"],["color","danger","name","alert-circle-outline"]],template:function(n,i){n&1&&(s(0,"ion-col",0),f(1,O5,1,0,"ion-icon",1)(2,V5,2,1),l()),n&2&&(r(),_(i.isEdgeOnline?2:1))},dependencies:[Ae,ie],styles:[".sum-state-icon[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{font-size:20pt!important}"]})}}return t})(),qg=t=>({placeholder:t.instant("GENERAL.SUM_STATE"),category:"sumState",options:[{name:"Ok",value:"ok"},{name:t.instant("GENERAL.INFO"),value:"Info"},{name:t.instant("GENERAL.WARNING"),value:"Warning"},{name:t.instant("GENERAL.FAULT"),value:"Fault"}],setAdditionalFilter:()=>({key:"isOnline",value:!0})});var B5=()=>({cssClass:"custom-ion-popover"});function W5(t,o){if(t&1&&(s(0,"ion-select-option",3),h(1),l()),t&2){let e=o.$implicit;c("value",e.value),r(),R("",e.name," ")}}function U5(t,o){if(t&1){let e=W();s(0,"ion-select",2),O("ionDismiss",function(i){P(e);let a=p().$implicit,m=p();return L(m.searchOnChange(i,a))}),fe(1,W5,2,2,"ion-select-option",3,xe),l()}if(t&2){let e=p().$implicit;c("multiple",!0)("label",e.placeholder)("interfaceOptions",H(3,B5)),r(),_e(e.options)}}function z5(t,o){if(t&1&&(s(0,"ion-col",0),f(1,U5,3,4,"ion-select",1),l()),t&2){let e=o.$implicit;r(),_(e?1:-1)}}var Kg=(()=>{class t{constructor(e){this.translate=e,this.setSearchParams=new qr,this.filters=[pt.PRODUCT_TYPES(this.translate),qg(this.translate)],this.searchParams=new Map}searchOnChange(e,n){let i=e.target.value;if(!i)return;let a=!1;if(Array.isArray(this.searchParams.get(n.category))?a=M.compareArraysSafely(i,this.searchParams.get(n.category)):a=i==this.searchParams.get(n.category),this.searchParams.has(n.category)&&a)return;let m;n.setAdditionalFilter&&(m=n.setAdditionalFilter()),i?.length===0?(this.searchParams.delete(n.category),m&&this.searchParams.delete(m.key)):(this.searchParams.set(n.category,i),m&&this.searchParams.set(m.key,m.value)),this.setSearchParams.emit(this.searchParams)}static{this.\u0275fac=function(n){return new(n||t)(x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["oe-filter"]],outputs:{setSearchParams:"setSearchParams"},standalone:!1,decls:3,vars:0,consts:[["size","6"],["interface","popover","label-placement","floating","fill","outline","type","radio","mode","md",1,"custom-ion-popover","ion-select-border-color-primary",2,"white-space","initial","--color","var(--ion-color-primary)",3,"multiple","label","interfaceOptions"],["interface","popover","label-placement","floating","fill","outline","type","radio","mode","md",1,"custom-ion-popover","ion-select-border-color-primary",2,"white-space","initial","--color","var(--ion-color-primary)",3,"ionDismiss","multiple","label","interfaceOptions"],[3,"value"]],template:function(n,i){n&1&&(s(0,"ion-row"),fe(1,z5,2,1,"ion-col",0,xe),l()),n&2&&(r(),_e(i.filters))},dependencies:[Ae,Se,jn,Yn,$e],encapsulation:2})}}return t})();var jr=t=>({edgeShortName:t}),Y5=t=>["/device",t],$5=t=>({text:"./installation",routeRelative:t}),X5=()=>["./installation"];function q5(t,o){if(t&1&&(s(0,"ion-item",4),d(1,"ion-icon",5),s(2,"ion-label",6),h(3),g(4,"translate"),l()(),s(5,"ion-card-content",7)(6,"p",8),h(7," INSTALLATION.CLICK_RECOMMENDATION"),l()()),t&2){let e=p(4);r(3),N(q(4,2,"INDEX.NO_EDGE_AVAILABLE",be(5,jr,e.environment.edgeShortName))),r(3),c("translateParams",be(7,jr,e.environment.edgeShortName))}}function K5(t,o){if(t&1&&(s(0,"ion-item",4),d(1,"ion-icon",5),s(2,"ion-label",9),h(3),g(4,"translate"),l()(),s(5,"ion-card-content",7)(6,"p",8),h(7," INDEX.VISIBLE_HERE_AFTER_INSTALLATION"),l()()),t&2){let e=p(4);r(2),c("translateParams",be(6,jr,e.environment.edgeShortName)),r(),N(q(4,3,"INDEX.NO_EDGE_FOR_USER",be(8,jr,e.environment.edgeShortName))),r(3),c("translateParams",be(10,jr,e.environment.edgeShortName))}}function Q5(t,o){if(t&1&&f(0,q5,8,9)(1,K5,8,12),t&2){let e=o;_(e.globalRole==="installer"||e.globalRole==="admin"?0:1)}}function Z5(t,o){if(t&1&&(s(0,"ion-card",0),f(1,Q5,2,1),g(2,"async"),l()),t&2){let e,n=p(2);r(),_((e=(e=E(2,1,n.service.metadata))==null?null:e.user)?1:-1,e)}}function J5(t,o){if(t&1){let e=W();s(0,"oe-filter",16),O("setSearchParams",function(i){P(e);let a=p(4);return L(a.searchOnChange(i))}),l()}}function eV(t,o){if(t&1&&f(0,J5,1,0,"oe-filter"),t&2){let e=p(3);_(e.isAtLeastInstaller?0:-1)}}function tV(t,o){t&1&&(s(0,"ion-item",12),d(1,"ion-spinner",17),l()),t&2&&(r(),c("name","crescent"))}function nV(t,o){if(t&1&&(s(0,"ion-label")(1,"ion-text",21),h(2,"INDEX.OFFLINE_SINCE"),l(),h(3),g(4,"date"),l()),t&2){let e=p(2).$implicit;r(3),R(" ",q(4,1,e.lastmessage,"dd.MM.yyyy HH:mm")," ")}}function iV(t,o){if(t&1&&(s(0,"p",19)(1,"ion-text",21),h(2,"INDEX.DEVICE_OFFLINE"),l(),f(3,nV,5,4,"ion-label"),l()),t&2){let e=p().$implicit;r(3),_(e.lastmessage?3:-1)}}function oV(t,o){if(t&1&&(s(0,"p",20),h(1),l(),s(2,"p",20)(3,"ion-text",21),h(4,"INDEX.TYPE"),l(),h(5),l()),t&2){let e=p().$implicit;r(),R("ID: ",e.id),r(4),R(": ",e.producttype," ")}}function rV(t,o){if(t&1){let e=W();s(0,"ion-item",18),O("click",function(){let i=P(e).$implicit,a=p(3);return L(a.getAndSubscribeEdge(i))}),s(1,"ion-label")(2,"h2",19),h(3),l(),f(4,iV,4,1,"p",19),l(),s(5,"ion-label"),f(6,oV,6,2),s(7,"p",20)(8,"ion-text",21),h(9,"INDEX.LOGGED_IN_AS"),l(),h(10),l()(),d(11,"oe-sum-state",22),l()}if(t&2){let e=o.$implicit,n=p(3);c("routerLink",be(8,Y5,e.id))("color",e.isOnline?null:"light"),r(3),N(e.comment),r(),_(e.isOnline?-1:4),r(2),_(n.environment.backend==="OpenEMS Backend"?6:-1),r(4),R(": ",e.getRoleString()," "),r(),c("sumState",e.sumState)("isEdgeOnline",e.isOnline)}}function aV(t,o){if(t&1){let e=W();s(0,"ion-grid")(1,"ion-row",0)(2,"ion-col")(3,"ion-searchbar",10),Zt("ngModelChange",function(i){P(e);let a=p(2);return Qt(a.query,i)||(a.query=i),L(i)}),O("ionInput",function(){P(e);let i=p(2);return L(i.searchOnChange())}),l()()(),f(4,eV,1,1),g(5,"async"),s(6,"ion-row",0)(7,"ion-col")(8,"ion-list",11),f(9,tV,2,1,"ion-item",12),fe(10,rV,12,10,"ion-item",13,xe),s(12,"ion-infinite-scroll",14),O("ionInfinite",function(i){P(e);let a=p(2);return L(a.doInfinite(i))}),d(13,"ion-infinite-scroll-content",15),l()()()()()}if(t&2){let e,n=p(2);r(3),Kt("ngModel",n.query),c("debounce",1e3),r(),_((e=(e=E(5,6,n.service.metadata))==null?null:e.user)?4:-1,e),r(5),_(n.loading?9:-1),r(),_e(n.filteredEdges),r(2),c("disabled",n.limitReached),r(),c("loadingSpinner","crescent")}}function sV(t,o){if(t&1&&f(0,Z5,3,3,"ion-card",0)(1,aV,14,8,"ion-grid"),t&2){let e=p();_(e.noEdges?0:1)}}function lV(t,o){if(t&1&&(s(0,"ion-fab",2)(1,"ion-fab-button",23),d(2,"ion-icon",24),l(),s(3,"ion-fab-list",25)(4,"oe-flat-button",26),h(5),g(6,"translate"),l()()()),t&2){let e=p();r(4),c("link",be(5,$5,e.route)),r(),R(" ",q(6,2,"INDEX.ADD_EDGE",be(7,jr,e.environment.edgeShortName))," ")}}function cV(t,o){if(t&1&&(s(0,"ion-fab",3)(1,"ion-fab-button",27),d(2,"ion-icon",24),l(),s(3,"ion-fab-list",28)(4,"ion-button",29),h(5,"INDEX.ADD_EDGE"),l()()()),t&2){let e=p();r(4),c("routerLink",H(2,X5))("translateParams",be(3,jr,e.environment.edgeShortName))}}var Qg=(()=>{class t{constructor(e,n,i,a,m,u,C,v){this.service=e,this.websocket=n,this.utils=i,this.translate=a,this.pagination=m,this.route=u,this.router=C,this.userService=v,this.environment=pt,this.noEdges=!1,this.loggedInUserCanInstall=!1,this.filteredEdges=[],this.loading=!1,this.searchParams=new Map,this.isAtLeastInstaller=!1,this.stopOnDestroy=new qt,this.page=0,this.query=null,this.limit=20,this.limitReached=!1,this.lastReqId=null,wt(()=>{let T=this.userService.currentUser();T&&(this.isAtLeastInstaller=T.isAtLeast(Rt.INSTALLER))})}ionViewWillEnter(){this.page=0,this.filteredEdges=[],this.limitReached=!1,this.service.metadata.pipe(vt(e=>!!e),pn(1)).subscribe(()=>{this.init()})}doInfinite(e){setTimeout(()=>{this.page++,this.loadNextPage().then(n=>{this.filteredEdges.push(...n),e.target.complete()}).catch(()=>{e.target.complete()})},200)}ngOnDestroy(){this.stopOnDestroy.next(),this.stopOnDestroy.complete()}loadNextPage(){return this.loading=!0,new Promise((e,n)=>{if(this.limitReached){e([]);return}let i={};if(this.searchParams&&this.searchParams.size>0)for(let[m,u]of this.searchParams)i[m]=u;let a=new rc(ke(ke(ke({page:this.page},this.query&&this.query!=""&&{query:this.query}),this.limit&&{limit:this.limit}),i&&{searchParams:i}));this.lastReqId=a.id,this.service.getEdges(a).then(m=>{this.lastReqId!==a.id&&e(this.filteredEdges),this.limitReached=m.length<this.limit,e(m)}).catch(m=>{n(m)})}).finally(()=>this.loading=!1)}getAndSubscribeEdge(e){this.pagination.getAndSubscribeEdge(e)}searchOnChange(e){e&&(this.searchParams=e),this.filteredEdges=[],this.page=0,this.limitReached=!1,this.loadNextPage().then(n=>{this.filteredEdges=n})}init(){this.loadNextPage().then(e=>{this.service.metadata.pipe(vt(n=>!!n),pn(1)).subscribe(n=>{let i=Object.keys(n.edges);if(this.noEdges=i.length===0,this.loggedInUserCanInstall=Rt.isAtLeast(n.user.globalRole,"installer"),pt.backend=="OpenEMS Edge"||!this.loggedInUserCanInstall&&i.length==1){let a=n.edges[i[0]];setTimeout(()=>{this.router.navigate(["/device",a.id])},100);return}this.filteredEdges=e})})}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(Ce),x(M),x(te),x(pa),x(De),x(It),x(qn))}}static{this.\u0275cmp=I({type:t,selectors:[["overview"]],standalone:!1,decls:7,vars:3,consts:[[1,"ion-justify-content-center"],["size","12","size-md","8","size-lg","6"],["vertical","bottom","horizontal","center","testId","ibn-button",2,"position","fixed","margin-top","10%","display","block"],["horizontal","end","vertical","bottom","testId","ibn-button",2,"position","fixed"],["color","warning","lines","full"],["slot","start","name","alert-circle-outline"],[1,"ion-text-wrap","ion-text-center"],[1,"ion-text-center"],["translate","",3,"translateParams"],[1,"ion-text-wrap","ion-text-center",3,"translateParams"],["mode","md",2,"--background","var(--ion-color-searchbar-background)","color","var(--ion-color-searchbar-text)",3,"ngModelChange","ionInput","ngModel","debounce"],["lines","full"],["lines","none"],["lines","inset",3,"routerLink","color"],[3,"ionInfinite","disabled"],["ngClass","custom-spinner",3,"loadingSpinner"],[3,"setSearchParams"],[3,"name"],["lines","inset",3,"click","routerLink","color"],[1,"ion-text-wrap"],[1,"custom-theme-text"],["translate",""],[3,"sumState","isEdgeOnline"],["size","large"],["name","add-outline"],["side","top","id","blurred",2,"left","0","align-items","flex-start"],["color","primary",3,"link"],["size","small"],["side","top",2,"right","0","align-items","flex-end"],["color","primary","routerLinkActive","active","translate","",3,"routerLink","translateParams"]],template:function(n,i){n&1&&(s(0,"ion-content")(1,"ion-grid")(2,"ion-row",0)(3,"ion-col",1),f(4,sV,2,1),f(5,lV,7,9,"ion-fab",2),f(6,cV,6,5,"ion-fab",3),l()()()()),n&2&&(r(4),_(i.environment.backend==="OpenEMS Backend"?4:-1),r(),_(i.loggedInUserCanInstall&&!i.service.isSmartphoneResolution?5:-1),r(),_(i.loggedInUserCanInstall&&i.service.isSmartphoneResolution?6:-1))},dependencies:[Si,Ie,Tn,Ge,Ht,We,Ae,je,Wn,Un,qp,Me,ie,Zp,Jp,J,ne,zn,Se,od,ad,He,Bn,ji,ii,ta,Ne,qi,Kg,Xg,lt,$o,V],encapsulation:2})}}return t})();var pV=t=>({edgeShortName:t});function dV(t,o){if(t&1&&(s(0,"ngx-spinner",2)(1,"p",4)(2,"span",5),h(3," LOADING_SCREEN.LOADING "),l(),h(4," ... "),l()()),t&2){let e=p();c("name",e.spinnerId)}}function uV(t,o){t&1&&_o(0)}function fV(t,o){if(t&1&&G(0,uV,1,0,"ng-container",8),t&2){p(2);let e=it(4);c("ngTemplateOutlet",e)}}function _V(t,o){t&1&&_o(0)}function hV(t,o){if(t&1&&G(0,_V,1,0,"ng-container",8),t&2){p(2);let e=it(6);c("ngTemplateOutlet",e)}}function CV(t,o){if(t&1&&(s(0,"ion-grid",3)(1,"ion-row",6)(2,"ion-col",7)(3,"ion-card")(4,"ion-card-content"),f(5,fV,1,1,"ng-container")(6,hV,1,1,"ng-container"),l()()()()()),t&2){let e=p();r(5),_(e.environment.backend==="OpenEMS Backend"?5:6)}}function gV(t,o){t&1&&(s(0,"ion-row",9)(1,"ion-col",10),d(2,"ion-icon",11),s(3,"ion-label",12),h(4),g(5,"translate"),l()()(),s(6,"ion-row",13)(7,"ion-col",14)(8,"ion-item",15)(9,"ion-label",16),h(10),g(11,"translate"),l()()()(),s(12,"ion-row",17)(13,"ion-col",14)(14,"ion-item",15)(15,"ion-label",18),h(16),g(17,"translate"),l()()()()),t&2&&(r(4),R(" ",E(5,3,"LOADING_SCREEN.SERVER_NOT_ACCESSIBLE")),r(6),R(" ",E(11,5,"LOADING_SCREEN.SERVER_NOT_ACCESSIBLE_DESCRIPTION")," "),r(6),R(" ",E(17,7,"LOADING_SCREEN.SERVER_NOT_ACCESSIBLE_TRY_RELOADING")," "))}function EV(t,o){if(t&1&&(s(0,"ion-row",13)(1,"ion-col",10),d(2,"ion-icon",19),s(3,"ion-label",12),h(4),g(5,"translate"),l()()(),s(6,"ion-row",17)(7,"ion-col",14)(8,"ion-item",15)(9,"ion-label",20),h(10," OFFLINE.EDGE.DESCRIPTION "),l()()()(),s(11,"ion-row",13)(12,"ion-col",14)(13,"ion-item",15)(14,"ion-label",18),h(15),g(16,"translate"),l()()()()),t&2){let e=p();r(4),R(" ",E(5,3,"OFFLINE.EDGE.LOCAL_ACCESS_CURRENTLY_NOT_POSSIBLE")," "),r(5),c("translateParams",be(7,pV,e.environment.edgeShortName)),r(6),R(" ",E(16,5,"LOADING_SCREEN.SERVER_NOT_ACCESSIBLE_TRY_RELOADING")," ")}}var Zg=(()=>{class t{constructor(e,n,i,a){this.service=e,this.websocket=n,this.router=i,this.appStateTracker=a,this.spinnerId="IndexComponent",this.environment=pt,this.backendState="loading",wt(()=>{switch(this.backendState=this.appStateTracker.loadingState(),this.backendState){case"loading":this.service.startSpinner(this.spinnerId);break;case"failed":this.service.stopSpinner(this.spinnerId);break;case"authenticated":this.appStateTracker.navigateAfterAuthentication();break}})}static{this.\u0275fac=function(n){return new(n||t)(x(j),x(Ce),x(It),x(Zo))}}static{this.\u0275cmp=I({type:t,selectors:[["index"]],standalone:!1,decls:7,vars:1,consts:[["connectionToBackendFailed",""],["connectionToEdgeFailed",""],[3,"name"],[2,"align-content","center","height","100%","vertical-align","middle"],["translate","",2,"color","white"],["translate",""],[1,"ion-justify-content-center"],["size","12","size-md","6","size-lg","4"],[4,"ngTemplateOutlet"],[1,"ion-justify-content-center","ion-align-items-center","ion-no-padding"],[2,"display","flex","align-items","center","justify-content","center","border","2px solid var(--ion-color-primary)"],["name","cloud-offline-outline","color","danger","size","large",2,"padding-right","5%"],["color","primary",1,"ion-text-wrap",2,"font-size","larger"],[1,"ion-justify-content-center","ion-align-items-center"],["size","12"],["lines","none",1,"ion-text-center"],[1,"ion-text-wrap"],[1,"ion-justify-content-center","ion-align-items-center","ion-padding-top"],[1,"ion-text-wrap",2,"font-weight","bolder"],["name","file-tray-full-outline","color","primary","size","large",2,"padding-right","5%"],["translate","",1,"ion-text-wrap","ion-font-size-smaller",3,"translateParams"]],template:function(n,i){if(n&1&&(s(0,"ion-content"),f(1,dV,5,1,"ngx-spinner",2)(2,CV,7,1,"ion-grid",3),l(),G(3,gV,18,9,"ng-template",null,0,yt)(5,EV,17,9,"ng-template",null,1,yt)),n&2){let a;r(),_((a=i.backendState)==="loading"?1:a==="failed"?2:-1)}},dependencies:[Jr,me,Ht,We,Ae,je,Me,ie,J,ne,Se,Ne,V],encapsulation:2})}}return t})();function vV(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function yV(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var Jg=(()=>{class t extends de{getChartData(){let e=this.config.getComponent(this.route.snapshot.params.componentId),n=["rgb(246, 180, 137)","rgb(238, 120, 42)","rgb(118, 52, 9)"],i=["rgb(255, 0, 0)","rgb(133, 0, 0)","rgb(71, 0, 0)"];return{input:[...jt.THREE_PHASE.map(m=>({name:"Current"+m,powerChannel:y.fromString(e.id+"/Current"+m)})),...jt.THREE_PHASE.map(m=>({name:"Voltage"+m,powerChannel:y.fromString(e.id+"/Voltage"+m)}))],output:m=>[...jt.THREE_PHASE.map((u,C)=>({name:this.translate.instant("EDGE.HISTORY.CURRENT")+" "+u,converter:()=>m["Current"+u],hideShadow:!0,color:n[C],yAxisId:B.LEFT})),...jt.THREE_PHASE.map((u,C)=>({name:this.translate.instant("EDGE.HISTORY.VOLTAGE")+" "+u,converter:()=>m["Voltage"+u],hideShadow:!0,color:i[C],yAxisId:B.RIGHT}))],tooltip:{formatNumber:"1.1-2",afterTitle:this.translate.instant("GENERAL.TOTAL")},yAxes:[{unit:Z.VOLTAGE,position:"right",yAxisId:B.RIGHT,displayGrid:!1,scale:{dynamicScale:!0}},{unit:Z.CURRENT,position:"left",yAxisId:B.LEFT}]}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["currentVoltageAsymmetricChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,vV,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,yV,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,Ee,me],encapsulation:2})}}return t})();function IV(t,o){if(t&1&&(s(0,"table",1)(1,"tr")(2,"td",5),h(3),l()()()),t&2){let e=p();r(3),N(e.chartTitle)}}function xV(t,o){if(t&1&&d(0,"canvas",4),t&2){let e=p();c("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var e1=(()=>{class t extends de{getChartData(){let e=this.config.getComponent(this.route.snapshot.params.componentId);return{input:[{name:e.id+"Current",powerChannel:y.fromString(e.id+"/Current")},{name:e.id+"Voltage",powerChannel:y.fromString(e.id+"/Voltage")}],output:i=>[{name:this.translate.instant("EDGE.HISTORY.CURRENT"),converter:()=>i[e.id+"Current"],color:"rgb(253,197,7)",hiddenOnInit:!1,stack:1,yAxisId:B.LEFT},{name:this.translate.instant("EDGE.HISTORY.VOLTAGE"),converter:()=>i[e.id+"Voltage"],color:"rgb(255,0,0)",hiddenOnInit:!1,stack:1,yAxisId:B.RIGHT}],tooltip:{formatNumber:"1.1-2",afterTitle:this.translate.instant("GENERAL.TOTAL")},yAxes:[{unit:Z.VOLTAGE,position:"right",yAxisId:B.RIGHT,displayGrid:!1,scale:{dynamicScale:!0}},{unit:Z.CURRENT,position:"left",yAxisId:B.LEFT}]}}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["currentVoltageChart"]],standalone:!1,features:[S],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(n,i){n&1&&(d(0,"oe-history-data-error",0),f(1,IV,4,1,"table",1),s(2,"div",2),d(3,"ngx-spinner",3),f(4,xV,1,4,"canvas",4),l()),n&2&&(c("response",i.errorResponse),r(),_(i.chartTitle?1:-1),r(),re("height",i.getChartHeight(),"px"),r(),c("name",i.spinnerId),r(),_(i.loading?-1:4))},dependencies:[ye,Ee,me],encapsulation:2})}}return t})();var AV=()=>["day","week"],wV=()=>[];function bV(t,o){t&1&&d(0,"currentVoltageAsymmetricChart",4),t&2&&c("isOnlyChart",!0)}function DV(t,o){t&1&&d(0,"currentVoltageChart",4),t&2&&c("isOnlyChart",!0)}function RV(t,o){if(t&1){let e=W();s(0,"oe-chart",2),g(1,"translate"),O("setShowTotal",function(i){P(e);let a=p();return L(a.setShowTotal(i))})("setShowPhases",function(i){P(e);let a=p();return L(a.setShowPhases(i))}),d(2,"pickdate",3),f(3,bV,1,1,"currentVoltageAsymmetricChart",4),f(4,DV,1,1,"currentVoltageChart",4),l()}if(t&2){let e=p();c("title",e.component.alias+"\xA0-\xA0"+E(1,7,"EDGE.HISTORY.CURRENT_AND_VOLTAGE"))("showPhases",e.showPhases)("showTotal",e.showTotal)("period",e.service.historyPeriod.value),r(2),c("historyPeriods",H(9,AV)),r(),_(e.isMeterAsymmetric?3:-1),r(),_(e.isMeterAsymmetric?-1:4)}}function OV(t,o){t&1&&d(0,"oe-footer-subnavigation",1),t&2&&c("backButton",!0)("navigationOptions",H(2,wV))}var lc=(()=>{class t extends et{constructor(){super(...arguments),this.isMeterAsymmetric=null}afterIsInitialized(){this.isMeterAsymmetric=this.config.hasComponentNature("io.openems.edge.meter.api.ElectricityMeter",this.route.snapshot.params.componentId)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,features:[S],decls:2,vars:2,consts:[[3,"title","showPhases","showTotal","period"],[3,"backButton","navigationOptions"],[3,"setShowTotal","setShowPhases","title","showPhases","showTotal","period"],["custom-pickdate","",3,"historyPeriods"],[3,"isOnlyChart"]],template:function(n,i){n&1&&(f(0,RV,5,10,"oe-chart",0),f(1,OV,1,3,"oe-footer-subnavigation",1)),n&2&&(_(i.isInitialized&&i.isMeterAsymmetric!==null?0:-1),r(),_(i.isInitialized?1:-1))},dependencies:[xn,tt,In,Jg,e1,V],encapsulation:2})}}return t})();var t1=(()=>{class t extends un{static{this.METHOD="getUserInformation"}constructor(){super(t.METHOD,{})}}return t})();var n1=(()=>{class t extends un{static{this.METHOD="setUserInformation"}constructor(e){super(t.METHOD,e),this.params=e}}return t})();var i1=(()=>{class t extends un{static{this.METHOD="updateUserLanguage"}constructor(e){super(t.METHOD,e),this.params=e}}return t})();var NV=()=>({cssClass:"custom-ion-popover"});function MV(t,o){if(t&1){let e=W();s(0,"ion-card")(1,"ion-item",4),d(2,"ion-icon",13),s(3,"ion-label",6),h(4),g(5,"translate"),l()(),s(6,"ion-card-content",6)(7,"ion-item",14)(8,"ion-label"),h(9),g(10,"translate"),l(),s(11,"ion-label"),h(12),l()(),s(13,"ion-item",14)(14,"ion-label"),h(15),g(16,"translate"),l(),s(17,"ion-label"),h(18),l()(),s(19,"ion-item",14)(20,"ion-label"),h(21),g(22,"translate"),l(),s(23,"ion-label"),h(24),g(25,"translate"),l()(),s(26,"ion-item",10)(27,"ion-button",15),O("click",function(){P(e);let i=p();return L(i.doLogout())}),s(28,"ion-label"),h(29),g(30,"translate"),l(),d(31,"ion-icon",16),l()()()()}if(t&2){let e=o,n=p();r(4),R(" ",E(5,8,"MENU.USER")," "),r(5),R(" ",E(10,10,"MENU.NAME")," "),r(3),R(" ",n.form!=null&&n.form.model?(((n.form==null||n.form.model==null?null:n.form.model.firstname)??"")+" "+((n.form==null||n.form.model==null?null:n.form.model.lastname)??"")).trim():e.name," "),r(3),R(" ",E(16,12,"LOGIN.TITLE")," "),r(3),R(" ",e.id," "),r(3),R(" ",E(22,14,"MENU.ACCESS_LEVEL")," "),r(3),R(" ",E(25,16,"Role."+e.globalRole)," "),r(5),N(E(30,18,"MENU.LOGOUT"))}}function FV(t,o){t&1&&(h(0," ("),s(1,"span",17),h(2,"REGISTER.FORM.PRIVATE"),l(),h(3,") "))}function GV(t,o){if(t&1){let e=W();s(0,"ion-card")(1,"ion-item",4),d(2,"ion-icon",13),s(3,"ion-label",6)(4,"span",17),h(5," REGISTER.FORM.CONTACT_DETAILS "),l(),f(6,FV,4,0),l()(),s(7,"ion-card-content"),d(8,"oe-formly-skeleton-wrapper",18),s(9,"ion-item",10)(10,"ion-button",19),O("click",function(){P(e);let i=p();return L(i.enableAndDisableEditMode())}),s(11,"ion-label"),h(12),g(13,"translate"),g(14,"translate"),l(),d(15,"ion-icon",20),l(),s(16,"ion-button",21),O("click",function(){P(e);let i=p();return L(i.applyChanges())}),s(17,"ion-label"),h(18),g(19,"translate"),l(),d(20,"ion-icon",22),l()()()()}if(t&2){let e=p();r(6),_(e.companyInformationFields.length>0?6:-1),r(2),c("show",e.showInformation)("form",e.form==null?null:e.form.formGroup)("fields",e.userInformationFields)("model",e.form==null?null:e.form.model),r(2),c("disabled",!e.isEditModeDisabled&&!(!(e.form==null||e.form.formGroup==null)&&e.form.formGroup.dirty)),r(2),N(e.isEditModeDisabled?E(13,9,"GENERAL.EDIT"):E(14,11,"GENERAL.RESET")),r(4),c("disabled",!(!(e.form==null||e.form.formGroup==null)&&e.form.formGroup.dirty)),r(2),N(E(19,13,"GENERAL.SAVE"))}}function PV(t,o){if(t&1&&(s(0,"ion-card")(1,"ion-item",4),d(2,"ion-icon",13),s(3,"ion-label",6),h(4),g(5,"translate"),g(6,"translate"),l()(),s(7,"ion-card-content"),d(8,"oe-formly-skeleton-wrapper",18),l()()),t&2){let e=p();r(4),Ts(" ",E(5,6,"REGISTER.FORM.CONTACT_DETAILS")," (",E(6,8,"REGISTER.FORM.COMPANY"),") "),r(4),c("show",e.showInformation)("form",e.form==null?null:e.form.formGroup)("fields",e.companyInformationFields)("model",e.form==null?null:e.form.model)}}function LV(t,o){if(t&1&&(s(0,"div")(1,"p",23),h(2,"ABOUT.BUILD"),l(),s(3,"ul")(4,"li")(5,"a",24),h(6),g(7,"version"),l()()()()),t&2){let e=p();r(6),N(q(7,1,e.uiVersion,o))}}function kV(t,o){if(t&1&&(s(0,"ion-select-option",12),h(1),l()),t&2){let e=o.$implicit;c("value",e),r(),R(" ",e.title," ")}}function VV(t,o){if(t&1){let e=W();s(0,"ion-item",26)(1,"ion-checkbox",25),O("ionChange",function(i){P(e);let a=p(2);return L(a.toggleNewUI(i))}),Zt("ngModelChange",function(i){P(e);let a=p(2);return Qt(a.useNewUi,i)||(a.useNewUi=i),L(i)}),h(2,"Neues UI "),l()()}if(t&2){let e=p(2);c("disabled",e.newNavigationForced),r(),Kt("ngModel",e.useNewUi)}}function HV(t,o){t&1&&(s(0,"ion-note",27)(1,"small"),h(2," The language can not be changed permanently in the local online-monitoring for technical reasons."),l()())}function BV(t,o){if(t&1){let e=W();s(0,"ion-item",10)(1,"ion-checkbox",25),O("ionChange",function(i){P(e);let a=p();return L(a.toggleDebugMode(i))}),Zt("ngModelChange",function(i){P(e);let a=p();return Qt(a.environment.debugMode,i)||(a.environment.debugMode=i),L(i)}),h(2,"Debug-Mode "),l()(),f(3,VV,3,2,"ion-item",26),f(4,HV,3,0,"ion-note",27)}if(t&2){let e=p();r(),Kt("ngModel",e.environment.debugMode),r(2),_(e.useNewUi!==null?3:-1),r(),_(e.environment.backend==="OpenEMS Edge"?4:-1)}}var cc=class t{static{this.DEFAULT_THEME=Os.LIGHT}constructor(o,e,n,i,a){this.translate=o,this.service=e,this.websocket=n,this.userService=i,this.navigationService=a,this.themes=[{key:"Light",value:"light"},{key:"Dark",value:"dark"},{key:"System",value:"system"}],this.environment=pt,this.uiVersion=Pd.UI_VERSION,this.languages=Ze.ALL,this.isEditModeDisabled=!0,this.showInformation=!1,this.userInformationFields=[{key:"firstname",type:"input",props:{label:this.translate.instant("REGISTER.FORM.FIRSTNAME"),disabled:!0}},{key:"lastname",type:"input",props:{label:this.translate.instant("REGISTER.FORM.LASTNAME"),disabled:!0}}],this.companyInformationFields=[],this.isAtLeastAdmin=!1,this.isAllowedToSeeUserDetails=!0,this.useNewUi=null,this.newNavigationForced=!1,wt(()=>ae(this,null,function*(){let m=this.userService.currentUser();m&&this.form==null&&(this.isAtLeastAdmin=Rt.isAtLeast(m.globalRole,Rt.ADMIN),yield this.updateUserInformation(),this.isAllowedToSeeUserDetails=this.isUserAllowedToSeeContactDetails(m.id),this.showInformation=this.form!=null,this.userTheme=m.getThemeFromSettings()??t.DEFAULT_THEME,this.useNewUi=m.getUseNewUIFromSettings(),this.newNavigationForced=fn.forceNewNavigation(wp(()=>this.service.currentEdge())))}))}ngOnInit(){this.currentLanguage=Ze.getByKey(localStorage.LANGUAGE)??Ze.DEFAULT,this.systemTheme=pt.theme}setTheme(o){this.userService.selectTheme(o)}applyChanges(){let o={user:{lastname:this.form.model.lastname,firstname:this.form.model.firstname,email:this.form.model.email,phone:this.form.model.phone,address:{street:this.form.model.street,zip:this.form.model.zip,city:this.form.model.city,country:this.form.model.country}}};this.service.websocket.sendRequest(new n1(o)).then(()=>{this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(e=>{this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+e.error.message,"danger")}),this.enableAndDisableFormFields(),this.form.formGroup.markAsPristine()}enableAndDisableEditMode(){this.isEditModeDisabled||this.updateUserInformation(),this.enableAndDisableFormFields()}enableAndDisableFormFields(){return this.userInformationFields=this.userInformationFields.map(o=>(o.props.disabled=!o.props.disabled,o)),this.isEditModeDisabled=!this.isEditModeDisabled}getUserInformation(){return new Promise(o=>{let e=setInterval(()=>{this.websocket.status==="online"&&(this.service.websocket.sendRequest(new t1).then(n=>{let i=n.result.user;o(ke({lastname:i.lastname,firstname:i.firstname,email:i.email,phone:i.phone,street:i.address.street,zip:i.address.zip,city:i.address.city,country:i.address.country},i.company?.name?{companyName:i.company.name}:{}))}).catch(()=>{o({lastname:"",firstname:"",email:"",phone:"",street:"",zip:"",city:"",country:""})}),clearInterval(e))},1e3)})}doLogout(){this.userService.currentUser.set(null),this.websocket.logout()}toggleDebugMode(o){localStorage.setItem("DEBUGMODE",o.detail.checked),this.environment.debugMode=o.detail.checked}toggleNewUI(o){return ae(this,null,function*(){let e=o.detail.checked;this.service.startSpinner("user"),yield this.userService.updateUserSettingsWithProperty("useNewUI",e),this.service.stopSpinner("user")})}setLanguage(o){localStorage.LANGUAGE=o.key,this.service.setLang(o),this.websocket.sendRequest(new i1({language:o.key})).then(()=>{this.service.toast(this.translate.instant("GENERAL.CHANGE_ACCEPTED"),"success")}).catch(e=>{this.service.toast(this.translate.instant("GENERAL.CHANGE_FAILED")+`
`+e.error.message,"danger")}),this.currentLanguage=o,this.translate.use(o.key)}updateUserInformation(){return this.getUserInformation().then(o=>{this.form={formGroup:new hi({}),model:o};let e=[{key:"street",type:"input",props:{label:this.translate.instant("REGISTER.FORM.STREET"),disabled:!0}},{key:"zip",type:"input",props:{label:this.translate.instant("REGISTER.FORM.ZIP"),disabled:!0}},{key:"city",type:"input",props:{label:this.translate.instant("REGISTER.FORM.CITY"),disabled:!0}},{key:"country",type:"select",props:{label:this.translate.instant("REGISTER.FORM.COUNTRY"),options:ac(this.translate),disabled:!0}},{key:"email",type:"input",props:{label:this.translate.instant("REGISTER.FORM.EMAIL"),disabled:!0},validators:{validation:[le.email]}},{key:"phone",type:"input",props:{label:this.translate.instant("REGISTER.FORM.PHONE"),disabled:!0}}];Object.prototype.hasOwnProperty.call(o,"companyName")?this.companyInformationFields=[{key:"companyName",type:"input",props:{label:this.translate.instant("REGISTER.FORM.COMPANY_NAME"),disabled:!0}},...e]:this.userInformationFields=e})}isUserAllowedToSeeContactDetails(o){switch(o){case"demo@fenecon.de":case"pv@schachinger-gaerten.de":case"pv@studentenpark1-straubing.de":return!1;default:return!0}}static{this.\u0275fac=function(e){return new(e||t)(x(te),x(j),x(Ce),x(qn),x(fn))}}static{this.\u0275cmp=I({type:t,selectors:[["ng-component"]],standalone:!1,decls:41,vars:29,consts:[["langSelect",""],["name","user"],[1,"ion-justify-content-center"],["size","12","size-md","8","size-xl","4"],["lines","full","color","light"],["slot","start","size","large","color","primary","name","code-slash-outline"],[1,"ion-text-wrap"],[1,"ion-padding",3,"innerHTML"],["target","_blank","href","https://openems.io","translate","",1,"ion-link"],["slot","start","size","large","color","primary","name","options-outline"],["lines","none"],["interface","popover",3,"ionChange","value","interfaceOptions","label"],[3,"value"],["slot","start","size","large","color","primary","name","person-outline"],["lines","inset"],["slot","end",2,"padding-top","0.8em",3,"click"],["name","log-out-outline"],["translate",""],[3,"show","form","fields","model"],["slot","start",2,"padding-top","0.3em",3,"click","disabled"],["name","pencil-outline","slot","end"],["slot","end",3,"click","disabled"],["name","save-outline","slot","end"],["translate","",1,"ion-padding"],["routerLinkActive","active","routerLink","/changelog",1,"ion-link"],[3,"ionChange","ngModelChange","ngModel"],["lines","none",3,"disabled"],[1,"ion-padding"]],template:function(e,n){if(e&1){let i=W();d(0,"ngx-spinner",1),s(1,"ion-content")(2,"ion-grid")(3,"ion-row",2)(4,"ion-col",3),f(5,MV,32,20,"ion-card"),g(6,"async"),f(7,GV,21,15,"ion-card"),f(8,PV,9,10,"ion-card"),l(),s(9,"ion-col",3)(10,"ion-card")(11,"ion-item",4),d(12,"ion-icon",5),s(13,"ion-label",6),h(14),g(15,"translate"),l()(),s(16,"ion-card-content",6),d(17,"p",7),g(18,"translate"),s(19,"ul")(20,"li")(21,"a",8),h(22,"ABOUT.OPEN_EMS"),l()()(),f(23,LV,8,4,"div"),g(24,"async"),d(25,"p",7),g(26,"translate"),l()(),s(27,"ion-card")(28,"ion-item",4),d(29,"ion-icon",9),s(30,"ion-label"),h(31),g(32,"translate"),l()(),s(33,"ion-card-content")(34,"ion-item",10)(35,"ion-select",11,0),g(37,"translate"),O("ionChange",function(){P(i);let m=it(36);return L(n.setLanguage(m.value))}),fe(38,kV,2,2,"ion-select-option",12,xe),l()(),f(40,BV,5,3),l()()()()()()}if(e&2){let i,a;r(5),_((i=(i=E(6,14,n.service.metadata))==null?null:i.user)?5:-1,i),r(2),_(n.isAllowedToSeeUserDetails?7:-1),r(),_(n.companyInformationFields.length>0?8:-1),r(6),Sp(" ",n.environment.edgeShortName," - ",n.environment.edgeLongName," ",E(15,16,"ABOUT.ENERGY_MANAGEMENT")," "),r(3),c("innerHTML",E(18,18,"ABOUT.DESCRIPTION"),Vn),r(6),_((a=(a=E(24,20,n.service.metadata))==null||a.user==null?null:a.user.globalRole)?23:-1,a),r(2),c("innerHTML",E(26,22,"ABOUT.CONTACT"),Vn),r(6),N(E(32,24,"MENU.GENERAL_SETTINGS")),r(4),c("value",n.currentLanguage)("interfaceOptions",H(28,NV))("label",E(37,26,"ABOUT.LANGUAGE")),r(3),_e(n.languages),r(2),_(n.isAtLeastAdmin?40:-1)}},dependencies:[me,rC,Ie,Tn,Ge,Ht,We,zt,Ae,je,Me,ie,J,ne,qo,Se,jn,Yn,ft,$e,bs,ii,ta,Ne,lt,jd,V],encapsulation:2})}};var o1=t=>[{path:"history",providers:[{useClass:vh,provide:kt}],component:wm,children:[{path:"",component:Eh,data:ke({},t?{navbarTitleToBeTranslated:"GENERAL.HISTORY"}:{})},{path:":componentId/asymmetricpeakshavingchart",component:z_},{path:":componentId/delayedselltogridchart",component:K_},{path:":componentId/enerixcontrolchart",component:b_},{path:":componentId/gridOptimizedChargeChart",component:O_},{path:":componentId/heatingelementchart",component:H_},{path:":componentId/heatmypvchart",component:Vl},{path:":componentId/heatchart",component:Vl},{path:":componentId/heatpumpchart",loadChildren:()=>import("./chunk-YYNKIFCG.js").then(o=>o.HeatPumpModule)},{path:":componentId/modbusTcpApi",component:W_},{path:":componentId/scheduleChart",component:M_},{path:":componentId/symmetricpeakshavingchart",component:Y_},{path:":componentId/timeslotpeakshavingchart",component:X_},{path:"autarchychart",component:m0},{path:"consumptionchart",component:C0},{path:"consumptionchart/:componentId",component:_0},{path:"consumptionchart/:componentId/currentVoltage",component:lc},{path:"gridchart",component:__},{path:"gridchart/externalLimitation",component:p_},{path:"gridchart/:componentId",component:u_},{path:"gridchart/:componentId/currentVoltage",component:lc},{path:"productionchart",component:y_},{path:"productionchart/:componentId",component:E_},{path:"productionchart/:componentId/currentVoltage",component:lc},{path:"selfconsumptionchart",component:I_},{path:"storagechart",loadChildren:()=>import("./chunk-IMDVPJ2H.js").then(o=>o.CommonStorage)},{path:"channelthresholdchart",component:S_},{path:"digitaloutputchart",component:k_},{path:"digitaloutputchart/:componentId",component:P_}]}],WV=[{path:"",redirectTo:"index",pathMatch:"full"},{path:"index",component:Zg},{path:"login",component:us,data:{navbarTitle:pt.uiTitle}},{path:"overview",component:Qg},{path:"user",component:cc,data:{navbarTitleToBeTranslated:"MENU.USER"}},{path:"changelog",loadChildren:()=>import("./chunk-F4PCHHQV.js").then(t=>t.ChangelogModule),data:{navbarTitleToBeTranslated:"MENU.CHANGELOG"}},{path:"device/:edgeId",component:l0,children:[{path:"",redirectTo:"live",pathMatch:"full"},{path:"live",data:{navbarTitle:pt.uiTitle},providers:[{useClass:ci,provide:kt}],component:wm,children:[{path:"",component:zg},{path:"evse/:componentId",component:bm},{path:"evse/:componentId/history",component:Ah},{path:"evse/:componentId/settings",component:yC},{path:"evse/:componentId/forecast",component:Ih},{path:"evse/:componentId/car/update/:appId",component:TC,canActivate:[su(Rt.OWNER)]},{path:"io-heating-room/:componentId",component:Fm},...o1(!0)]},{path:"settings",loadChildren:()=>import("./chunk-CW235RNI.js").then(t=>t.SettingsRoutingModule)},...o1(!1)]},{path:"demo",component:us},{path:"**",pathMatch:"full",redirectTo:"index"}];var r1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[na.forRoot(WV,{preloadingStrategy:Bp,paramsInheritanceStrategy:"always"}),na]})}}return t})();var a1=kd("SplashScreen",{web:()=>import("./chunk-4EID6XOE.js").then(t=>new t.SplashScreenWeb)});var s1=(()=>{class t{constructor(e,n,i){this.service=e,this.router=n,this.translate=i,this.router.events.pipe(vt(a=>a instanceof Vp),Xr(a=>{let m=null,u=a.state.root;for(;u;)m=u.data||m,u=u.firstChild;return m})).subscribe(a=>ae(this,null,function*(){let m=Object.entries(a).map(([C,v])=>({key:C,value:v})).reverse()[0]??null;if(m==null)return;let u=m.key==="navbarTitle"?m.value:(m.key==="navbarTitleToBeTranslated"?i.instant(m.value):null)??this.service.currentPageTitle??pt.uiTitle;this.service.currentPageTitle=u}))}static{this.\u0275fac=function(n){return new(n||t)(Jt(j),Jt(It),Jt(te))}}static{this.\u0275prov=xi({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var zV=()=>({value:"OpenEMS"});function jV(t,o){}function YV(t,o){t&1&&G(0,jV,0,0,"ng-template")}function $V(t,o){}function XV(t,o){t&1&&G(0,$V,0,0,"ng-template")}function qV(t,o){if(t&1&&G(0,YV,1,0,null,5)(1,XV,1,0,null,5),t&2){p(2);let e=it(7),n=it(9);c("ngTemplateOutlet",n),r(),c("ngTemplateOutlet",e)}}function KV(t,o){t&1&&_o(0)}function QV(t,o){}function ZV(t,o){t&1&&G(0,QV,0,0,"ng-template")}function JV(t,o){if(t&1&&(s(0,"ion-split-pane",6),G(1,KV,1,0,"ng-container",5),s(2,"div",7),G(3,ZV,1,0,null,5),l()()),t&2){p(2);let e=it(7),n=it(9);r(),c("ngTemplateOutlet",n),r(2),c("ngTemplateOutlet",e)}}function eH(t,o){t&1&&_o(0)}function tH(t,o){t&1&&_o(0)}function nH(t,o){if(t&1&&G(0,eH,1,0,"ng-container",5)(1,tH,1,0,"ng-container",5),t&2){p(2);let e=it(7),n=it(9);c("ngTemplateOutlet",e),r(),c("ngTemplateOutlet",n)}}function iH(t,o){if(t&1&&(s(0,"ion-content"),f(1,qV,2,2),f(2,JV,4,2,"ion-split-pane",6),f(3,nH,2,2),l()),t&2){let e=p();r(),_(e.navigationService.position()==="disabled"?1:-1),r(),_(e.navigationService.position()==="left"?2:-1),r(),_(e.navigationService.position()==="bottom"?3:-1)}}function oH(t,o){if(t&1&&d(0,"oe-notification",4),t&2){let e=p();c("text",e.latestIncident.message)("id",e.latestIncident.id)}}function rH(t,o){t&1&&_o(0)}function aH(t,o){t&1&&(s(0,"ion-item",11),d(1,"ion-icon",12),s(2,"ion-label",13)(3,"h2",14),h(4,"INDEX.CONNECTION_IN_PROGRESS"),l()()())}function sH(t,o){if(t&1&&(s(0,"ion-item",11),d(1,"ion-icon",15),s(2,"ion-label",13)(3,"h2",16),h(4,"INDEX.CONNECTION_FAILED"),l(),s(5,"p",11),h(6),l()()()),t&2){let e=p(3);r(3),c("translateParams",H(2,zV)),r(3),N(e.environment.url)}}function lH(t,o){if(t&1&&(s(0,"ion-grid")(1,"ion-row",9)(2,"ion-col",10)(3,"ion-card"),f(4,aH,5,0,"ion-item",11)(5,sH,7,3,"ion-item",11),l()()()()),t&2){let e,n=p(2);r(4),_((e=n.websocket.status)==="connecting"?4:e==="failed"?5:-1)}}function cH(t,o){t&1&&d(0,"systemLog")}function mH(t,o){if(t&1&&(f(0,lH,6,1,"ion-grid"),f(1,cH,1,0,"systemLog"),d(2,"ion-router-outlet",8)),t&2){let e=p();_(e.websocket.status==="connecting"||e.websocket.status==="failed"?0:-1),r(),_(e.isSystemLogEnabled?1:-1)}}function pH(t,o){if(t&1){let e=W();s(0,"ion-item",19),O("keydown.enter",function(){P(e);let i=p(2);return i.navCtrl.navigateRoot("/user"),L(i.menu.close())})("click",function(){P(e);let i=p(2);return i.navCtrl.navigateRoot("/user"),L(i.menu.close())}),d(1,"ion-icon",20),s(2,"ion-label")(3,"p",21),h(4),l(),s(5,"ion-text")(6,"p",22),h(7),l()()()()}if(t&2){let e=o;r(4),N(e.name),r(3),N(e.id)}}function dH(t,o){if(t&1){let e=W();s(0,"ion-item",24),O("click",function(){P(e);let i=p(3);return L(i.menu.close())}),s(1,"ion-label"),h(2),g(3,"translate"),l()()}t&2&&(r(2),N(E(3,1,"MENU.OVERVIEW")))}function uH(t,o){if(t&1&&f(0,dH,4,3,"ion-item",23),t&2){let e=p(2);_(e.isUserAllowedToSeeOverview?0:-1)}}function fH(t,o){if(t&1){let e=W();s(0,"nav")(1,"ion-item",25),O("click",function(){P(e);let i=p(2);return L(i.menu.close())}),s(2,"ion-label"),h(3),g(4,"translate"),l()()()}t&2&&(r(),c("routerLink",Ui("/device/",o.id,"/settings")),r(2),N(E(4,3,"MENU.EDGE_SETTINGS")))}function _H(t,o){if(t&1){let e=W();s(0,"oe-navigation-chips",26),O("navigate",function(i){P(e);let a=p(2);return L(a.navigationService.navigateTo(i))}),l()}}function hH(t,o){if(t&1&&(s(0,"ion-menu",17)(1,"ion-list"),f(2,pH,8,2,"ion-item",18),g(3,"async"),f(4,uH,1,1),g(5,"async"),f(6,fH,5,5,"nav"),f(7,_H,1,0,"oe-navigation-chips"),l()()),t&2){let e,n,i,a=p();c("contentId",a.navigationService.position==="left"?"main":"content")("type",a.navigationService.position==="left"?"":"overlay"),r(2),_((e=(e=E(3,6,a.service.metadata))==null?null:e.user)?2:-1,e),r(2),_((n=E(5,8,a.service.metadata))?4:-1,n),r(2),_((i=a.service.currentEdge())?6:-1,i),r(),_(!a.service.isSmartphoneResolution&&a.navigationService.position()==="left"?7:-1)}}function CH(t,o){t&1&&(s(0,"ion-footer")(1,"ion-toolbar",28)(2,"ion-grid")(3,"ion-row",9)(4,"ion-col",10)(5,"span",14),h(6,"GENERAL.SYSTEM_OUTAGE"),l(),s(7,"span"),h(8,"\xA0"),l(),s(9,"a",29),h(10,"status.fenecon.de"),l()()()()()())}function gH(t,o){t&1&&d(0,"oe-footer",27,3)}function EH(t,o){if(t&1&&(f(0,CH,11,0,"ion-footer"),f(1,gH,2,0,"oe-footer",27)),t&2){let e=p();_(e.isSystemOutage?0:-1),r(),_(e.isUserAllowedToSeeFooter&&!e.isHistoryDetailView?1:-1)}}var l1=(()=>{class t{constructor(e,n,i,a,m,u,C,v,T,A,b,F,k,Q,ve,Re){this.platform=e,this.menu=n,this.modalCtrl=i,this.router=a,this.service=m,this.userService=u,this.toastController=C,this.websocket=v,this.globalRouteChangeHandler=T,this.meta=A,this.appService=b,this.title=F,this.stateService=k,this.navigationService=Q,this.navCtrl=ve,this.translate=Re,this.environment=pt,this.backUrl="/",this.isSystemLogEnabled=!1,this.isUserAllowedToSeeOverview=!1,this.isUserAllowedToSeeFooter=!1,this.isHistoryDetailView=!1,this.latestIncident=null,this.ngUnsubscribe=new qt,this.subscription=new hs,m.setLang(Ze.getByKey(localStorage.LANGUAGE)??Ze.getByBrowserLang(navigator.language)),this.subscription.add(this.service.metadata.pipe(vt(se=>!!se)).subscribe(se=>{this.isUserAllowedToSeeOverview=Sc.isUserAllowedToSeeOverview(se.user),this.isUserAllowedToSeeFooter=Sc.isUserAllowedToSeeFooter(se.user)})),this.subscription.add(this.router.events.pipe(vt(se=>se instanceof ea)).subscribe(se=>{let ge=se.url.split("/");this.isHistoryDetailView=ge.slice(0,-1).includes("history")})),this.appService.listen(),a1.hide()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete(),this.subscription.unsubscribe()}ngOnInit(){localStorage.getItem("DEBUGMODE")&&(this.environment.debugMode=JSON.parse(localStorage.getItem("DEBUGMODE"))),this.service.notificationEvent.pipe(An(this.ngUnsubscribe)).subscribe(e=>ae(this,null,function*(){(yield this.toastController.create({message:e.message,position:"top",duration:2e3,buttons:[{text:"Ok",role:"cancel"}]})).present()})),this.platform.ready().then(()=>{let e=getComputedStyle(document.documentElement).getPropertyValue("--ion-color-background");this.meta.updateTag({name:"theme-color",content:e}),this.service.deviceHeight=this.platform.height(),this.service.deviceWidth=this.platform.width(),this.checkSmartphoneResolution(!0),this.platform.resize.pipe(An(this.ngUnsubscribe)).subscribe(()=>{this.service.deviceHeight=this.platform.height(),this.service.deviceWidth=this.platform.width(),this.checkSmartphoneResolution(!1)})}),this.title.setTitle(pt.edgeShortName)}checkSmartphoneResolution(e){e==!0?this.platform.width()<=576?(this.service.isSmartphoneResolution=!0,this.service.isSmartphoneResolutionSubject.next(!0)):this.platform.width()>576&&(this.service.isSmartphoneResolution=!1,this.service.isSmartphoneResolutionSubject.next(!1)):this.platform.width()<=576&&this.service.isSmartphoneResolution==!1?(this.service.isSmartphoneResolution=!0,this.service.isSmartphoneResolutionSubject.next(!0)):this.platform.width()>576&&this.service.isSmartphoneResolution==!0&&(this.service.isSmartphoneResolution=!1,this.service.isSmartphoneResolutionSubject.next(!1))}static{this.\u0275fac=function(n){return new(n||t)(x(zp),x(yr),x(he),x(It),x(j),x(qn),x(pd),x(Ce),x(s1),x(Gp),x(Ei),x(Pp),x(Zo),x(fn),x(Xo),x(te))}}static{this.\u0275cmp=I({type:t,selectors:[["app-root"]],standalone:!1,decls:12,vars:3,consts:[["content",""],["sidemenu",""],["footer",""],["appFooter",""],["color","warning",3,"text","id"],[4,"ngTemplateOutlet"],["when","xs","contentId","main",2,"--side-max-width","10%"],["id","main"],["id","content"],[1,"ion-justify-content-center"],["size","12","size-md","6"],["color","light"],["slot","start","name","wifi-outline"],[1,"ion-text-wrap"],["translate",""],["slot","start","name","close-circle-outline"],["translate","",3,"translateParams"],["menuId","main-menu","side","start",3,"contentId","type"],["tabindex","0","button","","routerLinkActive","active"],["tabindex","0","button","","routerLinkActive","active",3,"keydown.enter","click"],["size","large","color","primary","slot","start","name","person-outline",2,"margin-right","5%"],[2,"color","var(--ion-text-color)"],[2,"color","var(--ion-text-color-shade)"],["lines","full","routerLinkActive","active","routerLink","/overview"],["lines","full","routerLinkActive","active","routerLink","/overview",3,"click"],["lines","inset",3,"click","routerLink"],[3,"navigate"],["slot","fixed"],["color","warning"],["href","https://status.fenecon.de/","target","_blank"]],template:function(n,i){if(n&1&&(s(0,"ion-app"),d(1,"app-header"),f(2,iH,4,3,"ion-content"),d(3,"oe-navigation"),f(4,oH,1,2,"oe-notification",4),G(5,rH,1,0,"ng-container",5),l(),G(6,mH,3,2,"ng-template",null,0,yt)(8,hH,8,10,"ng-template",null,1,yt)(10,EH,2,2,"ng-template",null,2,yt)),n&2){let a=it(11);r(2),_(i.navigationService.position()!==null?2:-1),r(2),_(i.latestIncident!==null?4:-1),r(),c("ngTemplateOutlet",a)}},dependencies:[ii,ta,Jr,Xp,Ht,Ae,je,Kp,Me,ie,J,ne,zn,id,Se,sd,He,ct,aa,ji,hC,ou,iu,Kd,Ne,Qd,lt,V],encapsulation:2})}}return t})();var vH="Service workers are disabled or not supported by this browser",Xm=class{serviceWorker;worker;registration;events;constructor(o,e){if(this.serviceWorker=o,!o)this.worker=this.events=this.registration=new ba(n=>n.error(new Ct(5601,!1)));else{let n=null,i=new qt;this.worker=new ba(v=>(n!==null&&v.next(n),i.subscribe(T=>v.next(T))));let a=()=>{let{controller:v}=o;v!==null&&(n=v,i.next(n))};o.addEventListener("controllerchange",a),a(),this.registration=this.worker.pipe(Cp(()=>o.getRegistration().then(v=>{if(!v)throw new Ct(5601,!1);return v})));let m=new qt;this.events=m.asObservable();let u=v=>{let{data:T}=v;T?.type&&m.next(T)};o.addEventListener("message",u),e?.get(xp,null,{optional:!0})?.onDestroy(()=>{o.removeEventListener("controllerchange",a),o.removeEventListener("message",u)})}}postMessage(o,e){return new Promise(n=>{this.worker.pipe(pn(1)).subscribe(i=>{i.postMessage(ke({action:o},e)),n()})})}postMessageWithOperation(o,e,n){let i=this.waitForOperationCompleted(n),a=this.postMessage(o,e);return Promise.all([a,i]).then(([,m])=>m)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(o){let e;return typeof o=="string"?e=n=>n.type===o:e=n=>o.includes(n.type),this.events.pipe(vt(e))}nextEventOfType(o){return this.eventsOfType(o).pipe(pn(1))}waitForOperationCompleted(o){return new Promise((e,n)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(vt(i=>i.nonce===o),pn(1),Xr(i=>{if(i.result!==void 0)return i.result;throw new Error(i.error)})).subscribe({next:e,error:n})})}get isEnabled(){return!!this.serviceWorker}};var c1=(()=>{class t{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}ongoingCheckForUpdate=null;constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=uc,this.unrecoverable=uc;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED","VERSION_FAILED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(vH));if(this.ongoingCheckForUpdate)return this.ongoingCheckForUpdate;let e=this.sw.generateNonce();return this.ongoingCheckForUpdate=this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e).finally(()=>{this.ongoingCheckForUpdate=null}),this.ongoingCheckForUpdate}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Ct(5601,!1));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static \u0275fac=function(n){return new(n||t)(Jt(Xm))};static \u0275prov=xi({token:t,factory:t.\u0275fac})}return t})();var m1=(()=>{class t{constructor(e,n){this.update=e,this.service=n}static{this.\u0275fac=function(n){return new(n||t)(Jt(c1),Jt(j))}}static{this.\u0275prov=xi({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var qm=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var mc=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,Ve,To,an,_n,gi.forRoot({type:"ball-clip-rotate-multiple"}),Xd,$d]})}}return t})();var Km=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue,To,mc]})}}return t})();var Qm=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var Zm=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,To,ue]})}}return t})();var Jm=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue,To,mc]})}}return t})();var ep=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var p1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[qm,Km,Qm,Zm,Jm,ep,qm,Km,Qm,Zm,Jm,ep]})}}return t})();var tp=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var np=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var Aa=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var ip=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Aa,Aa]})}}return t})();var op=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var rp=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var ap=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue,To]})}}return t})();var sp=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var lp=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[ap,sp,ap,sp]})}}return t})();var cp=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var d1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[ip,rp,lp,tp,np,Aa,cp,op,ip,rp,lp,tp,np,Aa,cp,op]})}}return t})();var u1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[p1,d1,_n,ue]})}}return t})();var f1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,Ve,an]})}}return t})();var _1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var h1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,ue,Sr,Sr]})}}return t})();var C1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var g1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var E1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var v1={de:{TITLE_WITH_LOCATION:"Wettervorhersage f\xFCr {{location}}",MIN_TEMPERATURE:"T: {{temp}}\xB0",MAX_TEMPERATURE:"H: {{temp}}\xB0",SUNSHINE_DURATION_HOURS:"{{duration}} h",WEATHER_CODE_0:"Sonnig",WEATHER_CODE_1:"Heiter",WEATHER_CODE_2:"Teilweise bew\xF6lkt",WEATHER_CODE_3:"Bew\xF6lkt",WEATHER_CODE_45:"Nebel",WEATHER_CODE_48:"Gefrierender Nebel",WEATHER_CODE_51:"Leichter Niesel",WEATHER_CODE_53:"M\xE4\xDFiger Niesel",WEATHER_CODE_55:"Starker Niesel",WEATHER_CODE_56:"Leichter gefrierender Niesel",WEATHER_CODE_57:"Starker gefrierender Niesel",WEATHER_CODE_61:"Leichter Regen",WEATHER_CODE_63:"M\xE4\xDFiger Regen",WEATHER_CODE_65:"Starker Regen",WEATHER_CODE_66:"Leichter gefrierender Regen",WEATHER_CODE_67:"Starker gefrierender Regen",WEATHER_CODE_71:"Leichter Schneefall",WEATHER_CODE_73:"M\xE4\xDFiger Schneefall",WEATHER_CODE_75:"Starker Schneefall",WEATHER_CODE_77:"Graupel",WEATHER_CODE_80:"Leichter Regenschauer",WEATHER_CODE_81:"M\xE4\xDFiger Regenschauer",WEATHER_CODE_82:"Starker Regenschauer",WEATHER_CODE_85:"Leichter Schneeschauer",WEATHER_CODE_86:"Starker Schneeschauer",WEATHER_CODE_95:"Gewitter",WEATHER_CODE_96:"Leichtes Hagelgewitter",WEATHER_CODE_99:"Starkes Hagelgewitter",WEATHER_CODE_0_NIGHT:"Klarer Himmel",WEATHER_CODE_1_NIGHT:"Heiter",WEATHER_CODE_2_NIGHT:"Teilweise bew\xF6lkt",WEATHER_CODE_UNKNOWN:"Unbekannt"},en:{TITLE_WITH_LOCATION:"Weather forecast for {{location}}",MIN_TEMPERATURE:"L: {{temp}}\xB0",MAX_TEMPERATURE:"H: {{temp}}\xB0",SUNSHINE_DURATION_HOURS:"{{duration}} h",WEATHER_CODE_0:"Sunny",WEATHER_CODE_1:"Mainly clear",WEATHER_CODE_2:"Partly cloudy",WEATHER_CODE_3:"Overcast",WEATHER_CODE_45:"Fog",WEATHER_CODE_48:"Depositing rime fog",WEATHER_CODE_51:"Light drizzle",WEATHER_CODE_53:"Moderate drizzle",WEATHER_CODE_55:"Dense drizzle",WEATHER_CODE_56:"Slight freezing drizzle",WEATHER_CODE_57:"Dense freezing drizzle",WEATHER_CODE_61:"Slight rain",WEATHER_CODE_63:"Moderate rain",WEATHER_CODE_65:"Heavy rain",WEATHER_CODE_66:"Light freezing rain",WEATHER_CODE_67:"Heavy freezing rain",WEATHER_CODE_71:"Slight snow fall",WEATHER_CODE_73:"Moderate snow fall",WEATHER_CODE_75:"Heavy snow fall",WEATHER_CODE_77:"Snow grains",WEATHER_CODE_80:"Slight rain showers",WEATHER_CODE_81:"Moderate rain showers",WEATHER_CODE_82:"Heavy rain showers",WEATHER_CODE_85:"Slight snow showers",WEATHER_CODE_86:"Heavy snow showers",WEATHER_CODE_95:"Thunderstorm",WEATHER_CODE_96:"Thunderstorm with slight hail",WEATHER_CODE_99:"Thunderstorm with heavy hail",WEATHER_CODE_0_NIGHT:"Clear sky",WEATHER_CODE_1_NIGHT:"Mainly clear",WEATHER_CODE_2_NIGHT:"Partly cloudy",WEATHER_CODE_UNKNOWN:"Unknown"}};var y1=(()=>{class t{constructor(e){this.translate=e,Cg(),Ze.setAdditionalTranslationFile(v1,e).then(({lang:n,translations:i,shouldMerge:a})=>{e.setTranslation(n,i,a)})}static{this.\u0275fac=function(n){return new(n||t)(Jt(te))}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[ue]})}}return t})();var T1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var I1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var x1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var S1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue,nr]})}}return t})();var A1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var w1={de:{EVSE_SINGLE:{SETTINGS:{ENERGY_LIMIT:"Energielimit"},HOME:{MODE:{LABEL:"Modus",ZERO:"Aus",MINIMUM:"Minimal",SURPLUS:"PV",FORCE:"Schnell"},STATE_MACHINE:{LABEL:"Status",EV_NOT_CONNECTED:"EV nicht verbunden",EV_CONNECTED:"EV verbunden",CHARGING:"L\xE4dt",FINISHED_EV_STOP:"Ladevorgang beendet durch EV",FINISHED_ENERGY_SESSION_LIMIT:"Ladevorgang beendet durch Energielimit",PHASE_SWITCH_TO_THREE_PHASE:"Wechsel auf 3-phasig",PHASE_SWITCH_TO_SINGLE_PHASE:"Wechsel auf 1-phasig"},POWER:"Leistung",ENERGY_SINCE_START:"Energie seit Ladebeginn",VEHICLES:"App Center Fahrzeuge"}}},en:{EVSE_SINGLE:{SETTINGS:{ENERGY_LIMIT:"Energy limit"},HOME:{MODE:{LABEL:"Mode",ZERO:"Off",MINIMUM:"Minimal",SURPLUS:"PV",FORCE:"Fast"},STATE_MACHINE:{LABEL:"State",EV_NOT_CONNECTED:"EV not connected",EV_CONNECTED:"EV connected",CHARGING:"Charging",FINISHED_EV_STOP:"Charging finished by EV",FINISHED_ENERGY_SESSION_LIMIT:"Charging finished by energy limit",PHASE_SWITCH_TO_THREE_PHASE:"Switch to 3-phase",PHASE_SWITCH_TO_SINGLE_PHASE:"Switch to 1-phase"},POWER:"Power",ENERGY_SINCE_START:"Energy since the last charge start",VEHICLES:"App Center Vehicles"}}}};var b1=(()=>{class t extends mt{constructor(e,n){super(),this.router=e,this.route=n,this.urlToNavigate=null}ngOnInit(){this.urlToNavigate=this.buildUrlToNavigate()}onNavigate(){Lt.assertIsDefined(this.urlToNavigate,"link is undefined"),this.router.navigateForward(this.urlToNavigate)}buildUrlToNavigate(){let e=this.props.link;if(e==null)return null;if(e.type==="appUpdate"){let n=this.route.snapshot;for(;n&&n?.routeConfig?.path?.indexOf(":edgeId")===-1;)n=n?.parent;return n==null?null:n.url.join("/")+"/settings/app/update/"+e.appId}return null}static{this.\u0275fac=function(n){return new(n||t)(x(Xo),x(De))}}static{this.\u0275cmp=I({type:t,selectors:[["formly-link"]],standalone:!1,features:[S],decls:6,vars:3,consts:[["lines","none","button","true",3,"click","href"],["aria-hidden","true","name","arrow-redo-outline","slot","end"]],template:function(n,i){n&1&&(s(0,"ion-item",0),O("click",function(m){return m.preventDefault(),i.onNavigate()}),s(1,"ion-label"),h(2),s(3,"p"),h(4),l()(),d(5,"ion-icon",1),l()),n&2&&(c("href",i.urlToNavigate),r(2),R(" ",i.props.label," "),r(2),N(i.props.description))},dependencies:[ie,J,ne],encapsulation:2})}}return t})();var D1=(()=>{class t extends mt{constructor(){super()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=I({type:t,selectors:[["formly-text"]],standalone:!1,features:[S],decls:2,vars:1,consts:[["lines","none"],[3,"innerHTML"]],template:function(n,i){n&1&&(s(0,"ion-item",0),d(1,"ion-text",1),l()),n&2&&(r(),c("innerHTML",i.props.description,Vn))},dependencies:[J,He],styles:[`.warning{color:red}
`],encapsulation:2})}}return t})();function xH(t,o){}var R1=(()=>{class t extends Bt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-input-with-unit"]],standalone:!1,features:[S],decls:7,vars:1,consts:[["fieldComponent",""],[2,"width","100%"],[1,"ion-align-items-center"],["size","auto"]],template:function(n,i){n&1&&(s(0,"ion-grid",1)(1,"ion-row",2)(2,"ion-col"),G(3,xH,0,0,"ng-template",null,0,yt),l(),s(5,"ion-col",3),h(6),l()()()),n&2&&(r(6),R(" ",i.props.unit," "))},dependencies:[Ae,Me,Se],encapsulation:2})}}return t})();function fs(t,o){return t?t.expressions?.title?.(o)??t.title??t.value:null}function SH(t,o){if(t&1){let e=W();s(0,"ion-segment-button",5),O("click",function(){let i=P(e).$index,a=p(2);return L(a.selectedIndex=i)}),s(1,"ion-text",6),h(2),l()()}if(t&2){let e=o.$implicit;c("value",e.group),r(2),R(" ",e.title," ")}}function AH(t,o){if(t&1){let e=W();s(0,"div")(1,"ion-checkbox",9),O("ionChange",function(){P(e);let i=p().$implicit,a=p(4);return L(a.valueChangeCheckbox(i))}),l()()}if(t&2){let e=p().$implicit;r(),c("checked",e.selected)}}function wH(t,o){if(t&1&&d(0,"ion-radio",8),t&2){let e=p().$implicit;c("value",e.value)}}function bH(t,o){if(t&1&&(s(0,"ion-row")(1,"ion-col")(2,"ion-item",7),f(3,AH,2,1,"div")(4,wH,1,1,"ion-radio",8),h(5),l()()()),t&2){let e=o.$implicit,n=p(4);r(2),c("disabled",e.disabled),r(),_(n.multi?3:4),r(2),R(" ",e.title," ")}}function DH(t,o){if(t&1&&(s(0,"div"),fe(1,bH,6,3,"ion-row",null,xe),l()),t&2){let e=p().$implicit;r(),_e(e.options)}}function RH(t,o){if(t&1&&(s(0,"div"),f(1,DH,3,0,"div"),l()),t&2){let e=o.$index,n=p(2);r(),_(n.selectedIndex===e?1:-1)}}function OH(t,o){if(t&1&&(s(0,"ion-segment",4),fe(1,SH,3,2,"ion-segment-button",4,xe),l(),fe(3,RH,2,1,"div",null,xe)),t&2){let e=p();c("value",e.selectedGroup==null?null:e.selectedGroup.group),r(),_e(e.optionGroups),r(2),_e(e.optionGroups)}}function NH(t,o){if(t&1&&(s(0,"div")(1,"ion-grid")(2,"ion-row",10)(3,"ion-col",11)(4,"ion-label")(5,"h1"),h(6),l()()()()()()),t&2){let e=p();r(6),R(" ",e.to.missingOptionsText," ")}}function MH(t,o){}function FH(t,o){if(t&1&&G(0,MH,0,0,"ng-template",2),t&2){let e=p();c("ngTemplateOutlet",e.ShowOptions)}}function GH(t,o){if(t&1&&(s(0,"div",null,1),d(2,"template",2),l()),t&2){p();let e=it(1);r(2),c("ngTemplateOutlet",e)}}function PH(t,o){if(t&1){let e=W();s(0,"ion-radio-group",12,1),Zt("ngModelChange",function(i){P(e);let a=p();return Qt(a.selectedValue,i)||(a.selectedValue=i),L(i)}),O("ionChange",function(){P(e);let i=p();return L(i.valueChange())}),d(2,"template",2),l()}if(t&2){let e=p(),n=it(1);Kt("ngModel",e.selectedValue),c("value",e.selectedValue),r(2),c("ngTemplateOutlet",n)}}var O1=(()=>{class t extends mt{constructor(){super(...arguments),this.multi=!1,this.selectedGroup=null,this.selectedIndex=0,this.optionGroups=[]}static getOptionGroups(e,n){return n.map(i=>({group:i.group,title:i.title,options:i.options.filter(a=>!(a.expressions?.hide?.(e)??a.hide??!1)).map(a=>({value:a.value,title:fs(a,e),disabled:a.expressions?.disabled?.(e)??a.disabled??!1,selected:!1}))})).filter(i=>i.options.length!==0)}ngOnInit(){this.multi=this.props.isMulti??!1,this.selectedValue=this.formControl.getRawValue(),this.multi&&!Array.isArray(this.selectedValue)&&(this.selectedValue=[this.selectedValue]),this.invalidateOptionGroups(),this.optionGroups.forEach((e,n)=>{let i=!1;for(let a of e.options)if(this.isMulti(this.selectedValue)){if(!this.selectedValue.some(m=>m===a.value))continue;i=!0,a.selected=!0}else{if(a.value!==this.selectedValue)continue;i=!0,a.selected=!0}i&&(this.selectedGroup=e,this.selectedIndex=n)}),!this.selectedGroup&&this.optionGroups.length>0&&(this.selectedGroup=this.optionGroups[0],this.selectedIndex=0)}valueChange(){this.formControl.setValue(this.selectedValue),this.form.markAsDirty()}valueChangeCheckbox(e){this.isMulti(this.selectedValue)&&(e.selected=!e.selected,this.selectedValue.includes(e.value)?this.selectedValue.splice(this.selectedValue.indexOf(e.value),1):this.selectedValue.push(e.value),this.valueChange())}isMulti(e){return this.multi}invalidateOptionGroups(){this.optionGroups=t.getOptionGroups(this.field,this.props.options)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["formly-option-group-picker"]],standalone:!1,features:[S],decls:6,vars:2,consts:[["inside",""],["elseShowOptions",""],[3,"ngTemplateOutlet"],[3,"ngModel","value"],[3,"value"],[3,"click","value"],["translate","",2,"white-space","initial"],[3,"disabled"],["slot","start",3,"value"],["labelPlacement","start",1,"ion-margin-end",3,"ionChange","checked"],[1,"ion-justify-content-center"],["size","12",1,"ion-text-center"],[3,"ngModelChange","ionChange","ngModel","value"]],template:function(n,i){n&1&&(G(0,OH,5,1,"ng-template",null,0,yt),f(2,NH,7,1,"div")(3,FH,1,1,null,2),f(4,GH,3,1,"div")(5,PH,3,3,"ion-radio-group",3)),n&2&&(r(2),_(i.optionGroups.length===0?2:3),r(2),_(i.multi?4:5))},dependencies:[Jr,Ie,Tn,zt,Ae,Me,J,ne,Eo,vo,Se,ri,ai,He,ft,$e,Ne],encapsulation:2})}}return t})();var LH=()=>({cssClass:"custom-ion-popover"});function kH(t,o){t&1&&d(0,"ion-reorder",11)}function VH(t,o){if(t&1){let e=W();s(0,"ion-item",1),f(1,kH,1,0,"ion-reorder",11),s(2,"ion-label"),h(3),l(),s(4,"ion-buttons")(5,"ion-button",12),O("click",function(){let i=P(e).$implicit,a=p();return L(a.removeItem(i))}),d(6,"ion-icon",13),l()()()}if(t&2){let e=o.$implicit;c("id",e.value)("disabled",e.expressions.locked),r(),_(e.expressions.locked?-1:1),r(2),R(" ",e.label," ")}}function HH(t,o){if(t&1&&(s(0,"ion-label",5),h(1),l()),t&2){let e=p();r(),R(" ",e.props.label," ")}}function BH(t,o){if(t&1&&(s(0,"ion-select-option",7),h(1),l()),t&2){let e=o.$implicit;c("value",e),r(),R(" ",e.label," ")}}var N1=(()=>{class t extends mt{constructor(){super(...arguments),this.selectedItems=[],this.itemToAdd=null}get allowDuplicates(){return this.props.allowDuplicates??!1}get selectOptions(){return this.props.selectOptions.map(e=>({label:e.label,value:e.value,expressions:{locked:e.expressions?.locked?.(this.field)??!1}}))??[]}ngOnInit(){let e=this.formControl.getRawValue();if(this.availableItems=this.selectOptions,e)for(let n of e){let i=this.availableItems.findIndex(a=>a.value===n);i!==-1&&(this.selectedItems.push(this.availableItems[i]),this.allowDuplicates||this.availableItems.splice(i,1))}this.availableItems.length!==0&&(this.itemToAdd=this.availableItems[0]),this.updateValue()}doReorder(e){if(this.selectedItems[e.detail.to].expressions.locked){e.detail.complete(!1);return}this.selectedItems=e.detail.complete(this.selectedItems),this.updateValue()}removeItem(e){let n=this.selectedItems.splice(this.selectedItems.indexOf(e),1);this.updateValue(),!this.allowDuplicates&&(this.availableItems.push(...n),this.itemToAdd||(this.itemToAdd=n[0]))}addItem(){this.itemToAdd&&(this.selectedItems.push(this.itemToAdd),this.updateValue(),!this.allowDuplicates&&(this.availableItems.splice(this.availableItems.indexOf(this.itemToAdd),1),this.itemToAdd=this.availableItems.length!==0?this.availableItems[0]:null))}updateValue(){this.formControl.setValue(this.selectedItems.map(e=>e.value)),this.invalidateSelectOptions()}invalidateSelectOptions(){let e=this.selectOptions;this.selectedItems.forEach(n=>{let i=e.find(a=>a.value===n.value);i&&(n.expressions.locked=i.expressions.locked)})}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=D(t)))(i||t)}})()}static{this.\u0275cmp=I({type:t,selectors:[["reorder-array"]],standalone:!1,features:[S],decls:17,vars:6,consts:[["disabled","false",3,"ionItemReorder"],[3,"id","disabled"],[1,"ion-no-margin"],[2,"display","flex","align-items","center"],["lines","none"],["position","floating","color","primary",2,"white-space","normal !important"],["label","Add","interface","popover","label-placement","floating",3,"ngModelChange","ngModel","interfaceOptions","disabled"],[3,"value"],["size","auto"],[3,"click","disabled"],["name","add","size","large"],["slot","start"],[3,"click"],["name","trash-outline"]],template:function(n,i){n&1&&(s(0,"ion-list")(1,"ion-reorder-group",0),O("ionItemReorder",function(m){return i.doReorder(m)}),fe(2,VH,7,4,"ion-item",1,xe),l()(),s(4,"ion-grid",2)(5,"ion-row",3)(6,"ion-col")(7,"ion-list")(8,"ion-item",4),f(9,HH,2,1,"ion-label",5),s(10,"ion-select",6),Zt("ngModelChange",function(m){return Qt(i.itemToAdd,m)||(i.itemToAdd=m),m}),fe(11,BH,2,2,"ion-select-option",7,xe),l()()()(),s(13,"ion-col",8)(14,"ion-buttons")(15,"ion-button",9),O("click",function(){return i.addItem()}),d(16,"ion-icon",10),l()()()()()),n&2&&(r(2),_e(i.selectedItems),r(7),_(i.props.label?9:-1),r(),Kt("ngModel",i.itemToAdd),c("interfaceOptions",H(5,LH))("disabled",!i.availableItems.length),r(),_e(i.availableItems),r(4),c("disabled",!i.availableItems.length))},dependencies:[Ie,Tn,Ge,Xe,Ae,Me,ie,J,ne,zn,ws,ra,Se,jn,Yn,$e],encapsulation:2})}}return t})();var M1=(()=>{class t{constructor(e){this.modalCtrl=e,this.fields=null,this.form=new hi({})}ngOnInit(){this.myModel=Object.assign({},this.model)}onSelected(){this.modalCtrl.dismiss(this.myModel)}static{this.\u0275fac=function(n){return new(n||t)(x(he))}}static{this.\u0275cmp=I({type:t,selectors:[["formly-safe-input-modal"]],inputs:{title:"title",fields:"fields",model:"model"},standalone:!1,decls:22,vars:5,consts:[["color","primary",1,"ion-justify-content-center"],["slot","end"],[3,"click"],["name","close",2,"color","var(--ion-title-color)"],["aria-hidden","false"],[3,"form","fields","model"],["size","12","size-md","4"],["translate","",2,"display","flex",3,"click"],["size","12","size-md","8"],["translate","",2,"display","flex",3,"click","disabled"]],template:function(n,i){n&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),h(3),l(),s(4,"ion-buttons",1)(5,"ion-button",2),O("click",function(){return i.modalCtrl.dismiss()}),d(6,"ion-icon",3),l()()()(),s(7,"div")(8,"ion-grid",4)(9,"ion-row")(10,"ion-col"),d(11,"formly-form",5),l()(),s(12,"ion-row")(13,"ion-col")(14,"ion-grid")(15,"ion-row")(16,"ion-col",6)(17,"ion-button",7),O("click",function(){return i.modalCtrl.dismiss()}),h(18," GENERAL.CANCEL "),l()(),s(19,"ion-col",8)(20,"ion-button",9),O("click",function(){return i.onSelected()}),h(21," GENERAL.OK "),l()()()()()()()()),n&2&&(r(3),N(i.title),r(8),c("form",i.form)("fields",i.fields)("model",i.myModel),r(9),c("disabled",!i.form.valid))},dependencies:[si,Ge,Xe,Ae,Me,xt,ie,Se,St,ct,Ne],encapsulation:2})}}return t})();function WH(t,o){t&1&&(s(0,"span"),h(1,"*"),l())}function UH(t,o){if(t&1&&(s(0,"span"),d(1,"br"),s(2,"small"),h(3),l()()),t&2){let e=p();r(3),R(" ",e.to.description," ")}}function zH(t,o){if(t&1&&(s(0,"div"),d(1,"ion-checkbox",3),l()),t&2){let e=p();r(),c("checked",e.model[e.pathToDisplayValue])}}function jH(t,o){if(t&1&&(s(0,"ion-text"),h(1),l(),d(2,"ion-icon",4)),t&2){let e=p();r(),N(e.getValue())}}function YH(t,o){if(t&1&&(s(0,"ion-item",2)(1,"ion-label")(2,"ion-text",5)(3,"p"),d(4,"formly-validation-message",6),l()()()()),t&2){let e=p();r(4),c("field",e.field)}}var F1=(()=>{class t extends Bt{constructor(e,n){super(),this.modalController=e,this.changeDetectorRef=n}ngOnInit(){this.pathToDisplayValue=this.props.pathToDisplayValue,this.displayType=this.props.displayType??"string"}getValue(){if(this.displayType==="boolean"||this.displayType==="number"||this.displayType==="string")return this.model[this.pathToDisplayValue];if(this.displayType==="optionGroup"){let e=this.getValueOfOptionGroup();if(e)return e}return this.model[this.pathToDisplayValue]}onSelectItem(){this.formControl.markAsTouched(),this.openModal()}openModal(){return ae(this,null,function*(){let e=yield this.modalController.create({component:M1,componentProps:{title:this.props.label,fields:this.getFields(),model:structuredClone(this.model)},cssClass:["auto-height"]});return e.onDidDismiss().then(n=>{if(!n.data)return;let i=ke(ke({},this.form.getRawValue()),n.data),a={};for(let[m,u]of Object.entries(i))u!==this.model[m]&&(a[m]=u);for(let[m,u]of Object.entries(a))this.model[m]=u;if(this.field.fieldGroup)this.form.setValue(this.form.getRawValue());else for(let[m,u]of Object.entries(a)){let C=this.form.controls[m];C&&C.setValue(u)}this.formControl.markAsDirty(),this.changeDetectorRef.detectChanges()}),yield e.present()})}getValueOfOptionGroup(){let e=ru.findField(this.getFields(),this.pathToDisplayValue.split("."));if(!e)return null;let n=this.model[this.pathToDisplayValue],i=(e.templateOptions??e.props).options.map(a=>a.options).reduce((a,m)=>a.concat(m),[]);if(Array.isArray(n))return n.map(a=>i.find(m=>m.value===a)).map(a=>fs(a,this.field)).join(", ");{let a=i.find(m=>m.value===n);return a?fs(a,this.field):null}}getFields(){return this.field.fieldGroup?this.field.fieldGroup:this.props.fields?this.props.fields:[]}static{this.\u0275fac=function(n){return new(n||t)(x(he),x(ln))}}static{this.\u0275cmp=I({type:t,selectors:[["formly-safe-input-wrapper"]],standalone:!1,features:[S],decls:9,vars:8,consts:[[3,"click","disabled","button"],[2,"max-width","none",3,"position"],["lines","none"],["disabled","true",3,"checked"],["name","caret-down-outline"],["color","danger"],[3,"field"]],template:function(n,i){n&1&&(s(0,"ion-item",0),O("click",function(){return i.onSelectItem()}),s(1,"ion-label",1)(2,"span"),h(3),l(),f(4,WH,2,0,"span"),f(5,UH,4,1,"span"),l(),f(6,zH,2,1,"div")(7,jH,3,1),l(),f(8,YH,5,1,"ion-item",2)),n&2&&(c("disabled",i.formControl.disabled)("button",!i.formControl.disabled),r(),c("position",i.to.labelPosition),r(2),N(i.to.label),r(),_(i.to.required&&i.to.hideRequiredMarker!==!0?4:-1),r(),_(i.to.description?5:-1),r(),_(i.displayType==="boolean"?6:7),r(2),_(i.showError?8:-1))},dependencies:[Xi,zt,ie,J,ne,He,ft],encapsulation:2})}}return t})();function $H(t){return/^(.{4}-){3}.{4}$/.test(t.value)?null:{key:!0}}function XH(t){return{validationMessages:[{name:"key",message(){return t.stream("EDGE.CONFIG.APP.KEY.INVALID_PATTERN")}}]}}var pc=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({providers:[{provide:Ds,multi:!0,useFactory:XH,deps:[te]}],imports:[ue,rn.forRoot({wrappers:[{name:"formly-safe-input-wrapper",component:F1},{name:"input-with-unit",component:R1}],types:[{name:"text",component:D1},{name:"link",component:b1},{name:"formly-option-group-picker",component:O1},{name:"reorder-array",component:N1}],validators:[{name:"key",validation:$H}],validationMessages:[{name:"key",message:"The key doesnt match the pattern!"}]})]})}}return t})();var G1=(()=>{class t{constructor(e){this.translate=e,Ze.setAdditionalTranslationFile(w1,e).then(({lang:n,translations:i,shouldMerge:a})=>{e.setTranslation(n,i,a)})}static{this.\u0275fac=function(n){return new(n||t)(Jt(te))}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue,Yd,nr,Hs,pc,da]})}}return t})();var P1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue,Et,Ve,an]})}}return t})();var L1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var k1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var V1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var H1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Te,ue]})}}return t})();var B1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[lo,Te,ue]})}}return t})();var W1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[lo,Te,_1,h1,C1,g1,E1,H1,T1,I1,x1,S1,A1,G1,P1,k1,V1,L1,f1,B1,y1,nr,ue,ic,Oi]})}}return t})();var U1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[u1,W1,ue]})}}return t})();var z1={de:{PROFILE:{SYSTEM_PROTOCOL:{LABEL:"Systemprotokoll",DOWNLOAD:"Download",TITLE:"Aktuelles"}}},en:{PROFILE:{SYSTEM_PROTOCOL:{LABEL:"System protocol",DOWNLOAD:"Download",TITLE:"Currently"}}}};var j1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[ue]})}}return t})();var Y1=(()=>{class t{constructor(e){this.translate=e,Ze.setAdditionalTranslationFile(z1,e).then(({lang:n,translations:i,shouldMerge:a})=>{e.setTranslation(n,i,a)})}static{this.\u0275fac=function(n){return new(n||t)(Jt(te))}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[pc,j1,ue,lu,Fa,Oi,qi,da]})}}return t})();var dc=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[Et,ue,sc]})}}return t})();var $1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[ue,dc,qi]})}}return t})();var X1=(()=>{class t{constructor(e){this.injector=e}handleError(e){let n=this.injector.get(Jo);if(console.error(e),e.message){let i={error:{message:e.message},metadata:{browser:navigator.userAgent}};n.error(JSON.stringify(i))}}static{this.\u0275fac=function(n){return new(n||t)(Jt(Oo))}}static{this.\u0275prov=xi({token:t,factory:t.\u0275fac})}}return t})();var mp=class{constructor(o){this.translate=o}prePopulate(o){let e=o.props||{};!e.translate||e._translated||(e._translated=!0,o.expressions=Li(ke({},o.expressions||{}),{"props.label":this.translate.stream(e.label)}))}};function q1(t){return{validationMessages:[],extensions:[{name:"translate",extension:new mp(t)}]}}var K1=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t})}static{this.\u0275inj=$({imports:[ue,Ve]})}}return t})();hd(yc);var Q1=(()=>{class t{constructor(){Op(Lp)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=X({type:t,bootstrap:[l1]})}static{this.\u0275inj=$({providers:[{provide:Hp,useClass:jp},vd,{provide:Ep,useClass:X1},{provide:jo,useFactory:()=>(Ze.getByKey(localStorage.LANGUAGE)??Ze.getByBrowserLang(navigator.language)??Ze.DEFAULT).key},{provide:Ds,multi:!0,useFactory:q1,deps:[te]},yd,pa,m1,Ei,Zo,qn,fn,{provide:Ip,useFactory:KH,deps:[qn,fn],multi:!0},Ed(gd())],imports:[Cd,r1,lo,Te,U1,Y1,$1,Ve.forRoot({innerHTMLTemplatesEnabled:!0}),Fp,ue,an.forRoot({loader:{provide:_d,useClass:yc}}),K1,dc]})}}return t})();function KH(){return()=>ae(null,null,function*(){})}pt.production&&void 0;Mp().bootstrapModule(Q1).catch(t=>console.log(t));
