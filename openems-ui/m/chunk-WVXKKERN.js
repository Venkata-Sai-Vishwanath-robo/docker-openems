import{d as pe}from"./chunk-VQJOV6KK.js";import{a as kt}from"./chunk-V6SQQYN5.js";import{$c as Me,Aa as we,Ab as lt,Ac as le,Bb as st,Ca as T,Cc as dt,D as Ye,Da as y,Db as ct,E as S,Ea as m,Eb as Oe,F as I,Fc as _t,Gd as Y,Hd as qe,Hf as Et,Id as vt,Jd as yt,Kd as Be,La as A,Lc as Ne,Ld as $e,Lf as de,Mc as ut,Mf as Tt,Nc as Le,Oc as U,Pc as Ct,Pd as me,Pf as wt,Qa as c,Qc as ft,Qd as De,Qf as Ue,R as Ze,Ra as b,Sa as h,Sd as Je,Ta as be,Td as St,Uf as Ge,V as a,Va as he,Vd as je,Wa as xe,Wc as G,Wf as N,Xa as ge,Xe as q,Ya as ke,Yc as Q,Zc as z,_c as Ve,ba as f,bd as ht,bg as bt,cb as X,cd as H,da as L,db as te,dc as j,dd as V,dg as D,eb as Fe,ee as Z,eg as ye,fc as mt,fe as ee,fg as ze,gc as Re,ge as It,ia as E,jb as w,jd as W,kb as k,kf as K,lb as et,ld as $,nb as tt,oa as u,oe as ve,pc as Ae,pd as Pe,qa as C,qc as ie,qd as M,rd as xt,sa as F,sb as nt,sc as oe,sd as se,ta as O,td as P,ua as R,ud as ce,va as p,vb as it,vc as re,wa as o,wb as ot,xa as r,xb as rt,xc as pt,xd as gt,ya as _,yb as at,yc as ae,za as Te}from"./chunk-UEHZAF3Y.js";import{a as Ee,g as B}from"./chunk-OQDXQ3X5.js";var yi=t=>(s,e)=>{let n=Ye(nt);return Ye(N).getCurrentEdge().then(l=>{if(l){let d=Et.isAtLeast(l.role,t);return d||(console.warn(`Routing Failed. Reason: User not allowed to access [component:${s?.component.SELECTOR??e.url}]`),n.back()),d}return!1}),!0};var Ft=(()=>{class t extends K{static{this.METHOD="setChannelValue"}constructor(e){super(t.METHOD,e),this.params=e}}return t})();var Ke=()=>({cssClass:"custom-ion-popover"}),Bt=t=>({edgeShortName:t}),$t=()=>["RW","WO"];function Dt(t,s){if(t&1&&(o(0,"ion-select-option",11),c(1),r()),t&2){let e=s.$implicit;p("value",e.key),a(),be(" ",e.value.id," (",e.value.alias,")")}}function Jt(t,s){if(t&1&&(o(0,"ion-select-option",17),c(1),r()),t&2){let e=s.$implicit;p("value",e.key),a(),h(" ",e.key)}}function jt(t,s){if(t&1&&(O(0,Jt,2,2,"ion-select-option",17,F),w(2,"keyvalue")),t&2){m();let e=A(13),n=m();R(k(2,0,n.channelsPerComponent.get(e.value).channels))}}function Ut(t,s){if(t&1){let e=T();o(0,"ion-button",18),y("click",function(){S(e),m();let i=A(13),l=A(21);return m().subscribeChannels(i.value,l.value),i.value=null,I(l.value=null)}),o(1,"span",19),c(2,"CHANNELS.ADD"),r()()}}function Gt(t,s){if(t&1){let e=T();o(0,"ion-button",20),y("click",function(){S(e);let i=m(2);return I(i.saveChannelsInLocalStorage())}),o(1,"span",19),c(2,"CHANNELS.SAVE"),r()()}}function zt(t,s){if(t&1&&(o(0,"span"),c(1),r()),t&2){let e=m();a(),h("/ Text:",e.text)}}function Ht(t,s){if(t&1&&(o(0,"span"),c(1),r()),t&2){let e=m().$implicit;a(),h(" (",e.key,") ")}}function Wt(t,s){if(t&1&&u(0,Ht,2,1,"span"),t&2){let e=s.$implicit,n=m(4).$implicit,i=m().$implicit,l=m();C(e.value===l.channel[i.key+"/"+n.key]?0:-1)}}function Yt(t,s){if(t&1&&(O(0,Wt,1,1,null,null,F),w(2,"keys")),t&2){let e=m(2);R(k(2,0,e.options))}}function Kt(t,s){t&1&&(o(0,"span"),c(1,"(State is SET)"),r())}function Xt(t,s){t&1&&(o(0,"span"),c(1,"(State is not set)"),r())}function Qt(t,s){if(t&1&&(u(0,Kt,2,0,"span"),u(1,Xt,2,0,"span")),t&2){let e=m(3).$implicit,n=m().$implicit,i=m();C(i.channel[n.key+"/"+e.key]===1?0:-1),a(),C(i.channel[n.key+"/"+e.key]===0?1:-1)}}function Zt(t,s){t&1&&(o(0,"span"),c(1,"(On)"),r())}function en(t,s){t&1&&(o(0,"span"),c(1,"(Off)"),r())}function tn(t,s){if(t&1&&(u(0,Zt,2,0,"span"),u(1,en,2,0,"span")),t&2){let e=m(3).$implicit,n=m().$implicit,i=m();C(i.channel[n.key+"/"+e.key]===1?0:-1),a(),C(i.channel[n.key+"/"+e.key]===0?1:-1)}}function nn(t,s){if(t&1&&(o(0,"ion-item")(1,"ion-label"),c(2),w(3,"translate"),r(),o(4,"ion-text"),c(5),u(6,Yt,3,2),u(7,Qt,2,2),u(8,tn,2,2),r()()),t&2){let e=m(),n=m().$implicit,i=m().$implicit,l=m();a(2),b(k(3,6,"CHANNELS.VALUE")),a(3),be(" ",l.channel[i.key+"/"+n.key],"\xA0",e.unit," "),a(),C(e.category==="ENUM"?6:-1),a(),C(e.category==="STATE"?7:-1),a(),C(e.category==="OPENEMS_TYPE"&&e.type==="BOOLEAN"?8:-1)}}function on(t,s){if(t&1){let e=T();_(0,"ion-toggle",29,2),o(2,"ion-button",30),y("click",function(){S(e);let i=A(1),l=m(3).$implicit,d=m().$implicit,x=m(3);return I(x.setChannelValue(d.key,l.key,i.checked))}),_(3,"ion-icon",31),r()}}function rn(t,s){if(t&1){let e=T();_(0,"ion-input",32,3),o(2,"ion-button",30),y("click",function(){S(e);let i=A(1),l=m(3).$implicit,d=m().$implicit,x=m(3);return I(x.setChannelValue(d.key,l.key,i.value))}),_(3,"ion-icon",31),r()}}function an(t,s){if(t&1&&(o(0,"ion-item")(1,"ion-label"),c(2),w(3,"translate"),r(),u(4,on,4,0)(5,rn,4,0),r()),t&2){let e=m();a(2),b(k(3,2,"CHANNELS.SET_VALUE")),a(2),C(e.type==="BOOLEAN"?4:5)}}function ln(t,s){t&1&&(o(0,"ion-item",5)(1,"ion-note",24)(2,"ion-text",33),c(3," Warnung: "),r(),c(4," Channelwert wird nicht sek\xFCndlich zum Online-Monitoring \xFCbertragen "),r()())}function sn(t,s){if(t&1&&(o(0,"ion-card-content")(1,"ion-item")(2,"div",27),c(3," Meta\xA0 "),r(),o(4,"ion-text",28),c(5),o(6,"span"),c(7,"\xA0"),r(),u(8,zt,2,1,"span"),r()(),u(9,nn,9,8,"ion-item"),u(10,an,6,4,"ion-item"),u(11,ln,5,0,"ion-item",5),r()),t&2){let e=s,n=m().$implicit;a(5),be(" Type: ",e.type.toLowerCase()," / Access-Mode: ",e.accessMode," "),a(3),C(e.text?8:-1),a(),C(e.accessMode!=="WO"?9:-1),a(),C(X(6,$t).includes(e.accessMode)?10:-1),a(),C(n.value.showPersistencePriority?11:-1)}}function cn(t,s){if(t&1){let e=T();o(0,"ion-item",23)(1,"ion-label",24)(2,"span",19),c(3,"CHANNELS.CHANNEL"),r(),c(4),r(),o(5,"ion-button",25),y("click",function(){let i=S(e).$implicit,l=m().$implicit,d=m(3);return I(d.unsubscribeChannel(l.key,i.key))}),_(6,"ion-icon",26),r()(),u(7,sn,12,7,"ion-card-content")}if(t&2){let e,n=s.$implicit,i=m().$implicit,l=m(3);a(4),h(": ",n.key),a(3),C((e=l.channelsPerComponent.get(i.key).channels[n.key])?7:-1,e)}}function mn(t,s){if(t&1&&(o(0,"ion-select-option",34),c(1),r()),t&2){let e=s.$implicit;p("value",e.key),a(),h(" ",e.key," ")}}function pn(t,s){if(t&1&&(O(0,mn,2,2,"ion-select-option",34,F),w(2,"keyvalue")),t&2){let e=m().$implicit,n=m(3);R(k(2,0,n.channelsPerComponent.get(e.key).channels))}}function dn(t,s){if(t&1){let e=T();o(0,"ion-button",35),y("click",function(){S(e);let i=m().$implicit,l=A(13);return m(3).subscribeChannels(i.key,l.value),I(l.value=null)}),c(1," CHANNELS.ADD"),r()}}function _n(t,s){if(t&1&&(o(0,"ion-col",15)(1,"ion-card")(2,"ion-item",8),_(3,"ion-icon",9),o(4,"ion-label"),c(5),r()(),o(6,"ion-card-content")(7,"ion-list"),O(8,cn,8,2,null,null,F),w(10,"keyvalue"),o(11,"ion-item",5)(12,"ion-select",21,1),w(14,"translate"),u(15,pn,3,2),r()(),u(16,dn,2,0,"ion-button",22),r()()()()),t&2){let e=s.$implicit,n=A(13);a(5),b(e.key),a(3),R(k(10,6,e.value)),a(4),p("multiple",!0)("interfaceOptions",X(10,Ke))("label",k(14,8,"CHANNELS.MORE_CHANNELS")),a(3),C(e.key?15:-1),a(),C(n!=null&&n.value?16:-1)}}function un(t,s){if(t&1&&(O(0,_n,17,11,"ion-col",15,F),w(2,"keyvalue")),t&2){let e=m(2);R(k(2,0,e.selectedComponentChannels))}}function Cn(t,s){if(t&1){let e=T();o(0,"ion-grid")(1,"ion-row",6)(2,"ion-col",7)(3,"ion-card")(4,"ion-item",8),_(5,"ion-icon",9),o(6,"ion-label"),c(7),w(8,"translate"),r()(),o(9,"ion-card-content")(10,"ion-list")(11,"ion-item",5)(12,"ion-select",10,0),w(14,"translate"),y("ionChange",function(i){S(e);let l=m();return I(l.onSelectedComponentChanged(i))}),O(15,Dt,2,3,"ion-select-option",11,F),w(17,"keys"),r()(),o(18,"ion-item",5),_(19,"ngx-spinner",12),o(20,"ion-select",13,1),w(22,"translate"),u(23,jt,3,2),r()()(),u(24,Ut,3,0,"ion-button",14),r()()(),o(25,"ion-col",15)(26,"ion-card")(27,"ion-item",8),_(28,"ion-icon",9),o(29,"ion-label"),c(30),w(31,"translate"),r()(),o(32,"ion-card-content"),u(33,Gt,3,0,"ion-button",16),o(34,"ion-label"),c(35),w(36,"translate"),r()()()()(),o(37,"ion-row"),u(38,un,3,2),w(39,"async"),r()()}if(t&2){let e,n=A(13),i=A(21),l=m();a(7),b(k(8,14,"CHANNELS.ADD_CHANNEL")),a(5),p("label",k(14,16,"CHANNELS.COMPONENT"))("interfaceOptions",X(29,Ke)),a(3),R(k(17,18,l.config.components)),a(4),p("name",n.value),a(),p("disabled",!(n!=null&&n.value))("label",k(22,20,"CHANNELS.CHANNEL"))("multiple",!0)("interfaceOptions",X(30,Ke)),a(3),C(n!=null&&n.value?23:-1),a(),C(n&&n.value&&i&&i.value?24:-1),a(6),b(k(31,22,"CHANNELS.SAVE")),a(3),C(l.edge.id?33:-1),a(2),h("",et(36,24,"CHANNELS.SAVE_DESCRIPTION",te(31,Bt,l.environment.edgeShortName))," "),a(3),C((e=k(39,27,!l.isLoading&&l.selectedComponentChannels&&(l.edge==null?null:l.edge.currentData)))?38:-1,e)}}function fn(t,s){t&1&&(o(0,"ion-item",5)(1,"ion-label"),Te(2),o(3,"ion-row",6)(4,"ion-col",15)(5,"ion-card")(6,"ion-item",8),_(7,"ion-icon",36),c(8," A component couldn't be found! "),r()()()(),we(),r()())}var Ai=(()=>{class t{static{this.SELECTOR="channels"}static{this.URL_PREFIX="channels"}constructor(e,n,i,l,d){this.service=e,this.websocket=n,this.route=i,this.router=l,this.translate=d,this.customAlertOptions={cssClass:"wide-alert"},this.isAtLeastOneChannelExistingInEdgeConfig=!1,this.spinnerId=t.SELECTOR,this.environment=ve,this.edge=null,this.config=null,this.channelsPerComponent=new Map,this.selectedComponentChannels=new Map,this.subscribedChannels=new Map,this.persistencePriority=Ue.DEFAULT_GLOBAL_PRIORITY}static{this.ERROR_COMPONENT_COULD_NOT_BE_FOUND=e=>`[ComponentId] ${e} doesn't exist on this edge`}ionViewWillEnter(){this.service.getCurrentEdge().then(e=>{this.edge=e}),this.service.getConfig().then(e=>{this.config=e,this.persistencePriority=this.config.getComponentsByFactory("Controller.Api.Backend")?.[0]?.properties.persistencePriority??Ue.DEFAULT_GLOBAL_PRIORITY,this.service.startSpinner(this.spinnerId),this.loadSavedChannels().then(n=>{n&&this.service.toast(n,"success")}).catch(n=>{this.service.toast(n,"danger"),this.selectedComponentChannels=new Map,this.isAtLeastOneChannelExistingInEdgeConfig=!0}).finally(()=>{this.service.stopSpinner(this.spinnerId)})})}ionViewDidLeave(){this.selectedComponentChannels=new Map,this.edge?.unsubscribeChannels(this.websocket,t.SELECTOR)}subscribeChannels(e,n){return B(this,null,function*(){n.forEach(i=>B(this,null,function*(){this.subscribeChannel(e,i)}))})}subscribeChannel(e,n){return B(this,null,function*(){let i={showPersistencePriority:!0},l=this.selectedComponentChannels.get(e);l||(l=new Map,this.selectedComponentChannels.set(e,l)),l.set(n,i);let d=yield this.getChannel(e,n);if(i.showPersistencePriority=Ue.isLessThan(d.persistencePriority,this.persistencePriority),d.accessMode!="WO"){let x=new ye(e,n),v=x.toString();this.subscribedChannels.has(v)||this.subscribedChannels.set(v,[x]),this.edge&&this.edge.subscribeChannels(this.websocket,t.SELECTOR,Array.from(this.subscribedChannels.values()).flat())}this.saveChannelsInUrl()})}unsubscribeChannel(e,n){let i=this.selectedComponentChannels.get(e);i&&(i.delete(n),i.size===0&&this.selectedComponentChannels.delete(e));let l=new ye(e,n);this.subscribedChannels.delete(l.toString())&&this.edge.subscribeChannels(this.websocket,t.SELECTOR,Array.from(this.subscribedChannels.values()).flat()),this.saveChannelsInUrl()}setChannelValue(e,n,i){this.edge&&this.edge.sendRequest(this.service.websocket,new Ft({componentId:e,channelId:n,value:i})).then(()=>{this.service.toast("Successfully set "+e+"/"+n+" to ["+i+"]","success")}).catch(()=>{this.service.toast("Error setting "+e+"/"+n+" to ["+i+"]","danger")})}saveChannelsInLocalStorage(){let e=this.getSelectedChannels();e&&e.length>0?localStorage.setItem(t.URL_PREFIX+"-"+this.edge.id,JSON.stringify(e)):localStorage.removeItem(t.URL_PREFIX+"-"+this.edge.id),this.service.toast("Successfully saved subscribed channels","success")}onSelectedComponentChanged(e){let n=e.detail.value;!n||this.channelsPerComponent.has(n)||this.loadChannelsAndStore(n).then(()=>{}).catch(i=>{this.service.toast("Unable to load channels for "+n+": "+i,"danger")})}saveChannelsInUrl(){let e=this.getSelectedChannelStrings();e&&e.length>0?(this.router.navigate(["device/"+this.edge.id+"/settings/channels/"],{queryParams:{save:e.toString()}}),this.isAtLeastOneChannelExistingInEdgeConfig=!1):this.router.navigate(["device/"+this.edge.id+"/settings/channels/"])}getSelectedChannelStrings(){return this.getSelectedChannels().map(e=>e.toString())}getSelectedChannels(){let e=[];for(let[n,i]of this.selectedComponentChannels.entries())for(let[l]of i.entries())e.push(new ye(n,l));return e}loadSavedChannels(){return B(this,null,function*(){let e=this.route.snapshot.queryParamMap.get("save");if(e){let i=e.split(",")?.map(l=>ye.fromString(l));try{return yield Promise.all(i.map(l=>this.subscribeChannel(l.componentId,l.channelId))),"Successfully loaded saved channels from url"}catch(l){throw"Some channels may not have been loaded from url: "+l}}let n=localStorage.getItem(t.URL_PREFIX+"-"+this.edge.id);if(n){let i=JSON.parse(n);try{return yield Promise.all(i.map(l=>this.subscribeChannel(l.componentId,l.channelId))),"Successfully loaded saved channels from session"}catch(l){throw"Some channels may not have been loaded from session: "+l}}})}getChannel(e,n){return new Promise((i,l)=>{let d=this.channelsPerComponent.get(e);if(d&&!d.activeRequest){let x=d.channels[n];x?i(x):l(n+" is not defined by component "+e);return}this.loadChannelsAndStore(e).then(x=>{let v=x.channels[n];v?i(v):l(n+" is not defined by component "+e)}).catch(l)})}loadChannels(e){return new Promise((n,i)=>{if(ze.hasChannelsInEdgeConfig(this.edge)){let l=this.config.components[e];if(!l){i();return}let d=[];for(let[x,v]of Object.entries(l.channels))d.push(Ee({id:x},v));n(d);return}if(!(e in this.config.components)){console.warn(t.ERROR_COMPONENT_COULD_NOT_BE_FOUND(e)),this.isAtLeastOneChannelExistingInEdgeConfig=!0,i();return}this.edge.sendRequest(this.websocket,new de({componentId:"_componentManager",payload:new Tt({componentId:e})})).then(l=>{n(l.result.channels)}).catch(i)})}loadChannelsAndStore(e){return new Promise((n,i)=>{if(!e){i();return}let l;this.channelsPerComponent.has(e)?l=this.channelsPerComponent.get(e):(l={channels:{}},this.channelsPerComponent.set(e,l)),this.service.startSpinnerTransparentBackground(e),(l.activeRequest??(l.activeRequest=this.loadChannels(e))).then(x=>{x.forEach(v=>{l.channels[v.id]=v}),n(l)}).catch(i).finally(()=>{l.activeRequest=void 0,this.service.stopSpinner(e)})})}static{this.\u0275fac=function(n){return new(n||t)(f(N),f(D),f(j),f(mt),f(Z))}}static{this.\u0275cmp=L({type:t,selectors:[["channels"]],standalone:!1,decls:4,vars:3,consts:[["selectedComponentId",""],["selectedChannelId",""],["valueToggle",""],["channelValue",""],[3,"name"],["lines","none"],[1,"ion-justify-content-center"],["size","12","size-md","6"],["color","light","lines","full"],["slot","start","name","today-outline","color","primary"],["justify","space-between","interface","popover","labelPlacement","start","aria-modal","true",1,"ion-text-align-left","custom-ion-popover",2,"white-space","initial","width","100%",3,"ionChange","label","interfaceOptions"],[2,"white-space","normal !important",3,"value"],[1,"custom-theme-text","custom-ion-popover",3,"name"],["interface","popover","justify","space-between","aria-modal","true",1,"custom-ion-popover",2,"white-space","initial","width","100%",3,"disabled","label","multiple","interfaceOptions"],["expand","block",2,"white-space","initial","line-break","strict"],["size","12","size-md","4"],["expand","block"],[3,"value"],["expand","block",2,"white-space","initial","line-break","strict",3,"click"],["translate",""],["expand","block",3,"click"],["interface","popover","aria-modal","true",3,"multiple","interfaceOptions","label"],["expand","block","translate",""],["lines","inset"],[2,"white-space","initial"],["slot","end","color","light","size","small",3,"click"],["slot","icon-only","name","trash-outline"],[2,"display","block","width","30%"],["color","medium",2,"display","block","width","100%","align-items","end"],["tabindex","0","mode","md"],["slot","end","color","light",3,"click"],["slot","icon-only","name","send-outline"],["placeholder","value"],["color","warning"],["color","danger",3,"value"],["expand","block","translate","",3,"click"],["color","danger","size","large","slot","start","name","alert-circle"]],template:function(n,i){n&1&&(o(0,"ion-content"),_(1,"ngx-spinner",4),u(2,Cn,40,33,"ion-grid"),u(3,fn,9,0,"ion-item",5),r()),n&2&&(a(),p("name",i.spinnerId),a(),C(i.config?2:-1),a(),C(i.isAtLeastOneChannelExistingInEdgeConfig?3:-1))},dependencies:[Ge,G,Q,z,H,V,W,$,Pe,M,P,ce,gt,Y,Be,$e,me,Je,Ne,Le,U,ee,st,Oe,kt,It],encapsulation:2})}}return t})();var hn=t=>[t];function xn(t,s){if(t&1){let e=T();o(0,"ion-item",2),y("click",function(){S(e);let i=m().$implicit;return I(i.isClicked=!i.isClicked)}),_(1,"ion-icon",3),o(2,"ion-label",4),c(3),r()()}if(t&2){let e=m().$implicit;a(),p("name",ke(e.category.icon)),a(2),h(" ",e.category.title," ")}}function gn(t,s){if(t&1&&(o(0,"ion-item",5)(1,"ion-label",6)(2,"ion-text",7)(3,"h3"),c(4),r()(),o(5,"small",8),c(6),r()()()),t&2){let e=s.$implicit;p("routerLink",te(3,hn,e.id)),a(4),b(e.name),a(2),b(e.description)}}function vn(t,s){if(t&1&&O(0,gn,7,5,"ion-item",5,F),t&2){let e=m().$implicit;R(e.filteredFactories)}}function yn(t,s){if(t&1&&(o(0,"ion-item-group"),u(1,xn,4,3,"ion-item",1),r(),u(2,vn,2,0)),t&2){let e=s.$implicit,n=m();a(),C(e.filteredFactories.length>=1?1:-1),a(),C(e.isClicked||n.showAllFactories?2:-1)}}var Bi=(()=>{class t{static{this.SELECTOR="indexComponentInstall"}constructor(e,n,i){this.translate=e,this.service=n,this.websocket=i,this.components=null,this.showAllFactories=!1}ngOnInit(){return B(this,null,function*(){this.edge=yield this.service.getCurrentEdge(),this.list=yield this.getCategorizedFactories();for(let e of this.list)e.isClicked=!1,e.filteredFactories=e.factories;this.updateFilter("")})}updateFilter(e){let n=e.toLowerCase().split(" "),i=0;for(let l of this.list)l.filteredFactories=l.factories.filter(d=>q.matchAll(n,[d.id.toLowerCase(),d.name.toLowerCase(),d.description.toLowerCase()])),i+=l.filteredFactories.length;i>10?this.showAllFactories=!1:this.showAllFactories=!0}getCategorizedFactories(){return B(this,null,function*(){if(ze.hasReducedFactories(this.edge)){let n=yield this.edge.sendRequest(this.websocket,new de({componentId:"_componentManager",payload:new Sn}));for(let[i,l]of Object.entries(n.result.factories))l.id=i;return wt.listAvailableFactories(n.result.factories,this.translate)}return(yield this.service.getConfig()).listAvailableFactories(this.translate)})}static{this.\u0275fac=function(n){return new(n||t)(f(Z),f(N),f(D))}}static{this.\u0275cmp=L({type:t,selectors:[["indexComponentInstall"]],standalone:!1,decls:5,vars:0,consts:[[2,"--background","var(--ion-color-searchbar-background)","color","var(--ion-color-searchbar-text)",3,"ionInput"],["lines","inset",2,"cursor","pointer"],["lines","inset",2,"cursor","pointer",3,"click"],[3,"name"],[1,"ion-padding-start"],["lines","none",3,"routerLink"],[1,"ion-text-wrap",2,"cursor","pointer"],["color","primary"],[1,"custom-channels-text"]],template:function(n,i){n&1&&(o(0,"ion-content")(1,"ion-searchbar",0),y("ionInput",function(d){return i.updateFilter(d.detail.value)}),r(),o(2,"ion-list"),O(3,yn,3,2,null,null,F),r()()),n&2&&(a(3),R(i.list))},dependencies:[V,$,M,se,P,ce,qe,me,U,je,Re],encapsulation:2})}}return t})(),Sn=(()=>{class t extends K{static{this.METHOD="getAllComponentFactories"}constructor(){super(t.METHOD,{})}}return t})();function In(t,s){if(t&1){let e=T();o(0,"ion-grid")(1,"ion-row",0)(2,"ion-col",1)(3,"ion-card")(4,"ion-item"),_(5,"ion-icon",2),o(6,"ion-label")(7,"ion-card-title",3),c(8),r(),o(9,"ion-card-subtitle",4),c(10),r()()(),o(11,"ion-card-content")(12,"form",5),y("ngSubmit",function(){S(e);let i=m();return I(i.submit())}),_(13,"formly-form",6),o(14,"ion-item")(15,"ion-button",7),c(16,"SETTINGS.SYSTEM_UPDATE.CREATE_COMPONENT "),r()()()()()()()()}if(t&2){let e=m();a(5),p("name",e.componentIcon),a(3),h("",e.factory.name," "),a(2),h(" ",e.factory.description),a(2),p("formGroup",e.form),a(),p("form",e.form)("fields",e.fields)("model",e.model)}}var Ui=(()=>{class t{static{this.SELECTOR="componentInstall"}constructor(e,n,i,l){this.route=e,this.utils=n,this.websocket=i,this.service=l,this.edge=null,this.factory=null,this.form=null,this.model=null,this.fields=null,this.componentIcon=null,this.factoryId=null}ngOnInit(){return B(this,null,function*(){this.factoryId=this.route.snapshot.params.factoryId,this.edge=yield this.service.getCurrentEdge();let e=yield this.service.getConfig();this.componentIcon=e.getFactoryIcon(this.factory,this.service.translate);let[n,i]=yield this.edge.getFactoryProperties(this.websocket,this.factoryId);this.factory=n;let l=[],d={};for(let x of i){let v=x.id.replace(".","_"),g=x.defaultValue;x.schema.type==="repeat"&&g===null&&(g=[]);let J={key:v,type:"input",templateOptions:{label:x.name,required:g===null,description:x.description}};if(q.deepCopy(x.schema,J),l.push(J),g!=null&&(d[v]=g,v=="id"&&x.schema.type!=="repeat")){let ne=g.match(/^(.*)(\d+)$/);if(ne){let Ie=ne[1],He=Number.parseInt(ne[2]);for(let Vt of Object.keys(e.components)){let We=Vt.match(/^(.*)(\d+)$/);if(We&&We[1]===Ie){let Mt=Number.parseInt(We[2]);He=Math.max(He,Mt+1)}}d[v]=Ie+He}}}this.form=new oe({}),this.fields=l,this.model=d})}submit(){if(!this.form.valid){this.service.toast("Please fill mandatory fields!","danger");return}let e=[];for(let n in this.form.controls){let i=this.form.controls[n];if(i.value===null)continue;let l=n.replace("_",".");e.push({name:l,value:i.value})}this.edge.createComponentConfig(this.websocket,this.factoryId,e).then(n=>{this.form.markAsPristine(),this.service.toast("Successfully created in instance of "+this.factoryId+".","success")}).catch(n=>{this.service.toast("Error creating an instance of "+this.factoryId+":"+n.error.message,"danger")})}static{this.\u0275fac=function(n){return new(n||t)(f(j),f(q),f(D),f(N))}}static{this.\u0275cmp=L({type:t,selectors:[["componentInstall"]],standalone:!1,decls:2,vars:1,consts:[[1,"ion-justify-content-center"],["size","12","size-xl","8"],["slot","start","color","primary",3,"name"],[1,"ion-text-wrap",2,"color","var(--ion-text-color-reverse)"],[1,"ion-text-wrap",2,"color","var(--ion-text-color-shade)"],[3,"ngSubmit","formGroup"],[3,"form","fields","model"],["type","submit","color","primary","translate",""]],template:function(n,i){n&1&&(o(0,"ion-content"),u(1,In,17,7,"ion-grid"),r()),n&2&&(a(),C(i.factory&&i.form?1:-1))},dependencies:[pe,ae,ie,G,Q,z,Ve,Me,H,V,W,$,M,P,Y,le,ee],encapsulation:2})}}return t})();function En(t,s){if(t&1&&(o(0,"ion-item",1),_(1,"ion-icon",3),o(2,"ion-label",4),c(3),r()()),t&2){let e=m().$implicit;a(),p("name",ke(e.category.icon)),a(2),h(" ",e.category.title," ")}}function Tn(t,s){if(t&1&&(o(0,"span"),c(1),r()),t&2){let e=m().$implicit;a(),h(" (",e.id,")")}}function wn(t,s){t&1&&(o(0,"small"),c(1," ("),o(2,"span",8),c(3,"GENERAL.COMPONENT_INACTIVE"),r(),c(4,")"),r())}function bn(t,s){if(t&1&&(o(0,"p",7),c(1),o(2,"small"),c(3),r()()),t&2){let e=s;a(),h("",e.name," "),a(2),h("(",e.description,")")}}function kn(t,s){if(t&1&&(o(0,"ion-item",2)(1,"ion-label",5)(2,"ion-text",6)(3,"h3"),c(4),u(5,Tn,2,1,"span"),u(6,wn,5,0,"small"),r()(),u(7,bn,4,2,"p",7),r()()),t&2){let e,n=s.$implicit,i=m(2);p("routerLink",n.id),a(4),h("",n.alias," "),a(),C(n.id!==n.alias?5:-1),a(),C(n.isEnabled?-1:6),a(),C((e=i.config.factories[n.factoryId])?7:-1,e)}}function Fn(t,s){if(t&1&&(o(0,"ion-item-group"),u(1,En,4,3,"ion-item",1),r(),O(2,kn,8,5,"ion-item",2,F)),t&2){let e=s.$implicit;a(),C(e.filteredComponents.length>=1?1:-1),a(),R(e.filteredComponents)}}var Wi=(()=>{class t{static{this.SELECTOR="indexComponentUpdate"}constructor(e,n){this.service=e,this.translate=n,this.config=null,this.showAllEntries=!1}ngOnInit(){this.service.getConfig().then(e=>{this.config=e;let n=[];this.list=e.listActiveComponents(n,this.translate);for(let i of this.list)i.isNatureClicked=!1,i.filteredComponents=i.components;this.updateFilter("")})}updateFilter(e){let n=e.toLowerCase().split(" "),i=0;for(let l of this.list)l.filteredComponents=l.components.filter(d=>q.matchAll(n,[d.id.toLowerCase(),d.alias.toLowerCase(),d.factoryId])),i+=l.filteredComponents.length;i>5?this.showAllEntries=!1:this.showAllEntries=!0}static{this.\u0275fac=function(n){return new(n||t)(f(N),f(Z))}}static{this.\u0275cmp=L({type:t,selectors:[["indexComponentUpdate"]],standalone:!1,decls:5,vars:0,consts:[[2,"--background","var(--ion-color-searchbar-background)","color","var(--ion-color-searchbar-text)",3,"ionChange"],["lines","inset"],["lines","none",3,"routerLink"],[3,"name"],[1,"ion-padding-start"],[1,"ion-text-wrap",2,"cursor","pointer"],["color","primary"],[1,"custom-channels-text"],["translate",""]],template:function(n,i){n&1&&(o(0,"ion-content")(1,"ion-searchbar",0),y("ionChange",function(d){return i.updateFilter(d.detail.value)}),r(),o(2,"ion-list"),O(3,Fn,4,1,null,null,F),r()()),n&2&&(a(3),R(i.list))},dependencies:[V,$,M,se,P,ce,qe,me,U,je,Re,ee],encapsulation:2})}}return t})();function On(t,s){if(t&1){let e=T();o(0,"ion-grid")(1,"ion-row",0)(2,"ion-col",1)(3,"ion-card")(4,"ion-item"),_(5,"ion-icon",2),o(6,"ion-label")(7,"ion-card-title",3),c(8),r(),o(9,"ion-card-subtitle",4),c(10),r()()(),o(11,"ion-card-content")(12,"form",5),y("ngSubmit",function(){S(e);let i=m();return I(i.submit())}),_(13,"formly-form",6),r(),o(14,"div",7)(15,"ion-button",8),y("click",function(){S(e);let i=m();return I(i.submit())}),c(16," SETTINGS.SYSTEM_UPDATE.UPDATE_COMPONENT "),r(),o(17,"ion-button",9),y("click",function(){S(e);let i=m();return I(i.delete())}),c(18," SETTINGS.SYSTEM_UPDATE.DELETE_COMPONENT "),r()()()()()()()}if(t&2){let e=m();a(5),p("name",e.componentIcon),a(3),h("",e.factory.name," "),a(2),b(e.factory.description),a(2),p("formGroup",e.form),a(),p("form",e.form)("fields",e.fields)("model",e.model),a(2),p("disabled",e.form.pristine)}}var Qi=(()=>{class t{static{this.SELECTOR="componentUpdate"}constructor(e,n,i,l){this.route=e,this.utils=n,this.websocket=i,this.service=l,this.edge=null,this.factory=null,this.form=null,this.model=null,this.fields=null,this.componentIcon=null,this.componentId=null}ngOnInit(){return B(this,null,function*(){this.edge=yield this.service.getCurrentEdge();let e=this.route.snapshot.params.componentId,n=yield this.service.getConfig();this.componentId=e;let i=n.components[e];this.componentIcon=n.getFactoryIcon(this.factory,this.service.translate);let l=[],d={},[x,v]=yield this.edge.getFactoryProperties(this.websocket,i.factoryId);this.factory=x;for(let g of v){if(g.id==="id")continue;let J=g.id.replace(".","_"),ne={key:J,type:"input",templateOptions:{label:g.name,description:g.description,required:g.isRequired}};q.deepCopy(g.schema,ne),l.push(ne),i.properties[g.id]&&(Array.isArray(i.properties[g.id])&&i.properties[g.id]?.length>0&&i.properties[g.id]?.every(Ie=>typeof Ie=="object")?d[J]=JSON.stringify(i.properties[g.id]):d[J]=i.properties[g.id])}this.form=new oe({}),this.fields=l,this.model=d})}submit(){let e=[];for(let n in this.form.controls){let i=this.form.controls[n];if(i.dirty){let l=n.replace("_",".");e.push({name:l,value:i.value})}}this.edge.updateComponentConfig(this.websocket,this.componentId,e).then(()=>{this.form.markAsPristine(),this.service.toast("Successfully updated "+this.componentId+".","success")}).catch(n=>{this.service.toast("Error updating "+this.componentId+":"+n.error.message,"danger")})}delete(){this.edge.deleteComponentConfig(this.websocket,this.componentId).then(()=>{this.form.markAsPristine(),this.service.toast("Successfully deleted "+this.componentId+".","success")}).catch(e=>{this.service.toast("Error deleting "+this.componentId+":"+e.error.message,"danger")})}static{this.\u0275fac=function(n){return new(n||t)(f(j),f(q),f(D),f(N))}}static{this.\u0275cmp=L({type:t,selectors:[["componentUpdate"]],standalone:!1,decls:2,vars:1,consts:[[1,"ion-justify-content-center"],["size","12","size-xl","8"],["size","large","slot","start","color","primary",3,"name"],[1,"ion-text-wrap",2,"color","var(--ion-text-color-reverse)"],[1,"ion-text-wrap",2,"color","var(--ion-text-color-shade)"],[3,"ngSubmit","formGroup"],[3,"form","fields","model"],[2,"padding-top","10px"],["size","small","color","primary","translate","",1,"ion-float-left",3,"click","disabled"],["size","small","color","warning","translate","",1,"ion-float-right",3,"click"]],template:function(n,i){n&1&&(o(0,"ion-content"),u(1,On,19,8,"ion-grid"),r()),n&2&&(a(),C(i.factory&&i.form?1:-1))},dependencies:[pe,ae,ie,G,Q,z,Ve,Me,H,V,W,$,M,P,Y,le,ee],encapsulation:2})}}return t})();var Rt=()=>[],Qe=(t,s)=>({value:t,indentation:s}),At=t=>({value:t,indentation:4});function Rn(t,s){t&1&&(o(0,"a"),c(1," \xA0 "),r())}function An(t,s){if(t&1&&(o(0,"a"),E(1,Rn,2,0,"a",3),c(2),_(3,"template",4),c(4,", "),_(5,"br"),r()),t&2){let e=s.$implicit,n=m(2).indentation;m();let i=A(1);a(),p("ngForOf",X(4,Rt).constructor(n)),a(),h(' "',e.key,'": '),a(),p("ngTemplateOutlet",i)("ngTemplateOutletContext",Fe(5,Qe,e.value,n+4))}}function Nn(t,s){t&1&&(o(0,"a"),c(1," \xA0 "),r())}function Ln(t,s){if(t&1&&(c(0," { "),_(1,"br"),E(2,An,6,8,"a",3),w(3,"keyvalue"),E(4,Nn,2,0,"a",3),c(5," } ")),t&2){let e=m(),n=e.value,i=e.indentation;a(2),p("ngForOf",k(3,2,n.properties)),a(2),p("ngForOf",X(4,Rt).constructor(i-4))}}function Vn(t,s){if(t&1&&c(0),t&2){let e=m().value;h(" ",e.type," ")}}function Mn(t,s){if(t&1&&_(0,"template",4),t&2){let e=m(2),n=e.value,i=e.indentation;m();let l=A(1);p("ngTemplateOutlet",l)("ngTemplateOutletContext",Fe(2,Qe,n.elementType,i+4))}}function Pn(t,s){if(t&1&&(E(0,Mn,1,5,"template",5),c(1," [] ")),t&2){let e=m().value;p("ngIf",e.elementType)}}function qn(t,s){if(t&1&&(o(0,"a"),_(1,"template",4),c(2," | "),r()),t&2){let e=s.$implicit,n=m(2).indentation;m();let i=A(1);a(),p("ngTemplateOutlet",i)("ngTemplateOutletContext",Fe(2,Qe,e,n+4))}}function Bn(t,s){if(t&1&&E(0,qn,3,5,"a",3),t&2){let e=m().value;p("ngForOf",e.validTypes)}}function $n(t,s){t&1&&c(0," ? ")}function Dn(t,s){if(t&1&&(u(0,Ln,6,5)(1,Vn,1,1)(2,Pn,2,1)(3,Bn,1,1,"a"),u(4,$n,1,0)),t&2){let e,n=s.value;C((e=n.type)==="object"?0:e==="string"?1:e==="array"?2:e==="multiple"?3:-1),a(4),C(n.optional?4:-1)}}function Jn(t,s){if(t&1&&(o(0,"span",15),c(1),r()),t&2){let e=s.$implicit;a(),h(" ",e.method," \u2794 ")}}function jn(t,s){if(t&1&&(o(0,"a")(1,"ion-chip"),c(2),r()()),t&2){let e=s.$implicit;a(2),h(" ",e.name," ")}}function Un(t,s){if(t&1&&(o(0,"ion-col",13),_(1,"div",16),r()),t&2){let e=m().$implicit;a(),p("innerHTML",e.description,Ze)}}function Gn(t,s){if(t&1&&(o(0,"ion-row")(1,"ion-col",13)(2,"ion-chip"),c(3),r(),c(4),r()()),t&2){let e=s.$implicit;a(3),h(" ",e.name," "),a(),h(" ",e.description," ")}}function zn(t,s){if(t&1&&(o(0,"ion-col",17)(1,"div"),c(2,"Request"),r(),_(3,"template",4),r()),t&2){let e=m().$implicit;m();let n=A(1);a(3),p("ngTemplateOutlet",n)("ngTemplateOutletContext",te(2,At,e.request.json))}}function Hn(t,s){if(t&1&&(o(0,"ion-col",17)(1,"div"),c(2,"Response"),r(),_(3,"template",4),r()),t&2){let e=m().$implicit;m();let n=A(1);a(3),p("ngTemplateOutlet",n)("ngTemplateOutletContext",te(2,At,e.response.json))}}function Wn(t,s){if(t&1&&(o(0,"ion-select-option",20),c(1),r()),t&2){let e=s.$implicit;p("value",e.key),a(),h(" ",e.key," ")}}function Yn(t,s){if(t&1&&(o(0,"div")(1,"pre")(2,"code"),c(3),w(4,"json"),r()()()),t&2){let e=m().$implicit;a(3),b(k(4,1,e.value))}}function Kn(t,s){if(t&1&&(o(0,"div"),E(1,Yn,5,3,"div",12),r()),t&2){let e=s.$implicit,n=m(3).$implicit;a(),p("ngIf",e.key===n.request.selectedExample)}}function Xn(t,s){if(t&1){let e=T();o(0,"ion-col",17)(1,"ion-item")(2,"ion-select",18),ge("ngModelChange",function(i){S(e);let l=m(2).$implicit;return xe(l.request.selectedExample,i)||(l.request.selectedExample=i),I(i)}),E(3,Wn,2,2,"ion-select-option",19),r()(),E(4,Kn,2,1,"div",3),r()}if(t&2){let e=m(2).$implicit;a(2),he("ngModel",e.request.selectedExample),a(),p("ngForOf",e.request.examples),a(),p("ngForOf",e.request.examples)}}function Qn(t,s){if(t&1&&(o(0,"ion-select-option",20),c(1),r()),t&2){let e=s.$implicit;p("value",e.key),a(),h(" ",e.key," ")}}function Zn(t,s){if(t&1&&(o(0,"div")(1,"pre")(2,"code"),c(3),w(4,"json"),r()()()),t&2){let e=m().$implicit;a(3),b(k(4,1,e.value))}}function ei(t,s){if(t&1&&(o(0,"div"),E(1,Zn,5,3,"div",12),r()),t&2){let e=s.$implicit,n=m(3).$implicit;a(),p("ngIf",e.key===n.response.selectedExample)}}function ti(t,s){if(t&1){let e=T();o(0,"ion-col",17)(1,"ion-item")(2,"ion-select",21),ge("ngModelChange",function(i){S(e);let l=m(2).$implicit;return xe(l.response.selectedExample,i)||(l.response.selectedExample=i),I(i)}),E(3,Qn,2,2,"ion-select-option",19),r()(),E(4,ei,2,1,"div",3),r()}if(t&2){let e=m(2).$implicit;a(2),he("ngModel",e.response.selectedExample),a(),p("ngForOf",e.response.examples),a(),p("ngForOf",e.response.examples)}}function ni(t,s){if(t&1&&(o(0,"ion-row")(1,"ion-col",13),c(2," Examples "),r(),E(3,Xn,5,3,"ion-col",11)(4,ti,5,3,"ion-col",11),r()),t&2){let e=m().$implicit;a(3),p("ngIf",e.request.json),a(),p("ngIf",e.response.json)}}function ii(t,s){if(t&1){let e=T();o(0,"div")(1,"ion-item")(2,"ion-textarea",29),ge("ngModelChange",function(i){S(e);let l=m(2).$implicit;return xe(l.modelRaw,i)||(l.modelRaw=i),I(i)}),r()()()}if(t&2){let e=m(2).$implicit;a(2),he("ngModel",e.modelRaw)}}function oi(t,s){t&1&&(o(0,"div"),c(1,"Form"),r())}function ri(t,s){if(t&1){let e=T();o(0,"div")(1,"ion-label"),c(2," Request "),r(),o(3,"ion-row")(4,"ion-col",17)(5,"ion-segment",22),ge("ngModelChange",function(i){S(e);let l=m().$implicit;return xe(l.requestMethod,i)||(l.requestMethod=i),I(i)}),o(6,"ion-segment-button",23)(7,"ion-label"),c(8,"Raw"),r()(),o(9,"ion-segment-button",24)(10,"ion-label"),c(11,"Form"),r()()()()(),o(12,"ion-row",25)(13,"ion-col"),E(14,ii,3,1,"div",26)(15,oi,2,0,"div",26),r()(),o(16,"ion-row")(17,"ion-col",13)(18,"ion-toolbar")(19,"ion-button",27),y("click",function(){S(e);let i=m().$implicit,l=m();return I(l.request(i))}),c(20," Run! "),r()()()(),o(21,"ion-label"),c(22," Response "),r(),o(23,"ion-row")(24,"ion-col",13),_(25,"ngx-spinner",28),o(26,"pre")(27,"code"),c(28),r()()()()()}if(t&2){let e=m().$implicit;a(5),he("ngModel",e.requestMethod),a(7),p("ngSwitch",e.requestMethod),a(2),p("ngSwitchCase","raw"),a(),p("ngSwitchCase","form"),a(4),p("disabled",e.fetch==null?null:e.fetch.loading),a(6),p("name",e.method),a(3),b(e.fetch==null?null:e.fetch.response)}}function ai(t,s){if(t&1){let e=T();Te(0),o(1,"ion-accordion-group")(2,"ion-accordion")(3,"ion-item",6)(4,"ion-label",7),E(5,Jn,2,1,"span",8),c(6),E(7,jn,3,1,"a",3),r()(),o(8,"ion-card-content",9)(9,"ion-grid")(10,"ion-row"),E(11,Un,2,1,"ion-col",10),r(),E(12,Gn,5,2,"ion-row",3),o(13,"ion-row"),E(14,zn,4,4,"ion-col",11)(15,Hn,4,4,"ion-col",11),r(),E(16,ni,5,2,"ion-row",12),o(17,"ion-row")(18,"ion-col",13)(19,"ion-toolbar")(20,"ion-button",14),y("click",function(){let i=S(e).$implicit;return I(i.tryRequest=!i.tryRequest)}),c(21,"Try now!"),r()()()(),E(22,ri,29,7,"div",12),r()()()(),we()}if(t&2){let e=s.$implicit;a(5),p("ngForOf",e.parent),a(),h(" ",e.method," "),a(),p("ngForOf",e.tags),a(4),p("ngIf",e.description),a(),p("ngForOf",e.guards),a(2),p("ngIf",e.request.json),a(),p("ngIf",e.response.json),a(),p("ngIf",e.request.examples&&e.response.examples),a(6),p("ngIf",e.tryRequest)}}var ro=(()=>{class t{static{this.SELECTOR="jsonrpcTest"}constructor(e,n,i,l){this.route=e,this.service=n,this.websocket=i,this.userService=l,this.endpoints=[]}ngOnInit(){this.service.getCurrentEdge().then(e=>{this.edge=e,e.sendRequest(this.websocket,new K("routes",{})).then(n=>{this.endpoints=n.result.endpoints.map(i=>({method:i.method,description:i.description?i.description.replace(`
`,"<br>"):null,tags:i.tags,guards:i.guards,request:i.request,response:i.response,parent:i.parent,requestMethod:"raw",form:new oe({}),model:{},modelRaw:JSON.stringify(Nt(i.request.json),null,2)}))})}).catch(e=>{this.service.toast(e,"danger")})}request(e){console.log("Run!",e),e.fetch||(e.fetch={}),e.fetch.loading=!0,this.service.startSpinnerTransparentBackground(e.method);let n=new K(e.method,e.modelRaw?JSON.parse(e.modelRaw):{});for(let i=e.parent.length-1;i>=0;i--){let l=e.parent[i];if(ve.backend==="OpenEMS Backend"&&l.method==="authenticatedRpc")break;let d=n;n=new K(l.method,Ee({},l.request.base));let x=n.params;for(let v=0;v<l.request.pathToSubrequest.length;v++){let g=l.request.pathToSubrequest[v];v===l.request.pathToSubrequest.length-1?x[g]=d:x[g]={}}}(ve.backend==="OpenEMS Edge"?this.websocket.sendRequest(n):this.edge.sendRequest(this.websocket,n)).then(i=>{e.fetch.response=JSON.stringify(i,null,2)}).catch(i=>{e.fetch.response=JSON.stringify(i,null,2)}).finally(()=>{e.fetch.loading=!1,this.service.stopSpinner(e.method)})}static{this.\u0275fac=function(n){return new(n||t)(f(j),f(N),f(D),f(bt))}}static{this.\u0275cmp=L({type:t,selectors:[["jsonrpcTest"]],standalone:!1,decls:7,vars:1,consts:[["type",""],[1,"ion-justify-content-center"],["size","12","size-xl","8"],[4,"ngFor","ngForOf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],["slot","header","lines","bottom"],[2,"white-space","initial"],["style","opacity: 30%",4,"ngFor","ngForOf"],["slot","content"],["size","12",4,"ngIf"],["size","6",4,"ngIf"],[4,"ngIf"],["size","12"],["slot","end",3,"click"],[2,"opacity","30%"],[3,"innerHTML"],["size","6"],["label","Example Request","placeholder","Select example Request...","interface","popover",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["label","Example Response","placeholder","Select example Response...","interface","popover",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value","raw"],["value","form"],[3,"ngSwitch"],[4,"ngSwitchCase"],["slot","end",3,"click","disabled"],[3,"name"],["label","Request","auto-grow","true","type","text",3,"ngModelChange","ngModel"]],template:function(n,i){n&1&&(E(0,Dn,5,2,"ng-template",null,0,tt),o(2,"ion-content")(3,"ion-grid")(4,"ion-row",1)(5,"ion-col",2),E(6,ai,23,9,"ng-container",3),r()()()()),n&2&&(a(6),p("ngForOf",i.endpoints))},dependencies:[it,ot,lt,rt,at,Ge,Ae,pt,Ct,ft,G,z,ht,H,V,W,M,P,Y,vt,yt,Be,$e,De,St,Le,U,ct,Oe],encapsulation:2})}}return t})();function Nt(t){if(t)switch(t.type){case"object":{let s={};for(let[e,n]of Object.entries(t.properties))s[e]=Nt(n);return s}case"string":return"string"}}var Lt=(()=>{class t extends K{static{this.METHOD="executeSystemCommand"}constructor(e){super(t.METHOD,e),this.params=e}}return t})();function li(t,s){if(t&1&&(c(0),_(1,"br"),c(2,`
                      `)),t&2){let e=s.$implicit;h(`
                        `,e)}}function si(t,s){if(t&1&&(o(0,"ion-item-group")(1,"ion-item-divider")(2,"ion-label"),c(3,"Output"),r()(),o(4,"ion-item",14)(5,"pre"),O(6,li,3,1,null,null,F),r()()()),t&2){let e=m(3);a(6),R(e.stdout)}}function ci(t,s){if(t&1&&(c(0),_(1,"br"),c(2,`
                      `)),t&2){let e=s.$implicit;h(`
                        `,e)}}function mi(t,s){if(t&1&&(o(0,"ion-item-group")(1,"ion-item-divider")(2,"ion-label"),c(3,"Error"),r()(),o(4,"ion-item",14)(5,"pre"),O(6,ci,3,1,null,null,F),r()()()),t&2){let e=m(3);a(6),R(e.stderr)}}function pi(t,s){if(t&1&&(u(0,si,8,0,"ion-item-group"),u(1,mi,8,0,"ion-item-group")),t&2){let e=m(2);C(e.stdout.length>0?0:-1),a(),C(e.stderr.length>0?1:-1)}}function di(t,s){if(t&1&&(o(0,"ion-row",0)(1,"ion-col",12)(2,"ion-card")(3,"ion-item",2),_(4,"ion-icon",3),o(5,"ion-label"),c(6,"Latest output"),r()(),o(7,"ion-card-content"),_(8,"ngx-loading",13),u(9,pi,2,2),r()()()()),t&2){let e=m();a(8),p("show",e.loading),a(),C(e.loading?-1:9)}}function _i(t,s){if(t&1){let e=T();o(0,"ion-row")(1,"ion-col",15),c(2),r(),o(3,"ion-col",15),c(4),r(),o(5,"ion-col",17),c(6),r(),o(7,"ion-col",15)(8,"ion-button",18),y("click",function(){let i=S(e).$implicit,l=m(2);return l.formGroup.controls.username.value=i.params.username,l.formGroup.controls.password.value=i.params.password,l.formGroup.controls.timeoutSeconds.value=i.params.timeoutSeconds,l.formGroup.controls.runInBackground.value=i.params.runInBackground,I(l.formGroup.controls.command.value=i.params.command)}),c(9,"Repeat "),r()()()}if(t&2){let e=s.$implicit;a(2),b(e.params.timeoutSeconds),a(2),b(e.params.runInBackground),a(2),b(e.params.command)}}function ui(t,s){if(t&1&&(o(0,"ion-row",0)(1,"ion-col",12)(2,"ion-card")(3,"ion-item",2),_(4,"ion-icon",3),o(5,"ion-label"),c(6,"Last commands"),r()(),o(7,"ion-card-content")(8,"ion-grid")(9,"ion-row")(10,"ion-col",15)(11,"ion-label",16),c(12,"Timeout"),r()(),o(13,"ion-col",15)(14,"ion-label",16),c(15,"Run in background"),r()(),o(16,"ion-col",17)(17,"ion-label",16),c(18,"Command"),r()(),_(19,"ion-col",15),r(),O(20,_i,10,3,"ion-row",null,F),r()()()()()),t&2){let e=m();a(20),R(e.commandLogs)}}var Ci={ping:t=>`ping -c4 ${t}`,"openems-restart":()=>"which at || DEBIAN_FRONTEND=noninteractive apt-get -y install at; echo 'systemctl restart openems' | at now"},uo=(()=>{class t{static{this.SELECTOR="systemExecute"}constructor(e,n,i,l,d,x){this.route=e,this.utils=n,this.websocket=i,this.service=l,this.translate=d,this.formBuilder=x,this.loading=!1,this.stdout=[],this.stderr=[],this.commandLogs=[],this.model={},this.options={},this.fields=[{key:"predefined",type:"radio",templateOptions:{options:[{value:"ping",label:"Ping device in network"}]}},{key:"ping",hideExpression:(v,g)=>this.model.predefined!=="ping",fieldGroup:[{key:"ip",type:"input",templateOptions:{label:"IP-Address",placeholder:"192.168.0.1",required:!0,pattern:/(\d{1,3}\.){3}\d{1,3}/},validation:{messages:{pattern:(v,g)=>`"${g.formControl.value}" is not a valid IP Address`}}}]},{key:"predefined",type:"radio",templateOptions:{options:[{value:"openems-restart",label:"Restart OpenEMS Edge service"}]}}]}ngOnInit(){this.form=this.formBuilder.group({username:new re("root"),password:new re(""),timeoutSeconds:new re(5),runInBackground:new re(!1),command:new re("")})}updatePredefined(){let e;if(!this.form.valid)e="";else{let n=this.model,i=Ci[n.predefined];switch(n.predefined){case"ping":e=i(n.ping.ip);break;case"openems-restart":default:e=i()}}this.form.controls.command.setValue(e)}submit(){let e=this.form.controls.username,n=this.form.controls.password,i=this.form.controls.timeoutSeconds,l=this.form.controls.runInBackground,d=this.form.controls.command;this.service.getCurrentEdge().then(x=>{this.loading=!0,this.stdout=[],this.stderr=[];let v=new Lt({username:e.value,password:n.value,timeoutSeconds:i.value,runInBackground:l.value,command:d.value});x.sendRequest(this.websocket,new de({componentId:"_host",payload:v})).then(g=>{let J=g.result;this.loading=!1,J.stdout.length==0?this.stdout=[""]:this.stdout=J.stdout,this.stderr=J.stderr}).catch(g=>{this.loading=!1,this.stderr=["Error executing system command:",g.error.message]}),this.commandLogs.unshift(v)})}static{this.\u0275fac=function(n){return new(n||t)(f(j),f(q),f(D),f(N),f(Z),f(_t))}}static{this.\u0275cmp=L({type:t,selectors:[["systemExecute"]],standalone:!1,decls:34,vars:7,consts:[[1,"ion-justify-content-center"],["size","12","size-md","6"],["lines","full","color","light"],["slot","start","name","code-working-outline","color","primary"],[1,"hide-empty-list-header",3,"modelChange","model","fields","options","form"],[3,"ngSubmit","formGroup"],["formControlName","username","type","text","label","Username"],["formControlName","password","type","password","label","Password"],["formControlName","timeoutSeconds","type","number","label","Timeout"],["tabindex","0","mode","md","formControlName","runInBackground","label","Run in Background","justify","space-between"],["auto-grow","true","formControlName","command","type","text","label","Command","label-placement","floating",1,"command-textbox"],["expand","block","type"," submit","color","primary"],["size","12"],[3,"show"],[2,"font-family","monospace"],["size","1"],["color","primary"],["size","9"],[3,"click"]],template:function(n,i){n&1&&(o(0,"ion-content")(1,"ion-grid")(2,"ion-row",0)(3,"ion-col",1)(4,"ion-card")(5,"ion-item",2),_(6,"ion-icon",3),o(7,"ion-label"),c(8,"Predefined Commands"),r()(),o(9,"ion-card-content")(10,"formly-form",4),y("modelChange",function(){return i.updatePredefined()}),r()()()(),o(11,"ion-col",1)(12,"ion-card")(13,"ion-item",2),_(14,"ion-icon",3),o(15,"ion-label"),c(16,"Manual System Execute"),r()(),o(17,"ion-card-content")(18,"form",5),y("ngSubmit",function(){return i.submit()}),o(19,"ion-item"),_(20,"ion-input",6),r(),o(21,"ion-item"),_(22,"ion-input",7),r(),o(23,"ion-item"),_(24,"ion-input",8),r(),o(25,"ion-item")(26,"ion-toggle",9),c(27,"Run in background"),r()(),o(28,"ion-item"),_(29,"ion-textarea",10),r(),o(30,"ion-button",11),c(31,"Send"),r()()()()()(),u(32,di,10,2,"ion-row",0),u(33,ui,22,0,"ion-row",0),r()()),n&2&&(a(10),p("model",i.model)("fields",i.fields)("options",i.options)("form",i.form),a(8),p("formGroup",i.form),a(14),C(i.stdout.length>0||i.stderr.length>0||i.loading?32:-1),a(),C(i.commandLogs.length>0?33:-1))},dependencies:[pe,ae,Ae,ie,G,Q,z,H,V,W,$,Pe,M,xt,se,P,Y,De,Je,Ne,ut,U,le,dt],encapsulation:2})}}return t})();export{yi as a,Ai as b,Bi as c,Ui as d,Wi as e,Qi as f,ro as g,uo as h};
