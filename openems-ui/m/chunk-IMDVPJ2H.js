import{a as k}from"./chunk-IZM4D5AZ.js";import{a as ye,b as oe}from"./chunk-U4AVYC7D.js";import{a as Q}from"./chunk-B5TTBQK4.js";import{d as X,g as $,h as ee,j as S,k as U,m as P}from"./chunk-RQWSIHDL.js";import"./chunk-6SDHATKH.js";import{a as te}from"./chunk-2OZBANFK.js";import"./chunk-GYAINRZU.js";import"./chunk-V6SQQYN5.js";import{$d as de,$f as ve,A as ae,Ca as Z,Da as j,E as b,Ea as c,Ef as q,F as V,Ff as h,Hb as ce,Hc as y,Ma as z,N as F,Qa as K,Ra as W,Uf as J,V as a,Vf as B,Wf as ge,Xe as O,Ye as L,Ze as _,_e as G,ba as Y,ce as Ce,da as T,dc as ue,ea as me,eg as m,fc as he,ge as fe,ha as x,ie as Ee,jb as le,jc as re,kb as pe,mg as I,oa as C,qa as f,va as p,wa as g,xa as v,ya as d}from"./chunk-UEHZAF3Y.js";import"./chunk-TCWA4BEU.js";import"./chunk-HJTVDRW6.js";import"./chunk-YJIFWFWF.js";import"./chunk-QUJFQN2Y.js";import"./chunk-P3LHHAYW.js";import"./chunk-Y7WT5TFP.js";import"./chunk-JHMH7CMQ.js";import"./chunk-WVHTM5RI.js";import"./chunk-IN6HLDFE.js";import"./chunk-GIMG75PD.js";import"./chunk-IHO4TDRD.js";import"./chunk-4KCIDQZU.js";import"./chunk-7UI6JPU6.js";import"./chunk-J5AVGG2P.js";import"./chunk-VIYDSDQU.js";import"./chunk-F46NF3P5.js";import"./chunk-SAL3DLJT.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EOGXKGKT.js";import"./chunk-CKP3SGE2.js";import"./chunk-RY6RMDSE.js";import{a as R,b as ne}from"./chunk-OQDXQ3X5.js";function Re(o,H){if(o&1&&(g(0,"table",1)(1,"tr")(2,"td",5),K(3),v()()()),o&2){let e=c();a(3),W(e.chartTitle)}}function Te(o,H){if(o&1&&d(0,"canvas",4),o&2){let e=c();p("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var _e=(()=>{class o extends q{static getChartData(e,t,i,n){ve.assertIsDefined(t);let l=n?.hasComponentNature("io.openems.edge.ess.api.HybridEss",t.id),w=o.getChargeDischargeInputChannel(l,t.id,i,n,e),E=[{unit:L.ENERGY,position:"left",yAxisId:_.LEFT}];i==="line"&&E.push({unit:L.PERCENTAGE,position:"right",yAxisId:_.RIGHT});let N=[...w,{name:"Soc",powerChannel:m.fromString(t.id+"/Soc")}],M=n.getComponentsByFactory("Controller.Ess.EmergencyCapacityReserve").filter(u=>u!=null&&u.isEnabled&&t.hasPropertyValue("ess.id",t.id))[0]??null,s=n.getPropertyFromComponent(M,"isReserveSocEnabled");return M&&s&&N.push({name:"EmergencyReserve",powerChannel:new m(M.id,"ActualReserveSoc")}),{input:N,output:u=>{let A=[ne(R({name:e.instant("GENERAL.CHARGE")},o.getChargeDisplayValues(t.id,u,l,i)),{stack:0,color:h.Colors.GREEN}),ne(R({name:e.instant("GENERAL.DISCHARGE")},o.getDischargeDisplayValues(t.id,u,l)),{stack:1,color:h.Colors.RED})];return n.hasComponentNature("io.openems.edge.ess.api.AsymmetricEss",t.id)&&A.push(...k.THREE_PHASE.map((r,D)=>({name:e.instant("GENERAL.PHASE")+" "+r,converter:()=>u[t.id+"/ActivePower"+r],stack:1,color:h.Colors.DEFAULT_PHASES_COLORS[D]}))),i==="line"&&A.push({name:e.instant("GENERAL.SOC"),converter:()=>u.Soc.map(r=>O.multiplySafely(r,1e3)),color:h.Colors.GREY,borderDash:[10,10],yAxisId:_.RIGHT}),M&&s&&A.push({name:e.instant("EDGE.INDEX.EMERGENCY_RESERVE.EMERGENCY_RESERVE"),converter:()=>u.EmergencyReserve.map(r=>O.multiplySafely(r,1e3)),color:h.Colors.BLACK,yAxisId:_.RIGHT,borderDash:[3,3]}),A},tooltip:{formatNumber:h.NumberFormat.ZERO_TO_TWO},yAxes:E}}static getChargeDischargeInputChannel(e,t,i,n,l){let w=[R({name:t+"Charge"},o.getChargeInputChannels(e,t,i)),R(R({name:t+"Discharge"},o.getDischargeInputChannels(e,t)),i==="line"&&{converter:G.ValueConverter.NEGATIVE_AS_ZERO})];return n.hasComponentNature("io.openems.edge.ess.api.AsymmetricEss",t)&&w.push(...k.THREE_PHASE.map(E=>R({name:l.instant("GENERAL.PHASE")+" "+E,powerChannel:new m(t,"ActivePower"+E)},i==="line"&&{converter:G.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE}))),w}static getChargeInputChannels(e,t,i){return R({energyChannel:new m(t,e?"DcChargeEnergy":"ActiveChargeEnergy"),powerChannel:new m(t,e?"DcDischargePower":"ActivePower")},i==="line"?{converter:G.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE}:{})}static getDischargeInputChannels(e,t){return{energyChannel:new m(t,e?"DcDischargeEnergy":"ActiveDischargeEnergy"),powerChannel:new m(t,e?"DcDischargePower":"ActivePower")}}static getChargeDisplayValues(e,t,i,n){let l=o.getChargeInputChannels(i,e,n);return{converter:()=>t[e+"Charge"],nameSuffix:w=>w.result.data[l.energyChannel.toString()]}}static getDischargeDisplayValues(e,t,i){let n=o.getDischargeInputChannels(i,e);return{converter:()=>t[e+"Discharge"],nameSuffix:l=>l.result.data[n.energyChannel.toString()]}}getChartData(){let e=this.config.getComponent(this.route.snapshot.params.componentId);return o.getChartData(this.translate,e,this.chartType,this.config)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=F(o)))(i||o)}})()}static{this.\u0275cmp=T({type:o,selectors:[["common-storage-details-ess-chart"]],features:[x],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(t,i){t&1&&(d(0,"oe-history-data-error",0),C(1,Re,4,1,"table",1),g(2,"div",2),d(3,"ngx-spinner",3),C(4,Te,1,4,"canvas",4),v()),t&2&&(p("response",i.errorResponse),a(),f(i.chartTitle?1:-1),a(),z("height",i.getChartHeight(),"px"),a(),p("name",i.spinnerId),a(),f(i.loading?-1:4))},dependencies:[I,X,y,P,J,S,ee,B],encapsulation:2})}}return o})();function Pe(o,H){if(o&1){let e=Z();g(0,"oe-chart",1),j("setShowTotal",function(i){b(e);let n=c();return V(n.setShowTotal(i))})("setShowPhases",function(i){b(e);let n=c();return V(n.setShowPhases(i))}),d(1,"common-storage-details-ess-chart",2),v()}if(o&2){let e=c();p("title",e.component.alias)("showPhases",e.showPhases)("showTotal",e.showTotal)("period",e.service.historyPeriod.value),a(),p("component",e.component)("isOnlyChart",!0)}}var Se=(()=>{class o extends Q{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=F(o)))(i||o)}})()}static{this.\u0275cmp=T({type:o,selectors:[["ng-component"]],features:[x],decls:1,vars:1,consts:[[3,"title","showPhases","showTotal","period"],[3,"setShowTotal","setShowPhases","title","showPhases","showTotal","period"],[3,"component","isOnlyChart"]],template:function(t,i){t&1&&C(0,Pe,2,6,"oe-chart",0),t&2&&f(i.isInitialized?0:-1)},dependencies:[I,te,y,P,$,U,S,_e,oe],encapsulation:2})}}return o})();function Ie(o,H){if(o&1&&(g(0,"table",1)(1,"tr")(2,"td",5),K(3),v()()()),o&2){let e=c();a(3),W(e.chartTitle)}}function Ne(o,H){if(o&1&&d(0,"canvas",4),o&2){let e=c();p("datasets",e.datasets)("labels",e.labels)("options",e.options)("type",e.chartType)}}var we=(()=>{class o extends q{static getChartData(e,t,i){let n=i?.getComponentsImplementingNature("io.openems.edge.ess.api.SymmetricEss").filter(s=>!s.factoryId.includes("Ess.Cluster")),l=n?.length===1?n[0]:null,w=[{unit:L.ENERGY,position:"left",yAxisId:_.LEFT}];t==="line"&&w.push({unit:L.PERCENTAGE,position:"right",yAxisId:_.RIGHT});let E=[];E.push({name:"_sum/EssActivePower",powerChannel:m.fromString("_sum/EssActivePower")},{name:"_sum/Charge",energyChannel:m.fromString("_sum/EssDcChargeEnergy")},{name:"_sum/Discharge",energyChannel:m.fromString("_sum/EssDcDischargeEnergy")},{name:"_sum/ProductionDcActualPower",powerChannel:m.fromString("_sum/ProductionDcActualPower"),energyChannel:m.fromString("_sum/ProductionActiveEnergy")},{name:"Soc",powerChannel:m.fromString("_sum/EssSoc")});let N=i.getComponentsByFactory("Controller.Ess.EmergencyCapacityReserve").filter(s=>s.isEnabled)[0]??null,M=i.getPropertyFromComponent(N,"isReserveSocEnabled");return n.length===1&&N!=null&&M&&E.push({name:"EmergencyReserve",powerChannel:new m(N.id,"ActualReserveSoc")}),l!==null&&i.hasComponentNature("io.openems.edge.ess.api.AsymmetricEss",l.id)&&E.push(...k.THREE_PHASE.map((s,u)=>({name:e.instant("GENERAL.PHASE")+" "+s,powerChannel:new m(l.id,"ActivePower"+s)}))),{input:E,output:s=>{let u=[];t==="line"&&(i.getComponentsImplementingNature("io.openems.edge.ess.dccharger.api.EssDcCharger").length>0?s["_sum/ProductionDcActualPower"]?.forEach((r,D)=>{s["_sum/ProductionDcActualPower"][D]!=null&&s["_sum/ProductionDcActualPower"][D]!=null&&(u[D]=O.subtractSafely(s["_sum/EssActivePower"][D],r))}):u=s["_sum/EssActivePower"]);let A=[{name:e.instant("GENERAL.CHARGE"),converter:()=>t==="line"?u?.map(r=>G.ValueConverter.POSITIVE_AS_ZERO_AND_INVERT_NEGATIVE(r)):s["_sum/Charge"],nameSuffix:r=>r.result.data["_sum/EssDcChargeEnergy"],color:h.Colors.GREEN,stack:0},{name:e.instant("GENERAL.DISCHARGE"),converter:()=>t==="line"?u?.map(r=>G.ValueConverter.NEGATIVE_AS_ZERO(r)):s["_sum/Discharge"],nameSuffix:r=>r.result.data["_sum/EssDcDischargeEnergy"],color:h.Colors.RED,stack:1}];return l!==null&&i.hasComponentNature("io.openems.edge.ess.api.AsymmetricEss",l.id)&&A.push(...k.THREE_PHASE.map((r,D)=>({name:e.instant("GENERAL.PHASE")+" "+r,converter:()=>s[l.id+"/ActivePower"+r],stack:1,color:h.Colors.DEFAULT_PHASES_COLORS[D]}))),t==="line"&&A.push({name:e.instant("GENERAL.SOC"),converter:()=>s.Soc?.map(r=>O.multiplySafely(r,1e3)),color:h.Colors.GREY,borderDash:[10,10],yAxisId:_.RIGHT}),N!=null&&M&&A.push({name:e.instant("EDGE.INDEX.EMERGENCY_RESERVE.EMERGENCY_RESERVE"),converter:()=>s.EmergencyReserve?.map(r=>O.multiplySafely(r,1e3)),color:h.Colors.BLACK,yAxisId:_.RIGHT,borderDash:[3,3]}),A},tooltip:{formatNumber:h.NumberFormat.ZERO_TO_TWO},yAxes:w}}getChartData(){return o.getChartData(this.translate,this.chartType,this.config)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=F(o)))(i||o)}})()}static{this.\u0275cmp=T({type:o,selectors:[["common-storage-total-chart"]],features:[x],decls:5,vars:6,consts:[[3,"response"],[1,"full_width"],["id","chart-area",1,"semi-transparent-background","ion-padding-top"],[3,"name"],["baseChart","",2,"padding-bottom","2vh",3,"datasets","labels","options","type"],[1,"ion-padding",2,"width","100%"]],template:function(t,i){t&1&&(d(0,"oe-history-data-error",0),C(1,Ie,4,1,"table",1),g(2,"div",2),d(3,"ngx-spinner",3),C(4,Ne,1,4,"canvas",4),v()),t&2&&(p("response",i.errorResponse),a(),f(i.chartTitle?1:-1),a(),z("height",i.getChartHeight(),"px"),a(),p("name",i.spinnerId),a(),f(i.loading?-1:4))},dependencies:[I,X,y,P,J,S,ee,B],encapsulation:2})}}return o})();function Me(o,H){if(o&1){let e=Z();g(0,"oe-chart",2),le(1,"translate"),j("setShowTotal",function(i){b(e);let n=c();return V(n.setShowTotal(i))})("setShowPhases",function(i){b(e);let n=c();return V(n.setShowPhases(i))}),d(2,"common-storage-total-chart",3),v()}if(o&2){let e=c();p("title",pe(1,4,"GENERAL.STORAGE_SYSTEM"))("showTotal",e.showTotal)("period",e.service.historyPeriod.value),a(2),p("isOnlyChart",!0)}}function Oe(o,H){if(o&1&&d(0,"oe-footer-subnavigation",1),o&2){let e=c();p("navigationOptions",e.navigationButtons)}}var se=(()=>{class o extends Q{constructor(e,t,i,n){super(e,t,i),this.service=e,this.route=t,this.modalCtrl=i,this.router=n,this.essComponents=null,this.navigationButtons=[]}afterIsInitialized(){this.essComponents=this.config?.getComponentsImplementingNature("io.openems.edge.ess.api.SymmetricEss").filter(e=>e.isEnabled&&!e.factoryId.includes("Ess.Cluster")),!(!this.essComponents||this.essComponents.length<=1)&&(this.navigationButtons=this.essComponents.map(e=>({id:e.id,alias:e.alias,callback:()=>{this.router.navigate(["./"+e.id],{relativeTo:this.route})}})))}static{this.\u0275fac=function(t){return new(t||o)(Y(ge),Y(ue),Y(de),Y(he))}}static{this.\u0275cmp=T({type:o,selectors:[["storage-chart-overview"]],features:[x],decls:2,vars:2,consts:[[3,"title","showTotal","period"],[3,"navigationOptions"],[3,"setShowTotal","setShowPhases","title","showTotal","period"],[3,"isOnlyChart"]],template:function(t,i){t&1&&(C(0,Me,3,6,"oe-chart",0),C(1,Oe,1,1,"oe-footer-subnavigation",1)),t&2&&(f(i.isInitialized?0:-1),a(),f(i.isInitialized&&(i.navigationButtons==null?null:i.navigationButtons.length)>0?1:-1))},dependencies:[I,te,y,P,$,U,S,we,oe,ye,fe],encapsulation:2})}}return o})();var Ge=[{path:"",component:se},{path:":componentId",component:Se}],Bt=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275mod=me({type:o})}static{this.\u0275inj=ae({imports:[y,ce,Ce,Ee,U,re.forChild(Ge),S,B,se,re]})}}return o})();export{Bt as CommonStorage};
