import{$f as S,A as v,C,D as j,H as V,K as p,Wf as c,ba as b,bf as m,c as g,dg as F,ea as y,fa as I,ha as w,qb as d,u as o,z as D}from"./chunk-UEHZAF3Y.js";import{g as h}from"./chunk-OQDXQ3X5.js";var a=(()=>{class s{constructor(t){this.currentValue=p({allComponents:{}}),this.lastUpdated=p(new Date),this.edge=null,this.stopOnDestroy=new g,this.timestamps=[],t.getCurrentEdge().then(e=>{this.edge=e,e.currentData.pipe(o(this.stopOnDestroy)).subscribe(()=>this.lastUpdated.set(new Date))})}static{this.\u0275fac=function(e){return new(e||s)(C(c))}}static{this.\u0275prov=D({token:s,factory:s.\u0275fac})}}return s})();var U=(()=>{class s extends a{constructor(t,e){super(e),this.websocket=t,this.service=e,this.subscribeId=m(),this.subscribedChannelAddresses=[],this.subscription=null,this.injector=j(V),this.service.getCurrentEdge().then(r=>{this.edge=r,r.currentData.pipe(o(this.stopOnDestroy)).subscribe(()=>this.lastUpdated.set(new Date))})}getValues(t,e,r){S.assertIsDefined(e);for(let i of t)this.subscribedChannelAddresses.push(i);this.subscribeId=m(),this.edge=e,t.length!=0&&e.subscribeChannels(this.websocket,this.subscribeId,t),e.currentData.pipe(o(this.stopOnDestroy)).subscribe(i=>{let u=this.currentValue().allComponents;for(let l of t){let n=l.toString();u[n]=i.channel[n]}this.currentValue.set({allComponents:u}),this.lastUpdated.set(new Date)})}ngOnDestroy(){this!=null&&(this.edge?.unsubscribeFromChannels(this.subscribeId,this.websocket,this.subscribedChannelAddresses),this.stopOnDestroy?.next(),this.stopOnDestroy?.complete(),this.subscription?.destroy())}unsubscribeFromChannels(t){this.lastUpdated.set(null),this.edge?.unsubscribeFromChannels(this.subscribeId,this.websocket,t)}refresh(t){this.currentValue.set({allComponents:{}}),this.edge?.subscribeChannels(this.websocket,this.subscribeId,this.subscribedChannelAddresses),setTimeout(()=>{t.target.complete()},1e3)}subscribeAndGetFirstValidValueForChannels(t,e){return h(this,null,function*(){return this.getValues(t,this.edge,e),new Promise(r=>{this.subscription=d(()=>{let i=this.currentValue();if(!i||!t.every(n=>i.allComponents[n.toString()]!=null))return;this.unsubscribeFromChannels(t);let l=t.reduce((n,f)=>(n[f.toString()]=i.allComponents[f.toString()],n),{});i.allComponents=l,r(i)},{injector:this.injector}),this.subscription.destroy()})})}getFirstValidValueForChannel(t){return h(this,null,function*(){return new Promise(e=>{this.subscription=d(()=>{let r=this.currentValue();r||e(null);let i=r.allComponents[t.toString()];i!=null&&e(i)},{injector:this.injector})})})}static{this.\u0275fac=function(e){return new(e||s)(b(F),b(c))}}static{this.\u0275dir=I({type:s,features:[w]})}}return s})();var Q=(()=>{class s{static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275mod=y({type:s})}static{this.\u0275inj=v({providers:[{provide:a,useClass:U}]})}}return s})();export{a,U as b,Q as c};
