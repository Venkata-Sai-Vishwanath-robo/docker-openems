import{a as A,h as f}from"./chunk-A6D3LFCM.js";import{d as se,j as re}from"./chunk-VQJOV6KK.js";import{f as de}from"./chunk-GYAINRZU.js";import{Ac as $,Ca as L,Da as w,E as T,Ea as v,F as x,Gd as ie,Hc as z,Lf as h,Qa as C,Ra as U,Uf as ce,V as o,Wc as W,Wf as le,Xe as pe,Yc as K,Zc as Q,Zd as ne,ba as p,cd as X,da as b,dc as k,dd as Y,dg as me,ee as oe,fc as j,fe as ae,jc as H,jd as Z,kf as d,mf as g,mg as ue,oa as G,qa as N,qc as J,qd as ee,sa as O,sc as V,ta as M,td as te,ua as q,va as l,wa as c,xa as m,ya as E,yc as B}from"./chunk-UEHZAF3Y.js";import{a as y,g as F}from"./chunk-OQDXQ3X5.js";var _;(function(n){n.METHOD="deleteAppInstance";class a extends d{constructor(t){super(n.METHOD,t),this.params=t}}n.Request=a})(_||(_={}));var D;(function(n){n.METHOD="getAppInstances";class a extends d{constructor(i){super(n.METHOD,i),this.params=i}}n.Request=a;class e extends g{constructor(i,s){super(i,s),this.id=i,this.result=s}}n.Response=e})(D||(D={}));var R;(function(n){n.METHOD="updateAppInstance";class a extends d{constructor(i){super(n.METHOD,i),this.params=i}}n.Request=a;class e extends g{constructor(i,s){super(i,s),this.id=i,this.result=s}}n.Response=e})(R||(R={}));function fe(n,a){n&1&&E(0,"div",7)}function Ie(n,a){if(n&1){let e=L();c(0,"ion-row",0)(1,"ion-col",1)(2,"ion-card")(3,"form",2),w("ngSubmit",function(){let i=T(e).$implicit,s=v();return x(s.submit(i))}),c(4,"ion-item",3)(5,"ion-label"),C(6),m()(),c(7,"ion-card-content"),E(8,"formly-form",4),c(9,"ion-item")(10,"ion-button",5),C(11," EDGE.CONFIG.APP.UPDATE_APP "),m(),c(12,"ion-button",6),w("click",function(){let i=T(e).$implicit,s=v();return x(s.submitDelete(i))}),C(13," EDGE.CONFIG.APP.DELETE_APP "),m(),G(14,fe,1,0,"div",7),E(15,"ngx-spinner",8),m()()()()()()}if(n&2){let e=a.$implicit,t=v();o(3),l("formGroup",e.form),o(3),U(t.appName),o(2),l("form",e.form)("fields",e.fields)("model",e.properties),o(2),l("disabled",!(!e.form.pristine&&e.form.valid)||e.isDeleting||e.isUpdating),o(2),l("disabled",e.isDeleting||e.isUpdating),o(2),N(e.isDeleting||e.isUpdating?14:-1),o(),l("name",e.instanceId)}}var He=(()=>{class n{static{this.SELECTOR="app-update"}constructor(e,t,i,s,r,u,I){this.route=e,this.utils=t,this.websocket=i,this.service=s,this.router=r,this.translate=u,this.alertCtrl=I,this.spinnerId=n.SELECTOR,this.instances=[],this.appName=null,this.edge=null}ngOnInit(){this.service.startSpinner(this.spinnerId);let e=this.route.snapshot.params.appId,t=this.route.snapshot.queryParams.name??this.service.currentPageTitle;this.service.setCurrentComponent(t,this.route).then(i=>{this.edge=i,i.sendRequest(this.websocket,new h({componentId:"_appManager",payload:new D.Request({appId:e})})).then(s=>{let r=s.result.instances;i.sendRequest(this.websocket,new h({componentId:"_appManager",payload:new A.Request({appId:e})})).then(u=>{let I=u.result;this.appName=I.name,this.instances=[];for(let S of r){let he=new V({}),P=y({ALIAS:S.alias},S.properties);this.instances.push({instanceId:S.instanceId,form:he,isDeleting:!1,isUpdating:!1,fields:A.setInitialModel(A.postprocess(structuredClone(I)).fields,structuredClone(P)),properties:P})}this.service.stopSpinner(this.spinnerId)}).catch(f.errorToast(this.service,u=>"Error while receiving App Assistant for ["+e+"]: "+u))}).catch(f.errorToast(this.service,s=>"Error while receiving App-Instances for ["+e+"]: "+s))})}submit(e){this.service.startSpinnerTransparentBackground(e.instanceId),e.isUpdating=!0;let t=e.form.value.ALIAS,i={};for(let s in e.form.value)s!="ALIAS"&&(i[s]=e.form.value[s]);e.form.markAsPristine(),this.edge.sendRequest(this.websocket,new h({componentId:"_appManager",payload:new R.Request({instanceId:e.instanceId,alias:t,properties:i})})).then(s=>{let r=s.result;r.warnings&&r.warnings.length>0?this.service.toast(r.warnings.join(";"),"warning"):this.service.toast(this.translate.instant("EDGE.CONFIG.APP.SUCCESS_UPDATE"),"success"),e.properties=r.instance.properties,e.properties.ALIAS=r.instance.alias}).catch(f.errorToast(this.service,s=>this.translate.instant("EDGE.CONFIG.APP.FAIL_UPDATE",{error:s}))).finally(()=>{e.isUpdating=!1,this.service.stopSpinner(e.instanceId)})}submitDelete(e){return F(this,null,function*(){let t=this.translate;(yield this.alertCtrl.create({subHeader:t.instant("EDGE.CONFIG.APP.DELETE_CONFIRM_HEADLINE"),message:t.instant("EDGE.CONFIG.APP.DELETE_CONFIRM_DESCRIPTION"),buttons:[{text:t.instant("GENERAL.CANCEL"),role:"cancel"},{text:t.instant("EDGE.CONFIG.APP.DELETE_CONFIRM"),handler:()=>this.delete(e)}],cssClass:"alertController"})).present()})}delete(e){this.service.startSpinnerTransparentBackground(e.instanceId),e.isDeleting=!0,this.edge.sendRequest(this.websocket,new h({componentId:"_appManager",payload:new _.Request({instanceId:e.instanceId})})).then(t=>{this.instances.splice(this.instances.indexOf(e),1),this.service.toast(this.translate.instant("EDGE.CONFIG.APP.SUCCESS_DELETE"),"success");let i={state:{appInstanceChange:!0}};this.router.navigate(["device/"+this.edge.id+"/settings/app/"],i)}).catch(f.errorToast(this.service,t=>this.translate.instant("EDGE.CONFIG.APP.FAIL_DELETE",{error:t}))).finally(()=>{e.isDeleting=!1,this.service.stopSpinner(e.instanceId)})}static{this.\u0275fac=function(t){return new(t||n)(p(k),p(pe),p(me),p(le),p(j),p(oe),p(ne))}}static{this.\u0275cmp=b({type:n,selectors:[["app-update"]],decls:4,vars:0,consts:[[1,"ion-justify-content-center"],["size","12","size-xl","8"],[3,"ngSubmit","formGroup"],["lines","full","color","primary"],[3,"form","fields","model"],["type","submit","color","primary","translate","",3,"disabled"],["color","primary","translate","",3,"click","disabled"],[2,"min-height","100px"],[3,"name"]],template:function(t,i){t&1&&(c(0,"ion-content")(1,"ion-grid"),M(2,Ie,16,9,"ion-row",0,O),m()()),t&2&&(o(2),q(i.instances))},dependencies:[ue,W,K,Q,X,Y,Z,ee,te,ie,ae,de,ce,z,B,J,$,H,re,se],encapsulation:2})}}return n})();export{He as a};
